<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­–ç•¥ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-left: 4px solid #007acc; }
        .success { border-color: #28a745; }
        .warning { border-color: #ffc107; }
        .error { border-color: #dc3545; }
        .code { background: #282c34; color: #abb2bf; padding: 10px; border-radius: 4px; font-family: 'Courier New', monospace; }
        button { padding: 10px 20px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a9e; }
        .test-step { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .test-result { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç­–ç•¥ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿé›†æˆæµ‹è¯•</h1>
    
    <div class="log success">
        <h3>âœ… ç³»ç»Ÿä¿®å¤å®Œæˆ</h3>
        <ul>
            <li>TypeScriptç¼–è¯‘é”™è¯¯å·²ä¿®å¤</li>
            <li>ç”Ÿäº§ç‰ˆæœ¬æ„å»ºæˆåŠŸ</li>
            <li>metadataå­—æ®µå®šä¹‰å®Œæ•´</li>
            <li>WebSocketæµå¼æ¶ˆæ¯å¤„ç†ä¼˜åŒ–</li>
        </ul>
    </div>
    
    <div class="test-step">
        <h3>æµ‹è¯•æ­¥éª¤ 1: å‰ç«¯ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h3>
        <p>æ£€æŸ¥ç”Ÿäº§ç¯å¢ƒæ˜¯å¦å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬</p>
        <button onclick="checkFrontendStatus()">æ£€æŸ¥å‰ç«¯çŠ¶æ€</button>
        <div id="frontend-status" class="test-result"></div>
    </div>
    
    <div class="test-step">
        <h3>æµ‹è¯•æ­¥éª¤ 2: AIä¼šè¯åˆ›å»ºæµ‹è¯•</h3>
        <p>åˆ›å»ºæ–°çš„AIä¼šè¯å¹¶æµ‹è¯•JWTè®¤è¯</p>
        <button onclick="testSessionCreation()">æµ‹è¯•ä¼šè¯åˆ›å»º</button>
        <div id="session-result" class="test-result"></div>
    </div>
    
    <div class="test-step">
        <h3>æµ‹è¯•æ­¥éª¤ 3: ç­–ç•¥ç”ŸæˆæˆåŠŸæ¶ˆæ¯æµ‹è¯•</h3>
        <p>æ¨¡æ‹Ÿç­–ç•¥ç”ŸæˆæˆåŠŸçš„æµå¼æ¶ˆæ¯</p>
        <button onclick="testStrategySuccessDetection()">æµ‹è¯•ç­–ç•¥æ£€æµ‹</button>
        <div id="strategy-result" class="test-result"></div>
    </div>
    
    <div class="test-step">
        <h3>æµ‹è¯•æ­¥éª¤ 4: å®Œæ•´æµç¨‹éªŒè¯</h3>
        <p>å®Œæ•´æµ‹è¯•ï¼šåˆ›å»ºä¼šè¯ â†’ AIç”Ÿæˆç­–ç•¥ â†’ ç‰ˆæœ¬æ§åˆ¶æŒ‰é’®æ˜¾ç¤º</p>
        <button onclick="window.open('http://43.167.252.120/ai-chat', '_blank')">ğŸš€ å®Œæ•´æµç¨‹æµ‹è¯•</button>
        <div class="log warning">
            <strong>æµ‹è¯•æŒ‡å—</strong>:
            <ol>
                <li>æ‰“å¼€AIèŠå¤©é¡µé¢</li>
                <li>è¾“å…¥ç­–ç•¥éœ€æ±‚ï¼Œå¦‚ï¼š"æˆ‘æƒ³è¦ä¸€ä¸ªMACDç­–ç•¥"</li>
                <li>ç¡®è®¤ç”Ÿæˆä»£ç </li>
                <li>è§‚å¯Ÿæ˜¯å¦å‡ºç°ç‰ˆæœ¬æ§åˆ¶æŒ‰é’®ï¼ˆç»¿è‰²å°æŒ‰é’®ï¼Œæ ‡è®°"ä»£ç "ï¼‰</li>
                <li>ç‚¹å‡»ç‰ˆæœ¬æŒ‰é’®æŸ¥çœ‹ç­–ç•¥ä»£ç </li>
            </ol>
        </div>
    </div>
    
    <h2>é¢„æœŸæµ‹è¯•ç»“æœ</h2>
    <div class="log success">
        <h3>âœ… æˆåŠŸæŒ‡æ ‡</h3>
        <ul>
            <li><strong>å‰ç«¯çŠ¶æ€</strong>: åº”æ˜¾ç¤ºæœ€æ–°çš„æ„å»ºç‰ˆæœ¬å’Œæ—¶é—´æˆ³</li>
            <li><strong>ä¼šè¯åˆ›å»º</strong>: JWTè®¤è¯æˆåŠŸï¼Œä¼šè¯IDæ­£ç¡®ç”Ÿæˆ</li>
            <li><strong>æ¶ˆæ¯æ£€æµ‹</strong>: ç­–ç•¥æˆåŠŸæ£€æµ‹é€»è¾‘æ­£ç¡®è¯†åˆ«ç›®æ ‡æ¶ˆæ¯</li>
            <li><strong>ç‰ˆæœ¬æŒ‰é’®</strong>: åœ¨"ç­–ç•¥ç”ŸæˆæˆåŠŸ"æ¶ˆæ¯æ—æ˜¾ç¤ºç»¿è‰²ç‰ˆæœ¬æŒ‰é’®</li>
            <li><strong>ä»£ç å±•ç¤º</strong>: ç‚¹å‡»æŒ‰é’®åæ­£ç¡®æ˜¾ç¤ºç­–ç•¥ä»£ç æ¨¡æ€æ¡†</li>
        </ul>
    </div>
    
    <h2>è°ƒè¯•æ—¥å¿—ç›‘æ§</h2>
    <div class="log">
        <h3>ğŸ” å…³é”®æ—¥å¿—æŒ‡æ ‡</h3>
        <p>åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š</p>
        <div class="code">
ğŸ“ [WebSocketClient] æµå¼AIæ•°æ®å—: âœ… **ç­–ç•¥ç”ŸæˆæˆåŠŸï¼**
âœ… [AIStore] æµå¼ç»“æŸ: ...
ğŸš€ [AIStore] ç«‹å³å¼ºåˆ¶æ›´æ–°messagesæ•°ç»„ä»¥è§¦å‘Reacté‡æ–°æ¸²æŸ“
[GlobalMessageTracker] æ¶ˆæ¯æ•°ç»„å‘ç”Ÿå˜åŒ–
ğŸ” [StrategyDetection] æ£€æµ‹åˆ°ç­–ç•¥æˆåŠŸæ¶ˆæ¯
ğŸ¯ [StrategyDetection] æ·»åŠ ç‰ˆæœ¬æ§åˆ¶æŒ‰é’®
        </div>
    </div>
    
    <script>
        const JWT_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2IiwiZW1haWwiOiJhZG1pbkB0cmFkZW1lLmNvbSIsIm1lbWJlcnNoaXBMZXZlbCI6InByb2Zlc3Npb25hbCIsInR5cGUiOiJhY2Nlc3MiLCJpYXQiOjE3NTc2Nzg5NzUsImV4cCI6MTc1ODI4Mzc3NSwiYXVkIjoidHJhZGVtZS1hcHAiLCJpc3MiOiJ0cmFkZW1lLXVzZXItc2VydmljZSJ9.wB3lgUgg70uoKIClv_Iq082CUqfd52XvALV1wU1JLoE';
        
        async function checkFrontendStatus() {
            const result = document.getElementById('frontend-status');
            result.innerHTML = 'æ£€æŸ¥ä¸­...';
            
            try {
                // æ£€æŸ¥æ„å»ºæ–‡ä»¶çš„æ—¶é—´æˆ³
                const response = await fetch('/');
                if (response.ok) {
                    result.innerHTML = `
                        <span class="success">âœ… å‰ç«¯çŠ¶æ€æ­£å¸¸</span><br>
                        æœ€åæ£€æŸ¥æ—¶é—´: ${new Date().toLocaleString()}<br>
                        å“åº”çŠ¶æ€: ${response.status}
                    `;
                } else {
                    result.innerHTML = `<span class="error">âŒ å‰ç«¯è®¿é—®å¼‚å¸¸: ${response.status}</span>`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ å‰ç«¯æ£€æŸ¥å¤±è´¥: ${error.message}</span>`;
            }
        }
        
        async function testSessionCreation() {
            const result = document.getElementById('session-result');
            result.innerHTML = 'åˆ›å»ºä¼šè¯ä¸­...';
            
            try {
                const response = await fetch('http://43.167.252.120:8001/api/v1/ai/sessions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${JWT_TOKEN}`
                    },
                    body: JSON.stringify({
                        name: 'Version Management Test Session',
                        ai_mode: 'trader',
                        session_type: 'strategy',
                        description: 'Testing strategy version management integration'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `
                        <span class="success">âœ… ä¼šè¯åˆ›å»ºæˆåŠŸ</span><br>
                        ä¼šè¯ID: ${data.session_id}<br>
                        æ¨¡å¼: ${data.ai_mode}<br>
                        ç±»å‹: ${data.session_type}
                    `;
                    
                    // å­˜å‚¨ä¼šè¯IDä¾›åç»­æµ‹è¯•ä½¿ç”¨
                    window.testSessionId = data.session_id;
                } else {
                    const errorText = await response.text();
                    result.innerHTML = `<span class="error">âŒ ä¼šè¯åˆ›å»ºå¤±è´¥: ${response.status} - ${errorText}</span>`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ ä¼šè¯åˆ›å»ºå¼‚å¸¸: ${error.message}</span>`;
            }
        }
        
        function testStrategySuccessDetection() {
            const result = document.getElementById('strategy-result');
            result.innerHTML = 'æµ‹è¯•ç­–ç•¥æ£€æµ‹é€»è¾‘...';
            
            // æ¨¡æ‹Ÿç­–ç•¥æˆåŠŸæ¶ˆæ¯æ£€æµ‹
            const testMessages = [
                'âœ… **ç­–ç•¥ç”ŸæˆæˆåŠŸï¼**',
                'ğŸ“Š **æ€§èƒ½è¯„çº§**: æœªçŸ¥ ğŸ“ˆ **ç­–ç•¥ä»£ç å·²ç”Ÿæˆå¹¶é€šè¿‡éªŒè¯**',
                'ç­–ç•¥ä»£ç å·²ç”Ÿæˆå¹¶é€šè¿‡éªŒè¯',
                'æ‚¨å¯ä»¥åœ¨ç­–ç•¥ç®¡ç†é¡µé¢æŸ¥çœ‹å’Œä½¿ç”¨ç”Ÿæˆçš„ç­–ç•¥'
            ];
            
            const detectionResults = testMessages.map(content => {
                const isStrategySuccess = (
                    content.includes('ç­–ç•¥ç”ŸæˆæˆåŠŸ') ||
                    content.includes('ç­–ç•¥ä»£ç å·²ç”Ÿæˆå¹¶é€šè¿‡éªŒè¯') ||
                    content.includes('âœ… **ç­–ç•¥ç”ŸæˆæˆåŠŸï¼**') ||
                    (content.includes('ğŸ“Š **æ€§èƒ½è¯„çº§**') && content.includes('ğŸ“ˆ **ç­–ç•¥ä»£ç å·²ç”Ÿæˆå¹¶é€šè¿‡éªŒè¯**')) ||
                    content.includes('æ‚¨å¯ä»¥åœ¨ç­–ç•¥ç®¡ç†é¡µé¢æŸ¥çœ‹å’Œä½¿ç”¨ç”Ÿæˆçš„ç­–ç•¥')
                );
                
                return {
                    content: content.substring(0, 50) + (content.length > 50 ? '...' : ''),
                    detected: isStrategySuccess
                };
            });
            
            const successCount = detectionResults.filter(r => r.detected).length;
            result.innerHTML = `
                <span class="${successCount > 0 ? 'success' : 'error'}">
                    ${successCount > 0 ? 'âœ…' : 'âŒ'} æ£€æµ‹ç»“æœ: ${successCount}/${detectionResults.length} ä¸ªæ¶ˆæ¯è¢«æ­£ç¡®è¯†åˆ«
                </span><br>
                <details>
                    <summary>è¯¦ç»†æ£€æµ‹ç»“æœ</summary>
                    <ul>
                        ${detectionResults.map(r => 
                            `<li>${r.detected ? 'âœ…' : 'âŒ'} ${r.content}</li>`
                        ).join('')}
                    </ul>
                </details>
            `;
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        console.log('ğŸ”§ [æµ‹è¯•é¡µé¢] ç­–ç•¥ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½');
        console.log('ğŸ“‹ [ä¿®å¤çŠ¶æ€] TypeScriptç¼–è¯‘é”™è¯¯å·²ä¿®å¤ï¼Œç”Ÿäº§ç‰ˆæœ¬å·²æ›´æ–°');
        console.log('ğŸ¯ [æµ‹è¯•ç›®æ ‡] éªŒè¯AIå¯¹è¯ä¸­çš„ç­–ç•¥ç‰ˆæœ¬æ§åˆ¶åŠŸèƒ½');
        
        // æ£€æµ‹å½“å‰ç¯å¢ƒ
        const isProduction = location.hostname === '43.167.252.120';
        console.log(`ğŸŒ [ç¯å¢ƒ] å½“å‰ç¯å¢ƒ: ${isProduction ? 'ç”Ÿäº§ç¯å¢ƒ' : 'å¼€å‘ç¯å¢ƒ'}`);
        
        if (isProduction) {
            console.log('ğŸ“ [æç¤º] è¯·ç‚¹å‡»"å®Œæ•´æµç¨‹æµ‹è¯•"è¿›è¡Œç«¯åˆ°ç«¯éªŒè¯');
        }
    </script>
</body>
</html>