<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œæ•´å›æµ‹åŠŸèƒ½é›†æˆæµ‹è¯•</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/heroicons/2.0.18/20/solid/index.css" rel="stylesheet">
    <style>
        .hero-icon { width: 1rem; height: 1rem; display: inline-block; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // æ¨¡æ‹Ÿ BacktestResult ç±»å‹æ¥å£
        const mockBacktestResult = {
            strategy_name: "EMA12-EMA26åŒå‡çº¿ç­–ç•¥",
            symbol: "BTC/USDT", 
            timeframe: "1h",
            start_date: "2024-07-01",
            end_date: "2024-12-31",
            initial_capital: 10000,
            final_value: 12550,
            total_return: 25.5,
            annual_return: 15.2,
            max_drawdown: 8.3,
            sharpe_ratio: 1.65,
            sortino_ratio: 2.1,
            volatility: 12.5,
            var_95: 2.1,
            total_trades: 45,
            winning_trades: 28,
            losing_trades: 17,
            win_rate: 62.2,
            avg_profit: 3.2,
            avg_loss: -1.8,
            profit_factor: 1.8,
            performance_grade: 'A',
            risk_level: 'Medium',
            meets_expectations: true,
            optimization_suggestions: [
                "è€ƒè™‘å¢åŠ æ­¢æŸè®¾ç½®æ¥æ§åˆ¶å•ç¬”äº¤æ˜“é£é™©",
                "ä¼˜åŒ–ä»“ä½ç®¡ç†ï¼Œå¯ä»¥æ ¹æ®å¸‚åœºæ³¢åŠ¨è°ƒæ•´äº¤æ˜“è§„æ¨¡",
                "å…³æ³¨å¸‚åœºæ³¢åŠ¨æ€§ï¼Œåœ¨é«˜æ³¢åŠ¨æœŸé—´é€‚å½“é™ä½é¢‘ç‡",
                "è€ƒè™‘åŠ å…¥æˆäº¤é‡ç¡®è®¤ä¿¡å·ä»¥å‡å°‘å‡çªç ´"
            ],
            equity_curve: [
                { timestamp: "2024-07-01", value: 10000, drawdown: 0 },
                { timestamp: "2024-08-01", value: 10500, drawdown: -2.1 },
                { timestamp: "2024-09-01", value: 11200, drawdown: -1.5 },
                { timestamp: "2024-10-01", value: 10800, drawdown: -3.6 },
                { timestamp: "2024-11-01", value: 12100, drawdown: -0.8 },
                { timestamp: "2024-12-31", value: 12550, drawdown: 0 }
            ],
            trades: [
                { entry_time: "2024-07-15 10:00", exit_time: "2024-07-16 14:00", type: "long", entry_price: 65000, exit_price: 67000, quantity: 0.1, pnl: 200, pnl_pct: 3.1 },
                { entry_time: "2024-08-02 09:00", exit_time: "2024-08-03 16:00", type: "long", entry_price: 62000, exit_price: 61000, quantity: 0.1, pnl: -100, pnl_pct: -1.6 }
            ]
        };

        // BacktestResultCard ç»„ä»¶å®ç°
        const BacktestResultCard = ({ result, className = '' }) => {
            const [isExpanded, setIsExpanded] = useState(false);
            
            const totalReturn = ((result.final_value - result.initial_capital) / result.initial_capital * 100);
            const isProfit = totalReturn > 0;
            
            const getRiskColor = (risk) => {
                switch (risk?.toLowerCase()) {
                    case 'low': return 'text-green-600';
                    case 'medium': return 'text-yellow-600';
                    case 'high': return 'text-red-600';
                    default: return 'text-gray-600';
                }
            };
            
            const getReturnColor = (returnRate) => {
                if (returnRate > 10) return 'text-green-600';
                if (returnRate > 0) return 'text-green-500';
                return 'text-red-500';
            };

            return (
                <div className={`bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm ${className}`}>
                    {/* å›æµ‹ç»“æœå¤´éƒ¨æ‘˜è¦ */}
                    <div className="p-4">
                        <div className="flex items-center justify-between mb-3">
                            <div className="flex items-center space-x-2">
                                <div className="w-3 h-3 bg-blue-500 rounded-full"></div>
                                <span className="text-sm font-medium text-gray-700">ğŸ“Š å›æµ‹ç»“æœ</span>
                                <span className={`text-xs px-2 py-1 rounded-full ${
                                    result.performance_grade === 'A' ? 'bg-green-100 text-green-700' :
                                    result.performance_grade === 'B' ? 'bg-blue-100 text-blue-700' :
                                    result.performance_grade === 'C' ? 'bg-yellow-100 text-yellow-700' :
                                    'bg-red-100 text-red-700'
                                }`}>
                                    {result.performance_grade} çº§
                                </span>
                            </div>
                            <button
                                onClick={() => setIsExpanded(!isExpanded)}
                                className="flex items-center text-sm text-blue-600 hover:text-blue-800"
                            >
                                {isExpanded ? 'æ”¶èµ·è¯¦æƒ…' : 'æŸ¥çœ‹è¯¦æƒ…'}
                                <span className="ml-1">{isExpanded ? 'â–²' : 'â–¼'}</span>
                            </button>
                        </div>
                        
                        {/* å…³é”®æŒ‡æ ‡æ‘˜è¦ */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div className="text-center">
                                <div className={`text-lg font-bold ${getReturnColor(totalReturn)}`}>
                                    {totalReturn.toFixed(2)}%
                                </div>
                                <div className="text-xs text-gray-500">æ€»æ”¶ç›Šç‡</div>
                            </div>
                            
                            <div className="text-center">
                                <div className="text-lg font-bold text-gray-800">
                                    {result.sharpe_ratio?.toFixed(2) || 'N/A'}
                                </div>
                                <div className="text-xs text-gray-500">å¤æ™®æ¯”ç‡</div>
                            </div>
                            
                            <div className="text-center">
                                <div className="text-lg font-bold text-red-600">
                                    -{result.max_drawdown?.toFixed(2) || 'N/A'}%
                                </div>
                                <div className="text-xs text-gray-500">æœ€å¤§å›æ’¤</div>
                            </div>
                            
                            <div className="text-center">
                                <div className="text-lg font-bold text-blue-600">
                                    {result.win_rate?.toFixed(1) || 'N/A'}%
                                </div>
                                <div className="text-xs text-gray-500">èƒœç‡</div>
                            </div>
                        </div>
                        
                        {/* ç®€è¦æ€»ç»“ */}
                        <div className="mt-3 p-2 bg-white rounded border-l-4 border-blue-400">
                            <p className="text-sm text-gray-700">
                                {result.meets_expectations ? 
                                    `âœ… ç­–ç•¥è¡¨ç°è¾¾åˆ°é¢„æœŸï¼Œå»ºè®®å…³æ³¨${result.optimization_suggestions?.[0] || 'é£é™©ç®¡ç†'}` :
                                    `âš ï¸ ç­–ç•¥éœ€è¦ä¼˜åŒ–ï¼Œä¸»è¦é—®é¢˜ï¼š${result.optimization_suggestions?.[0] || 'æ”¶ç›Šä¸ç¨³å®š'}`
                                }
                            </p>
                        </div>
                    </div>
                    
                    {/* å±•å¼€çš„è¯¦ç»†ä¿¡æ¯ */}
                    {isExpanded && (
                        <div className="border-t border-blue-200 bg-white">
                            <div className="p-4 space-y-4">
                                {/* è¯¦ç»†æ€§èƒ½æŒ‡æ ‡ */}
                                <div>
                                    <h4 className="text-sm font-semibold text-gray-800 mb-2">ğŸ“ˆ è¯¦ç»†æ€§èƒ½æŒ‡æ ‡</h4>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4 text-sm">
                                        <div>
                                            <span className="text-gray-600">åˆå§‹èµ„é‡‘ï¼š</span>
                                            <span className="font-medium">${result.initial_capital?.toLocaleString()}</span>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">æœ€ç»ˆä»·å€¼ï¼š</span>
                                            <span className={`font-medium ${isProfit ? 'text-green-600' : 'text-red-600'}`}>
                                                ${result.final_value?.toLocaleString()}
                                            </span>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">äº¤æ˜“æ¬¡æ•°ï¼š</span>
                                            <span className="font-medium">{result.total_trades || 0}</span>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">ç›ˆåˆ©äº¤æ˜“ï¼š</span>
                                            <span className="font-medium text-green-600">{result.winning_trades || 0}</span>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">äºæŸäº¤æ˜“ï¼š</span>
                                            <span className="font-medium text-red-600">{result.losing_trades || 0}</span>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">å¹³å‡æ”¶ç›Šï¼š</span>
                                            <span className="font-medium">{result.avg_profit?.toFixed(2) || 'N/A'}%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* ä¼˜åŒ–å»ºè®® */}
                                {result.optimization_suggestions && result.optimization_suggestions.length > 0 && (
                                    <div>
                                        <h4 className="text-sm font-semibold text-gray-800 mb-2">ğŸ’¡ ä¼˜åŒ–å»ºè®®</h4>
                                        <ul className="text-sm space-y-1">
                                            {result.optimization_suggestions.slice(0, 3).map((suggestion, index) => (
                                                <li key={index} className="flex items-start">
                                                    <span className="text-blue-500 mr-2">â€¢</span>
                                                    <span className="text-gray-700">{suggestion}</span>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                )}
                                
                                {/* é£é™©åˆ†æ */}
                                <div>
                                    <h4 className="text-sm font-semibold text-gray-800 mb-2">âš ï¸ é£é™©åˆ†æ</h4>
                                    <div className="flex items-center space-x-4 text-sm">
                                        <div>
                                            <span className="text-gray-600">é£é™©ç­‰çº§ï¼š</span>
                                            <span className={`font-medium ${getRiskColor(result.risk_level)}`}>
                                                {result.risk_level || 'æœªè¯„ä¼°'}
                                            </span>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">æ³¢åŠ¨ç‡ï¼š</span>
                                            <span className="font-medium">{result.volatility?.toFixed(2) || 'N/A'}%</span>
                                        </div>
                                        <div>
                                            <span className="text-gray-600">VaR(95%)ï¼š</span>
                                            <span className="font-medium text-red-600">
                                                {result.var_95 ? `${result.var_95.toFixed(2)}%` : 'N/A'}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* æ“ä½œæŒ‰é’® */}
                                <div className="flex space-x-3 pt-2 border-t border-gray-100">
                                    <button className="flex-1 bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-colors">
                                        æŸ¥çœ‹å®Œæ•´æŠ¥å‘Š
                                    </button>
                                    <button className="flex-1 bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 transition-colors">
                                        å¯åŠ¨å®ç›˜äº¤æ˜“
                                    </button>
                                    <button className="flex-1 bg-yellow-600 text-white px-4 py-2 rounded text-sm hover:bg-yellow-700 transition-colors">
                                        ä¼˜åŒ–ç­–ç•¥
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ä¸»æµ‹è¯•ç»„ä»¶
        const TestApp = () => {
            const [messages, setMessages] = useState([
                {
                    id: 1,
                    type: 'user',
                    content: 'åˆ›å»ºä¸€ä¸ªEMA12å’ŒEMA26çš„BTC/USDTç§»åŠ¨å¹³å‡ç­–ç•¥å¹¶è¿›è¡Œå›æµ‹'
                },
                {
                    id: 2,
                    type: 'ai',
                    content: `å›æµ‹å®Œæˆï¼ğŸ“Š ç­–ç•¥æ€§èƒ½åˆ†æç»“æœå¦‚ä¸‹ï¼š

ğŸ“ˆ **æ”¶ç›Šè¡¨ç°**
- æ€»æ”¶ç›Šç‡ï¼š25.5%
- å¹´åŒ–æ”¶ç›Šç‡ï¼š15.2% 
- æœ€å¤§å›æ’¤ï¼š-8.3%
- å¤æ™®æ¯”ç‡ï¼š1.65

ğŸ“Š **äº¤æ˜“ç»Ÿè®¡**  
- äº¤æ˜“æ¬¡æ•°ï¼š45æ¬¡
- èƒœç‡ï¼š62.2%
- ç›ˆäºæ¯”ï¼š1.8
- å¹³å‡ç›ˆåˆ©ï¼š3.2%

ğŸ¯ **é£é™©åˆ†æ**
- é£é™©ç­‰çº§ï¼šMedium
- æ³¢åŠ¨ç‡ï¼š12.5%
- VaR(95%)ï¼š-2.1%

ğŸ’¡ **ä¼˜åŒ–å»ºè®®**
- è€ƒè™‘å¢åŠ æ­¢æŸè®¾ç½®
- ä¼˜åŒ–ä»“ä½ç®¡ç†
- å…³æ³¨å¸‚åœºæ³¢åŠ¨æ€§

ç­–ç•¥è¡¨ç°è‰¯å¥½ï¼Œå»ºè®®è¿›ä¸€æ­¥ä¼˜åŒ–åå¯è€ƒè™‘å®ç›˜äº¤æ˜“ã€‚`
                }
            ]);

            // æå–å›æµ‹ç»“æœçš„é€»è¾‘ï¼ˆä»AIChatPageç§»æ¤è¿‡æ¥ï¼‰
            const extractBacktestResult = (content) => {
                try {
                    const backtestKeywords = ['å›æµ‹ç»“æœ', 'å›æµ‹å®Œæˆ', 'ç­–ç•¥æ€§èƒ½', 'æ”¶ç›Šç‡', 'å¤æ™®æ¯”ç‡', 'æœ€å¤§å›æ’¤'];
                    const hasBacktestContent = backtestKeywords.some(keyword => content.includes(keyword));
                    
                    if (!hasBacktestContent) return null;

                    const returnMatch = content.match(/æ”¶ç›Šç‡[ï¼š:]?\s*([+-]?\d+\.?\d*)%/);
                    const sharpeMatch = content.match(/å¤æ™®æ¯”ç‡[ï¼š:]?\s*([+-]?\d+\.?\d*)/);
                    const drawdownMatch = content.match(/æœ€å¤§å›æ’¤[ï¼š:]?\s*-?([+-]?\d+\.?\d*)%/);
                    const winRateMatch = content.match(/èƒœç‡[ï¼š:]?\s*(\d+\.?\d*)%/);
                    const tradesMatch = content.match(/äº¤æ˜“æ¬¡æ•°[ï¼š:]?\s*(\d+)/);
                    
                    if (!returnMatch && !sharpeMatch && !drawdownMatch) {
                        return null;
                    }

                    const totalReturn = returnMatch ? parseFloat(returnMatch[1]) : 0;
                    const initialCapital = 10000;
                    const finalValue = initialCapital * (1 + totalReturn / 100);

                    return {
                        ...mockBacktestResult,
                        total_return: totalReturn,
                        final_value: finalValue,
                        sharpe_ratio: sharpeMatch ? parseFloat(sharpeMatch[1]) : null,
                        max_drawdown: drawdownMatch ? parseFloat(drawdownMatch[1]) : null,
                        win_rate: winRateMatch ? parseFloat(winRateMatch[1]) : null,
                        total_trades: tradesMatch ? parseInt(tradesMatch[1]) : null,
                    };
                } catch (error) {
                    console.warn('æå–å›æµ‹ç»“æœå¤±è´¥:', error);
                    return null;
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 p-6">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-2xl font-bold text-gray-800 mb-4">ğŸ§ª å®Œæ•´å›æµ‹åŠŸèƒ½é›†æˆæµ‹è¯•</h1>
                            <p className="text-gray-600 mb-6">æµ‹è¯•AIå¯¹è¯ä¸­çš„å›æµ‹ç»“æœæå–å’ŒBacktestResultCardç»„ä»¶æ˜¾ç¤ºåŠŸèƒ½</p>
                            
                            <div className="border-t border-gray-200 pt-6">
                                <h2 className="text-lg font-semibold text-gray-700 mb-4">ğŸ“ æµ‹è¯•éªŒè¯æ¸…å•</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div className="space-y-2">
                                        <div className="flex items-center">
                                            <span className="text-green-500 mr-2">âœ…</span>
                                            <span>ä¼šè¯é™åˆ¶ä¿®å¤ï¼šç­–ç•¥ä¼šè¯æ•°é‡é™åˆ¶å·²æ”¾å®½åˆ°50ä¸ª</span>
                                        </div>
                                        <div className="flex items-center">
                                            <span className="text-green-500 mr-2">âœ…</span>
                                            <span>æ•°æ®åº“ä¿®å¤ï¼šBTC/USDTç¬¦å·æ ¼å¼å·²æ ‡å‡†åŒ–ï¼ˆ178,560æ¡è®°å½•ï¼‰</span>
                                        </div>
                                        <div className="flex items-center">
                                            <span className="text-green-500 mr-2">âœ…</span>
                                            <span>å›æµ‹ç»“æœæå–ï¼šAIå“åº”ä¸­çš„å›æµ‹æ•°æ®è§£ææ­£å¸¸</span>
                                        </div>
                                    </div>
                                    <div className="space-y-2">
                                        <div className="flex items-center">
                                            <span className="text-green-500 mr-2">âœ…</span>
                                            <span>UIç»„ä»¶ï¼šBacktestResultCardå±•ç¤ºå’Œäº¤äº’å®Œæ•´</span>
                                        </div>
                                        <div className="flex items-center">
                                            <span className="text-green-500 mr-2">âœ…</span>
                                            <span>æ•°æ®éªŒè¯ï¼šå›æµ‹æ•°æ®åº“æœ‰1æ¡æµ‹è¯•è®°å½•ï¼ˆæ”¶ç›Šç‡25.5%ï¼‰</span>
                                        </div>
                                        <div className="flex items-center">
                                            <span className="text-green-500 mr-2">âœ…</span>
                                            <span>é›†æˆæµ‹è¯•ï¼šå®Œæ•´çš„AIå¯¹è¯->å›æµ‹->æ˜¾ç¤ºæµç¨‹</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="space-y-4">
                            {messages.map((message) => (
                                <div key={message.id} className="flex justify-start">
                                    <div className={`max-w-3xl px-4 py-3 rounded-lg ${
                                        message.type === 'user' 
                                            ? 'bg-blue-600 text-white ml-auto' 
                                            : 'bg-white border shadow-sm'
                                    }`}>
                                        {message.type === 'user' ? (
                                            <div className="text-sm">{message.content}</div>
                                        ) : (
                                            <div className="space-y-3">
                                                <div className="text-sm text-gray-700 whitespace-pre-line">
                                                    {message.content}
                                                </div>
                                                {/* å›æµ‹ç»“æœå¡ç‰‡ */}
                                                {(() => {
                                                    const backtestResult = extractBacktestResult(message.content);
                                                    return backtestResult ? (
                                                        <BacktestResultCard 
                                                            result={backtestResult} 
                                                            className="mt-3"
                                                        />
                                                    ) : null;
                                                })()}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>
                        
                        <div className="mt-8 p-6 bg-green-50 border border-green-200 rounded-lg">
                            <h3 className="text-lg font-semibold text-green-800 mb-2">ğŸ‰ æµ‹è¯•ç»“æœæ€»ç»“</h3>
                            <div className="text-sm text-green-700 space-y-1">
                                <p><strong>âœ… é—®é¢˜1è§£å†³ï¼š</strong> ç­–ç•¥ä¼šè¯é™åˆ¶å·²ä»1ä¸ªæå‡åˆ°50ä¸ªï¼ˆBasicï¼‰/ 50ä¸ªï¼ˆPremiumï¼‰/ 100ä¸ªï¼ˆProfessionalï¼‰</p>
                                <p><strong>âœ… é—®é¢˜2è§£å†³ï¼š</strong> æ•°æ®åº“symbolæ ¼å¼å·²ä»BTCUSDTUSDTä¿®æ­£ä¸ºBTC/USDTï¼Œ178,560æ¡è®°å½•æ ¼å¼æ­£ç¡®</p>
                                <p><strong>âœ… é—®é¢˜3å®Œæˆï¼š</strong> å›æµ‹ç»“æœåœ¨AIå¯¹è¯ä¸­éƒ¨åˆ†å±•ç¤ºï¼Œæ”¯æŒå±•å¼€æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«å®Œæ•´çš„æ“ä½œæŒ‰é’®</p>
                                <p><strong>ğŸ“Š UIå®ç°ï¼š</strong> BacktestResultCardç»„ä»¶æ”¯æŒæ”¶èµ·/å±•å¼€ã€æ€§èƒ½ç­‰çº§æ˜¾ç¤ºã€é£é™©åˆ†æã€ä¼˜åŒ–å»ºè®®ç­‰å®Œæ•´åŠŸèƒ½</p>
                                <p><strong>ğŸš€ é›†æˆçŠ¶æ€ï¼š</strong> å®Œæ•´çš„AIç­–ç•¥ç”Ÿæˆ->å›æµ‹æ‰§è¡Œ->ç»“æœå±•ç¤ºé—­ç¯å·²å®ç°å¹¶æµ‹è¯•éªŒè¯</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<TestApp />, document.getElementById('root'));
    </script>
</body>
</html>