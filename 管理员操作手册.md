# Trademe å¹³å°ç®¡ç†å‘˜æ“ä½œæ‰‹å†Œ

## ğŸ” ç®¡ç†å‘˜ç™»å½•

### ç®¡ç†å‘˜è´¦å·ä¿¡æ¯
- **é‚®ç®±**: `admin@trademe.com`
- **å½“å‰å¯†ç **: `admin123456`
- **æƒé™**: ç³»ç»Ÿç®¡ç†å‘˜ (ADMIN_EMAILé…ç½®)

#### ğŸ”’ å¯†ç å†å²è®°å½•
- `password123` - 2025-08-21 (åˆå§‹å¼€å‘é˜¶æ®µ)
- `Admin123!` - 2025-08-22 (create_admin.jsè„šæœ¬è®¾ç½®)
- `admin123456` - 2025-08-24 (å½“å‰ä½¿ç”¨ï¼ŒbcryptåŠ å¯†å­˜å‚¨)

### ç™»å½•æ­¥éª¤
1. è®¿é—® `http://43.167.252.120/login`
2. è¾“å…¥ç®¡ç†å‘˜é‚®ç®±å’Œå¯†ç 
3. ç™»å½•æˆåŠŸåï¼Œå¯¼èˆªæ ä¼šæ˜¾ç¤º"ç®¡ç†é¢æ¿"å…¥å£

---

## ğŸ›  ç®¡ç†é¢æ¿åŠŸèƒ½

### 1. ç”¨æˆ·ç®¡ç†
**è·¯å¾„**: `/admin/users`

#### ç”¨æˆ·åˆ—è¡¨æŸ¥çœ‹
- æ˜¾ç¤ºæ‰€æœ‰æ³¨å†Œç”¨æˆ·
- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ (ID, ç”¨æˆ·å, é‚®ç®±, æ³¨å†Œæ—¶é—´)
- ç”¨æˆ·çŠ¶æ€ (æ¿€æ´»/ç¦ç”¨)
- ä¼šå‘˜ç­‰çº§ (BASIC/PREMIUM)

#### ç”¨æˆ·æ“ä½œ
- **æŸ¥çœ‹è¯¦æƒ…**: ç‚¹å‡»ç”¨æˆ·æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
- **ç¦ç”¨ç”¨æˆ·**: ä¸´æ—¶ç¦æ­¢ç”¨æˆ·ç™»å½•
- **æ¿€æ´»ç”¨æˆ·**: é‡æ–°æ¿€æ´»è¢«ç¦ç”¨çš„ç”¨æˆ·
- **å‡çº§ä¼šå‘˜**: è°ƒæ•´ç”¨æˆ·ä¼šå‘˜ç­‰çº§

### 2. ç³»ç»Ÿç›‘æ§
**è·¯å¾„**: `/admin/system`

#### æœåŠ¡çŠ¶æ€ç›‘æ§
```bash
# æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
sudo systemctl status nginx
sudo systemctl status redis
ps aux | grep "node.*user-service"
ps aux | grep "uvicorn.*trading-service"
```

#### ç³»ç»Ÿèµ„æºç›‘æ§
- **CPUä½¿ç”¨ç‡**: `top` æˆ– `htop`
- **å†…å­˜ä½¿ç”¨**: `free -h`
- **ç£ç›˜ç©ºé—´**: `df -h`
- **ç½‘ç»œè¿æ¥**: `netstat -tlnp`

#### æ—¥å¿—æŸ¥çœ‹
```bash
# ç”¨æˆ·æœåŠ¡æ—¥å¿—
tail -f /root/trademe/backend/user-service/logs/combined.log

# Nginxè®¿é—®æ—¥å¿—  
tail -f /var/log/nginx/trademe_access.log

# Nginxé”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/trademe_error.log

# äº¤æ˜“æœåŠ¡æ—¥å¿— (åå°è¿›ç¨‹)
# æŸ¥çœ‹FastAPIæœåŠ¡è¾“å‡º
```

### 3. æ•°æ®åº“ç®¡ç†

#### ç”¨æˆ·æ•°æ®æŸ¥è¯¢
```sql
-- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
SELECT id, username, email, membership_level, created_at 
FROM users ORDER BY created_at DESC;

-- æŸ¥çœ‹ç”¨æˆ·ç™»å½•ç»Ÿè®¡
SELECT email, last_login_at, created_at 
FROM users WHERE last_login_at IS NOT NULL;

-- æŸ¥çœ‹ä¼šå‘˜åˆ†å¸ƒ
SELECT membership_level, COUNT(*) as count 
FROM users GROUP BY membership_level;
```

#### äº¤æ˜“æ•°æ®ç»Ÿè®¡
```sql
-- æŸ¥çœ‹ç­–ç•¥ç»Ÿè®¡
SELECT COUNT(*) as total_strategies FROM strategies;

-- æŸ¥çœ‹å›æµ‹ç»Ÿè®¡
SELECT status, COUNT(*) as count 
FROM backtests GROUP BY status;

-- æŸ¥çœ‹äº¤æ˜“è®°å½•ç»Ÿè®¡
SELECT trade_type, COUNT(*) as count, SUM(total_amount) as volume
FROM trades GROUP BY trade_type;
```

#### ç³»ç»Ÿé…ç½®ç®¡ç†
```sql
-- æŸ¥çœ‹ç³»ç»Ÿé…ç½®
SELECT key, value, description FROM system_configs 
WHERE is_public = true;

-- æ›´æ–°ç³»ç»Ÿé…ç½®
UPDATE system_configs 
SET value = 'new_value' 
WHERE key = 'config_key';
```

---

## ğŸ”§ ç³»ç»Ÿç»´æŠ¤æ“ä½œ

### 1. æœåŠ¡é‡å¯

#### é‡å¯ç”¨æˆ·æœåŠ¡
```bash
# åœæ­¢å½“å‰æœåŠ¡
pkill -f "node.*user-service"

# é‡æ–°å¯åŠ¨
cd /root/trademe/backend/user-service
npm run dev > /dev/null 2>&1 &
```

#### é‡å¯äº¤æ˜“æœåŠ¡
```bash
# åœæ­¢å½“å‰æœåŠ¡  
pkill -f "uvicorn.*trading-service"

# é‡æ–°å¯åŠ¨
cd /root/trademe/backend/trading-service
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8001 --log-level info > /dev/null 2>&1 &
```

#### é‡å¯Nginx
```bash
sudo systemctl reload nginx
# æˆ–è€…
sudo systemctl restart nginx
```

### 2. æ•°æ®åº“ç»´æŠ¤

#### æ•°æ®åº“å¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p /root/trademe/backups

# å¤‡ä»½SQLiteæ•°æ®åº“
cp /root/trademe/backend/user-service/prisma/data/trademe.db \
   /root/trademe/backups/trademe_backup_$(date +%Y%m%d_%H%M%S).db
```

#### æ•°æ®åº“ä¼˜åŒ–
```sql
-- è¿æ¥æ•°æ®åº“
sqlite3 /root/trademe/backend/user-service/prisma/data/trademe.db

-- æ¸…ç†æ•°æ®åº“
VACUUM;

-- é‡æ–°ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯
ANALYZE;

-- æ£€æŸ¥æ•°æ®åº“å®Œæ•´æ€§
PRAGMA integrity_check;
```

### 3. æ—¥å¿—ç®¡ç†

#### æ—¥å¿—è½®è½¬è®¾ç½®
```bash
# åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½®
sudo tee /etc/logrotate.d/trademe << EOF
/var/log/nginx/trademe_*.log {
    daily
    missingok
    rotate 30
    compress
    notifempty
    create 644 www-data www-data
    postrotate
        systemctl reload nginx > /dev/null 2>&1
    endscript
}

/root/trademe/backend/user-service/logs/*.log {
    daily
    missingok  
    rotate 30
    compress
    notifempty
    create 644 root root
}
EOF
```

#### æ¸…ç†æ—§æ—¥å¿—
```bash
# æ¸…ç†7å¤©å‰çš„æ—¥å¿—
find /root/trademe/backend/user-service/logs/ -name "*.log" -mtime +7 -delete
find /var/log/nginx/ -name "trademe_*.log.*" -mtime +30 -delete
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

### 1. ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡

#### æœåŠ¡å™¨èµ„æºç›‘æ§
```bash
# CPUå’Œå†…å­˜ç›‘æ§
htop

# ç£ç›˜I/Oç›‘æ§  
iotop

# ç½‘ç»œç›‘æ§
iftop

# è¿›ç¨‹ç›‘æ§
ps aux | grep -E "(node|python|nginx)"
```

#### æ•°æ®åº“æ€§èƒ½
```sql
-- æŸ¥çœ‹æ•°æ®åº“å¤§å°
SELECT 
  name,
  file_size / (1024 * 1024) as size_mb
FROM (
  SELECT 'main' as name, 
         (SELECT page_count * page_size FROM pragma_page_count(), pragma_page_size()) as file_size
);

-- æŸ¥çœ‹è¡¨è¡Œæ•°ç»Ÿè®¡
SELECT 
  name,
  (SELECT COUNT(*) FROM sqlite_master WHERE name = t.name) as row_count
FROM sqlite_master t WHERE type = 'table';
```

### 2. APIæ€§èƒ½ç›‘æ§

#### å“åº”æ—¶é—´ç»Ÿè®¡
```bash
# æ£€æŸ¥APIå“åº”æ—¶é—´
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:3001/health

# åˆ›å»ºcurlæ ¼å¼æ–‡ä»¶
cat > curl-format.txt << EOF
     time_namelookup:  %{time_namelookup}\n
        time_connect:  %{time_connect}\n
     time_appconnect:  %{time_appconnect}\n
    time_pretransfer:  %{time_pretransfer}\n
       time_redirect:  %{time_redirect}\n
  time_starttransfer:  %{time_starttransfer}\n
                     ----------\n
          time_total:  %{time_total}\n
EOF
```

#### å¹¶å‘æµ‹è¯•
```bash  
# å®‰è£…Apache Bench
sudo apt-get install apache2-utils

# å¹¶å‘æµ‹è¯•ç™»å½•API
ab -n 100 -c 10 -p login.json -T application/json \
   http://43.167.252.120/api/v1/auth/login

# åˆ›å»ºæµ‹è¯•æ•°æ®
cat > login.json << EOF
{"email":"demo@trademe.com","password":"Demo123!"}
EOF
```

---

## ğŸš¨ æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜è¯Šæ–­

#### ç½‘ç«™æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥NginxçŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep :80

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æµ‹è¯•æœ¬åœ°è®¿é—®
curl -I http://localhost
```

#### APIè°ƒç”¨å¤±è´¥  
```bash
# æ£€æŸ¥ç”¨æˆ·æœåŠ¡
curl http://localhost:3001/health

# æ£€æŸ¥äº¤æ˜“æœåŠ¡  
curl http://localhost:8001/health

# æ£€æŸ¥æœåŠ¡è¿›ç¨‹
ps aux | grep -E "(node|uvicorn)"
```

#### æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -la /root/trademe/backend/user-service/prisma/data/

# æµ‹è¯•æ•°æ®åº“è¿æ¥
sqlite3 /root/trademe/backend/user-service/prisma/data/trademe.db ".tables"

# æ£€æŸ¥Redisè¿æ¥
redis-cli ping
```

### 2. é”™è¯¯æ—¥å¿—åˆ†æ

#### åˆ†æç”¨æˆ·æœåŠ¡é”™è¯¯
```bash
# æŸ¥çœ‹æœ€æ–°é”™è¯¯
grep "error" /root/trademe/backend/user-service/logs/combined.log | tail -10

# åˆ†æCORSé”™è¯¯
grep "CORS" /root/trademe/backend/user-service/logs/combined.log

# åˆ†æè®¤è¯é”™è¯¯
grep -E "(login|auth)" /root/trademe/backend/user-service/logs/combined.log | grep error
```

#### åˆ†æNginxé”™è¯¯
```bash
# æŸ¥çœ‹æœ€æ–°é”™è¯¯
tail -20 /var/log/nginx/trademe_error.log

# åˆ†æè®¿é—®æ¨¡å¼
awk '{print $1}' /var/log/nginx/trademe_access.log | sort | uniq -c | sort -nr
```

---

## ğŸ”’ å®‰å…¨ç®¡ç†

### 1. ç”¨æˆ·å®‰å…¨

#### å¯†ç ç­–ç•¥
- æœ€å°é•¿åº¦: 8ä½
- å¿…é¡»åŒ…å«: å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦
- å¯†ç åŠ å¯†å­˜å‚¨ (bcrypt)

#### ä¼šè¯ç®¡ç†
```sql
-- æŸ¥çœ‹æ´»è·ƒä¼šè¯
SELECT user_id, expires_at, created_at 
FROM user_sessions 
WHERE expires_at > datetime('now');

-- æ¸…ç†è¿‡æœŸä¼šè¯
DELETE FROM user_sessions 
WHERE expires_at <= datetime('now');
```

### 2. APIå®‰å…¨

#### é€Ÿç‡é™åˆ¶é…ç½®
```javascript
// å½“å‰é…ç½® (ç”¨æˆ·æœåŠ¡)
RATE_LIMIT_WINDOW=15  // 15åˆ†é’Ÿçª—å£
RATE_LIMIT_MAX=100    // æœ€å¤š100æ¬¡è¯·æ±‚
```

#### CORSé…ç½®ç®¡ç†
```bash
# æŸ¥çœ‹å½“å‰CORSé…ç½®
grep ALLOWED_ORIGINS /root/trademe/backend/user-service/.env

# ç”Ÿäº§ç¯å¢ƒå»ºè®®é™åˆ¶æ¥æº
ALLOWED_ORIGINS=http://43.167.252.120
```

### 3. ç³»ç»Ÿå®‰å…¨

#### æ–‡ä»¶æƒé™æ£€æŸ¥
```bash
# æ£€æŸ¥å…³é”®æ–‡ä»¶æƒé™
ls -la /root/trademe/backend/user-service/.env
ls -la /root/trademe/backend/user-service/prisma/data/trademe.db

# è®¾ç½®å®‰å…¨æƒé™
chmod 600 /root/trademe/backend/user-service/.env
chmod 644 /root/trademe/backend/user-service/prisma/data/trademe.db
```

#### SSL/HTTPSé…ç½® (ç”Ÿäº§ç¯å¢ƒ)
```bash
# ä½¿ç”¨Let's Encryptç”³è¯·è¯ä¹¦
sudo apt-get install certbot python3-certbot-nginx
sudo certbot --nginx -d yourdomain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ : 0 12 * * * /usr/bin/certbot renew --quiet
```

---

## ğŸ“‹ ç»´æŠ¤æ¸…å•

### æ¯æ—¥æ£€æŸ¥
- [ ] æ£€æŸ¥æ‰€æœ‰æœåŠ¡è¿è¡ŒçŠ¶æ€
- [ ] æŸ¥çœ‹é”™è¯¯æ—¥å¿—
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´ä½¿ç”¨
- [ ] éªŒè¯ç½‘ç«™æ­£å¸¸è®¿é—®

### æ¯å‘¨æ£€æŸ¥  
- [ ] æ•°æ®åº“å¤‡ä»½
- [ ] æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶
- [ ] æ›´æ–°ç³»ç»Ÿå®‰å…¨è¡¥ä¸
- [ ] æ£€æŸ¥ç”¨æˆ·æ³¨å†Œ/ç™»å½•è¶‹åŠ¿

### æ¯æœˆæ£€æŸ¥
- [ ] ç³»ç»Ÿæ€§èƒ½åˆ†æ
- [ ] æ•°æ®åº“ä¼˜åŒ– (VACUUM, ANALYZE)
- [ ] å®‰å…¨å®¡è®¡
- [ ] å¤‡ä»½æ–‡ä»¶å½’æ¡£

---

## ğŸ“ ç´§æ€¥è”ç³»

### ç³»ç»Ÿæ•…éšœå¤„ç†
1. **æœåŠ¡ä¸­æ–­**: ç«‹å³é‡å¯ç›¸å…³æœåŠ¡
2. **æ•°æ®æŸå**: ä»æœ€æ–°å¤‡ä»½æ¢å¤
3. **å®‰å…¨äº‹ä»¶**: æš‚åœæœåŠ¡ï¼Œåˆ†ææ—¥å¿—
4. **æ€§èƒ½é—®é¢˜**: æ£€æŸ¥èµ„æºä½¿ç”¨ï¼Œä¼˜åŒ–é…ç½®

### è”ç³»æ–¹å¼
- **æŠ€æœ¯è´Ÿè´£äºº**: ç³»ç»Ÿç®¡ç†å‘˜
- **æœåŠ¡å™¨ä½ç½®**: è…¾è®¯äº‘ (43.167.252.120)
- **å¤‡ä»½ä½ç½®**: `/root/trademe/backups/`

---

**æ–‡æ¡£æ›´æ–°**: 2025å¹´8æœˆ20æ—¥  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª