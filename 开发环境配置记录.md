# Trademe å¼€å‘ç¯å¢ƒé…ç½®è®°å½•

**è®°å½•æ—¶é—´**: 2025-08-21 19:24  
**ç¯å¢ƒçŠ¶æ€**: ç”Ÿäº§å°±ç»ªï¼Œæ”¯æŒå…¬ç½‘çƒ­æ›´æ–°è°ƒè¯•  
**å…¬ç½‘åœ°å€**: http://43.167.252.120

## ğŸŒ ç³»ç»Ÿæ¦‚è§ˆ

### æœåŠ¡å™¨ä¿¡æ¯
- **å…¬ç½‘IP**: 43.167.252.120 (è…¾è®¯äº‘)
- **é…ç½®**: 4æ ¸8GBï¼ŒUbuntu 22.04
- **é¡¹ç›®è·¯å¾„**: `/root/trademe`
- **Nginxé…ç½®**: `/etc/nginx/sites-available/trademe.one`

### ä¸‰å±‚æœåŠ¡æ¶æ„
```
ğŸŒ å…¬ç½‘è®¿é—® (43.167.252.120:80)
    â†“ Nginxåå‘ä»£ç†
    â”œâ”€â”€ å‰ç«¯æœåŠ¡ (127.0.0.1:3000) â† Viteå¼€å‘æœåŠ¡å™¨ + HMR
    â”œâ”€â”€ ç”¨æˆ·æœåŠ¡ (127.0.0.1:3001) â† Node.js + Express
    â””â”€â”€ äº¤æ˜“æœåŠ¡ (127.0.0.1:8001) â† Python + FastAPI
```

## ğŸ”§ è¯¦ç»†é…ç½®

### 1. å‰ç«¯æœåŠ¡ (React + Vite)
**ç«¯å£**: 3000  
**è¿›ç¨‹**: npm run dev  
**ç‰¹æ€§**: çƒ­æ¨¡å—æ›¿æ¢ (HMR) + React Fast Refresh

**å…³é”®é…ç½®** (`vite.config.ts`):
```typescript
export default defineConfig({
  server: {
    port: 3000,
    host: '0.0.0.0'  // ç¡®ä¿IPv4ç»‘å®šï¼Œæ”¯æŒNginxä»£ç†
  }
})
```

**çƒ­æ›´æ–°æœºåˆ¶**:
- Viteç›‘å¬æ–‡ä»¶å˜åŒ–
- WebSocketè¿æ¥å®ç°å®æ—¶é€šä¿¡
- é€šè¿‡Nginxä»£ç†æ”¯æŒå…¬ç½‘çƒ­æ›´æ–°è®¿é—®

### 2. ç”¨æˆ·æœåŠ¡ (Node.js + Express)
**ç«¯å£**: 3001  
**è¿›ç¨‹**: nodemon + ts-node  
**æ•°æ®åº“**: SQLite + Prisma ORM  
**åŠŸèƒ½**: ç”¨æˆ·è®¤è¯ã€JWTç®¡ç†ã€ä¼šå‘˜ç³»ç»Ÿ

**å¥åº·æ£€æŸ¥ç«¯ç‚¹**: http://localhost:3001/health
```json
{
  "status": "ok",
  "services": {
    "database": "healthy",
    "redis": "healthy", 
    "upload": "healthy",
    "email": "healthy"
  }
}
```

### 3. äº¤æ˜“æœåŠ¡ (Python + FastAPI)
**ç«¯å£**: 8001  
**è¿›ç¨‹**: uvicorn --reload  
**åŠŸèƒ½**: ç­–ç•¥ç®¡ç†ã€å›æµ‹å¼•æ“ã€AIå¯¹è¯

**å¯åŠ¨å‚æ•°**:
```bash
PYTHONPATH=/root/trademe/backend/trading-service \
uvicorn app.main:app --host 0.0.0.0 --port 8001 --reload
```

**å¥åº·æ£€æŸ¥ç«¯ç‚¹**: http://localhost:8001/health
```json
{
  "status": "healthy",
  "timestamp": 1755775437.24,
  "environment": "development"
}
```

### 4. Nginxåå‘ä»£ç†é…ç½®
**é…ç½®æ–‡ä»¶**: `/etc/nginx/sites-available/trademe.one`

**å…³é”®é…ç½®æ®µ**:
```nginx
# å‰ç«¯å¼€å‘æœåŠ¡å™¨ä»£ç† (æ”¯æŒçƒ­æ›´æ–°)
upstream frontend {
    server 127.0.0.1:3000;
}

# ç”¨æˆ·æœåŠ¡APIä»£ç†  
upstream user_service {
    server 127.0.0.1:3001;
}

# äº¤æ˜“æœåŠ¡APIä»£ç†
upstream trading_service {
    server 127.0.0.1:8001;
}

server {
    listen 80;
    server_name 43.167.252.120;

    # å‰ç«¯åº”ç”¨ (æ”¯æŒWebSocketçƒ­æ›´æ–°)
    location / {
        proxy_pass http://frontend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_cache_bypass $http_upgrade;
    }

    # ç”¨æˆ·æœåŠ¡API
    location /api/v1/ {
        proxy_pass http://user_service/api/v1/;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
    }

    # äº¤æ˜“æœåŠ¡API
    location /trading/api/v1/ {
        proxy_pass http://trading_service/api/v1/;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
    }

    # å¥åº·æ£€æŸ¥
    location /health {
        return 200 'healthy';
        add_header Content-Type text/plain;
    }
}
```

## ğŸš€ å¯åŠ¨æµç¨‹

### è‡ªåŠ¨åŒ–å¯åŠ¨è„šæœ¬
**æ–‡ä»¶**: `/root/trademe/start-dev.sh`

**æ‰§è¡Œæ­¥éª¤**:
1. æ¸…ç†ç«¯å£å ç”¨ (3000, 3001, 8001)
2. éªŒè¯Nginxé…ç½®
3. å¯åŠ¨äº¤æ˜“æœåŠ¡ (Python FastAPI)
4. å¯åŠ¨ç”¨æˆ·æœåŠ¡ (Node.js Express)  
5. å¯åŠ¨å‰ç«¯æœåŠ¡ (React Vite + HMR)
6. é‡æ–°åŠ è½½Nginxé…ç½®
7. éªŒè¯æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€
8. æµ‹è¯•å…¬ç½‘è®¿é—®å’Œçƒ­æ›´æ–°åŠŸèƒ½

**ä½¿ç”¨æ–¹æ³•**:
```bash
cd /root/trademe
chmod +x start-dev.sh
./start-dev.sh
```

### åœæ­¢è„šæœ¬
**æ–‡ä»¶**: `/root/trademe/stop-dev.sh`
```bash
cd /root/trademe
./stop-dev.sh
```

## ğŸ”¥ çƒ­æ›´æ–°è°ƒè¯•åŠŸèƒ½

### å‰ç«¯çƒ­æ›´æ–°
- **æ–‡ä»¶ç›‘å¬**: Viteç›‘å¬ `src/` ç›®å½•
- **å³æ—¶æ›´æ–°**: ä¿®æ”¹Reactç»„ä»¶ç«‹å³ç”Ÿæ•ˆ
- **çŠ¶æ€ä¿æŒ**: ç»„ä»¶çŠ¶æ€åœ¨æ›´æ–°ä¸­ä¿æŒ
- **é”™è¯¯æ˜¾ç¤º**: è¯­æ³•é”™è¯¯åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤º

### åç«¯è‡ªåŠ¨é‡å¯
- **ç”¨æˆ·æœåŠ¡**: nodemonç›‘å¬TypeScriptæ–‡ä»¶å˜åŒ–
- **äº¤æ˜“æœåŠ¡**: uvicornç›‘å¬Pythonæ–‡ä»¶å˜åŒ–
- **é‡å¯æ—¶é—´**: ~2-3ç§’

### å…¬ç½‘è®¿é—®éªŒè¯
âœ… **å‰ç«¯ç•Œé¢**: http://43.167.252.120  
âœ… **ç”¨æˆ·API**: http://43.167.252.120/api/v1  
âœ… **äº¤æ˜“API**: http://43.167.252.120/trading/api/v1  
âœ… **å¥åº·æ£€æŸ¥**: http://43.167.252.120/health

## ğŸ“Š æœåŠ¡ç›‘æ§

### å®æ—¶æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
tail -f /root/trademe/logs/*.log

# åˆ†åˆ«æŸ¥çœ‹å„æœåŠ¡æ—¥å¿—
tail -f /root/trademe/logs/frontend.log
tail -f /root/trademe/logs/user-service.log  
tail -f /root/trademe/logs/trading-service.log
```

### è¿›ç¨‹çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥è¿è¡Œä¸­çš„æœåŠ¡
ps aux | grep -E "(node|uvicorn|nginx)" | grep -v grep

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i:3000,3001,8001

# æ£€æŸ¥NginxçŠ¶æ€
systemctl status nginx
```

### é˜²ç«å¢™é…ç½®
```bash
# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
ufw status

# å¼€æ”¾å¿…è¦ç«¯å£
ufw allow 80
ufw allow 3000
ufw allow 3001  
ufw allow 8001
```

## ğŸ§ª æµ‹è¯•ç¯å¢ƒ

### æµ‹è¯•è´¦æˆ·
- **é‚®ç®±**: publictest@example.com
- **å¯†ç **: PublicTest123!
- **æƒé™**: é«˜çº§ç‰ˆ (premium)
- **åˆ°æœŸæ—¶é—´**: 2026-08-21

### APIæµ‹è¯•ç¤ºä¾‹
```bash
# ç”¨æˆ·ç™»å½•
curl -X POST "http://43.167.252.120/api/v1/auth/login" \
-H "Content-Type: application/json" \
-d '{"email":"publictest@example.com","password":"PublicTest123!"}'

# å¥åº·æ£€æŸ¥
curl http://43.167.252.120/health
curl http://43.167.252.120/api/v1/health  
curl http://43.167.252.120/trading/api/v1/health
```

## ğŸ”§ é—®é¢˜æ’é™¤

### å¸¸è§é—®é¢˜
1. **çƒ­æ›´æ–°ä¸ç”Ÿæ•ˆ**
   - æ£€æŸ¥Viteé…ç½® `host: '0.0.0.0'`
   - éªŒè¯Nginxä»£ç†é…ç½®
   - ç¡®è®¤WebSocketè¿æ¥æ­£å¸¸

2. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ç«¯å£å ç”¨: `lsof -i:3000,3001,8001`
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—: `tail -20 /root/trademe/logs/*.log`
   - éªŒè¯ä¾èµ–å®‰è£…: `npm install` / `pip install`

3. **å…¬ç½‘è®¿é—®å¤±è´¥**
   - æ£€æŸ¥é˜²ç«å¢™: `ufw status`
   - éªŒè¯Nginxé…ç½®: `nginx -t`
   - é‡å¯Nginx: `systemctl restart nginx`

### æœåŠ¡é‡å¯
```bash
# é‡å¯å•ä¸ªæœåŠ¡
systemctl restart nginx

# é‡å¯æ•´ä¸ªç¯å¢ƒ
./stop-dev.sh && ./start-dev.sh
```

## ğŸ“ å¼€å‘å·¥ä½œæµ

### å‰ç«¯å¼€å‘
1. ä¿®æ”¹ `/root/trademe/frontend/src/` ä¸­çš„æ–‡ä»¶
2. ä¿å­˜åè‡ªåŠ¨è§¦å‘çƒ­æ›´æ–°
3. åœ¨ http://43.167.252.120 ä¸­å®æ—¶æŸ¥çœ‹æ•ˆæœ

### åç«¯å¼€å‘  
1. ä¿®æ”¹ç”¨æˆ·æœåŠ¡: `/root/trademe/backend/user-service/src/`
2. ä¿®æ”¹äº¤æ˜“æœåŠ¡: `/root/trademe/backend/trading-service/app/`
3. ä¿å­˜åæœåŠ¡è‡ªåŠ¨é‡å¯ (2-3ç§’)

### è°ƒè¯•æŠ€å·§
- **å‰ç«¯è°ƒè¯•**: Chrome DevTools + React DevTools
- **åç«¯è°ƒè¯•**: VS Codeæ–­ç‚¹ + æ—¥å¿—è¾“å‡º
- **ç½‘ç»œè°ƒè¯•**: Nginxæ—¥å¿— + æµè§ˆå™¨Networké¢æ¿
- **æ•°æ®åº“è°ƒè¯•**: SQLite Browser + Prisma Studio

---

**ç»´æŠ¤è¯´æ˜**: æ­¤é…ç½®ç»è¿‡å®Œæ•´æµ‹è¯•ï¼Œæ”¯æŒè¿œç¨‹å¼€å‘å’Œå…¬ç½‘è°ƒè¯•ã€‚ä¸‹æ¬¡å¯åŠ¨å¼€å‘ç¯å¢ƒæ—¶ï¼Œç›´æ¥æ‰§è¡Œ `./start-dev.sh` å³å¯è·å¾—ç›¸åŒçš„é…ç½®ç¯å¢ƒã€‚