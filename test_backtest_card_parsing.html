<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›æµ‹ç»“æœå¡ç‰‡è§£ææµ‹è¯•</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 20px; }
        .test-case { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .test-title { font-weight: bold; color: #2563eb; margin-bottom: 10px; }
        .ai-response { background: #f3f4f6; padding: 10px; border-radius: 4px; margin-bottom: 10px; }
        .result { background: #dcfce7; padding: 10px; border-radius: 4px; }
        .no-result { background: #fef2f2; padding: 10px; border-radius: 4px; }
        .extracted-data { background: #eff6ff; padding: 10px; border-radius: 4px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>ğŸ“Š BacktestResultCard è§£æåŠŸèƒ½æµ‹è¯•</h1>
    <p>æµ‹è¯•AIå›å¤ä¸­å›æµ‹ç»“æœçš„æå–å’Œè§£æé€»è¾‘</p>

    <div class="test-case">
        <div class="test-title">æµ‹è¯•æ¡ˆä¾‹1: æ ‡å‡†å›æµ‹ç»“æœæ ¼å¼</div>
        <div class="ai-response" id="response1">
            å›æµ‹å®Œæˆï¼ğŸ“Š ç­–ç•¥æ€§èƒ½åˆ†æç»“æœå¦‚ä¸‹ï¼š

            ğŸ“ˆ **æ”¶ç›Šè¡¨ç°**
            - æ€»æ”¶ç›Šç‡ï¼š25.5%
            - å¹´åŒ–æ”¶ç›Šç‡ï¼š15.2% 
            - æœ€å¤§å›æ’¤ï¼š-8.3%
            - å¤æ™®æ¯”ç‡ï¼š1.65

            ğŸ“Š **äº¤æ˜“ç»Ÿè®¡**
            - äº¤æ˜“æ¬¡æ•°ï¼š45æ¬¡
            - èƒœç‡ï¼š62.2%
            - ç›ˆäºæ¯”ï¼š1.8
            - å¹³å‡ç›ˆåˆ©ï¼š3.2%

            ğŸ¯ **é£é™©åˆ†æ**
            - é£é™©ç­‰çº§ï¼šMedium
            - æ³¢åŠ¨ç‡ï¼š12.5%
            - VaR(95%)ï¼š-2.1%

            ğŸ’¡ **ä¼˜åŒ–å»ºè®®**
            - è€ƒè™‘å¢åŠ æ­¢æŸè®¾ç½®
            - ä¼˜åŒ–ä»“ä½ç®¡ç†
            - å…³æ³¨å¸‚åœºæ³¢åŠ¨æ€§

            ç­–ç•¥è¡¨ç°è‰¯å¥½ï¼Œå»ºè®®è¿›ä¸€æ­¥ä¼˜åŒ–åå¯è€ƒè™‘å®ç›˜äº¤æ˜“ã€‚
        </div>
        <div class="result" id="result1"></div>
    </div>

    <div class="test-case">
        <div class="test-title">æµ‹è¯•æ¡ˆä¾‹2: ç®€åŒ–å›æµ‹ç»“æœæ ¼å¼</div>
        <div class="ai-response" id="response2">
            ç­–ç•¥å›æµ‹ç»“æœï¼šæ”¶ç›Šç‡ 15.8%ï¼Œæœ€å¤§å›æ’¤ -5.2%ï¼Œå¤æ™®æ¯”ç‡ 1.32ï¼Œèƒœç‡ 58%ï¼Œè¡¨ç°ä¼˜ç§€ã€‚
        </div>
        <div class="result" id="result2"></div>
    </div>

    <div class="test-case">
        <div class="test-title">æµ‹è¯•æ¡ˆä¾‹3: åŒ…å«ç­–ç•¥ä»£ç çš„å›å¤ï¼ˆä¸åº”æå–ï¼‰</div>
        <div class="ai-response" id="response3">
            è¿™æ˜¯ä¸€ä¸ªç§»åŠ¨å¹³å‡ç­–ç•¥çš„å®ç°ä»£ç ï¼š

            ```python
            def strategy():
                return "è¿™åªæ˜¯ä»£ç ç¤ºä¾‹"
            ```

            æš‚æœªè¿›è¡Œå›æµ‹ï¼Œéœ€è¦ç”¨æˆ·ç¡®è®¤å‚æ•°åæ‰§è¡Œã€‚
        </div>
        <div class="result" id="result3"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿ BacktestResultCard ä¸­çš„æå–é€»è¾‘
        function extractBacktestResult(content) {
            try {
                const backtestKeywords = ['å›æµ‹ç»“æœ', 'å›æµ‹å®Œæˆ', 'ç­–ç•¥æ€§èƒ½', 'æ”¶ç›Šç‡', 'å¤æ™®æ¯”ç‡', 'æœ€å¤§å›æ’¤'];
                const hasBacktestContent = backtestKeywords.some(keyword => content.includes(keyword));
                
                if (!hasBacktestContent) {
                    return null;
                }

                // æå–å„ç§æŒ‡æ ‡
                const returnMatch = content.match(/æ”¶ç›Šç‡[ï¼š:]?\s*([+-]?\d+\.?\d*)%/);
                const sharpeMatch = content.match(/å¤æ™®æ¯”ç‡[ï¼š:]?\s*([+-]?\d+\.?\d*)/);
                const drawdownMatch = content.match(/æœ€å¤§å›æ’¤[ï¼š:]?\s*-?([+-]?\d+\.?\d*)%/);
                const winRateMatch = content.match(/èƒœç‡[ï¼š:]?\s*(\d+\.?\d*)%/);
                const tradesMatch = content.match(/äº¤æ˜“æ¬¡æ•°[ï¼š:]?\s*(\d+)/);
                const riskMatch = content.match(/é£é™©ç­‰çº§[ï¼š:]?\s*(\w+)/);
                const volatilityMatch = content.match(/æ³¢åŠ¨ç‡[ï¼š:]?\s*(\d+\.?\d*)%/);
                const varMatch = content.match(/VaR\(95%\)[ï¼š:]?\s*-?([+-]?\d+\.?\d*)%/);

                if (!returnMatch && !sharpeMatch && !drawdownMatch) {
                    return null; // æ²¡æœ‰è¶³å¤Ÿçš„å…³é”®æŒ‡æ ‡
                }

                const totalReturn = returnMatch ? parseFloat(returnMatch[1]) : 0;
                const initialCapital = 10000; // é»˜è®¤å€¼
                const finalValue = initialCapital * (1 + totalReturn / 100);

                const backtestResult = {
                    strategy_name: "EMAåŒå‡çº¿ç­–ç•¥",
                    symbol: "BTC/USDT",
                    timeframe: "1h",
                    initial_capital: initialCapital,
                    final_value: finalValue,
                    total_return: totalReturn,
                    sharpe_ratio: sharpeMatch ? parseFloat(sharpeMatch[1]) : null,
                    max_drawdown: drawdownMatch ? parseFloat(drawdownMatch[1]) : null,
                    win_rate: winRateMatch ? parseFloat(winRateMatch[1]) : null,
                    total_trades: tradesMatch ? parseInt(tradesMatch[1]) : null,
                    risk_level: riskMatch ? riskMatch[1] : null,
                    volatility: volatilityMatch ? parseFloat(volatilityMatch[1]) : null,
                    var_95: varMatch ? parseFloat(varMatch[1]) : null,
                    meets_expectations: totalReturn > 10,
                    performance_grade: totalReturn > 20 ? 'A' : totalReturn > 10 ? 'B' : totalReturn > 0 ? 'C' : 'D',
                    optimization_suggestions: [
                        "è€ƒè™‘å¢åŠ æ­¢æŸè®¾ç½®",
                        "ä¼˜åŒ–ä»“ä½ç®¡ç†", 
                        "å…³æ³¨å¸‚åœºæ³¢åŠ¨æ€§"
                    ]
                };

                return backtestResult;
            } catch (error) {
                console.warn('æå–å›æµ‹ç»“æœå¤±è´¥:', error);
                return null;
            }
        }

        // æµ‹è¯•æ‰€æœ‰æ¡ˆä¾‹
        for (let i = 1; i <= 3; i++) {
            const responseText = document.getElementById(`response${i}`).textContent;
            const result = extractBacktestResult(responseText);
            const resultDiv = document.getElementById(`result${i}`);
            
            if (result) {
                resultDiv.className = 'result';
                resultDiv.innerHTML = `
                    <strong>âœ… æˆåŠŸæå–å›æµ‹ç»“æœï¼š</strong>
                    <div class="extracted-data">
                        <strong>åŸºæœ¬ä¿¡æ¯ï¼š</strong><br>
                        â€¢ ç­–ç•¥ï¼š${result.strategy_name}<br>
                        â€¢ äº¤æ˜“å¯¹ï¼š${result.symbol}<br>
                        â€¢ ç­‰çº§ï¼š${result.performance_grade}<br><br>
                        
                        <strong>è´¢åŠ¡æŒ‡æ ‡ï¼š</strong><br>
                        â€¢ æ€»æ”¶ç›Šç‡ï¼š${result.total_return}%<br>
                        â€¢ æœ€ç»ˆä»·å€¼ï¼š$${result.final_value.toLocaleString()}<br>
                        â€¢ å¤æ™®æ¯”ç‡ï¼š${result.sharpe_ratio || 'N/A'}<br>
                        â€¢ æœ€å¤§å›æ’¤ï¼š${result.max_drawdown ? '-' + result.max_drawdown + '%' : 'N/A'}<br><br>
                        
                        <strong>äº¤æ˜“ç»Ÿè®¡ï¼š</strong><br>
                        â€¢ èƒœç‡ï¼š${result.win_rate || 'N/A'}%<br>
                        â€¢ äº¤æ˜“æ¬¡æ•°ï¼š${result.total_trades || 'N/A'}<br><br>
                        
                        <strong>é£é™©åˆ†æï¼š</strong><br>
                        â€¢ é£é™©ç­‰çº§ï¼š${result.risk_level || 'N/A'}<br>
                        â€¢ æ³¢åŠ¨ç‡ï¼š${result.volatility || 'N/A'}%<br>
                        â€¢ VaR(95%)ï¼š${result.var_95 ? result.var_95 + '%' : 'N/A'}<br><br>
                        
                        <strong>è¯„ä¼°ï¼š</strong><br>
                        â€¢ è¾¾åˆ°é¢„æœŸï¼š${result.meets_expectations ? 'âœ… æ˜¯' : 'âŒ å¦'}<br>
                        â€¢ ä¼˜åŒ–å»ºè®®ï¼š${result.optimization_suggestions.slice(0,2).join('ï¼Œ')}
                    </div>
                `;
            } else {
                resultDiv.className = 'no-result';
                resultDiv.innerHTML = '<strong>âŒ æœªæ£€æµ‹åˆ°æœ‰æ•ˆå›æµ‹ç»“æœ</strong>';
            }
        }
    </script>
</body>
</html>