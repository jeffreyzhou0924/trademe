var wl=Object.defineProperty;var Ga=s=>{throw TypeError(s)};var Nl=(s,t,r)=>t in s?wl(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var Te=(s,t,r)=>Nl(s,typeof t!="symbol"?t+"":t,r),sa=(s,t,r)=>t.has(s)||Ga("Cannot "+r);var W=(s,t,r)=>(sa(s,t,"read from private field"),r?r.call(s):t.get(s)),Ne=(s,t,r)=>t.has(s)?Ga("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,r),fe=(s,t,r,a)=>(sa(s,t,"write to private field"),a?a.call(s,r):t.set(s,r),r),Xe=(s,t,r)=>(sa(s,t,"access private method"),r);var xr=(s,t,r,a)=>({set _(n){fe(s,t,n,r)},get _(){return W(s,t,a)}});import{r as y,a as kl,g as Sl,R as ze,u as dt,L as Ge,b as zr,c as di,N as _l,d as Cl,e as Oe,B as Al}from"./vendor-D-qGpst1.js";import{i as jr,L as ua,R as Ll}from"./charts-BV7FbyVl.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var ui={exports:{}},Ur={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tl=y,El=Symbol.for("react.element"),Ml=Symbol.for("react.fragment"),Il=Object.prototype.hasOwnProperty,Rl=Tl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Pl={key:!0,ref:!0,__self:!0,__source:!0};function mi(s,t,r){var a,n={},i=null,l=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(l=t.ref);for(a in t)Il.call(t,a)&&!Pl.hasOwnProperty(a)&&(n[a]=t[a]);if(s&&s.defaultProps)for(a in t=s.defaultProps,t)n[a]===void 0&&(n[a]=t[a]);return{$$typeof:El,type:s,key:i,ref:l,props:n,_owner:Rl.current}}Ur.Fragment=Ml;Ur.jsx=mi;Ur.jsxs=mi;ui.exports=Ur;var e=ui.exports,ma={},Ja=kl;ma.createRoot=Ja.createRoot,ma.hydrateRoot=Ja.hydrateRoot;var Wr=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(s){return this.listeners.add(s),this.onSubscribe(),()=>{this.listeners.delete(s),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},Vr=typeof window>"u"||"Deno"in globalThis;function yt(){}function $l(s,t){return typeof s=="function"?s(t):s}function Bl(s){return typeof s=="number"&&s>=0&&s!==1/0}function Dl(s,t){return Math.max(s+(t||0)-Date.now(),0)}function ha(s,t){return typeof s=="function"?s(t):s}function Ol(s,t){return typeof s=="function"?s(t):s}function Qa(s,t){const{type:r="all",exact:a,fetchStatus:n,predicate:i,queryKey:l,stale:o}=s;if(l){if(a){if(t.queryHash!==Ia(l,t.options))return!1}else if(!Qs(t.queryKey,l))return!1}if(r!=="all"){const c=t.isActive();if(r==="active"&&!c||r==="inactive"&&c)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||n&&n!==t.state.fetchStatus||i&&!i(t))}function Xa(s,t){const{exact:r,status:a,predicate:n,mutationKey:i}=s;if(i){if(!t.options.mutationKey)return!1;if(r){if(Js(t.options.mutationKey)!==Js(i))return!1}else if(!Qs(t.options.mutationKey,i))return!1}return!(a&&t.state.status!==a||n&&!n(t))}function Ia(s,t){return((t==null?void 0:t.queryKeyHashFn)||Js)(s)}function Js(s){return JSON.stringify(s,(t,r)=>xa(r)?Object.keys(r).sort().reduce((a,n)=>(a[n]=r[n],a),{}):r)}function Qs(s,t){return s===t?!0:typeof s!=typeof t?!1:s&&t&&typeof s=="object"&&typeof t=="object"?Object.keys(t).every(r=>Qs(s[r],t[r])):!1}function hi(s,t){if(s===t)return s;const r=Ya(s)&&Ya(t);if(r||xa(s)&&xa(t)){const a=r?s:Object.keys(s),n=a.length,i=r?t:Object.keys(t),l=i.length,o=r?[]:{},c=new Set(a);let d=0;for(let u=0;u<l;u++){const m=r?u:i[u];(!r&&c.has(m)||r)&&s[m]===void 0&&t[m]===void 0?(o[m]=void 0,d++):(o[m]=hi(s[m],t[m]),o[m]===s[m]&&s[m]!==void 0&&d++)}return n===l&&d===n?s:o}return t}function Ya(s){return Array.isArray(s)&&s.length===Object.keys(s).length}function xa(s){if(!en(s))return!1;const t=s.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!en(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(s)!==Object.prototype)}function en(s){return Object.prototype.toString.call(s)==="[object Object]"}function Fl(s){return new Promise(t=>{setTimeout(t,s)})}function zl(s,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(s,t):r.structuralSharing!==!1?hi(s,t):t}function Ul(s,t,r=0){const a=[...s,t];return r&&a.length>r?a.slice(1):a}function Wl(s,t,r=0){const a=[t,...s];return r&&a.length>r?a.slice(0,-1):a}var Ra=Symbol();function xi(s,t){return!s.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!s.queryFn||s.queryFn===Ra?()=>Promise.reject(new Error(`Missing queryFn: '${s.queryHash}'`)):s.queryFn}var ds,Kt,Ns,si,Vl=(si=class extends Wr{constructor(){super();Ne(this,ds);Ne(this,Kt);Ne(this,Ns);fe(this,Ns,t=>{if(!Vr&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){W(this,Kt)||this.setEventListener(W(this,Ns))}onUnsubscribe(){var t;this.hasListeners()||((t=W(this,Kt))==null||t.call(this),fe(this,Kt,void 0))}setEventListener(t){var r;fe(this,Ns,t),(r=W(this,Kt))==null||r.call(this),fe(this,Kt,t(a=>{typeof a=="boolean"?this.setFocused(a):this.onFocus()}))}setFocused(t){W(this,ds)!==t&&(fe(this,ds,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof W(this,ds)=="boolean"?W(this,ds):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},ds=new WeakMap,Kt=new WeakMap,Ns=new WeakMap,si),gi=new Vl,ks,Gt,Ss,ri,Hl=(ri=class extends Wr{constructor(){super();Ne(this,ks,!0);Ne(this,Gt);Ne(this,Ss);fe(this,Ss,t=>{if(!Vr&&window.addEventListener){const r=()=>t(!0),a=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",a,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",a)}}})}onSubscribe(){W(this,Gt)||this.setEventListener(W(this,Ss))}onUnsubscribe(){var t;this.hasListeners()||((t=W(this,Gt))==null||t.call(this),fe(this,Gt,void 0))}setEventListener(t){var r;fe(this,Ss,t),(r=W(this,Gt))==null||r.call(this),fe(this,Gt,t(this.setOnline.bind(this)))}setOnline(t){W(this,ks)!==t&&(fe(this,ks,t),this.listeners.forEach(a=>{a(t)}))}isOnline(){return W(this,ks)}},ks=new WeakMap,Gt=new WeakMap,Ss=new WeakMap,ri),Lr=new Hl;function ql(){let s,t;const r=new Promise((n,i)=>{s=n,t=i});r.status="pending",r.catch(()=>{});function a(n){Object.assign(r,n),delete r.resolve,delete r.reject}return r.resolve=n=>{a({status:"fulfilled",value:n}),s(n)},r.reject=n=>{a({status:"rejected",reason:n}),t(n)},r}function Zl(s){return Math.min(1e3*2**s,3e4)}function fi(s){return(s??"online")==="online"?Lr.isOnline():!0}var pi=class extends Error{constructor(s){super("CancelledError"),this.revert=s==null?void 0:s.revert,this.silent=s==null?void 0:s.silent}};function yi(s){let t=!1,r=0,a;const n=ql(),i=()=>n.status!=="pending",l=g=>{var w;i()||(k(new pi(g)),(w=s.abort)==null||w.call(s))},o=()=>{t=!0},c=()=>{t=!1},d=()=>gi.isFocused()&&(s.networkMode==="always"||Lr.isOnline())&&s.canRun(),u=()=>fi(s.networkMode)&&s.canRun(),m=g=>{i()||(a==null||a(),n.resolve(g))},k=g=>{i()||(a==null||a(),n.reject(g))},x=()=>new Promise(g=>{var w;a=v=>{(i()||d())&&g(v)},(w=s.onPause)==null||w.call(s)}).then(()=>{var g;a=void 0,i()||(g=s.onContinue)==null||g.call(s)}),b=()=>{if(i())return;let g;const w=r===0?s.initialPromise:void 0;try{g=w??s.fn()}catch(v){g=Promise.reject(v)}Promise.resolve(g).then(m).catch(v=>{var p;if(i())return;const L=s.retry??(Vr?0:3),C=s.retryDelay??Zl,M=typeof C=="function"?C(r,v):C,j=L===!0||typeof L=="number"&&r<L||typeof L=="function"&&L(r,v);if(t||!j){k(v);return}r++,(p=s.onFail)==null||p.call(s,r,v),Fl(M).then(()=>d()?void 0:x()).then(()=>{t?k(v):b()})})};return{promise:n,status:()=>n.status,cancel:l,continue:()=>(a==null||a(),n),cancelRetry:o,continueRetry:c,canStart:u,start:()=>(u()?b():x().then(b),n)}}var Kl=s=>setTimeout(s,0);function Gl(){let s=[],t=0,r=o=>{o()},a=o=>{o()},n=Kl;const i=o=>{t?s.push(o):n(()=>{r(o)})},l=()=>{const o=s;s=[],o.length&&n(()=>{a(()=>{o.forEach(c=>{r(c)})})})};return{batch:o=>{let c;t++;try{c=o()}finally{t--,t||l()}return c},batchCalls:o=>(...c)=>{i(()=>{o(...c)})},schedule:i,setNotifyFunction:o=>{r=o},setBatchNotifyFunction:o=>{a=o},setScheduler:o=>{n=o}}}var at=Gl(),us,ai,bi=(ai=class{constructor(){Ne(this,us)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Bl(this.gcTime)&&fe(this,us,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(s){this.gcTime=Math.max(this.gcTime||0,s??(Vr?1/0:5*60*1e3))}clearGcTimeout(){W(this,us)&&(clearTimeout(W(this,us)),fe(this,us,void 0))}},us=new WeakMap,ai),_s,Cs,ft,ms,Ze,ar,hs,bt,Dt,ni,Jl=(ni=class extends bi{constructor(t){super();Ne(this,bt);Ne(this,_s);Ne(this,Cs);Ne(this,ft);Ne(this,ms);Ne(this,Ze);Ne(this,ar);Ne(this,hs);fe(this,hs,!1),fe(this,ar,t.defaultOptions),this.setOptions(t.options),this.observers=[],fe(this,ms,t.client),fe(this,ft,W(this,ms).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,fe(this,_s,Xl(this.options)),this.state=t.state??W(this,_s),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=W(this,Ze))==null?void 0:t.promise}setOptions(t){this.options={...W(this,ar),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&W(this,ft).remove(this)}setData(t,r){const a=zl(this.state.data,t,this.options);return Xe(this,bt,Dt).call(this,{data:a,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),a}setState(t,r){Xe(this,bt,Dt).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var a,n;const r=(a=W(this,Ze))==null?void 0:a.promise;return(n=W(this,Ze))==null||n.cancel(t),r?r.then(yt).catch(yt):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(W(this,_s))}isActive(){return this.observers.some(t=>Ol(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Ra||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>ha(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!Dl(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(a=>a.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=W(this,Ze))==null||r.continue()}onOnline(){var r;const t=this.observers.find(a=>a.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=W(this,Ze))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),W(this,ft).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(W(this,Ze)&&(W(this,hs)?W(this,Ze).cancel({revert:!0}):W(this,Ze).cancelRetry()),this.scheduleGc()),W(this,ft).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Xe(this,bt,Dt).call(this,{type:"invalidate"})}async fetch(t,r){var c,d,u,m,k,x,b,g,w,v,L,C;if(this.state.fetchStatus!=="idle"&&((c=W(this,Ze))==null?void 0:c.status())!=="rejected"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(W(this,Ze))return W(this,Ze).continueRetry(),W(this,Ze).promise}if(t&&this.setOptions(t),!this.options.queryFn){const M=this.observers.find(j=>j.options.queryFn);M&&this.setOptions(M.options)}const a=new AbortController,n=M=>{Object.defineProperty(M,"signal",{enumerable:!0,get:()=>(fe(this,hs,!0),a.signal)})},i=()=>{const M=xi(this.options,r),p=(()=>{const S={client:W(this,ms),queryKey:this.queryKey,meta:this.meta};return n(S),S})();return fe(this,hs,!1),this.options.persister?this.options.persister(M,p,this):M(p)},o=(()=>{const M={fetchOptions:r,options:this.options,queryKey:this.queryKey,client:W(this,ms),state:this.state,fetchFn:i};return n(M),M})();(d=this.options.behavior)==null||d.onFetch(o,this),fe(this,Cs,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((u=o.fetchOptions)==null?void 0:u.meta))&&Xe(this,bt,Dt).call(this,{type:"fetch",meta:(m=o.fetchOptions)==null?void 0:m.meta}),fe(this,Ze,yi({initialPromise:r==null?void 0:r.initialPromise,fn:o.fetchFn,abort:a.abort.bind(a),onFail:(M,j)=>{Xe(this,bt,Dt).call(this,{type:"failed",failureCount:M,error:j})},onPause:()=>{Xe(this,bt,Dt).call(this,{type:"pause"})},onContinue:()=>{Xe(this,bt,Dt).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0}));try{const M=await W(this,Ze).start();if(M===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(M),(x=(k=W(this,ft).config).onSuccess)==null||x.call(k,M,this),(g=(b=W(this,ft).config).onSettled)==null||g.call(b,M,this.state.error,this),M}catch(M){if(M instanceof pi){if(M.silent)return W(this,Ze).promise;if(M.revert){if(this.setState({...W(this,Cs),fetchStatus:"idle"}),this.state.data===void 0)throw M;return this.state.data}}throw Xe(this,bt,Dt).call(this,{type:"error",error:M}),(v=(w=W(this,ft).config).onError)==null||v.call(w,M,this),(C=(L=W(this,ft).config).onSettled)==null||C.call(L,this.state.data,M,this),M}finally{this.scheduleGc()}}},_s=new WeakMap,Cs=new WeakMap,ft=new WeakMap,ms=new WeakMap,Ze=new WeakMap,ar=new WeakMap,hs=new WeakMap,bt=new WeakSet,Dt=function(t){const r=a=>{switch(t.type){case"failed":return{...a,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...a,fetchStatus:"paused"};case"continue":return{...a,fetchStatus:"fetching"};case"fetch":return{...a,...Ql(a.data,this.options),fetchMeta:t.meta??null};case"success":const n={...a,data:t.data,dataUpdateCount:a.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return fe(this,Cs,t.manual?n:void 0),n;case"error":const i=t.error;return{...a,error:i,errorUpdateCount:a.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:a.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...a,isInvalidated:!0};case"setState":return{...a,...t.state}}};this.state=r(this.state),at.batch(()=>{this.observers.forEach(a=>{a.onQueryUpdate()}),W(this,ft).notify({query:this,type:"updated",action:t})})},ni);function Ql(s,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:fi(t.networkMode)?"fetching":"paused",...s===void 0&&{error:null,status:"pending"}}}function Xl(s){const t=typeof s.initialData=="function"?s.initialData():s.initialData,r=t!==void 0,a=r?typeof s.initialDataUpdatedAt=="function"?s.initialDataUpdatedAt():s.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?a??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var At,ii,Yl=(ii=class extends Wr{constructor(t={}){super();Ne(this,At);this.config=t,fe(this,At,new Map)}build(t,r,a){const n=r.queryKey,i=r.queryHash??Ia(n,r);let l=this.get(i);return l||(l=new Jl({client:t,queryKey:n,queryHash:i,options:t.defaultQueryOptions(r),state:a,defaultOptions:t.getQueryDefaults(n)}),this.add(l)),l}add(t){W(this,At).has(t.queryHash)||(W(this,At).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=W(this,At).get(t.queryHash);r&&(t.destroy(),r===t&&W(this,At).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){at.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return W(this,At).get(t)}getAll(){return[...W(this,At).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(a=>Qa(r,a))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(a=>Qa(t,a)):r}notify(t){at.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){at.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){at.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},At=new WeakMap,ii),Lt,tt,xs,Tt,Vt,li,eo=(li=class extends bi{constructor(t){super();Ne(this,Tt);Ne(this,Lt);Ne(this,tt);Ne(this,xs);this.mutationId=t.mutationId,fe(this,tt,t.mutationCache),fe(this,Lt,[]),this.state=t.state||to(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){W(this,Lt).includes(t)||(W(this,Lt).push(t),this.clearGcTimeout(),W(this,tt).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){fe(this,Lt,W(this,Lt).filter(r=>r!==t)),this.scheduleGc(),W(this,tt).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){W(this,Lt).length||(this.state.status==="pending"?this.scheduleGc():W(this,tt).remove(this))}continue(){var t;return((t=W(this,xs))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var i,l,o,c,d,u,m,k,x,b,g,w,v,L,C,M,j,p,S,_;const r=()=>{Xe(this,Tt,Vt).call(this,{type:"continue"})};fe(this,xs,yi({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(U,re)=>{Xe(this,Tt,Vt).call(this,{type:"failed",failureCount:U,error:re})},onPause:()=>{Xe(this,Tt,Vt).call(this,{type:"pause"})},onContinue:r,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>W(this,tt).canRun(this)}));const a=this.state.status==="pending",n=!W(this,xs).canStart();try{if(a)r();else{Xe(this,Tt,Vt).call(this,{type:"pending",variables:t,isPaused:n}),await((l=(i=W(this,tt).config).onMutate)==null?void 0:l.call(i,t,this));const re=await((c=(o=this.options).onMutate)==null?void 0:c.call(o,t));re!==this.state.context&&Xe(this,Tt,Vt).call(this,{type:"pending",context:re,variables:t,isPaused:n})}const U=await W(this,xs).start();return await((u=(d=W(this,tt).config).onSuccess)==null?void 0:u.call(d,U,t,this.state.context,this)),await((k=(m=this.options).onSuccess)==null?void 0:k.call(m,U,t,this.state.context)),await((b=(x=W(this,tt).config).onSettled)==null?void 0:b.call(x,U,null,this.state.variables,this.state.context,this)),await((w=(g=this.options).onSettled)==null?void 0:w.call(g,U,null,t,this.state.context)),Xe(this,Tt,Vt).call(this,{type:"success",data:U}),U}catch(U){try{throw await((L=(v=W(this,tt).config).onError)==null?void 0:L.call(v,U,t,this.state.context,this)),await((M=(C=this.options).onError)==null?void 0:M.call(C,U,t,this.state.context)),await((p=(j=W(this,tt).config).onSettled)==null?void 0:p.call(j,void 0,U,this.state.variables,this.state.context,this)),await((_=(S=this.options).onSettled)==null?void 0:_.call(S,void 0,U,t,this.state.context)),U}finally{Xe(this,Tt,Vt).call(this,{type:"error",error:U})}}finally{W(this,tt).runNext(this)}}},Lt=new WeakMap,tt=new WeakMap,xs=new WeakMap,Tt=new WeakSet,Vt=function(t){const r=a=>{switch(t.type){case"failed":return{...a,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...a,isPaused:!0};case"continue":return{...a,isPaused:!1};case"pending":return{...a,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...a,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...a,data:void 0,error:t.error,failureCount:a.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),at.batch(()=>{W(this,Lt).forEach(a=>{a.onMutationUpdate(t)}),W(this,tt).notify({mutation:this,type:"updated",action:t})})},li);function to(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Ot,vt,nr,oi,so=(oi=class extends Wr{constructor(t={}){super();Ne(this,Ot);Ne(this,vt);Ne(this,nr);this.config=t,fe(this,Ot,new Set),fe(this,vt,new Map),fe(this,nr,0)}build(t,r,a){const n=new eo({mutationCache:this,mutationId:++xr(this,nr)._,options:t.defaultMutationOptions(r),state:a});return this.add(n),n}add(t){W(this,Ot).add(t);const r=gr(t);if(typeof r=="string"){const a=W(this,vt).get(r);a?a.push(t):W(this,vt).set(r,[t])}this.notify({type:"added",mutation:t})}remove(t){if(W(this,Ot).delete(t)){const r=gr(t);if(typeof r=="string"){const a=W(this,vt).get(r);if(a)if(a.length>1){const n=a.indexOf(t);n!==-1&&a.splice(n,1)}else a[0]===t&&W(this,vt).delete(r)}}this.notify({type:"removed",mutation:t})}canRun(t){const r=gr(t);if(typeof r=="string"){const a=W(this,vt).get(r),n=a==null?void 0:a.find(i=>i.state.status==="pending");return!n||n===t}else return!0}runNext(t){var a;const r=gr(t);if(typeof r=="string"){const n=(a=W(this,vt).get(r))==null?void 0:a.find(i=>i!==t&&i.state.isPaused);return(n==null?void 0:n.continue())??Promise.resolve()}else return Promise.resolve()}clear(){at.batch(()=>{W(this,Ot).forEach(t=>{this.notify({type:"removed",mutation:t})}),W(this,Ot).clear(),W(this,vt).clear()})}getAll(){return Array.from(W(this,Ot))}find(t){const r={exact:!0,...t};return this.getAll().find(a=>Xa(r,a))}findAll(t={}){return this.getAll().filter(r=>Xa(t,r))}notify(t){at.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return at.batch(()=>Promise.all(t.map(r=>r.continue().catch(yt))))}},Ot=new WeakMap,vt=new WeakMap,nr=new WeakMap,oi);function gr(s){var t;return(t=s.options.scope)==null?void 0:t.id}function tn(s){return{onFetch:(t,r)=>{var u,m,k,x,b;const a=t.options,n=(k=(m=(u=t.fetchOptions)==null?void 0:u.meta)==null?void 0:m.fetchMore)==null?void 0:k.direction,i=((x=t.state.data)==null?void 0:x.pages)||[],l=((b=t.state.data)==null?void 0:b.pageParams)||[];let o={pages:[],pageParams:[]},c=0;const d=async()=>{let g=!1;const w=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(t.signal.aborted?g=!0:t.signal.addEventListener("abort",()=>{g=!0}),t.signal)})},v=xi(t.options,t.fetchOptions),L=async(C,M,j)=>{if(g)return Promise.reject();if(M==null&&C.pages.length)return Promise.resolve(C);const S=(()=>{const X={client:t.client,queryKey:t.queryKey,pageParam:M,direction:j?"backward":"forward",meta:t.options.meta};return w(X),X})(),_=await v(S),{maxPages:U}=t.options,re=j?Wl:Ul;return{pages:re(C.pages,_,U),pageParams:re(C.pageParams,M,U)}};if(n&&i.length){const C=n==="backward",M=C?ro:sn,j={pages:i,pageParams:l},p=M(a,j);o=await L(j,p,C)}else{const C=s??i.length;do{const M=c===0?l[0]??a.initialPageParam:sn(a,o);if(c>0&&M==null)break;o=await L(o,M),c++}while(c<C)}return o};t.options.persister?t.fetchFn=()=>{var g,w;return(w=(g=t.options).persister)==null?void 0:w.call(g,d,{client:t.client,queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=d}}}function sn(s,{pages:t,pageParams:r}){const a=t.length-1;return t.length>0?s.getNextPageParam(t[a],t,r[a],r):void 0}function ro(s,{pages:t,pageParams:r}){var a;return t.length>0?(a=s.getPreviousPageParam)==null?void 0:a.call(s,t[0],t,r[0],r):void 0}var Ee,Jt,Qt,As,Ls,Xt,Ts,Es,ci,ao=(ci=class{constructor(s={}){Ne(this,Ee);Ne(this,Jt);Ne(this,Qt);Ne(this,As);Ne(this,Ls);Ne(this,Xt);Ne(this,Ts);Ne(this,Es);fe(this,Ee,s.queryCache||new Yl),fe(this,Jt,s.mutationCache||new so),fe(this,Qt,s.defaultOptions||{}),fe(this,As,new Map),fe(this,Ls,new Map),fe(this,Xt,0)}mount(){xr(this,Xt)._++,W(this,Xt)===1&&(fe(this,Ts,gi.subscribe(async s=>{s&&(await this.resumePausedMutations(),W(this,Ee).onFocus())})),fe(this,Es,Lr.subscribe(async s=>{s&&(await this.resumePausedMutations(),W(this,Ee).onOnline())})))}unmount(){var s,t;xr(this,Xt)._--,W(this,Xt)===0&&((s=W(this,Ts))==null||s.call(this),fe(this,Ts,void 0),(t=W(this,Es))==null||t.call(this),fe(this,Es,void 0))}isFetching(s){return W(this,Ee).findAll({...s,fetchStatus:"fetching"}).length}isMutating(s){return W(this,Jt).findAll({...s,status:"pending"}).length}getQueryData(s){var r;const t=this.defaultQueryOptions({queryKey:s});return(r=W(this,Ee).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(s){const t=this.defaultQueryOptions(s),r=W(this,Ee).build(this,t),a=r.state.data;return a===void 0?this.fetchQuery(s):(s.revalidateIfStale&&r.isStaleByTime(ha(t.staleTime,r))&&this.prefetchQuery(t),Promise.resolve(a))}getQueriesData(s){return W(this,Ee).findAll(s).map(({queryKey:t,state:r})=>{const a=r.data;return[t,a]})}setQueryData(s,t,r){const a=this.defaultQueryOptions({queryKey:s}),n=W(this,Ee).get(a.queryHash),i=n==null?void 0:n.state.data,l=$l(t,i);if(l!==void 0)return W(this,Ee).build(this,a).setData(l,{...r,manual:!0})}setQueriesData(s,t,r){return at.batch(()=>W(this,Ee).findAll(s).map(({queryKey:a})=>[a,this.setQueryData(a,t,r)]))}getQueryState(s){var r;const t=this.defaultQueryOptions({queryKey:s});return(r=W(this,Ee).get(t.queryHash))==null?void 0:r.state}removeQueries(s){const t=W(this,Ee);at.batch(()=>{t.findAll(s).forEach(r=>{t.remove(r)})})}resetQueries(s,t){const r=W(this,Ee);return at.batch(()=>(r.findAll(s).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...s},t)))}cancelQueries(s,t={}){const r={revert:!0,...t},a=at.batch(()=>W(this,Ee).findAll(s).map(n=>n.cancel(r)));return Promise.all(a).then(yt).catch(yt)}invalidateQueries(s,t={}){return at.batch(()=>(W(this,Ee).findAll(s).forEach(r=>{r.invalidate()}),(s==null?void 0:s.refetchType)==="none"?Promise.resolve():this.refetchQueries({...s,type:(s==null?void 0:s.refetchType)??(s==null?void 0:s.type)??"active"},t)))}refetchQueries(s,t={}){const r={...t,cancelRefetch:t.cancelRefetch??!0},a=at.batch(()=>W(this,Ee).findAll(s).filter(n=>!n.isDisabled()&&!n.isStatic()).map(n=>{let i=n.fetch(void 0,r);return r.throwOnError||(i=i.catch(yt)),n.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(a).then(yt)}fetchQuery(s){const t=this.defaultQueryOptions(s);t.retry===void 0&&(t.retry=!1);const r=W(this,Ee).build(this,t);return r.isStaleByTime(ha(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(s){return this.fetchQuery(s).then(yt).catch(yt)}fetchInfiniteQuery(s){return s.behavior=tn(s.pages),this.fetchQuery(s)}prefetchInfiniteQuery(s){return this.fetchInfiniteQuery(s).then(yt).catch(yt)}ensureInfiniteQueryData(s){return s.behavior=tn(s.pages),this.ensureQueryData(s)}resumePausedMutations(){return Lr.isOnline()?W(this,Jt).resumePausedMutations():Promise.resolve()}getQueryCache(){return W(this,Ee)}getMutationCache(){return W(this,Jt)}getDefaultOptions(){return W(this,Qt)}setDefaultOptions(s){fe(this,Qt,s)}setQueryDefaults(s,t){W(this,As).set(Js(s),{queryKey:s,defaultOptions:t})}getQueryDefaults(s){const t=[...W(this,As).values()],r={};return t.forEach(a=>{Qs(s,a.queryKey)&&Object.assign(r,a.defaultOptions)}),r}setMutationDefaults(s,t){W(this,Ls).set(Js(s),{mutationKey:s,defaultOptions:t})}getMutationDefaults(s){const t=[...W(this,Ls).values()],r={};return t.forEach(a=>{Qs(s,a.mutationKey)&&Object.assign(r,a.defaultOptions)}),r}defaultQueryOptions(s){if(s._defaulted)return s;const t={...W(this,Qt).queries,...this.getQueryDefaults(s.queryKey),...s,_defaulted:!0};return t.queryHash||(t.queryHash=Ia(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===Ra&&(t.enabled=!1),t}defaultMutationOptions(s){return s!=null&&s._defaulted?s:{...W(this,Qt).mutations,...(s==null?void 0:s.mutationKey)&&this.getMutationDefaults(s.mutationKey),...s,_defaulted:!0}}clear(){W(this,Ee).clear(),W(this,Jt).clear()}},Ee=new WeakMap,Jt=new WeakMap,Qt=new WeakMap,As=new WeakMap,Ls=new WeakMap,Xt=new WeakMap,Ts=new WeakMap,Es=new WeakMap,ci),no=y.createContext(void 0),io=({client:s,children:t})=>(y.useEffect(()=>(s.mount(),()=>{s.unmount()}),[s]),e.jsx(no.Provider,{value:s,children:t}));let lo={data:""},oo=s=>typeof window=="object"?((s?s.querySelector("#_goober"):window._goober)||Object.assign((s||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:s||lo,co=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,uo=/\/\*[^]*?\*\/|  +/g,rn=/\n+/g,qt=(s,t)=>{let r="",a="",n="";for(let i in s){let l=s[i];i[0]=="@"?i[1]=="i"?r=i+" "+l+";":a+=i[1]=="f"?qt(l,i):i+"{"+qt(l,i[1]=="k"?"":t)+"}":typeof l=="object"?a+=qt(l,t?t.replace(/([^,])+/g,o=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,o):o?o+" "+c:c)):i):l!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=qt.p?qt.p(i,l):i+":"+l+";")}return r+(t&&n?t+"{"+n+"}":n)+a},Pt={},vi=s=>{if(typeof s=="object"){let t="";for(let r in s)t+=r+vi(s[r]);return t}return s},mo=(s,t,r,a,n)=>{let i=vi(s),l=Pt[i]||(Pt[i]=(c=>{let d=0,u=11;for(;d<c.length;)u=101*u+c.charCodeAt(d++)>>>0;return"go"+u})(i));if(!Pt[l]){let c=i!==s?s:(d=>{let u,m,k=[{}];for(;u=co.exec(d.replace(uo,""));)u[4]?k.shift():u[3]?(m=u[3].replace(rn," ").trim(),k.unshift(k[0][m]=k[0][m]||{})):k[0][u[1]]=u[2].replace(rn," ").trim();return k[0]})(s);Pt[l]=qt(n?{["@keyframes "+l]:c}:c,r?"":"."+l)}let o=r&&Pt.g?Pt.g:null;return r&&(Pt.g=Pt[l]),((c,d,u,m)=>{m?d.data=d.data.replace(m,c):d.data.indexOf(c)===-1&&(d.data=u?c+d.data:d.data+c)})(Pt[l],t,a,o),l},ho=(s,t,r)=>s.reduce((a,n,i)=>{let l=t[i];if(l&&l.call){let o=l(r),c=o&&o.props&&o.props.className||/^go/.test(o)&&o;l=c?"."+c:o&&typeof o=="object"?o.props?"":qt(o,""):o===!1?"":o}return a+n+(l??"")},"");function Hr(s){let t=this||{},r=s.call?s(t.p):s;return mo(r.unshift?r.raw?ho(r,[].slice.call(arguments,1),t.p):r.reduce((a,n)=>Object.assign(a,n&&n.call?n(t.p):n),{}):r,oo(t.target),t.g,t.o,t.k)}let ji,ga,fa;Hr.bind({g:1});let Ft=Hr.bind({k:1});function xo(s,t,r,a){qt.p=t,ji=s,ga=r,fa=a}function rs(s,t){let r=this||{};return function(){let a=arguments;function n(i,l){let o=Object.assign({},i),c=o.className||n.className;r.p=Object.assign({theme:ga&&ga()},o),r.o=/ *go\d+/.test(c),o.className=Hr.apply(r,a)+(c?" "+c:"");let d=s;return s[0]&&(d=o.as||s,delete o.as),fa&&d[0]&&fa(o),ji(d,o)}return n}}var go=s=>typeof s=="function",Tr=(s,t)=>go(s)?s(t):s,fo=(()=>{let s=0;return()=>(++s).toString()})(),wi=(()=>{let s;return()=>{if(s===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");s=!t||t.matches}return s}})(),po=20,Pa="default",Ni=(s,t)=>{let{toastLimit:r}=s.settings;switch(t.type){case 0:return{...s,toasts:[t.toast,...s.toasts].slice(0,r)};case 1:return{...s,toasts:s.toasts.map(l=>l.id===t.toast.id?{...l,...t.toast}:l)};case 2:let{toast:a}=t;return Ni(s,{type:s.toasts.find(l=>l.id===a.id)?1:0,toast:a});case 3:let{toastId:n}=t;return{...s,toasts:s.toasts.map(l=>l.id===n||n===void 0?{...l,dismissed:!0,visible:!1}:l)};case 4:return t.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(l=>l.id!==t.toastId)};case 5:return{...s,pausedAt:t.time};case 6:let i=t.time-(s.pausedAt||0);return{...s,pausedAt:void 0,toasts:s.toasts.map(l=>({...l,pauseDuration:l.pauseDuration+i}))}}},wr=[],ki={toasts:[],pausedAt:void 0,settings:{toastLimit:po}},Et={},Si=(s,t=Pa)=>{Et[t]=Ni(Et[t]||ki,s),wr.forEach(([r,a])=>{r===t&&a(Et[t])})},_i=s=>Object.keys(Et).forEach(t=>Si(s,t)),yo=s=>Object.keys(Et).find(t=>Et[t].toasts.some(r=>r.id===s)),qr=(s=Pa)=>t=>{Si(t,s)},bo={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},vo=(s={},t=Pa)=>{let[r,a]=y.useState(Et[t]||ki),n=y.useRef(Et[t]);y.useEffect(()=>(n.current!==Et[t]&&a(Et[t]),wr.push([t,a]),()=>{let l=wr.findIndex(([o])=>o===t);l>-1&&wr.splice(l,1)}),[t]);let i=r.toasts.map(l=>{var o,c,d;return{...s,...s[l.type],...l,removeDelay:l.removeDelay||((o=s[l.type])==null?void 0:o.removeDelay)||(s==null?void 0:s.removeDelay),duration:l.duration||((c=s[l.type])==null?void 0:c.duration)||(s==null?void 0:s.duration)||bo[l.type],style:{...s.style,...(d=s[l.type])==null?void 0:d.style,...l.style}}});return{...r,toasts:i}},jo=(s,t="blank",r)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:s,pauseDuration:0,...r,id:(r==null?void 0:r.id)||fo()}),ir=s=>(t,r)=>{let a=jo(t,s,r);return qr(a.toasterId||yo(a.id))({type:2,toast:a}),a.id},Ue=(s,t)=>ir("blank")(s,t);Ue.error=ir("error");Ue.success=ir("success");Ue.loading=ir("loading");Ue.custom=ir("custom");Ue.dismiss=(s,t)=>{let r={type:3,toastId:s};t?qr(t)(r):_i(r)};Ue.dismissAll=s=>Ue.dismiss(void 0,s);Ue.remove=(s,t)=>{let r={type:4,toastId:s};t?qr(t)(r):_i(r)};Ue.removeAll=s=>Ue.remove(void 0,s);Ue.promise=(s,t,r)=>{let a=Ue.loading(t.loading,{...r,...r==null?void 0:r.loading});return typeof s=="function"&&(s=s()),s.then(n=>{let i=t.success?Tr(t.success,n):void 0;return i?Ue.success(i,{id:a,...r,...r==null?void 0:r.success}):Ue.dismiss(a),n}).catch(n=>{let i=t.error?Tr(t.error,n):void 0;i?Ue.error(i,{id:a,...r,...r==null?void 0:r.error}):Ue.dismiss(a)}),s};var wo=1e3,No=(s,t="default")=>{let{toasts:r,pausedAt:a}=vo(s,t),n=y.useRef(new Map).current,i=y.useCallback((m,k=wo)=>{if(n.has(m))return;let x=setTimeout(()=>{n.delete(m),l({type:4,toastId:m})},k);n.set(m,x)},[]);y.useEffect(()=>{if(a)return;let m=Date.now(),k=r.map(x=>{if(x.duration===1/0)return;let b=(x.duration||0)+x.pauseDuration-(m-x.createdAt);if(b<0){x.visible&&Ue.dismiss(x.id);return}return setTimeout(()=>Ue.dismiss(x.id,t),b)});return()=>{k.forEach(x=>x&&clearTimeout(x))}},[r,a,t]);let l=y.useCallback(qr(t),[t]),o=y.useCallback(()=>{l({type:5,time:Date.now()})},[l]),c=y.useCallback((m,k)=>{l({type:1,toast:{id:m,height:k}})},[l]),d=y.useCallback(()=>{a&&l({type:6,time:Date.now()})},[a,l]),u=y.useCallback((m,k)=>{let{reverseOrder:x=!1,gutter:b=8,defaultPosition:g}=k||{},w=r.filter(C=>(C.position||g)===(m.position||g)&&C.height),v=w.findIndex(C=>C.id===m.id),L=w.filter((C,M)=>M<v&&C.visible).length;return w.filter(C=>C.visible).slice(...x?[L+1]:[0,L]).reduce((C,M)=>C+(M.height||0)+b,0)},[r]);return y.useEffect(()=>{r.forEach(m=>{if(m.dismissed)i(m.id,m.removeDelay);else{let k=n.get(m.id);k&&(clearTimeout(k),n.delete(m.id))}})},[r,i]),{toasts:r,handlers:{updateHeight:c,startPause:o,endPause:d,calculateOffset:u}}},ko=Ft`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,So=Ft`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,_o=Ft`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Co=rs("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${s=>s.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${ko} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${So} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${s=>s.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${_o} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Ao=Ft`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Lo=rs("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${s=>s.secondary||"#e0e0e0"};
  border-right-color: ${s=>s.primary||"#616161"};
  animation: ${Ao} 1s linear infinite;
`,To=Ft`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Eo=Ft`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Mo=rs("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${s=>s.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${To} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Eo} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${s=>s.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Io=rs("div")`
  position: absolute;
`,Ro=rs("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Po=Ft`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,$o=rs("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Po} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Bo=({toast:s})=>{let{icon:t,type:r,iconTheme:a}=s;return t!==void 0?typeof t=="string"?y.createElement($o,null,t):t:r==="blank"?null:y.createElement(Ro,null,y.createElement(Lo,{...a}),r!=="loading"&&y.createElement(Io,null,r==="error"?y.createElement(Co,{...a}):y.createElement(Mo,{...a})))},Do=s=>`
0% {transform: translate3d(0,${s*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Oo=s=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${s*-150}%,-1px) scale(.6); opacity:0;}
`,Fo="0%{opacity:0;} 100%{opacity:1;}",zo="0%{opacity:1;} 100%{opacity:0;}",Uo=rs("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Wo=rs("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Vo=(s,t)=>{let r=s.includes("top")?1:-1,[a,n]=wi()?[Fo,zo]:[Do(r),Oo(r)];return{animation:t?`${Ft(a)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Ft(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Ho=y.memo(({toast:s,position:t,style:r,children:a})=>{let n=s.height?Vo(s.position||t||"top-center",s.visible):{opacity:0},i=y.createElement(Bo,{toast:s}),l=y.createElement(Wo,{...s.ariaProps},Tr(s.message,s));return y.createElement(Uo,{className:s.className,style:{...n,...r,...s.style}},typeof a=="function"?a({icon:i,message:l}):y.createElement(y.Fragment,null,i,l))});xo(y.createElement);var qo=({id:s,className:t,style:r,onHeightUpdate:a,children:n})=>{let i=y.useCallback(l=>{if(l){let o=()=>{let c=l.getBoundingClientRect().height;a(s,c)};o(),new MutationObserver(o).observe(l,{subtree:!0,childList:!0,characterData:!0})}},[s,a]);return y.createElement("div",{ref:i,className:t,style:r},n)},Zo=(s,t)=>{let r=s.includes("top"),a=r?{top:0}:{bottom:0},n=s.includes("center")?{justifyContent:"center"}:s.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:wi()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(r?1:-1)}px)`,...a,...n}},Ko=Hr`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,fr=16,Go=({reverseOrder:s,position:t="top-center",toastOptions:r,gutter:a,children:n,toasterId:i,containerStyle:l,containerClassName:o})=>{let{toasts:c,handlers:d}=No(r,i);return y.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:fr,left:fr,right:fr,bottom:fr,pointerEvents:"none",...l},className:o,onMouseEnter:d.startPause,onMouseLeave:d.endPause},c.map(u=>{let m=u.position||t,k=d.calculateOffset(u,{reverseOrder:s,gutter:a,defaultPosition:t}),x=Zo(m,k);return y.createElement(qo,{id:u.id,key:u.id,onHeightUpdate:d.updateHeight,className:u.visible?Ko:"",style:x},u.type==="custom"?Tr(u.message,u):n?n(u):y.createElement(Ho,{toast:u,position:m}))}))},E=Ue;const Jo={},an=s=>{let t;const r=new Set,a=(u,m)=>{const k=typeof u=="function"?u(t):u;if(!Object.is(k,t)){const x=t;t=m??(typeof k!="object"||k===null)?k:Object.assign({},t,k),r.forEach(b=>b(t,x))}},n=()=>t,c={setState:a,getState:n,getInitialState:()=>d,subscribe:u=>(r.add(u),()=>r.delete(u)),destroy:()=>{(Jo?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},d=t=s(a,n,c);return c},Qo=s=>s?an(s):an;var Ci={exports:{}},Ai={},Li={exports:{}},Ti={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ms=y;function Xo(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var Yo=typeof Object.is=="function"?Object.is:Xo,ec=Ms.useState,tc=Ms.useEffect,sc=Ms.useLayoutEffect,rc=Ms.useDebugValue;function ac(s,t){var r=t(),a=ec({inst:{value:r,getSnapshot:t}}),n=a[0].inst,i=a[1];return sc(function(){n.value=r,n.getSnapshot=t,ra(n)&&i({inst:n})},[s,r,t]),tc(function(){return ra(n)&&i({inst:n}),s(function(){ra(n)&&i({inst:n})})},[s]),rc(r),r}function ra(s){var t=s.getSnapshot;s=s.value;try{var r=t();return!Yo(s,r)}catch{return!0}}function nc(s,t){return t()}var ic=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?nc:ac;Ti.useSyncExternalStore=Ms.useSyncExternalStore!==void 0?Ms.useSyncExternalStore:ic;Li.exports=Ti;var lc=Li.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zr=y,oc=lc;function cc(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var dc=typeof Object.is=="function"?Object.is:cc,uc=oc.useSyncExternalStore,mc=Zr.useRef,hc=Zr.useEffect,xc=Zr.useMemo,gc=Zr.useDebugValue;Ai.useSyncExternalStoreWithSelector=function(s,t,r,a,n){var i=mc(null);if(i.current===null){var l={hasValue:!1,value:null};i.current=l}else l=i.current;i=xc(function(){function c(x){if(!d){if(d=!0,u=x,x=a(x),n!==void 0&&l.hasValue){var b=l.value;if(n(b,x))return m=b}return m=x}if(b=m,dc(u,x))return b;var g=a(x);return n!==void 0&&n(b,g)?(u=x,b):(u=x,m=g)}var d=!1,u,m,k=r===void 0?null:r;return[function(){return c(t())},k===null?void 0:function(){return c(k())}]},[t,r,a,n]);var o=uc(s,i[0],i[1]);return hc(function(){l.hasValue=!0,l.value=o},[o]),gc(o),o};Ci.exports=Ai;var fc=Ci.exports;const pc=Sl(fc),Ei={},{useDebugValue:yc}=ze,{useSyncExternalStoreWithSelector:bc}=pc;let nn=!1;const vc=s=>s;function jc(s,t=vc,r){(Ei?"production":void 0)!=="production"&&r&&!nn&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),nn=!0);const a=bc(s.subscribe,s.getState,s.getServerState||s.getInitialState,t,r);return yc(a),a}const ln=s=>{(Ei?"production":void 0)!=="production"&&typeof s!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t=typeof s=="function"?Qo(s):s,r=(a,n)=>jc(t,a,n);return Object.assign(r,t),r},as=s=>s?ln(s):ln,wc={};function Nc(s,t){let r;try{r=s()}catch{return}return{getItem:n=>{var i;const l=c=>c===null?null:JSON.parse(c,void 0),o=(i=r.getItem(n))!=null?i:null;return o instanceof Promise?o.then(l):l(o)},setItem:(n,i)=>r.setItem(n,JSON.stringify(i,void 0)),removeItem:n=>r.removeItem(n)}}const Xs=s=>t=>{try{const r=s(t);return r instanceof Promise?r:{then(a){return Xs(a)(r)},catch(a){return this}}}catch(r){return{then(a){return this},catch(a){return Xs(a)(r)}}}},kc=(s,t)=>(r,a,n)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:w=>w,version:0,merge:(w,v)=>({...v,...w}),...t},l=!1;const o=new Set,c=new Set;let d;try{d=i.getStorage()}catch{}if(!d)return s((...w)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...w)},a,n);const u=Xs(i.serialize),m=()=>{const w=i.partialize({...a()});let v;const L=u({state:w,version:i.version}).then(C=>d.setItem(i.name,C)).catch(C=>{v=C});if(v)throw v;return L},k=n.setState;n.setState=(w,v)=>{k(w,v),m()};const x=s((...w)=>{r(...w),m()},a,n);let b;const g=()=>{var w;if(!d)return;l=!1,o.forEach(L=>L(a()));const v=((w=i.onRehydrateStorage)==null?void 0:w.call(i,a()))||void 0;return Xs(d.getItem.bind(d))(i.name).then(L=>{if(L)return i.deserialize(L)}).then(L=>{if(L)if(typeof L.version=="number"&&L.version!==i.version){if(i.migrate)return i.migrate(L.state,L.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return L.state}).then(L=>{var C;return b=i.merge(L,(C=a())!=null?C:x),r(b,!0),m()}).then(()=>{v==null||v(b,void 0),l=!0,c.forEach(L=>L(b))}).catch(L=>{v==null||v(void 0,L)})};return n.persist={setOptions:w=>{i={...i,...w},w.getStorage&&(d=w.getStorage())},clearStorage:()=>{d==null||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>l,onHydrate:w=>(o.add(w),()=>{o.delete(w)}),onFinishHydration:w=>(c.add(w),()=>{c.delete(w)})},g(),b||x},Sc=(s,t)=>(r,a,n)=>{let i={storage:Nc(()=>localStorage),partialize:g=>g,version:0,merge:(g,w)=>({...w,...g}),...t},l=!1;const o=new Set,c=new Set;let d=i.storage;if(!d)return s((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),r(...g)},a,n);const u=()=>{const g=i.partialize({...a()});return d.setItem(i.name,{state:g,version:i.version})},m=n.setState;n.setState=(g,w)=>{m(g,w),u()};const k=s((...g)=>{r(...g),u()},a,n);n.getInitialState=()=>k;let x;const b=()=>{var g,w;if(!d)return;l=!1,o.forEach(L=>{var C;return L((C=a())!=null?C:k)});const v=((w=i.onRehydrateStorage)==null?void 0:w.call(i,(g=a())!=null?g:k))||void 0;return Xs(d.getItem.bind(d))(i.name).then(L=>{if(L)if(typeof L.version=="number"&&L.version!==i.version){if(i.migrate)return[!0,i.migrate(L.state,L.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,L.state];return[!1,void 0]}).then(L=>{var C;const[M,j]=L;if(x=i.merge(j,(C=a())!=null?C:k),r(x,!0),M)return u()}).then(()=>{v==null||v(x,void 0),x=a(),l=!0,c.forEach(L=>L(x))}).catch(L=>{v==null||v(void 0,L)})};return n.persist={setOptions:g=>{i={...i,...g},g.storage&&(d=g.storage)},clearStorage:()=>{d==null||d.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>b(),hasHydrated:()=>l,onHydrate:g=>(o.add(g),()=>{o.delete(g)}),onFinishHydration:g=>(c.add(g),()=>{c.delete(g)})},i.skipHydration||b(),x||k},_c=(s,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?((wc?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),kc(s,t)):Sc(s,t),Bs=_c;function Mi(s,t){return function(){return s.apply(t,arguments)}}const{toString:Cc}=Object.prototype,{getPrototypeOf:$a}=Object,{iterator:Kr,toStringTag:Ii}=Symbol,Gr=(s=>t=>{const r=Cc.call(t);return s[r]||(s[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Nt=s=>(s=s.toLowerCase(),t=>Gr(t)===s),Jr=s=>t=>typeof t===s,{isArray:Ds}=Array,Ys=Jr("undefined");function lr(s){return s!==null&&!Ys(s)&&s.constructor!==null&&!Ys(s.constructor)&&ot(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const Ri=Nt("ArrayBuffer");function Ac(s){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(s):t=s&&s.buffer&&Ri(s.buffer),t}const Lc=Jr("string"),ot=Jr("function"),Pi=Jr("number"),or=s=>s!==null&&typeof s=="object",Tc=s=>s===!0||s===!1,Nr=s=>{if(Gr(s)!=="object")return!1;const t=$a(s);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Ii in s)&&!(Kr in s)},Ec=s=>{if(!or(s)||lr(s))return!1;try{return Object.keys(s).length===0&&Object.getPrototypeOf(s)===Object.prototype}catch{return!1}},Mc=Nt("Date"),Ic=Nt("File"),Rc=Nt("Blob"),Pc=Nt("FileList"),$c=s=>or(s)&&ot(s.pipe),Bc=s=>{let t;return s&&(typeof FormData=="function"&&s instanceof FormData||ot(s.append)&&((t=Gr(s))==="formdata"||t==="object"&&ot(s.toString)&&s.toString()==="[object FormData]"))},Dc=Nt("URLSearchParams"),[Oc,Fc,zc,Uc]=["ReadableStream","Request","Response","Headers"].map(Nt),Wc=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function cr(s,t,{allOwnKeys:r=!1}={}){if(s===null||typeof s>"u")return;let a,n;if(typeof s!="object"&&(s=[s]),Ds(s))for(a=0,n=s.length;a<n;a++)t.call(null,s[a],a,s);else{if(lr(s))return;const i=r?Object.getOwnPropertyNames(s):Object.keys(s),l=i.length;let o;for(a=0;a<l;a++)o=i[a],t.call(null,s[o],o,s)}}function $i(s,t){if(lr(s))return null;t=t.toLowerCase();const r=Object.keys(s);let a=r.length,n;for(;a-- >0;)if(n=r[a],t===n.toLowerCase())return n;return null}const os=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Bi=s=>!Ys(s)&&s!==os;function pa(){const{caseless:s}=Bi(this)&&this||{},t={},r=(a,n)=>{const i=s&&$i(t,n)||n;Nr(t[i])&&Nr(a)?t[i]=pa(t[i],a):Nr(a)?t[i]=pa({},a):Ds(a)?t[i]=a.slice():t[i]=a};for(let a=0,n=arguments.length;a<n;a++)arguments[a]&&cr(arguments[a],r);return t}const Vc=(s,t,r,{allOwnKeys:a}={})=>(cr(t,(n,i)=>{r&&ot(n)?s[i]=Mi(n,r):s[i]=n},{allOwnKeys:a}),s),Hc=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),qc=(s,t,r,a)=>{s.prototype=Object.create(t.prototype,a),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:t.prototype}),r&&Object.assign(s.prototype,r)},Zc=(s,t,r,a)=>{let n,i,l;const o={};if(t=t||{},s==null)return t;do{for(n=Object.getOwnPropertyNames(s),i=n.length;i-- >0;)l=n[i],(!a||a(l,s,t))&&!o[l]&&(t[l]=s[l],o[l]=!0);s=r!==!1&&$a(s)}while(s&&(!r||r(s,t))&&s!==Object.prototype);return t},Kc=(s,t,r)=>{s=String(s),(r===void 0||r>s.length)&&(r=s.length),r-=t.length;const a=s.indexOf(t,r);return a!==-1&&a===r},Gc=s=>{if(!s)return null;if(Ds(s))return s;let t=s.length;if(!Pi(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=s[t];return r},Jc=(s=>t=>s&&t instanceof s)(typeof Uint8Array<"u"&&$a(Uint8Array)),Qc=(s,t)=>{const a=(s&&s[Kr]).call(s);let n;for(;(n=a.next())&&!n.done;){const i=n.value;t.call(s,i[0],i[1])}},Xc=(s,t)=>{let r;const a=[];for(;(r=s.exec(t))!==null;)a.push(r);return a},Yc=Nt("HTMLFormElement"),ed=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,a,n){return a.toUpperCase()+n}),on=(({hasOwnProperty:s})=>(t,r)=>s.call(t,r))(Object.prototype),td=Nt("RegExp"),Di=(s,t)=>{const r=Object.getOwnPropertyDescriptors(s),a={};cr(r,(n,i)=>{let l;(l=t(n,i,s))!==!1&&(a[i]=l||n)}),Object.defineProperties(s,a)},sd=s=>{Di(s,(t,r)=>{if(ot(s)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const a=s[r];if(ot(a)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},rd=(s,t)=>{const r={},a=n=>{n.forEach(i=>{r[i]=!0})};return Ds(s)?a(s):a(String(s).split(t)),r},ad=()=>{},nd=(s,t)=>s!=null&&Number.isFinite(s=+s)?s:t;function id(s){return!!(s&&ot(s.append)&&s[Ii]==="FormData"&&s[Kr])}const ld=s=>{const t=new Array(10),r=(a,n)=>{if(or(a)){if(t.indexOf(a)>=0)return;if(lr(a))return a;if(!("toJSON"in a)){t[n]=a;const i=Ds(a)?[]:{};return cr(a,(l,o)=>{const c=r(l,n+1);!Ys(c)&&(i[o]=c)}),t[n]=void 0,i}}return a};return r(s,0)},od=Nt("AsyncFunction"),cd=s=>s&&(or(s)||ot(s))&&ot(s.then)&&ot(s.catch),Oi=((s,t)=>s?setImmediate:t?((r,a)=>(os.addEventListener("message",({source:n,data:i})=>{n===os&&i===r&&a.length&&a.shift()()},!1),n=>{a.push(n),os.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",ot(os.postMessage)),dd=typeof queueMicrotask<"u"?queueMicrotask.bind(os):typeof process<"u"&&process.nextTick||Oi,ud=s=>s!=null&&ot(s[Kr]),B={isArray:Ds,isArrayBuffer:Ri,isBuffer:lr,isFormData:Bc,isArrayBufferView:Ac,isString:Lc,isNumber:Pi,isBoolean:Tc,isObject:or,isPlainObject:Nr,isEmptyObject:Ec,isReadableStream:Oc,isRequest:Fc,isResponse:zc,isHeaders:Uc,isUndefined:Ys,isDate:Mc,isFile:Ic,isBlob:Rc,isRegExp:td,isFunction:ot,isStream:$c,isURLSearchParams:Dc,isTypedArray:Jc,isFileList:Pc,forEach:cr,merge:pa,extend:Vc,trim:Wc,stripBOM:Hc,inherits:qc,toFlatObject:Zc,kindOf:Gr,kindOfTest:Nt,endsWith:Kc,toArray:Gc,forEachEntry:Qc,matchAll:Xc,isHTMLForm:Yc,hasOwnProperty:on,hasOwnProp:on,reduceDescriptors:Di,freezeMethods:sd,toObjectSet:rd,toCamelCase:ed,noop:ad,toFiniteNumber:nd,findKey:$i,global:os,isContextDefined:Bi,isSpecCompliantForm:id,toJSONObject:ld,isAsyncFn:od,isThenable:cd,setImmediate:Oi,asap:dd,isIterable:ud};function ye(s,t,r,a,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),a&&(this.request=a),n&&(this.response=n,this.status=n.status?n.status:null)}B.inherits(ye,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:B.toJSONObject(this.config),code:this.code,status:this.status}}});const Fi=ye.prototype,zi={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{zi[s]={value:s}});Object.defineProperties(ye,zi);Object.defineProperty(Fi,"isAxiosError",{value:!0});ye.from=(s,t,r,a,n,i)=>{const l=Object.create(Fi);return B.toFlatObject(s,l,function(c){return c!==Error.prototype},o=>o!=="isAxiosError"),ye.call(l,s.message,t,r,a,n),l.cause=s,l.name=s.name,i&&Object.assign(l,i),l};const md=null;function ya(s){return B.isPlainObject(s)||B.isArray(s)}function Ui(s){return B.endsWith(s,"[]")?s.slice(0,-2):s}function cn(s,t,r){return s?s.concat(t).map(function(n,i){return n=Ui(n),!r&&i?"["+n+"]":n}).join(r?".":""):t}function hd(s){return B.isArray(s)&&!s.some(ya)}const xd=B.toFlatObject(B,{},null,function(t){return/^is[A-Z]/.test(t)});function Qr(s,t,r){if(!B.isObject(s))throw new TypeError("target must be an object");t=t||new FormData,r=B.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,w){return!B.isUndefined(w[g])});const a=r.metaTokens,n=r.visitor||u,i=r.dots,l=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&B.isSpecCompliantForm(t);if(!B.isFunction(n))throw new TypeError("visitor must be a function");function d(b){if(b===null)return"";if(B.isDate(b))return b.toISOString();if(B.isBoolean(b))return b.toString();if(!c&&B.isBlob(b))throw new ye("Blob is not supported. Use a Buffer instead.");return B.isArrayBuffer(b)||B.isTypedArray(b)?c&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function u(b,g,w){let v=b;if(b&&!w&&typeof b=="object"){if(B.endsWith(g,"{}"))g=a?g:g.slice(0,-2),b=JSON.stringify(b);else if(B.isArray(b)&&hd(b)||(B.isFileList(b)||B.endsWith(g,"[]"))&&(v=B.toArray(b)))return g=Ui(g),v.forEach(function(C,M){!(B.isUndefined(C)||C===null)&&t.append(l===!0?cn([g],M,i):l===null?g:g+"[]",d(C))}),!1}return ya(b)?!0:(t.append(cn(w,g,i),d(b)),!1)}const m=[],k=Object.assign(xd,{defaultVisitor:u,convertValue:d,isVisitable:ya});function x(b,g){if(!B.isUndefined(b)){if(m.indexOf(b)!==-1)throw Error("Circular reference detected in "+g.join("."));m.push(b),B.forEach(b,function(v,L){(!(B.isUndefined(v)||v===null)&&n.call(t,v,B.isString(L)?L.trim():L,g,k))===!0&&x(v,g?g.concat(L):[L])}),m.pop()}}if(!B.isObject(s))throw new TypeError("data must be an object");return x(s),t}function dn(s){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(a){return t[a]})}function Ba(s,t){this._pairs=[],s&&Qr(s,this,t)}const Wi=Ba.prototype;Wi.append=function(t,r){this._pairs.push([t,r])};Wi.toString=function(t){const r=t?function(a){return t.call(this,a,dn)}:dn;return this._pairs.map(function(n){return r(n[0])+"="+r(n[1])},"").join("&")};function gd(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Vi(s,t,r){if(!t)return s;const a=r&&r.encode||gd;B.isFunction(r)&&(r={serialize:r});const n=r&&r.serialize;let i;if(n?i=n(t,r):i=B.isURLSearchParams(t)?t.toString():new Ba(t,r).toString(a),i){const l=s.indexOf("#");l!==-1&&(s=s.slice(0,l)),s+=(s.indexOf("?")===-1?"?":"&")+i}return s}class un{constructor(){this.handlers=[]}use(t,r,a){return this.handlers.push({fulfilled:t,rejected:r,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){B.forEach(this.handlers,function(a){a!==null&&t(a)})}}const Hi={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},fd=typeof URLSearchParams<"u"?URLSearchParams:Ba,pd=typeof FormData<"u"?FormData:null,yd=typeof Blob<"u"?Blob:null,bd={isBrowser:!0,classes:{URLSearchParams:fd,FormData:pd,Blob:yd},protocols:["http","https","file","blob","url","data"]},Da=typeof window<"u"&&typeof document<"u",ba=typeof navigator=="object"&&navigator||void 0,vd=Da&&(!ba||["ReactNative","NativeScript","NS"].indexOf(ba.product)<0),jd=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",wd=Da&&window.location.href||"http://localhost",Nd=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Da,hasStandardBrowserEnv:vd,hasStandardBrowserWebWorkerEnv:jd,navigator:ba,origin:wd},Symbol.toStringTag,{value:"Module"})),Ye={...Nd,...bd};function kd(s,t){return Qr(s,new Ye.classes.URLSearchParams,{visitor:function(r,a,n,i){return Ye.isNode&&B.isBuffer(r)?(this.append(a,r.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...t})}function Sd(s){return B.matchAll(/\w+|\[(\w*)]/g,s).map(t=>t[0]==="[]"?"":t[1]||t[0])}function _d(s){const t={},r=Object.keys(s);let a;const n=r.length;let i;for(a=0;a<n;a++)i=r[a],t[i]=s[i];return t}function qi(s){function t(r,a,n,i){let l=r[i++];if(l==="__proto__")return!0;const o=Number.isFinite(+l),c=i>=r.length;return l=!l&&B.isArray(n)?n.length:l,c?(B.hasOwnProp(n,l)?n[l]=[n[l],a]:n[l]=a,!o):((!n[l]||!B.isObject(n[l]))&&(n[l]=[]),t(r,a,n[l],i)&&B.isArray(n[l])&&(n[l]=_d(n[l])),!o)}if(B.isFormData(s)&&B.isFunction(s.entries)){const r={};return B.forEachEntry(s,(a,n)=>{t(Sd(a),n,r,0)}),r}return null}function Cd(s,t,r){if(B.isString(s))try{return(t||JSON.parse)(s),B.trim(s)}catch(a){if(a.name!=="SyntaxError")throw a}return(r||JSON.stringify)(s)}const dr={transitional:Hi,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const a=r.getContentType()||"",n=a.indexOf("application/json")>-1,i=B.isObject(t);if(i&&B.isHTMLForm(t)&&(t=new FormData(t)),B.isFormData(t))return n?JSON.stringify(qi(t)):t;if(B.isArrayBuffer(t)||B.isBuffer(t)||B.isStream(t)||B.isFile(t)||B.isBlob(t)||B.isReadableStream(t))return t;if(B.isArrayBufferView(t))return t.buffer;if(B.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(i){if(a.indexOf("application/x-www-form-urlencoded")>-1)return kd(t,this.formSerializer).toString();if((o=B.isFileList(t))||a.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Qr(o?{"files[]":t}:t,c&&new c,this.formSerializer)}}return i||n?(r.setContentType("application/json",!1),Cd(t)):t}],transformResponse:[function(t){const r=this.transitional||dr.transitional,a=r&&r.forcedJSONParsing,n=this.responseType==="json";if(B.isResponse(t)||B.isReadableStream(t))return t;if(t&&B.isString(t)&&(a&&!this.responseType||n)){const l=!(r&&r.silentJSONParsing)&&n;try{return JSON.parse(t)}catch(o){if(l)throw o.name==="SyntaxError"?ye.from(o,ye.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ye.classes.FormData,Blob:Ye.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};B.forEach(["delete","get","head","post","put","patch"],s=>{dr.headers[s]={}});const Ad=B.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ld=s=>{const t={};let r,a,n;return s&&s.split(`
`).forEach(function(l){n=l.indexOf(":"),r=l.substring(0,n).trim().toLowerCase(),a=l.substring(n+1).trim(),!(!r||t[r]&&Ad[r])&&(r==="set-cookie"?t[r]?t[r].push(a):t[r]=[a]:t[r]=t[r]?t[r]+", "+a:a)}),t},mn=Symbol("internals");function Us(s){return s&&String(s).trim().toLowerCase()}function kr(s){return s===!1||s==null?s:B.isArray(s)?s.map(kr):String(s)}function Td(s){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=r.exec(s);)t[a[1]]=a[2];return t}const Ed=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function aa(s,t,r,a,n){if(B.isFunction(a))return a.call(this,t,r);if(n&&(t=r),!!B.isString(t)){if(B.isString(a))return t.indexOf(a)!==-1;if(B.isRegExp(a))return a.test(t)}}function Md(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,r,a)=>r.toUpperCase()+a)}function Id(s,t){const r=B.toCamelCase(" "+t);["get","set","has"].forEach(a=>{Object.defineProperty(s,a+r,{value:function(n,i,l){return this[a].call(this,t,n,i,l)},configurable:!0})})}let ct=class{constructor(t){t&&this.set(t)}set(t,r,a){const n=this;function i(o,c,d){const u=Us(c);if(!u)throw new Error("header name must be a non-empty string");const m=B.findKey(n,u);(!m||n[m]===void 0||d===!0||d===void 0&&n[m]!==!1)&&(n[m||c]=kr(o))}const l=(o,c)=>B.forEach(o,(d,u)=>i(d,u,c));if(B.isPlainObject(t)||t instanceof this.constructor)l(t,r);else if(B.isString(t)&&(t=t.trim())&&!Ed(t))l(Ld(t),r);else if(B.isObject(t)&&B.isIterable(t)){let o={},c,d;for(const u of t){if(!B.isArray(u))throw TypeError("Object iterator must return a key-value pair");o[d=u[0]]=(c=o[d])?B.isArray(c)?[...c,u[1]]:[c,u[1]]:u[1]}l(o,r)}else t!=null&&i(r,t,a);return this}get(t,r){if(t=Us(t),t){const a=B.findKey(this,t);if(a){const n=this[a];if(!r)return n;if(r===!0)return Td(n);if(B.isFunction(r))return r.call(this,n,a);if(B.isRegExp(r))return r.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=Us(t),t){const a=B.findKey(this,t);return!!(a&&this[a]!==void 0&&(!r||aa(this,this[a],a,r)))}return!1}delete(t,r){const a=this;let n=!1;function i(l){if(l=Us(l),l){const o=B.findKey(a,l);o&&(!r||aa(a,a[o],o,r))&&(delete a[o],n=!0)}}return B.isArray(t)?t.forEach(i):i(t),n}clear(t){const r=Object.keys(this);let a=r.length,n=!1;for(;a--;){const i=r[a];(!t||aa(this,this[i],i,t,!0))&&(delete this[i],n=!0)}return n}normalize(t){const r=this,a={};return B.forEach(this,(n,i)=>{const l=B.findKey(a,i);if(l){r[l]=kr(n),delete r[i];return}const o=t?Md(i):String(i).trim();o!==i&&delete r[i],r[o]=kr(n),a[o]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const r=Object.create(null);return B.forEach(this,(a,n)=>{a!=null&&a!==!1&&(r[n]=t&&B.isArray(a)?a.join(", "):a)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,r])=>t+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...r){const a=new this(t);return r.forEach(n=>a.set(n)),a}static accessor(t){const a=(this[mn]=this[mn]={accessors:{}}).accessors,n=this.prototype;function i(l){const o=Us(l);a[o]||(Id(n,l),a[o]=!0)}return B.isArray(t)?t.forEach(i):i(t),this}};ct.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);B.reduceDescriptors(ct.prototype,({value:s},t)=>{let r=t[0].toUpperCase()+t.slice(1);return{get:()=>s,set(a){this[r]=a}}});B.freezeMethods(ct);function na(s,t){const r=this||dr,a=t||r,n=ct.from(a.headers);let i=a.data;return B.forEach(s,function(o){i=o.call(r,i,n.normalize(),t?t.status:void 0)}),n.normalize(),i}function Zi(s){return!!(s&&s.__CANCEL__)}function Os(s,t,r){ye.call(this,s??"canceled",ye.ERR_CANCELED,t,r),this.name="CanceledError"}B.inherits(Os,ye,{__CANCEL__:!0});function Ki(s,t,r){const a=r.config.validateStatus;!r.status||!a||a(r.status)?s(r):t(new ye("Request failed with status code "+r.status,[ye.ERR_BAD_REQUEST,ye.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Rd(s){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return t&&t[1]||""}function Pd(s,t){s=s||10;const r=new Array(s),a=new Array(s);let n=0,i=0,l;return t=t!==void 0?t:1e3,function(c){const d=Date.now(),u=a[i];l||(l=d),r[n]=c,a[n]=d;let m=i,k=0;for(;m!==n;)k+=r[m++],m=m%s;if(n=(n+1)%s,n===i&&(i=(i+1)%s),d-l<t)return;const x=u&&d-u;return x?Math.round(k*1e3/x):void 0}}function $d(s,t){let r=0,a=1e3/t,n,i;const l=(d,u=Date.now())=>{r=u,n=null,i&&(clearTimeout(i),i=null),s(...d)};return[(...d)=>{const u=Date.now(),m=u-r;m>=a?l(d,u):(n=d,i||(i=setTimeout(()=>{i=null,l(n)},a-m)))},()=>n&&l(n)]}const Er=(s,t,r=3)=>{let a=0;const n=Pd(50,250);return $d(i=>{const l=i.loaded,o=i.lengthComputable?i.total:void 0,c=l-a,d=n(c),u=l<=o;a=l;const m={loaded:l,total:o,progress:o?l/o:void 0,bytes:c,rate:d||void 0,estimated:d&&o&&u?(o-l)/d:void 0,event:i,lengthComputable:o!=null,[t?"download":"upload"]:!0};s(m)},r)},hn=(s,t)=>{const r=s!=null;return[a=>t[0]({lengthComputable:r,total:s,loaded:a}),t[1]]},xn=s=>(...t)=>B.asap(()=>s(...t)),Bd=Ye.hasStandardBrowserEnv?((s,t)=>r=>(r=new URL(r,Ye.origin),s.protocol===r.protocol&&s.host===r.host&&(t||s.port===r.port)))(new URL(Ye.origin),Ye.navigator&&/(msie|trident)/i.test(Ye.navigator.userAgent)):()=>!0,Dd=Ye.hasStandardBrowserEnv?{write(s,t,r,a,n,i){const l=[s+"="+encodeURIComponent(t)];B.isNumber(r)&&l.push("expires="+new Date(r).toGMTString()),B.isString(a)&&l.push("path="+a),B.isString(n)&&l.push("domain="+n),i===!0&&l.push("secure"),document.cookie=l.join("; ")},read(s){const t=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Od(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function Fd(s,t){return t?s.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):s}function Gi(s,t,r){let a=!Od(t);return s&&(a||r==!1)?Fd(s,t):t}const gn=s=>s instanceof ct?{...s}:s;function fs(s,t){t=t||{};const r={};function a(d,u,m,k){return B.isPlainObject(d)&&B.isPlainObject(u)?B.merge.call({caseless:k},d,u):B.isPlainObject(u)?B.merge({},u):B.isArray(u)?u.slice():u}function n(d,u,m,k){if(B.isUndefined(u)){if(!B.isUndefined(d))return a(void 0,d,m,k)}else return a(d,u,m,k)}function i(d,u){if(!B.isUndefined(u))return a(void 0,u)}function l(d,u){if(B.isUndefined(u)){if(!B.isUndefined(d))return a(void 0,d)}else return a(void 0,u)}function o(d,u,m){if(m in t)return a(d,u);if(m in s)return a(void 0,d)}const c={url:i,method:i,data:i,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:o,headers:(d,u,m)=>n(gn(d),gn(u),m,!0)};return B.forEach(Object.keys({...s,...t}),function(u){const m=c[u]||n,k=m(s[u],t[u],u);B.isUndefined(k)&&m!==o||(r[u]=k)}),r}const Ji=s=>{const t=fs({},s);let{data:r,withXSRFToken:a,xsrfHeaderName:n,xsrfCookieName:i,headers:l,auth:o}=t;t.headers=l=ct.from(l),t.url=Vi(Gi(t.baseURL,t.url,t.allowAbsoluteUrls),s.params,s.paramsSerializer),o&&l.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let c;if(B.isFormData(r)){if(Ye.hasStandardBrowserEnv||Ye.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((c=l.getContentType())!==!1){const[d,...u]=c?c.split(";").map(m=>m.trim()).filter(Boolean):[];l.setContentType([d||"multipart/form-data",...u].join("; "))}}if(Ye.hasStandardBrowserEnv&&(a&&B.isFunction(a)&&(a=a(t)),a||a!==!1&&Bd(t.url))){const d=n&&i&&Dd.read(i);d&&l.set(n,d)}return t},zd=typeof XMLHttpRequest<"u",Ud=zd&&function(s){return new Promise(function(r,a){const n=Ji(s);let i=n.data;const l=ct.from(n.headers).normalize();let{responseType:o,onUploadProgress:c,onDownloadProgress:d}=n,u,m,k,x,b;function g(){x&&x(),b&&b(),n.cancelToken&&n.cancelToken.unsubscribe(u),n.signal&&n.signal.removeEventListener("abort",u)}let w=new XMLHttpRequest;w.open(n.method.toUpperCase(),n.url,!0),w.timeout=n.timeout;function v(){if(!w)return;const C=ct.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),j={data:!o||o==="text"||o==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:C,config:s,request:w};Ki(function(S){r(S),g()},function(S){a(S),g()},j),w=null}"onloadend"in w?w.onloadend=v:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(v)},w.onabort=function(){w&&(a(new ye("Request aborted",ye.ECONNABORTED,s,w)),w=null)},w.onerror=function(){a(new ye("Network Error",ye.ERR_NETWORK,s,w)),w=null},w.ontimeout=function(){let M=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const j=n.transitional||Hi;n.timeoutErrorMessage&&(M=n.timeoutErrorMessage),a(new ye(M,j.clarifyTimeoutError?ye.ETIMEDOUT:ye.ECONNABORTED,s,w)),w=null},i===void 0&&l.setContentType(null),"setRequestHeader"in w&&B.forEach(l.toJSON(),function(M,j){w.setRequestHeader(j,M)}),B.isUndefined(n.withCredentials)||(w.withCredentials=!!n.withCredentials),o&&o!=="json"&&(w.responseType=n.responseType),d&&([k,b]=Er(d,!0),w.addEventListener("progress",k)),c&&w.upload&&([m,x]=Er(c),w.upload.addEventListener("progress",m),w.upload.addEventListener("loadend",x)),(n.cancelToken||n.signal)&&(u=C=>{w&&(a(!C||C.type?new Os(null,s,w):C),w.abort(),w=null)},n.cancelToken&&n.cancelToken.subscribe(u),n.signal&&(n.signal.aborted?u():n.signal.addEventListener("abort",u)));const L=Rd(n.url);if(L&&Ye.protocols.indexOf(L)===-1){a(new ye("Unsupported protocol "+L+":",ye.ERR_BAD_REQUEST,s));return}w.send(i||null)})},Wd=(s,t)=>{const{length:r}=s=s?s.filter(Boolean):[];if(t||r){let a=new AbortController,n;const i=function(d){if(!n){n=!0,o();const u=d instanceof Error?d:this.reason;a.abort(u instanceof ye?u:new Os(u instanceof Error?u.message:u))}};let l=t&&setTimeout(()=>{l=null,i(new ye(`timeout ${t} of ms exceeded`,ye.ETIMEDOUT))},t);const o=()=>{s&&(l&&clearTimeout(l),l=null,s.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),s=null)};s.forEach(d=>d.addEventListener("abort",i));const{signal:c}=a;return c.unsubscribe=()=>B.asap(o),c}},Vd=function*(s,t){let r=s.byteLength;if(r<t){yield s;return}let a=0,n;for(;a<r;)n=a+t,yield s.slice(a,n),a=n},Hd=async function*(s,t){for await(const r of qd(s))yield*Vd(r,t)},qd=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const t=s.getReader();try{for(;;){const{done:r,value:a}=await t.read();if(r)break;yield a}}finally{await t.cancel()}},fn=(s,t,r,a)=>{const n=Hd(s,t);let i=0,l,o=c=>{l||(l=!0,a&&a(c))};return new ReadableStream({async pull(c){try{const{done:d,value:u}=await n.next();if(d){o(),c.close();return}let m=u.byteLength;if(r){let k=i+=m;r(k)}c.enqueue(new Uint8Array(u))}catch(d){throw o(d),d}},cancel(c){return o(c),n.return()}},{highWaterMark:2})},Xr=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Qi=Xr&&typeof ReadableStream=="function",Zd=Xr&&(typeof TextEncoder=="function"?(s=>t=>s.encode(t))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),Xi=(s,...t)=>{try{return!!s(...t)}catch{return!1}},Kd=Qi&&Xi(()=>{let s=!1;const t=new Request(Ye.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!t}),pn=64*1024,va=Qi&&Xi(()=>B.isReadableStream(new Response("").body)),Mr={stream:va&&(s=>s.body)};Xr&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!Mr[t]&&(Mr[t]=B.isFunction(s[t])?r=>r[t]():(r,a)=>{throw new ye(`Response type '${t}' is not supported`,ye.ERR_NOT_SUPPORT,a)})})})(new Response);const Gd=async s=>{if(s==null)return 0;if(B.isBlob(s))return s.size;if(B.isSpecCompliantForm(s))return(await new Request(Ye.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(B.isArrayBufferView(s)||B.isArrayBuffer(s))return s.byteLength;if(B.isURLSearchParams(s)&&(s=s+""),B.isString(s))return(await Zd(s)).byteLength},Jd=async(s,t)=>{const r=B.toFiniteNumber(s.getContentLength());return r??Gd(t)},Qd=Xr&&(async s=>{let{url:t,method:r,data:a,signal:n,cancelToken:i,timeout:l,onDownloadProgress:o,onUploadProgress:c,responseType:d,headers:u,withCredentials:m="same-origin",fetchOptions:k}=Ji(s);d=d?(d+"").toLowerCase():"text";let x=Wd([n,i&&i.toAbortSignal()],l),b;const g=x&&x.unsubscribe&&(()=>{x.unsubscribe()});let w;try{if(c&&Kd&&r!=="get"&&r!=="head"&&(w=await Jd(u,a))!==0){let j=new Request(t,{method:"POST",body:a,duplex:"half"}),p;if(B.isFormData(a)&&(p=j.headers.get("content-type"))&&u.setContentType(p),j.body){const[S,_]=hn(w,Er(xn(c)));a=fn(j.body,pn,S,_)}}B.isString(m)||(m=m?"include":"omit");const v="credentials"in Request.prototype;b=new Request(t,{...k,signal:x,method:r.toUpperCase(),headers:u.normalize().toJSON(),body:a,duplex:"half",credentials:v?m:void 0});let L=await fetch(b,k);const C=va&&(d==="stream"||d==="response");if(va&&(o||C&&g)){const j={};["status","statusText","headers"].forEach(U=>{j[U]=L[U]});const p=B.toFiniteNumber(L.headers.get("content-length")),[S,_]=o&&hn(p,Er(xn(o),!0))||[];L=new Response(fn(L.body,pn,S,()=>{_&&_(),g&&g()}),j)}d=d||"text";let M=await Mr[B.findKey(Mr,d)||"text"](L,s);return!C&&g&&g(),await new Promise((j,p)=>{Ki(j,p,{data:M,headers:ct.from(L.headers),status:L.status,statusText:L.statusText,config:s,request:b})})}catch(v){throw g&&g(),v&&v.name==="TypeError"&&/Load failed|fetch/i.test(v.message)?Object.assign(new ye("Network Error",ye.ERR_NETWORK,s,b),{cause:v.cause||v}):ye.from(v,v&&v.code,s,b)}}),ja={http:md,xhr:Ud,fetch:Qd};B.forEach(ja,(s,t)=>{if(s){try{Object.defineProperty(s,"name",{value:t})}catch{}Object.defineProperty(s,"adapterName",{value:t})}});const yn=s=>`- ${s}`,Xd=s=>B.isFunction(s)||s===null||s===!1,Yi={getAdapter:s=>{s=B.isArray(s)?s:[s];const{length:t}=s;let r,a;const n={};for(let i=0;i<t;i++){r=s[i];let l;if(a=r,!Xd(r)&&(a=ja[(l=String(r)).toLowerCase()],a===void 0))throw new ye(`Unknown adapter '${l}'`);if(a)break;n[l||"#"+i]=a}if(!a){const i=Object.entries(n).map(([o,c])=>`adapter ${o} `+(c===!1?"is not supported by the environment":"is not available in the build"));let l=t?i.length>1?`since :
`+i.map(yn).join(`
`):" "+yn(i[0]):"as no adapter specified";throw new ye("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return a},adapters:ja};function ia(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new Os(null,s)}function bn(s){return ia(s),s.headers=ct.from(s.headers),s.data=na.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),Yi.getAdapter(s.adapter||dr.adapter)(s).then(function(a){return ia(s),a.data=na.call(s,s.transformResponse,a),a.headers=ct.from(a.headers),a},function(a){return Zi(a)||(ia(s),a&&a.response&&(a.response.data=na.call(s,s.transformResponse,a.response),a.response.headers=ct.from(a.response.headers))),Promise.reject(a)})}const el="1.11.0",Yr={};["object","boolean","number","function","string","symbol"].forEach((s,t)=>{Yr[s]=function(a){return typeof a===s||"a"+(t<1?"n ":" ")+s}});const vn={};Yr.transitional=function(t,r,a){function n(i,l){return"[Axios v"+el+"] Transitional option '"+i+"'"+l+(a?". "+a:"")}return(i,l,o)=>{if(t===!1)throw new ye(n(l," has been removed"+(r?" in "+r:"")),ye.ERR_DEPRECATED);return r&&!vn[l]&&(vn[l]=!0,console.warn(n(l," has been deprecated since v"+r+" and will be removed in the near future"))),t?t(i,l,o):!0}};Yr.spelling=function(t){return(r,a)=>(console.warn(`${a} is likely a misspelling of ${t}`),!0)};function Yd(s,t,r){if(typeof s!="object")throw new ye("options must be an object",ye.ERR_BAD_OPTION_VALUE);const a=Object.keys(s);let n=a.length;for(;n-- >0;){const i=a[n],l=t[i];if(l){const o=s[i],c=o===void 0||l(o,i,s);if(c!==!0)throw new ye("option "+i+" must be "+c,ye.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new ye("Unknown option "+i,ye.ERR_BAD_OPTION)}}const Sr={assertOptions:Yd,validators:Yr},St=Sr.validators;let gs=class{constructor(t){this.defaults=t||{},this.interceptors={request:new un,response:new un}}async request(t,r){try{return await this._request(t,r)}catch(a){if(a instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const i=n.stack?n.stack.replace(/^.+\n/,""):"";try{a.stack?i&&!String(a.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(a.stack+=`
`+i):a.stack=i}catch{}}throw a}}_request(t,r){typeof t=="string"?(r=r||{},r.url=t):r=t||{},r=fs(this.defaults,r);const{transitional:a,paramsSerializer:n,headers:i}=r;a!==void 0&&Sr.assertOptions(a,{silentJSONParsing:St.transitional(St.boolean),forcedJSONParsing:St.transitional(St.boolean),clarifyTimeoutError:St.transitional(St.boolean)},!1),n!=null&&(B.isFunction(n)?r.paramsSerializer={serialize:n}:Sr.assertOptions(n,{encode:St.function,serialize:St.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),Sr.assertOptions(r,{baseUrl:St.spelling("baseURL"),withXsrfToken:St.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let l=i&&B.merge(i.common,i[r.method]);i&&B.forEach(["delete","get","head","post","put","patch","common"],b=>{delete i[b]}),r.headers=ct.concat(l,i);const o=[];let c=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(r)===!1||(c=c&&g.synchronous,o.unshift(g.fulfilled,g.rejected))});const d=[];this.interceptors.response.forEach(function(g){d.push(g.fulfilled,g.rejected)});let u,m=0,k;if(!c){const b=[bn.bind(this),void 0];for(b.unshift(...o),b.push(...d),k=b.length,u=Promise.resolve(r);m<k;)u=u.then(b[m++],b[m++]);return u}k=o.length;let x=r;for(m=0;m<k;){const b=o[m++],g=o[m++];try{x=b(x)}catch(w){g.call(this,w);break}}try{u=bn.call(this,x)}catch(b){return Promise.reject(b)}for(m=0,k=d.length;m<k;)u=u.then(d[m++],d[m++]);return u}getUri(t){t=fs(this.defaults,t);const r=Gi(t.baseURL,t.url,t.allowAbsoluteUrls);return Vi(r,t.params,t.paramsSerializer)}};B.forEach(["delete","get","head","options"],function(t){gs.prototype[t]=function(r,a){return this.request(fs(a||{},{method:t,url:r,data:(a||{}).data}))}});B.forEach(["post","put","patch"],function(t){function r(a){return function(i,l,o){return this.request(fs(o||{},{method:t,headers:a?{"Content-Type":"multipart/form-data"}:{},url:i,data:l}))}}gs.prototype[t]=r(),gs.prototype[t+"Form"]=r(!0)});let e0=class tl{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(i){r=i});const a=this;this.promise.then(n=>{if(!a._listeners)return;let i=a._listeners.length;for(;i-- >0;)a._listeners[i](n);a._listeners=null}),this.promise.then=n=>{let i;const l=new Promise(o=>{a.subscribe(o),i=o}).then(n);return l.cancel=function(){a.unsubscribe(i)},l},t(function(i,l,o){a.reason||(a.reason=new Os(i,l,o),r(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const t=new AbortController,r=a=>{t.abort(a)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new tl(function(n){t=n}),cancel:t}}};function t0(s){return function(r){return s.apply(null,r)}}function s0(s){return B.isObject(s)&&s.isAxiosError===!0}const wa={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(wa).forEach(([s,t])=>{wa[t]=s});function sl(s){const t=new gs(s),r=Mi(gs.prototype.request,t);return B.extend(r,gs.prototype,t,{allOwnKeys:!0}),B.extend(r,t,null,{allOwnKeys:!0}),r.create=function(n){return sl(fs(s,n))},r}const Re=sl(dr);Re.Axios=gs;Re.CanceledError=Os;Re.CancelToken=e0;Re.isCancel=Zi;Re.VERSION=el;Re.toFormData=Qr;Re.AxiosError=ye;Re.Cancel=Re.CanceledError;Re.all=function(t){return Promise.all(t)};Re.spread=t0;Re.isAxiosError=s0;Re.mergeConfig=fs;Re.AxiosHeaders=ct;Re.formToJSON=s=>qi(B.isHTMLForm(s)?new FormData(s):s);Re.getAdapter=Yi.getAdapter;Re.HttpStatusCode=wa;Re.default=Re;const{Axios:jm,AxiosError:wm,CanceledError:Nm,isCancel:km,CancelToken:Sm,VERSION:_m,all:Cm,Cancel:Am,isAxiosError:Lm,spread:Tm,toFormData:Em,AxiosHeaders:Mm,HttpStatusCode:Im,formToJSON:Rm,getAdapter:Pm,mergeConfig:$m}=Re;var _r=(s=>(s.NETWORK="network",s.AUTH="auth",s.VALIDATION="validation",s.SERVER="server",s.WEBSOCKET="websocket",s.API="api",s.UNKNOWN="unknown",s))(_r||{});const ls=class ls{constructor(){Te(this,"errorListeners",[])}static getInstance(){return ls.instance||(ls.instance=new ls),ls.instance}handle(t,r,a=!0){const n=this.parseError(t,r);return this.logError(n),a&&this.showErrorToast(n),this.notifyListeners(n),n}parseError(t,r){const a=Date.now();return t!=null&&t.isAxiosError||t!=null&&t.response?this.parseAxiosError(t,r,a):(t==null?void 0:t.type)==="websocket"||r==="websocket"?{type:"websocket",message:this.getWebSocketErrorMessage(t),details:t,timestamp:a,source:r}:t instanceof Error?{type:"unknown",message:t.message,details:{name:t.name,stack:t.stack},timestamp:a,source:r}:typeof t=="string"?{type:"unknown",message:t,timestamp:a,source:r}:{type:"unknown",message:"发生未知错误",details:t,timestamp:a,source:r}}parseAxiosError(t,r,a){const{response:n,request:i,message:l}=t;if(n){const o=n.status,c=n.data;return o===401?{type:"auth",code:o,message:(c==null?void 0:c.message)||"认证失败，请重新登录",details:c,timestamp:a||Date.now(),source:r}:o===403?{type:"auth",code:o,message:(c==null?void 0:c.message)||"权限不足",details:c,timestamp:a||Date.now(),source:r}:o===422||o===400?{type:"validation",code:o,message:(c==null?void 0:c.message)||"请求参数错误",details:c,timestamp:a||Date.now(),source:r}:o===429?{type:"api",code:o,message:(c==null?void 0:c.message)||"请求过于频繁，请稍后再试",details:c,timestamp:a||Date.now(),source:r}:o>=500?{type:"server",code:o,message:(c==null?void 0:c.message)||"服务器内部错误，请稍后再试",details:c,timestamp:a||Date.now(),source:r}:{type:"api",code:o,message:(c==null?void 0:c.message)||`请求失败 (${o})`,details:c,timestamp:a||Date.now(),source:r}}return i?{type:"network",message:"网络连接失败，请检查网络设置",details:{message:l,request:i},timestamp:a||Date.now(),source:r}:{type:"unknown",message:l||"请求配置错误",details:t,timestamp:a||Date.now(),source:r}}getWebSocketErrorMessage(t){if(t!=null&&t.code)switch(t.code){case 1006:return"连接异常关闭，正在尝试重连...";case 1e3:return"连接正常关闭";case 1001:return"服务器端点离线";case 1002:return"协议错误";case 1003:return"不支持的数据类型";case 1005:return"未收到关闭状态码";case 1011:return"服务器遇到意外情况";default:return`WebSocket连接错误 (${t.code})`}return(t==null?void 0:t.message)||"WebSocket连接失败"}showErrorToast(t){const{type:r,message:a}=t;switch(r){case"auth":E.error(a,{id:"auth-error",duration:5e3,icon:"🔒"});break;case"network":E.error(a,{id:"network-error",duration:6e3,icon:"🌐"});break;case"validation":E.error(a,{id:"validation-error",duration:4e3,icon:"⚠️"});break;case"websocket":E.error(a,{id:"websocket-error",duration:3e3,icon:"🔌"});break;case"server":E.error(a,{id:"server-error",duration:5e3,icon:"🔥"});break;default:E.error(a,{duration:4e3,icon:"❌"})}}logError(t){this.getLogLevel(t.type);const r=`[${t.type.toUpperCase()}] ${t.message}`;console.error(r,{type:t.type,code:t.code,source:t.source,timestamp:t.timestamp})}getLogLevel(t){switch(t){case"auth":case"server":return"error";case"network":case"websocket":return"warn";default:return"info"}}addErrorListener(t){this.errorListeners.push(t)}removeErrorListener(t){this.errorListeners=this.errorListeners.filter(r=>r!==t)}notifyListeners(t){this.errorListeners.forEach(r=>{try{r(t)}catch(a){console.error("Error in error listener:",a)}})}createRetryableHandler(t=3,r=1e3){return async(a,n)=>{let i;for(let l=1;l<=t;l++)try{return await a()}catch(o){i=o;const c=this.parseError(o,n);if(c.type==="auth"||c.type==="validation")throw o;if(l===t)throw this.handle(o,n),o;await new Promise(d=>setTimeout(d,r*Math.pow(2,l-1)))}throw i}}};Te(ls,"instance");let Na=ls;const Oa=Na.getInstance(),rl=(s,t,r=!0)=>Oa.handle(s,t,r),r0=(s,t)=>Oa.createRetryableHandler(s,t),al=(s,t="api")=>{const r=Re.create({baseURL:s,timeout:6e4,headers:{"Content-Type":"application/json"}});return r.interceptors.request.use(a=>{var i;const n=localStorage.getItem("auth-storage");if(n)try{const l=JSON.parse(n),o=((i=l.state)==null?void 0:i.token)||l.token;o?(a.headers.Authorization=`Bearer ${o}`,console.log(`🔑 [${t}] Added token to request:`,o.substring(0,20)+"...")):console.warn(`⚠️ [${t}] No token found in auth data`)}catch(l){console.error(`❌ [${t}] Failed to parse auth data:`,l)}else console.warn(`⚠️ [${t}] No auth data in localStorage`);return a},a=>Promise.reject(a)),r.interceptors.response.use(a=>a,async a=>{var l,o;const n=a.config;if(((l=a.response)==null?void 0:l.status)===401&&!n._retry){if(n._retry=!0,t==="user")try{const c=localStorage.getItem("auth-storage");if(c){const d=JSON.parse(c),u=((o=d.state)==null?void 0:o.token)||d.token;if(u){const k=(await r.post("/auth/refresh",{token:u})).data.token;if(d.state){const x={...d.state,token:k};localStorage.setItem("auth-storage",JSON.stringify({state:x}))}else{const x={...d,token:k};localStorage.setItem("auth-storage",JSON.stringify(x))}return n.headers.Authorization=`Bearer ${k}`,r(n)}}}catch(c){console.error("Token refresh failed:",c)}return console.warn(`${t} service returned 401, clearing auth state`),localStorage.removeItem("auth-storage"),window.location.href="/login",Promise.reject(a)}const i=rl(a,"api-client",!1);return Promise.reject(i)}),r},a0="/api/v1",n0="/api/v1",mt=al(a0,"user"),G=al(n0,"trading"),q=s=>s.data,H=s=>{if(s!=null&&s.type&&(s!=null&&s.message))throw new Error(s.message);const t=rl(s,"api-error",!0);throw new Error(t.message)},Wt={async login(s){try{const t=await mt.post("/auth/login",s),r=q(t);return{user:r.data.user,token:r.data.access_token,refresh_token:r.data.refresh_token}}catch(t){H(t)}},async register(s){try{const t=await mt.post("/auth/register",s),r=q(t);return{user:r.data.user||null,token:r.data.access_token||null,refresh_token:r.data.refresh_token||null}}catch(t){H(t)}},async loginWithGoogle(s){try{const t=await mt.post("/auth/google",{google_token:s}),r=q(t);return{user:r.data.user,token:r.data.access_token,refresh_token:r.data.refresh_token}}catch(t){H(t)}},async forgotPassword(s){try{const t=await mt.post("/auth/forgot-password",{email:s});return q(t)}catch(t){H(t)}},async getProfile(){try{const s=await mt.get("/auth/profile");return q(s)}catch(s){H(s)}},async updateProfile(s){try{const t=await mt.put("/auth/profile",s);return q(t)}catch(t){H(t)}},async refreshToken(){try{const s=await mt.post("/auth/refresh");return q(s)}catch(s){H(s)}},async sendVerificationEmail(){try{const s=await mt.post("/auth/send-verification");return q(s)}catch(s){H(s)}},async verifyEmail(s){try{const t=await mt.post("/auth/verify-email",{token:s});return q(t)}catch(t){H(t)}},async sendPasswordReset(s){try{const t=await mt.post("/auth/password-reset",{email:s});return q(t)}catch(t){H(t)}},async resetPassword(s,t){try{const r=await mt.post("/auth/password-reset/confirm",{token:s,password:t});return q(r)}catch(r){H(r)}},async changePassword(s,t){try{const r=await mt.post("/auth/change-password",{current_password:s,new_password:t});return q(r)}catch(r){H(r)}},async logout(){try{const s=await mt.post("/auth/logout");return q(s)}catch(s){H(s)}}},Je=as()(Bs((s,t)=>({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null,login:async r=>{var a,n;s({isLoading:!0,error:null});try{const i=await Wt.login(r);return s({user:i.user,token:i.token,isAuthenticated:!0,isLoading:!1,error:null}),{success:!0}}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||i.message||"登录失败";let o=l;return l.includes("not found")||l.includes("不存在")?o="用户不存在":(l.includes("password")||l.includes("密码"))&&(o="密码错误"),s({isLoading:!1,error:o}),{success:!1,message:o}}},register:async r=>{var a,n;s({isLoading:!0,error:null});try{const i=await Wt.register(r);return s({user:i.user,token:i.token,isAuthenticated:!0,isLoading:!1,error:null}),{success:!0}}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"注册失败";return s({isLoading:!1,error:l}),{success:!1,message:l}}},loginWithGoogle:async r=>{var a,n;s({isLoading:!0,error:null});try{const i=await Wt.loginWithGoogle(r);return s({user:i.user,token:i.token,isAuthenticated:!0,isLoading:!1,error:null}),{success:!0}}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"Google登录失败";return s({isLoading:!1,error:l}),{success:!1,message:l}}},forgotPassword:async r=>{try{return await Wt.forgotPassword(r),!0}catch{return!1}},resetPassword:async(r,a)=>{try{return await Wt.resetPassword(r,a),!0}catch{return!1}},logout:()=>{s({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null}),E.success("已退出登录")},checkAuth:async()=>{const{token:r,isAuthenticated:a,user:n}=t();if(r&&!(a&&n)){s({isLoading:!0,error:null});try{const i=await Wt.getProfile();s({user:i,isAuthenticated:!0,isLoading:!1,error:null})}catch{s({user:null,token:null,isAuthenticated:!1,isLoading:!1,error:"Token已失效，请重新登录"})}}},updateProfile:async r=>{var a,n;try{const i=await Wt.updateProfile(r);return s(l=>({user:{...l.user,...i},error:null})),E.success("个人资料更新成功"),!0}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"更新失败";return s({error:l}),E.error(l),!1}},refreshToken:async()=>{try{const r=await Wt.refreshToken();return s({token:r.token,error:null}),!0}catch{return t().logout(),!1}},clearError:()=>{s({error:null})}}),{name:"auth-storage",partialize:s=>({token:s.token,user:s.user,isAuthenticated:s.isAuthenticated})})),ea=as()(Bs(s=>({theme:"light",toggleTheme:()=>s(t=>({theme:t.theme==="light"?"dark":"light"})),setTheme:t=>s({theme:t})}),{name:"theme-storage",getStorage:()=>localStorage}));function i0(s={}){const{nonce:t,onScriptLoadSuccess:r,onScriptLoadError:a}=s,[n,i]=y.useState(!1),l=y.useRef(r);l.current=r;const o=y.useRef(a);return o.current=a,y.useEffect(()=>{const c=document.createElement("script");return c.src="https://accounts.google.com/gsi/client",c.async=!0,c.defer=!0,c.nonce=t,c.onload=()=>{var d;i(!0),(d=l.current)===null||d===void 0||d.call(l)},c.onerror=()=>{var d;i(!1),(d=o.current)===null||d===void 0||d.call(o)},document.body.appendChild(c),()=>{document.body.removeChild(c)}},[t]),n}const nl=y.createContext(null);function l0({clientId:s,nonce:t,onScriptLoadSuccess:r,onScriptLoadError:a,children:n}){const i=i0({nonce:t,onScriptLoadSuccess:r,onScriptLoadError:a}),l=y.useMemo(()=>({clientId:s,scriptLoadedSuccessfully:i}),[s,i]);return ze.createElement(nl.Provider,{value:l},n)}function o0(){const s=y.useContext(nl);if(!s)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return s}function c0(s){var t;return(t=s==null?void 0:s.clientId)!==null&&t!==void 0?t:s==null?void 0:s.client_id}const d0={large:40,medium:32,small:20};function u0({onSuccess:s,onError:t,useOneTap:r,promptMomentNotification:a,type:n="standard",theme:i="outline",size:l="large",text:o,shape:c,logo_alignment:d,width:u,locale:m,click_listener:k,containerProps:x,...b}){const g=y.useRef(null),{clientId:w,scriptLoadedSuccessfully:v}=o0(),L=y.useRef(s);L.current=s;const C=y.useRef(t);C.current=t;const M=y.useRef(a);return M.current=a,y.useEffect(()=>{var j,p,S,_,U,re,X,te,R;if(v)return(S=(p=(j=window==null?void 0:window.google)===null||j===void 0?void 0:j.accounts)===null||p===void 0?void 0:p.id)===null||S===void 0||S.initialize({client_id:w,callback:ie=>{var Y;if(!(ie!=null&&ie.credential))return(Y=C.current)===null||Y===void 0?void 0:Y.call(C);const{credential:ge,select_by:T}=ie;L.current({credential:ge,clientId:c0(ie),select_by:T})},...b}),(re=(U=(_=window==null?void 0:window.google)===null||_===void 0?void 0:_.accounts)===null||U===void 0?void 0:U.id)===null||re===void 0||re.renderButton(g.current,{type:n,theme:i,size:l,text:o,shape:c,logo_alignment:d,width:u,locale:m,click_listener:k}),r&&((R=(te=(X=window==null?void 0:window.google)===null||X===void 0?void 0:X.accounts)===null||te===void 0?void 0:te.id)===null||R===void 0||R.prompt(M.current)),()=>{var ie,Y,ge;r&&((ge=(Y=(ie=window==null?void 0:window.google)===null||ie===void 0?void 0:ie.accounts)===null||Y===void 0?void 0:Y.id)===null||ge===void 0||ge.cancel())}},[w,v,r,n,i,l,o,c,d,u,m]),ze.createElement("div",{...x,ref:g,style:{height:d0[l],...x==null?void 0:x.style}})}const m0={zh:{welcomeTitle:"欢迎来到Trademe",welcomeSubtitle:"专业的数字货币策略交易平台",activeUsers:"活跃用户",tradingVolume:"交易量",uptime:"系统稳定性",platformDescription:"基于人工智能的量化交易平台，支持多交易所、自动化策略和智能风控",createAccount:"创建账户",accountLogin:"账户登录",registerSubtitle:"开始您的智能交易之旅",loginSubtitle:"欢迎回来，请登录您的账户",orContinueWith:"或者使用其他方式",username:"用户名",enterUsername:"请输入用户名",email:"邮箱地址",enterEmail:"请输入邮箱地址",password:"密码",enterPassword:"请输入密码",confirmPassword:"确认密码",enterPasswordAgain:"请再次输入密码",forgotPassword:"忘记密码",enterEmailForReset:"输入邮箱以重置密码",sendReset:"发送重置链接",processing:"处理中...",login:"登录",haveAccount:"已有账户？",noAccount:"还没有账户？",loginNow:"立即登录",registerNow:"立即注册",byRegisteringAgree:"注册即表示您同意我们的",termsOfService:"服务条款",and:"和",privacyPolicy:"隐私政策",userNotFound:"用户不存在，请检查邮箱地址",wrongPassword:"密码错误，请重试或重置密码",loginFailed:"登录失败，请重试",loginSuccess:"登录成功",registerSuccess:"注册成功",authError:"认证错误，请重试",googleLoginSuccess:"Google登录成功",googleLoginFailed:"Google登录失败",googleLoginError:"Google登录出错",passwordResetSent:"密码重置链接已发送到您的邮箱",passwordResetFailed:"发送重置链接失败",passwordResetError:"重置密码时出错",wantToRegister:"该用户不存在，是否要注册新账户？",dashboard:"仪表板",strategies:"策略管理",trading:"实盘交易",backtest:"回测分析",aiAssistant:"AI助手",market:"市场数据",portfolio:"投资组合",settings:"设置",logout:"退出登录",profile:"个人资料",notifications:"通知",help:"帮助中心",about:"关于我们",contact:"联系我们",language_setting:"语言",theme_setting:"主题",lightMode:"浅色模式",darkMode:"深色模式",chartTrading:"图表交易",liveTrading:"实盘交易",tradingNotes:"交易心得",apiManagement:"API管理",accountCenter:"账户中心",membershipManagement:"会员管理",personalSettings:"个人设置",tradingOverview:"交易概览",welcomeBack:"欢迎回来",checkTradingDataAndQuickActions:"查看您的交易数据和快速操作",realTimeConnected:"实时连接",connectionLost:"连接断开",totalStrategies:"策略总数",running:"运行中",totalProfit:"总收益",winRate:"胜率",quickActions:"快捷操作",strategiesManagement:"策略管理",viewAndManageStrategies:"查看和管理您的交易策略",startAutomatedTrading:"开始实盘自动化交易",strategyBacktest:"策略回测",testStrategyPerformance:"测试策略历史表现",getIntelligentTradingAdvice:"获取智能交易建议",recentStrategies:"最近策略",viewAll:"查看全部",loadingStrategies:"加载策略中...",viewDetails:"查看详情",noStrategies:"暂无策略",createFirstStrategy:"开始创建您的第一个交易策略",createStrategy:"创建策略",upgradeToCreate:"升级后创建",createStrategyRequiresPremium:"创建策略需要升级到高级版本",stopped:"已停止",tradingPair:"交易对",timeframe:"周期",monitorRunningStrategies:"监控运行中的实盘交易，查看收益和交易详情",totalLiveStrategies:"总实盘数",runningLive:"运行中",stoppedLive:"已停止",pausedLive:"已暂停",searchStrategies:"搜索策略...",allStatus:"全部",paused:"已暂停",strategyName:"策略名称",status:"状态",profitLoss:"盈亏",lastUpdate:"最近更新",actions:"操作",start:"启动",stop:"停止",pause:"暂停",delete:"删除",confirmDelete:"确定要删除策略",strategyDeleted:"策略已删除",strategyStarted:"已启动",strategyStopped:"已停止",strategyPaused:"已暂停",startStrategyRequiresPremium:"启动策略需要高级版本",loadingStrategiesError:"加载实盘失败",strategiesLoaded:"个实盘",noStrategiesMessage:"暂无策略数据",createFirstStrategyMessage:"创建您的第一个交易策略开始实盘交易",selected:"已选中",currentFilter:"当前筛选",clearFilter:"清除筛选",aiChatWelcome:`您好！我是Trademe AI交易助手。我可以帮您：

• 📈 分析市场趋势和技术指标
• 🤖 生成量化交易策略代码
• 💡 提供交易建议和风险评估
• 📊 解读回测结果和优化建议

请告诉我您需要什么帮助？`,aiChatRequiresPremium:"AI对话功能需要升级到高级版本",aiResponseError:"AI响应出错，请重试",sendMessage:"发送",typeMessage:"输入您的问题...",aiTyping:"AI正在思考...",newChat:"新对话",verifyTradingStrategy:"验证您的交易策略，优化投资决策",totalBacktests:"总回测数",completedSuccessfully:"成功完成",executionFailed:"执行失败",createBacktest:"创建回测",backtestHistory:"回测历史",backtestConfig:"回测配置",selectStrategy:"选择策略",strategyRequired:"请选择策略",confirmDeleteBacktest:"确定要删除这个回测吗？",getStrategiesError:"获取策略列表失败",completed:"已完成",failed:"已失败",unknown:"未知",selectOption:"请选择...",required:"必填项",optional:"可选项",shareTradeThoughts:"分享交易心得，学习交流经验",totalNotes:"心得总数",publicNotes:"公开心得",privateNotes:"私密心得",drafts:"草稿",myNotes:"我的心得",publicDiscussion:"公开讨论",createNote:"创建心得",writeTitle:"写下标题",shareTradeStory:"分享您的交易故事、心得体会",selectCategory:"选择分类",technicalAnalysis:"技术分析",fundamentalAnalysis:"基本面分析",strategyDiscussion:"策略探讨",errorReview:"错误复盘",marketView:"市场观点",tradingPairOptional:"交易对（可选）",entryPrice:"入场价格",exitPrice:"出场价格",stopLoss:"止损价格",takeProfit:"止盈价格",positionSize:"仓位大小",tags:"标签",addTag:"添加标签",publicPost:"公开发布",saveDraft:"保存草稿",publishing:"发布中...",saving:"保存中...",searchNotes:"搜索心得...",allCategories:"全部分类",sortBy:"排序方式",newest:"最新",oldest:"最早",mostLiked:"最受欢迎",noNotesMessage:"还没有心得分享",createFirstNote:"写下您的第一篇交易心得",manageExchangeConnections:"管理交易所连接，配置API密钥",totalAPIs:"API总数",activeAPIs:"活跃API",testConnection:"测试连接",addNewAPI:"添加新API",apiKeyManagement:"API密钥管理",exchangeName:"交易所名称",apiKey:"API密钥",secretKey:"密钥Secret",passphrase:"密码短语",permissions:"权限",connectionStatus:"连接状态",connected:"已连接",disconnected:"未连接",editAPI:"编辑API",deleteAPI:"删除API",confirmDeleteAPI:"确定要删除这个API配置吗？",manageAccountAndSettings:"管理账户信息和系统设置",accountInfo:"账户信息",membershipInfo:"会员信息",securitySettings:"安全设置",systemSettings:"系统设置",basicInfo:"基本信息",avatar:"头像",changePassword:"修改密码",twoFactorAuth:"双重验证",currentPlan:"当前套餐",validUntil:"有效期至",upgrade:"升级",renewMembership:"续费会员",usageStatistics:"使用统计",changeAvatar:"更换头像",uploadImage:"上传图片",currentPassword:"当前密码",newPassword:"新密码",confirmNewPassword:"确认新密码",saveChanges:"保存更改",cancel:"取消",basicUser:"初级用户",premiumUser:"高级用户",professionalUser:"专业用户",monthlyFee:"每月",apiKeyBinding:"个API密钥",dailyAIQuota:"每日AI助手额度",tickBacktestMonthly:"每月Tick级数据回测",tradingNotesStorage:"交易心得记录存储",indicatorsStrategies:"个指标/策略",liveInstances:"个实盘"},en:{welcomeTitle:"Welcome to Trademe",welcomeSubtitle:"Professional Cryptocurrency Strategy Trading Platform",activeUsers:"Active Users",tradingVolume:"Trading Volume",uptime:"System Uptime",platformDescription:"AI-powered quantitative trading platform with multi-exchange support, automated strategies, and intelligent risk control",createAccount:"Create Account",accountLogin:"Account Login",registerSubtitle:"Start your intelligent trading journey",loginSubtitle:"Welcome back, please login to your account",orContinueWith:"Or continue with",username:"Username",enterUsername:"Enter username",email:"Email Address",enterEmail:"Enter email address",password:"Password",enterPassword:"Enter password",confirmPassword:"Confirm Password",enterPasswordAgain:"Enter password again",forgotPassword:"Forgot Password",enterEmailForReset:"Enter email to reset password",sendReset:"Send Reset Link",processing:"Processing...",login:"Login",haveAccount:"Already have an account?",noAccount:"Don't have an account?",loginNow:"Login Now",registerNow:"Register Now",byRegisteringAgree:"By registering, you agree to our ",termsOfService:"Terms of Service",and:" and ",privacyPolicy:"Privacy Policy",userNotFound:"User not found, please check email address",wrongPassword:"Wrong password, please try again or reset password",loginFailed:"Login failed, please try again",loginSuccess:"Login successful",registerSuccess:"Registration successful",authError:"Authentication error, please try again",googleLoginSuccess:"Google login successful",googleLoginFailed:"Google login failed",googleLoginError:"Google login error",passwordResetSent:"Password reset link has been sent to your email",passwordResetFailed:"Failed to send reset link",passwordResetError:"Error resetting password",wantToRegister:"User does not exist, would you like to register a new account?",dashboard:"Dashboard",strategies:"Strategies",trading:"Live Trading",backtest:"Backtest",aiAssistant:"AI Assistant",market:"Market Data",portfolio:"Portfolio",settings:"Settings",logout:"Logout",profile:"Profile",notifications:"Notifications",help:"Help Center",about:"About Us",contact:"Contact Us",language_setting:"Language",theme_setting:"Theme",lightMode:"Light Mode",darkMode:"Dark Mode",chartTrading:"Chart Trading",liveTrading:"Live Trading",tradingNotes:"Trading Notes",apiManagement:"API Management",accountCenter:"Account Center",membershipManagement:"Membership Management",personalSettings:"Personal Settings",tradingOverview:"Trading Overview",welcomeBack:"Welcome back",checkTradingDataAndQuickActions:"View your trading data and quick actions",realTimeConnected:"Real-time Connected",connectionLost:"Connection Lost",totalStrategies:"Total Strategies",running:"Running",totalProfit:"Total Profit",winRate:"Win Rate",quickActions:"Quick Actions",strategiesManagement:"Strategies Management",viewAndManageStrategies:"View and manage your trading strategies",startAutomatedTrading:"Start automated live trading",strategyBacktest:"Strategy Backtest",testStrategyPerformance:"Test strategy historical performance",getIntelligentTradingAdvice:"Get intelligent trading advice",recentStrategies:"Recent Strategies",viewAll:"View All",loadingStrategies:"Loading strategies...",viewDetails:"View Details",noStrategies:"No Strategies",createFirstStrategy:"Start creating your first trading strategy",createStrategy:"Create Strategy",upgradeToCreate:"Upgrade to Create",createStrategyRequiresPremium:"Creating strategies requires premium upgrade",stopped:"Stopped",tradingPair:"Trading Pair",timeframe:"Timeframe",monitorRunningStrategies:"Monitor running live strategies, view profits and trading details",totalLiveStrategies:"Total Live Strategies",runningLive:"Running",stoppedLive:"Stopped",pausedLive:"Paused",searchStrategies:"Search strategies...",allStatus:"All",paused:"Paused",strategyName:"Strategy Name",status:"Status",profitLoss:"P&L",lastUpdate:"Last Update",actions:"Actions",start:"Start",stop:"Stop",pause:"Pause",delete:"Delete",confirmDelete:"Are you sure you want to delete strategy",strategyDeleted:"Strategy deleted",strategyStarted:"started",strategyStopped:"stopped",strategyPaused:"paused",startStrategyRequiresPremium:"Starting strategies requires premium version",loadingStrategiesError:"Failed to load live strategies",strategiesLoaded:"live strategies loaded",noStrategiesMessage:"No strategy data available",createFirstStrategyMessage:"Create your first trading strategy to start live trading",selected:"Selected",currentFilter:"Current filter",clearFilter:"Clear filter",aiChatWelcome:`Hello! I am Trademe AI trading assistant. I can help you:

• 📈 Analyze market trends and technical indicators
• 🤖 Generate quantitative trading strategy code
• 💡 Provide trading advice and risk assessment
• 📊 Interpret backtest results and optimization suggestions

What can I help you with?`,aiChatRequiresPremium:"AI chat feature requires premium version upgrade",aiResponseError:"AI response error, please try again",sendMessage:"Send",typeMessage:"Type your question...",aiTyping:"AI is thinking...",newChat:"New Chat",verifyTradingStrategy:"Verify your trading strategies and optimize investment decisions",totalBacktests:"Total Backtests",completedSuccessfully:"Completed Successfully",executionFailed:"Execution Failed",createBacktest:"Create Backtest",backtestHistory:"Backtest History",backtestConfig:"Backtest Configuration",selectStrategy:"Select Strategy",strategyRequired:"Please select a strategy",confirmDeleteBacktest:"Are you sure you want to delete this backtest?",getStrategiesError:"Failed to get strategy list",completed:"Completed",failed:"Failed",unknown:"Unknown",selectOption:"Please select...",required:"Required",optional:"Optional",shareTradeThoughts:"Share trading insights and learn from experiences",totalNotes:"Total Notes",publicNotes:"Public Notes",privateNotes:"Private Notes",drafts:"Drafts",myNotes:"My Notes",publicDiscussion:"Public Discussion",createNote:"Create Note",writeTitle:"Write title",shareTradeStory:"Share your trading story and insights",selectCategory:"Select Category",technicalAnalysis:"Technical Analysis",fundamentalAnalysis:"Fundamental Analysis",strategyDiscussion:"Strategy Discussion",errorReview:"Error Review",marketView:"Market View",tradingPairOptional:"Trading Pair (Optional)",entryPrice:"Entry Price",exitPrice:"Exit Price",stopLoss:"Stop Loss Price",takeProfit:"Take Profit Price",positionSize:"Position Size",tags:"Tags",addTag:"Add Tag",publicPost:"Publish Publicly",saveDraft:"Save Draft",publishing:"Publishing...",saving:"Saving...",searchNotes:"Search notes...",allCategories:"All Categories",sortBy:"Sort By",newest:"Newest",oldest:"Oldest",mostLiked:"Most Liked",noNotesMessage:"No notes shared yet",createFirstNote:"Write your first trading note",manageExchangeConnections:"Manage exchange connections and configure API keys",totalAPIs:"Total APIs",activeAPIs:"Active APIs",testConnection:"Test Connection",addNewAPI:"Add New API",apiKeyManagement:"API Key Management",exchangeName:"Exchange Name",apiKey:"API Key",secretKey:"Secret Key",passphrase:"Passphrase",permissions:"Permissions",connectionStatus:"Connection Status",connected:"Connected",disconnected:"Disconnected",editAPI:"Edit API",deleteAPI:"Delete API",confirmDeleteAPI:"Are you sure you want to delete this API configuration?",manageAccountAndSettings:"Manage account information and system settings",accountInfo:"Account Information",membershipInfo:"Membership Information",securitySettings:"Security Settings",systemSettings:"System Settings",basicInfo:"Basic Information",avatar:"Avatar",changePassword:"Change Password",twoFactorAuth:"Two-Factor Authentication",currentPlan:"Current Plan",validUntil:"Valid Until",upgrade:"Upgrade",renewMembership:"Renew Membership",usageStatistics:"Usage Statistics",changeAvatar:"Change Avatar",uploadImage:"Upload Image",currentPassword:"Current Password",newPassword:"New Password",confirmNewPassword:"Confirm New Password",saveChanges:"Save Changes",cancel:"Cancel",basicUser:"Basic User",premiumUser:"Premium User",professionalUser:"Professional User",monthlyFee:"per month",apiKeyBinding:"API keys",dailyAIQuota:"daily AI assistant quota",tickBacktestMonthly:"monthly tick-level backtests",tradingNotesStorage:"trading notes storage",indicatorsStrategies:"indicators/strategies",liveInstances:"live instances"}},ns=as()(Bs((s,t)=>({language:"zh",setLanguage:r=>s({language:r}),t:r=>{const a=t().language;return m0[a][r]||r}}),{name:"language-storage",getStorage:()=>localStorage})),h0=({data:s=[],title:t="收益率曲线",width:r="100%",height:a=300,className:n="",showBenchmark:i=!1,benchmarkName:l="基准",loading:o=!1})=>{const c=y.useRef(null),d=y.useRef(null);return y.useEffect(()=>{if(c.current)return d.current=jr(c.current),()=>{var u;(u=d.current)==null||u.dispose()}},[]),y.useEffect(()=>{if(!d.current||o)return;if(s.length===0){d.current.clear();return}const u=s.map(C=>new Date(C.timestamp).toLocaleDateString()),m=s.map(C=>C.value),k=i?s.map(C=>C.benchmark||0):[],x=[],b=[];let g=100,w=100;for(let C=0;C<m.length;C++)C===0?(x.push(g),i&&b.push(w)):(g=g*(1+m[C]/100),x.push(g),i&&k[C]!==void 0&&(w=w*(1+k[C]/100),b.push(w)));const v=[{name:"策略收益",type:"line",data:x,smooth:!0,symbol:"none",lineStyle:{color:"#1a3d7c",width:2},areaStyle:{color:new ua(0,0,0,1,[{offset:0,color:"rgba(26, 61, 124, 0.3)"},{offset:1,color:"rgba(26, 61, 124, 0.05)"}])}}];i&&b.length>0&&v.push({name:l,type:"line",data:b,smooth:!0,symbol:"none",lineStyle:{color:"#94a3b8",width:1,type:"dashed"}});const L={title:{text:t,left:0,textStyle:{color:"#1a3d7c",fontSize:16,fontWeight:"bold"}},tooltip:{trigger:"axis",backgroundColor:"rgba(255, 255, 255, 0.95)",borderColor:"#e5e7eb",borderWidth:1,textStyle:{color:"#374151"},formatter:function(C){if(!C||C.length===0)return"";const M=C[0].dataIndex,j=m[M],p=(x[M]-100).toFixed(2);let S=`
            <div style="padding: 8px;">
              <div style="margin-bottom: 4px; font-weight: bold;">${C[0].name}</div>
              <div style="color: #1a3d7c;">
                当日收益: ${j>0?"+":""}${j.toFixed(2)}%
              </div>
              <div style="color: #1a3d7c;">
                累计收益: ${parseFloat(p)>0?"+":""}${p}%
              </div>
          `;if(i&&C.length>1){const _=(b[M]-100).toFixed(2);S+=`
              <div style="color: #94a3b8;">
                ${l}累计: ${parseFloat(_)>0?"+":""}${_}%
              </div>
            `}return S+="</div>",S}},legend:{data:i?["策略收益",l]:["策略收益"],top:35,right:0,textStyle:{color:"#666"}},grid:{left:"3%",right:"4%",bottom:"8%",top:i?"20%":"15%",containLabel:!0},xAxis:{type:"category",data:u,boundaryGap:!1,axisLine:{lineStyle:{color:"#e5e7eb"}},axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:11},splitLine:{show:!1}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#e5e7eb"}},axisTick:{show:!1},axisLabel:{color:"#6b7280",fontSize:11,formatter:"{value}%"},splitLine:{lineStyle:{color:"#f3f4f6",type:"dashed"}}},series:v};d.current.setOption(L,!0)},[s,t,i,l,o]),y.useEffect(()=>{const u=()=>{var m;(m=d.current)==null||m.resize()};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),e.jsxs("div",{className:`relative ${n}`,children:[e.jsx("div",{ref:c,style:{width:r,height:a},className:"bg-white"}),o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"加载中..."})]})}),!o&&s.length===0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("p",{className:"text-gray-500",children:"暂无数据"})]})})]})},x0=({metrics:s,equityCurve:t=[],monthlyReturns:r=[],className:a=""})=>{const n=y.useRef(null),i=y.useRef(null),l=y.useRef(null),o=y.useRef(null),c=y.useRef(null),d=y.useRef(null);return y.useEffect(()=>(n.current&&(o.current=jr(n.current)),i.current&&(c.current=jr(i.current)),l.current&&(d.current=jr(l.current)),()=>{var u,m,k;(u=o.current)==null||u.dispose(),(m=c.current)==null||m.dispose(),(k=d.current)==null||k.dispose()}),[]),y.useEffect(()=>{if(!o.current||t.length===0)return;const u=t.map(g=>new Date(g.timestamp).toLocaleDateString()),m=t.map(g=>g.equity),k=t.map(g=>-Math.abs(g.drawdown)),x=t.map(g=>g.rolling_max),b={title:{text:"权益曲线与回撤分析",left:0,textStyle:{fontSize:16,fontWeight:"bold",color:"#1f2937"}},tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:g=>{const w=g[0].dataIndex;return`
            <div style="padding: 8px;">
              <div style="font-weight: bold; margin-bottom: 4px;">${u[w]}</div>
              <div style="color: #1e40af;">权益: $${m[w].toLocaleString()}</div>
              <div style="color: #dc2626;">回撤: ${k[w].toFixed(2)}%</div>
              <div style="color: #059669;">历史最高: $${x[w].toLocaleString()}</div>
            </div>
          `}},legend:{data:["权益曲线","历史最高","回撤"],top:25},grid:[{left:"8%",right:"8%",top:"15%",height:"50%"},{left:"8%",right:"8%",top:"70%",height:"20%"}],xAxis:[{type:"category",data:u,axisLine:{lineStyle:{color:"#e5e7eb"}},axisTick:{show:!1},axisLabel:{color:"#6b7280",interval:"auto"}},{type:"category",data:u,gridIndex:1,axisLine:{lineStyle:{color:"#e5e7eb"}},axisTick:{show:!1},axisLabel:{show:!1}}],yAxis:[{type:"value",position:"right",axisLine:{lineStyle:{color:"#e5e7eb"}},axisTick:{show:!1},axisLabel:{color:"#6b7280",formatter:g=>"$"+g.toLocaleString()},splitLine:{lineStyle:{color:"#f3f4f6",type:"dashed"}}},{type:"value",gridIndex:1,position:"right",axisLine:{lineStyle:{color:"#e5e7eb"}},axisTick:{show:!1},axisLabel:{color:"#6b7280",formatter:"{value}%"},max:0,min:Math.min(...k)*1.1}],series:[{name:"权益曲线",type:"line",data:m,smooth:!0,symbol:"none",lineStyle:{color:"#1e40af",width:2},areaStyle:{color:new ua(0,0,0,1,[{offset:0,color:"rgba(30, 64, 175, 0.3)"},{offset:1,color:"rgba(30, 64, 175, 0.05)"}])}},{name:"历史最高",type:"line",data:x,smooth:!0,symbol:"none",lineStyle:{color:"#059669",width:1,type:"dashed"}},{name:"回撤",type:"line",data:k,xAxisIndex:1,yAxisIndex:1,smooth:!0,symbol:"none",lineStyle:{color:"#dc2626",width:1},areaStyle:{color:new ua(0,0,0,1,[{offset:0,color:"rgba(220, 38, 38, 0.2)"},{offset:1,color:"rgba(220, 38, 38, 0.05)"}])}}],dataZoom:[{type:"inside",xAxisIndex:[0,1],start:0,end:100}]};o.current.setOption(b,!0)},[t]),y.useEffect(()=>{if(!c.current||r.length===0)return;const u=[...new Set(r.map(b=>b.year))].sort(),m=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],k=r.map(b=>[b.month-1,u.indexOf(b.year),b.return]),x={title:{text:"月度收益热力图",left:0,textStyle:{fontSize:16,fontWeight:"bold",color:"#1f2937"}},tooltip:{position:"top",formatter:b=>{const[g,w,v]=b.data,L=u[w],C=m[g],M=v>=0?"#059669":"#dc2626";return`
            <div style="padding: 8px;">
              <div style="font-weight: bold; margin-bottom: 4px;">${L}年${C}</div>
              <div style="color: ${M};">收益率: ${v.toFixed(2)}%</div>
            </div>
          `}},grid:{height:"60%",top:"15%",left:"10%",right:"10%"},xAxis:{type:"category",data:m,splitArea:{show:!1},axisLine:{lineStyle:{color:"#e5e7eb"}},axisTick:{show:!1},axisLabel:{color:"#6b7280"}},yAxis:{type:"category",data:u.map(b=>b.toString()),splitArea:{show:!1},axisLine:{lineStyle:{color:"#e5e7eb"}},axisTick:{show:!1},axisLabel:{color:"#6b7280"}},visualMap:{min:Math.min(...r.map(b=>b.return)),max:Math.max(...r.map(b=>b.return)),calculable:!0,orient:"horizontal",left:"center",bottom:"5%",inRange:{color:["#dc2626","#ffffff","#059669"]},text:["高收益","低收益"],textStyle:{color:"#6b7280"}},series:[{name:"月度收益",type:"heatmap",data:k,label:{show:!0,formatter:b=>b.data[2].toFixed(1)+"%",color:"#1f2937",fontSize:10},emphasis:{itemStyle:{shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};c.current.setOption(x,!0)},[r]),y.useEffect(()=>{if(!d.current)return;const u={title:{text:"策略性能雷达图",left:0,textStyle:{fontSize:16,fontWeight:"bold",color:"#1f2937"}},tooltip:{trigger:"item",formatter:m=>{const{name:k,value:x}=m;return`<div style="padding: 8px;"><b>${k}</b><br/>评分: ${x}</div>`}},radar:{radius:"70%",center:["50%","55%"],indicator:[{name:"收益能力",max:100},{name:"风险控制",max:100},{name:"稳定性",max:100},{name:"交易效率",max:100},{name:"回撤控制",max:100},{name:"风险收益比",max:100}],axisName:{color:"#6b7280",fontSize:12},splitArea:{areaStyle:{color:["rgba(59, 130, 246, 0.05)","rgba(59, 130, 246, 0.1)"]}},axisLine:{lineStyle:{color:"#e5e7eb"}},splitLine:{lineStyle:{color:"#e5e7eb"}}},series:[{name:"策略性能",type:"radar",data:[{value:[Math.min(Math.max((s.annual_return+50)*2,0),100),Math.min(Math.max(100-s.volatility*2,0),100),Math.min(Math.max(s.sharpe_ratio*30,0),100),Math.min(Math.max(s.win_rate,0),100),Math.min(Math.max(100-Math.abs(s.max_drawdown)*2,0),100),Math.min(Math.max(s.profit_factor*20,0),100)],name:"当前策略",areaStyle:{color:new Ll(.5,.5,1,[{offset:0,color:"rgba(59, 130, 246, 0.3)"},{offset:1,color:"rgba(59, 130, 246, 0.1)"}])},lineStyle:{color:"#3b82f6",width:2},symbol:"circle",symbolSize:6}]}]};d.current.setOption(u,!0)},[s]),y.useEffect(()=>{const u=()=>{var m,k,x;(m=o.current)==null||m.resize(),(k=c.current)==null||k.resize(),(x=d.current)==null||x.resize()};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),e.jsxs("div",{className:`space-y-6 ${a}`,children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${s.total_return>=0?"text-green-600":"text-red-600"}`,children:[s.total_return>=0?"+":"",s.total_return.toFixed(2),"%"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"总收益率"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-600",children:[s.max_drawdown.toFixed(2),"%"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"最大回撤"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${s.sharpe_ratio>=1?"text-green-600":"text-orange-600"}`,children:s.sharpe_ratio.toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-500",children:"夏普比率"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[s.win_rate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"胜率"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:s.sortino_ratio.toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-500",children:"索提诺比率"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:s.calmar_ratio.toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-500",children:"卡尔玛比率"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsx("div",{ref:n,style:{width:"100%",height:"400px"}})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsx("div",{ref:l,style:{width:"100%",height:"400px"}})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsx("div",{ref:i,style:{width:"100%",height:"300px"}})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"详细统计"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"收益指标"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"年化收益率:"}),e.jsxs("span",{className:s.annual_return>=0?"text-green-600":"text-red-600",children:[s.annual_return.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"总交易次数:"}),e.jsx("span",{className:"text-gray-900",children:s.total_trades})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"盈亏比:"}),e.jsx("span",{className:"text-gray-900",children:s.profit_factor.toFixed(2)})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"风险指标"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"波动率:"}),e.jsxs("span",{className:"text-gray-900",children:[s.volatility.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"VaR (95%):"}),e.jsxs("span",{className:"text-red-600",children:[s.var_95.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"CVaR (95%):"}),e.jsxs("span",{className:"text-red-600",children:[s.cvar_95.toFixed(2),"%"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"交易指标"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"平均盈利:"}),e.jsxs("span",{className:"text-green-600",children:[s.avg_win.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"平均亏损:"}),e.jsxs("span",{className:"text-red-600",children:[s.avg_loss.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"最大连胜:"}),e.jsx("span",{className:"text-green-600",children:s.max_consecutive_wins})]})]})]})]})]})]})},g0=()=>{var g;const s=dt(),{isAuthenticated:t,user:r}=Je(),{theme:a}=ea(),{t:n}=ns(),[i,l]=y.useState(null),[o,c]=y.useState([]),[d,u]=y.useState(!1),[m,k]=y.useState(!1),[x,b]=y.useState("90");return y.useEffect(()=>{t&&s("/ai-chat",{replace:!0})},[t,s]),t?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:e.jsxs("div",{className:"w-full max-w-6xl min-h-screen bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 mx-auto transition-colors",children:[e.jsxs("header",{className:"py-4 px-8 flex justify-between items-center border-b border-gray-200 dark:border-gray-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"w-7 h-7 mr-3 text-blue-600 dark:text-blue-400",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),e.jsx("path",{d:"M8 12h8M12 8v8",stroke:"currentColor",strokeWidth:"2"})]}),e.jsx("h1",{className:"text-xl font-bold text-blue-600 dark:text-blue-400 transition-colors",children:"Trademe"})]}),e.jsxs("nav",{className:"flex gap-2",children:[e.jsx("div",{className:"px-4 py-2 rounded-lg text-white font-medium bg-blue-600 dark:bg-blue-600 transition-colors",children:"首页"}),e.jsx(Ge,{to:"/strategies",className:"px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"策略交易"}),e.jsx(Ge,{to:"/trading",className:"px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"图表交易"}),e.jsx(Ge,{to:"/trading-notes",className:"px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"交易心得"}),e.jsx(Ge,{to:"/api-keys",className:"px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"API管理"}),e.jsx(Ge,{to:"/profile",className:"px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"账户中心"})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"w-9 h-9 rounded-full bg-gray-200 overflow-hidden",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-r from-blue-400 to-blue-600 flex items-center justify-center text-white font-semibold",children:(g=r==null?void 0:r.username)==null?void 0:g.charAt(0).toUpperCase()})})})]}),e.jsxs("main",{className:"p-8",children:[e.jsxs("section",{className:"grid grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-xl shadow-sm border border-gray-100 dark:border-gray-600 p-6 flex items-center transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mr-4 bg-blue-100 dark:bg-blue-900",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1721 9z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"APIKEY数量"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d?e.jsx("span",{className:"animate-pulse bg-gray-200 dark:bg-gray-600 rounded h-8 w-16 inline-block"}):e.jsxs(e.Fragment,{children:[(i==null?void 0:i.api_keys.current)||0,e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["/",(i==null?void 0:i.api_keys.limit)||10]})]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-xl shadow-sm border border-gray-100 dark:border-gray-600 p-6 flex items-center transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mr-4 bg-green-100 dark:bg-green-900",children:e.jsx("svg",{className:"w-6 h-6 text-green-600 dark:text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"实盘策略数"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d?e.jsx("span",{className:"animate-pulse bg-gray-200 dark:bg-gray-600 rounded h-8 w-12 inline-block"}):(i==null?void 0:i.live_strategies.current)||0})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-xl shadow-sm border border-gray-100 dark:border-gray-600 p-6 flex items-center transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mr-4 bg-yellow-100 dark:bg-yellow-900",children:e.jsx("svg",{className:"w-6 h-6 text-yellow-600 dark:text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"本月收益率"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:d?e.jsx("span",{className:"animate-pulse bg-gray-200 dark:bg-gray-600 rounded h-8 w-20 inline-block"}):e.jsxs("span",{className:`px-2 py-1 rounded-md ${((i==null?void 0:i.monthly_return)||0)>=0?"bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-400":"bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-400"}`,children:[((i==null?void 0:i.monthly_return)||0)>=0?"+":"",((i==null?void 0:i.monthly_return)||0).toFixed(1),"%"]})})]})]})]}),e.jsx("section",{className:"mb-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-xl shadow-sm border border-gray-100 dark:border-gray-600 p-6 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:"当前收益率曲线"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b("7"),className:`px-3 py-1 rounded-lg text-sm transition-colors ${x==="7"?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-500"}`,children:"近7天"}),e.jsx("button",{onClick:()=>b("30"),className:`px-3 py-1 rounded-lg text-sm transition-colors ${x==="30"?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-500"}`,children:"本月"}),e.jsx("button",{onClick:()=>b("90"),className:`px-3 py-1 rounded-lg text-sm transition-colors ${x==="90"?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-100 dark:bg-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-500"}`,children:"近3月"})]})]}),m?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-500 dark:text-gray-400",children:"加载收益数据..."})]}):e.jsx(h0,{data:o,title:"",height:250,className:"mt-2"})]})})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center transition-colors",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center px-4",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-brand-500 rounded-full flex items-center justify-center mb-4",children:e.jsx("span",{className:"text-white font-bold text-xl",children:"T"})}),e.jsxs("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-4 transition-colors",children:["欢迎使用 ",e.jsx("span",{className:"text-brand-500",children:"Trademe"})]}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-300 mb-8 transition-colors",children:"专业的数字货币策略交易平台，集成AI智能分析"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 mb-12",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 transition-colors",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-gradient-to-r from-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("h3",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white text-center",children:"AI策略回测"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 leading-relaxed",children:"使用Claude 4先进AI技术，将您的交易想法智能转化为专业策略代码。平台提供tick级别的高精度历史数据回测， 确保策略验证的准确性。回测完成后，可一键部署至实盘交易，实现从想法到盈利的完整闭环。"}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Claude 4智能策略生成"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Tick级别高精度回测"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"一键转实盘运行"]})]}),e.jsx(Ge,{to:"/ai-backtest-intro",className:"block",children:e.jsx("button",{className:"w-full py-3 px-6 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-medium rounded-lg hover:from-blue-600 hover:to-cyan-600 transition-all transform hover:scale-105",children:"了解详情"})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 border border-gray-200 dark:border-gray-700 transition-colors",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-gradient-to-r from-green-500 to-emerald-500 rounded-2xl flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsx("h3",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white text-center",children:"AI智能分析"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6 leading-relaxed",children:"通过深度记录和分析您的策略开单情况及手动交易行为，AI助手能够学习您的交易逻辑和风格偏好。 与AI进行深度对话，共同构建个性化的智能交易系统，让AI成为您24小时不间断的专业交易顾问。"}),e.jsxs("div",{className:"space-y-2 mb-6",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"智能交易行为分析"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"个性化交易逻辑学习"]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"24/7智能交易助手"]})]}),e.jsx(Ge,{to:"/ai-analysis-intro",className:"block",children:e.jsx("button",{className:"w-full py-3 px-6 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-medium rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all transform hover:scale-105",children:"了解详情"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-12",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700 text-center transition-colors",children:[e.jsx("div",{className:"w-12 h-12 mx-auto bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-purple-600 dark:text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"多交易所支持"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"支持币安、OKX等主流交易所API，统一管理多个账户"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700 text-center transition-colors",children:[e.jsx("div",{className:"w-12 h-12 mx-auto bg-orange-100 dark:bg-orange-900 rounded-lg flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-orange-600 dark:text-orange-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"安全可靠"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"银行级别的安全加密，API密钥本地加密存储"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 border border-gray-200 dark:border-gray-700 text-center transition-colors",children:[e.jsx("div",{className:"w-12 h-12 mx-auto bg-indigo-100 dark:bg-indigo-900 rounded-lg flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"实时监控"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm",children:"实时监控策略表现，智能风控保护您的资金安全"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center items-center mb-8",children:[e.jsx(Ge,{to:"/login",className:"w-full sm:w-auto",children:e.jsx("button",{className:"w-full sm:w-auto px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg",children:"免费开始使用"})}),e.jsx(Ge,{to:"/pricing",className:"w-full sm:w-auto",children:e.jsx("button",{className:"w-full sm:w-auto px-8 py-4 bg-transparent border-2 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-xl hover:border-blue-500 dark:hover:border-blue-400 transition-colors",children:"查看会员方案"})})]}),e.jsxs("div",{className:"mt-20 mb-16",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"AI策略回测 - 让想法变成盈利"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto",children:"使用Claude 4先进AI技术，将您的交易想法智能转化为专业策略代码"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-bold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"描述您的策略想法"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:'用自然语言描述您的交易策略思路，比如"当RSI超卖且价格触及支撑位时买入"。 Claude 4能够理解复杂的交易逻辑和技术指标组合。'})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"AI智能策略生成"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"AI自动将您的想法转换为专业的Python交易策略代码，包含完整的开仓、平仓、止损止盈逻辑， 支持多种技术指标和风控机制。"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-bold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"Tick级别精确回测"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"使用真实的tick级别历史数据进行回测，精确模拟每一笔交易的执行过程， 包含滑点、手续费等真实交易成本，确保回测结果的可靠性。"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 dark:bg-orange-900 rounded-lg flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx("span",{className:"text-orange-600 dark:text-orange-400 font-bold",children:"4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"一键转实盘运行"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"回测验证策略有效性后，一键部署到实盘交易环境。 平台自动处理API连接、订单执行、风险控制等技术细节，让您专注于策略优化。"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-8 text-white",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"策略回测报告示例"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"总收益率"}),e.jsx("span",{className:"font-bold text-green-300",children:"+156.8%"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"夏普比率"}),e.jsx("span",{className:"font-bold",children:"2.34"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"最大回撤"}),e.jsx("span",{className:"font-bold text-red-300",children:"-8.5%"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"胜率"}),e.jsx("span",{className:"font-bold",children:"68.2%"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"盈亏比"}),e.jsx("span",{className:"font-bold",children:"2.1:1"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-white/10 rounded-lg",children:[e.jsx("p",{className:"text-sm",children:'"该策略在过去12个月的回测中表现优异，具有较低的风险和稳定的收益。建议配置20%的资金进行实盘交易。"'}),e.jsx("p",{className:"text-xs mt-2 opacity-80",children:"— AI策略分析师"})]})]})]})]}),e.jsxs("div",{className:"mt-20 mb-16",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"AI智能分析 - 您的24/7交易顾问"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto",children:"通过深度学习您的交易行为，构建个性化的智能交易系统"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-teal-600 rounded-2xl p-8 text-white",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"AI学习您的交易模式"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-white/10 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"交易心得记录"}),e.jsx("p",{className:"text-sm opacity-90",children:'"今天在BTCUSDT 45000附近看到双底形态，结合RSI超卖信号， 决定建立多头仓位。设置止损在44500，目标位46500。"'})]}),e.jsxs("div",{className:"p-4 bg-white/10 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"AI分析反馈"}),e.jsx("p",{className:"text-sm opacity-90",children:'"您偏好在技术形态确认后进场，风险控制意识较强。 建议在类似条件下可以适当加大仓位，历史胜率达72%。"'})]}),e.jsxs("div",{className:"p-4 bg-white/10 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"交易建议"}),e.jsx("p",{className:"text-sm opacity-90",children:'"当前ETHUSDT出现类似的双底+RSI超卖组合， 基于您的交易风格，建议关注入场机会。"'})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx("span",{className:"text-green-600 dark:text-green-400 font-bold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"记录交易心得"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"详细记录每次交易的思路、进场逻辑、情绪状态等。 平台支持文字、图片、语音等多种形式，让记录更加便捷真实。"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-bold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"AI深度学习"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"AI分析您的交易记录，识别成功和失败的交易模式， 学习您的风险偏好、时间习惯、技术分析方法等个性化特征。"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-lg flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-bold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"智能对话分析"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"与AI进行深度对话，讨论市场观点、交易策略、风险控制等。 AI会根据您的历史表现和当前市况，提供个性化的交易建议。"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 dark:bg-orange-900 rounded-lg flex items-center justify-center mr-4 flex-shrink-0",children:e.jsx("span",{className:"text-orange-600 dark:text-orange-400 font-bold",children:"4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-900 dark:text-white",children:"构建专属交易系统"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"基于学习结果，AI帮助构建符合您交易风格的智能系统， 包括自动监控、风险提醒、交易机会推送等功能。"})]})]})]})]})]}),e.jsxs("div",{className:"mt-20 mb-16",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"会员方案"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-300",children:"选择适合您的专业交易方案，开启AI助力的量化交易之旅"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700 transition-colors",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"免费用户"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:["$0",e.jsx("span",{className:"text-lg text-gray-500 dark:text-gray-400",children:"/月"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"体验基础功能"})]}),e.jsxs("ul",{className:"space-y-2 mb-8 text-sm",children:[e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"绑定 1 个API密钥"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"$10 AI对话额度 (总额)"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"无限次K线级回测"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"1KB 交易心得存储"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"1个策略/1个指标"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"1个实盘交易"]})]}),e.jsx("button",{className:"w-full py-3 px-6 bg-gray-600 hover:bg-gray-700 text-white font-medium rounded-lg transition-colors",children:"免费开始"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700 transition-colors",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"初级会员"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:["$19",e.jsx("span",{className:"text-lg text-gray-500 dark:text-gray-400",children:"/月"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"个人交易者首选"})]}),e.jsxs("ul",{className:"space-y-2 mb-8 text-sm",children:[e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"绑定 1 个API密钥"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"每日 $100 AI助手额度"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"每日 5次 Tick级回测"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"无限次K线级回测"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"1MB 交易心得存储"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"2个策略/2个指标"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"2个实盘交易"]})]}),e.jsx("button",{className:"w-full py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"选择初级会员"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 border-2 border-blue-500 relative transition-colors",children:[e.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:e.jsx("span",{className:"bg-blue-500 text-white px-4 py-1 rounded-full text-sm font-medium",children:"推荐"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"高级会员"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:["$99",e.jsx("span",{className:"text-lg text-gray-500 dark:text-gray-400",children:"/月"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"专业交易团队"})]}),e.jsxs("ul",{className:"space-y-2 mb-8 text-sm",children:[e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"绑定 5 个API密钥"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"每日 $100 AI助手额度"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"每月 30次 Tick级回测"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"无限次K线级回测"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"20MB 交易心得存储"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"10个策略/10个指标"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"10个实盘交易"]})]}),e.jsx("button",{className:"w-full py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"选择高级会员"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 border border-gray-200 dark:border-gray-700 transition-colors",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"专业会员"}),e.jsxs("div",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:["$199",e.jsx("span",{className:"text-lg text-gray-500 dark:text-gray-400",children:"/月"})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2",children:"机构投资者"})]}),e.jsxs("ul",{className:"space-y-2 mb-8 text-sm",children:[e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"绑定 10 个API密钥"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"每日 $200 AI对话额度"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"每月 100次 Tick级回测"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"无限次K线级回测"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"50MB 交易心得存储"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"20个策略/20个指标"]}),e.jsxs("li",{className:"flex items-center text-gray-600 dark:text-gray-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"20个实盘交易"]})]}),e.jsx("button",{className:"w-full py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors",children:"选择专业会员"})]})]}),e.jsxs("div",{className:"text-center mt-8",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"💡 AI额度已优化至最佳性价比 • 所有方案包含无限K线回测 • 免费用户可体验完整功能"}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 inline-block",children:e.jsx("p",{className:"text-blue-600 dark:text-blue-400 text-sm font-medium",children:"🎯 推荐：先使用免费账户体验，再根据需要升级付费方案"})})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"遇到问题？联系我们的专业团队"}),e.jsxs("a",{href:"https://t.me/+K2JBhvnMW2AwNGZl",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white font-medium rounded-lg transition-colors",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 0C5.374 0 0 5.373 0 12s5.374 12 12 12 12-5.373 12-12S18.626 0 12 0zm5.568 8.16l-1.61 7.59c-.12.54-.44.67-.9.42l-2.47-1.82-1.19 1.14c-.13.13-.24.24-.5.24l.18-2.51 4.62-4.18c.2-.18-.04-.28-.32-.1L10.42 13l-2.42-.76c-.53-.16-.54-.53.11-.78l9.46-3.64c.44-.16.82.1.68.78z"})}),"加入 Telegram 群聊"]})]})]})})};var ur=s=>s.type==="checkbox",cs=s=>s instanceof Date,st=s=>s==null;const il=s=>typeof s=="object";var Ie=s=>!st(s)&&!Array.isArray(s)&&il(s)&&!cs(s),f0=s=>Ie(s)&&s.target?ur(s.target)?s.target.checked:s.target.value:s,p0=s=>s.substring(0,s.search(/\.\d+(\.|$)/))||s,y0=(s,t)=>s.has(p0(t)),b0=s=>{const t=s.constructor&&s.constructor.prototype;return Ie(t)&&t.hasOwnProperty("isPrototypeOf")},Fa=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function qe(s){let t;const r=Array.isArray(s),a=typeof FileList<"u"?s instanceof FileList:!1;if(s instanceof Date)t=new Date(s);else if(!(Fa&&(s instanceof Blob||a))&&(r||Ie(s)))if(t=r?[]:Object.create(Object.getPrototypeOf(s)),!r&&!b0(s))t=s;else for(const n in s)s.hasOwnProperty(n)&&(t[n]=qe(s[n]));else return s;return t}var ta=s=>/^\w*$/.test(s),De=s=>s===void 0,za=s=>Array.isArray(s)?s.filter(Boolean):[],Ua=s=>za(s.replace(/["|']|\]/g,"").split(/\.|\[/)),ae=(s,t,r)=>{if(!t||!Ie(s))return r;const a=(ta(t)?[t]:Ua(t)).reduce((n,i)=>st(n)?n:n[i],s);return De(a)||a===s?De(s[t])?r:s[t]:a},Ct=s=>typeof s=="boolean",_e=(s,t,r)=>{let a=-1;const n=ta(t)?[t]:Ua(t),i=n.length,l=i-1;for(;++a<i;){const o=n[a];let c=r;if(a!==l){const d=s[o];c=Ie(d)||Array.isArray(d)?d:isNaN(+n[a+1])?{}:[]}if(o==="__proto__"||o==="constructor"||o==="prototype")return;s[o]=c,s=s[o]}};const jn={BLUR:"blur",FOCUS_OUT:"focusout"},jt={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},$t={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},v0=ze.createContext(null);v0.displayName="HookFormContext";var j0=(s,t,r,a=!0)=>{const n={defaultValues:t._defaultValues};for(const i in s)Object.defineProperty(n,i,{get:()=>{const l=i;return t._proxyFormState[l]!==jt.all&&(t._proxyFormState[l]=!a||jt.all),s[l]}});return n};const w0=typeof window<"u"?ze.useLayoutEffect:ze.useEffect;var Mt=s=>typeof s=="string",N0=(s,t,r,a,n)=>Mt(s)?(a&&t.watch.add(s),ae(r,s,n)):Array.isArray(s)?s.map(i=>(a&&t.watch.add(i),ae(r,i))):(a&&(t.watchAll=!0),r),ka=s=>st(s)||!il(s);function Zt(s,t,r=new WeakSet){if(ka(s)||ka(t))return s===t;if(cs(s)&&cs(t))return s.getTime()===t.getTime();const a=Object.keys(s),n=Object.keys(t);if(a.length!==n.length)return!1;if(r.has(s)||r.has(t))return!0;r.add(s),r.add(t);for(const i of a){const l=s[i];if(!n.includes(i))return!1;if(i!=="ref"){const o=t[i];if(cs(l)&&cs(o)||Ie(l)&&Ie(o)||Array.isArray(l)&&Array.isArray(o)?!Zt(l,o,r):l!==o)return!1}}return!0}var ll=(s,t,r,a,n)=>t?{...r[s],types:{...r[s]&&r[s].types?r[s].types:{},[a]:n||!0}}:{},Zs=s=>Array.isArray(s)?s:[s],wn=()=>{let s=[];return{get observers(){return s},next:n=>{for(const i of s)i.next&&i.next(n)},subscribe:n=>(s.push(n),{unsubscribe:()=>{s=s.filter(i=>i!==n)}}),unsubscribe:()=>{s=[]}}},lt=s=>Ie(s)&&!Object.keys(s).length,Wa=s=>s.type==="file",wt=s=>typeof s=="function",Ir=s=>{if(!Fa)return!1;const t=s?s.ownerDocument:0;return s instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},ol=s=>s.type==="select-multiple",Va=s=>s.type==="radio",k0=s=>Va(s)||ur(s),la=s=>Ir(s)&&s.isConnected;function S0(s,t){const r=t.slice(0,-1).length;let a=0;for(;a<r;)s=De(s)?a++:s[t[a++]];return s}function _0(s){for(const t in s)if(s.hasOwnProperty(t)&&!De(s[t]))return!1;return!0}function $e(s,t){const r=Array.isArray(t)?t:ta(t)?[t]:Ua(t),a=r.length===1?s:S0(s,r),n=r.length-1,i=r[n];return a&&delete a[i],n!==0&&(Ie(a)&&lt(a)||Array.isArray(a)&&_0(a))&&$e(s,r.slice(0,-1)),s}var cl=s=>{for(const t in s)if(wt(s[t]))return!0;return!1};function Rr(s,t={}){const r=Array.isArray(s);if(Ie(s)||r)for(const a in s)Array.isArray(s[a])||Ie(s[a])&&!cl(s[a])?(t[a]=Array.isArray(s[a])?[]:{},Rr(s[a],t[a])):st(s[a])||(t[a]=!0);return t}function dl(s,t,r){const a=Array.isArray(s);if(Ie(s)||a)for(const n in s)Array.isArray(s[n])||Ie(s[n])&&!cl(s[n])?De(t)||ka(r[n])?r[n]=Array.isArray(s[n])?Rr(s[n],[]):{...Rr(s[n])}:dl(s[n],st(t)?{}:t[n],r[n]):r[n]=!Zt(s[n],t[n]);return r}var Ws=(s,t)=>dl(s,t,Rr(t));const Nn={value:!1,isValid:!1},kn={value:!0,isValid:!0};var ul=s=>{if(Array.isArray(s)){if(s.length>1){const t=s.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return s[0].checked&&!s[0].disabled?s[0].attributes&&!De(s[0].attributes.value)?De(s[0].value)||s[0].value===""?kn:{value:s[0].value,isValid:!0}:kn:Nn}return Nn},ml=(s,{valueAsNumber:t,valueAsDate:r,setValueAs:a})=>De(s)?s:t?s===""?NaN:s&&+s:r&&Mt(s)?new Date(s):a?a(s):s;const Sn={isValid:!1,value:null};var hl=s=>Array.isArray(s)?s.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,Sn):Sn;function _n(s){const t=s.ref;return Wa(t)?t.files:Va(t)?hl(s.refs).value:ol(t)?[...t.selectedOptions].map(({value:r})=>r):ur(t)?ul(s.refs).value:ml(De(t.value)?s.ref.value:t.value,s)}var C0=(s,t,r,a)=>{const n={};for(const i of s){const l=ae(t,i);l&&_e(n,i,l._f)}return{criteriaMode:r,names:[...s],fields:n,shouldUseNativeValidation:a}},Pr=s=>s instanceof RegExp,Vs=s=>De(s)?s:Pr(s)?s.source:Ie(s)?Pr(s.value)?s.value.source:s.value:s,Cn=s=>({isOnSubmit:!s||s===jt.onSubmit,isOnBlur:s===jt.onBlur,isOnChange:s===jt.onChange,isOnAll:s===jt.all,isOnTouch:s===jt.onTouched});const An="AsyncFunction";var A0=s=>!!s&&!!s.validate&&!!(wt(s.validate)&&s.validate.constructor.name===An||Ie(s.validate)&&Object.values(s.validate).find(t=>t.constructor.name===An)),L0=s=>s.mount&&(s.required||s.min||s.max||s.maxLength||s.minLength||s.pattern||s.validate),Ln=(s,t,r)=>!r&&(t.watchAll||t.watch.has(s)||[...t.watch].some(a=>s.startsWith(a)&&/^\.\w+/.test(s.slice(a.length))));const Ks=(s,t,r,a)=>{for(const n of r||Object.keys(s)){const i=ae(s,n);if(i){const{_f:l,...o}=i;if(l){if(l.refs&&l.refs[0]&&t(l.refs[0],n)&&!a)return!0;if(l.ref&&t(l.ref,l.name)&&!a)return!0;if(Ks(o,t))break}else if(Ie(o)&&Ks(o,t))break}}};function Tn(s,t,r){const a=ae(s,r);if(a||ta(r))return{error:a,name:r};const n=r.split(".");for(;n.length;){const i=n.join("."),l=ae(t,i),o=ae(s,i);if(l&&!Array.isArray(l)&&r!==i)return{name:r};if(o&&o.type)return{name:i,error:o};if(o&&o.root&&o.root.type)return{name:`${i}.root`,error:o.root};n.pop()}return{name:r}}var T0=(s,t,r,a)=>{r(s);const{name:n,...i}=s;return lt(i)||Object.keys(i).length>=Object.keys(t).length||Object.keys(i).find(l=>t[l]===(!a||jt.all))},E0=(s,t,r)=>!s||!t||s===t||Zs(s).some(a=>a&&(r?a===t:a.startsWith(t)||t.startsWith(a))),M0=(s,t,r,a,n)=>n.isOnAll?!1:!r&&n.isOnTouch?!(t||s):(r?a.isOnBlur:n.isOnBlur)?!s:(r?a.isOnChange:n.isOnChange)?s:!0,I0=(s,t)=>!za(ae(s,t)).length&&$e(s,t),R0=(s,t,r)=>{const a=Zs(ae(s,r));return _e(a,"root",t[r]),_e(s,r,a),s},Cr=s=>Mt(s);function En(s,t,r="validate"){if(Cr(s)||Array.isArray(s)&&s.every(Cr)||Ct(s)&&!s)return{type:r,message:Cr(s)?s:"",ref:t}}var vs=s=>Ie(s)&&!Pr(s)?s:{value:s,message:""},Mn=async(s,t,r,a,n,i)=>{const{ref:l,refs:o,required:c,maxLength:d,minLength:u,min:m,max:k,pattern:x,validate:b,name:g,valueAsNumber:w,mount:v}=s._f,L=ae(r,g);if(!v||t.has(g))return{};const C=o?o[0]:l,M=te=>{n&&C.reportValidity&&(C.setCustomValidity(Ct(te)?"":te||""),C.reportValidity())},j={},p=Va(l),S=ur(l),_=p||S,U=(w||Wa(l))&&De(l.value)&&De(L)||Ir(l)&&l.value===""||L===""||Array.isArray(L)&&!L.length,re=ll.bind(null,g,a,j),X=(te,R,ie,Y=$t.maxLength,ge=$t.minLength)=>{const T=te?R:ie;j[g]={type:te?Y:ge,message:T,ref:l,...re(te?Y:ge,T)}};if(i?!Array.isArray(L)||!L.length:c&&(!_&&(U||st(L))||Ct(L)&&!L||S&&!ul(o).isValid||p&&!hl(o).isValid)){const{value:te,message:R}=Cr(c)?{value:!!c,message:c}:vs(c);if(te&&(j[g]={type:$t.required,message:R,ref:C,...re($t.required,R)},!a))return M(R),j}if(!U&&(!st(m)||!st(k))){let te,R;const ie=vs(k),Y=vs(m);if(!st(L)&&!isNaN(L)){const ge=l.valueAsNumber||L&&+L;st(ie.value)||(te=ge>ie.value),st(Y.value)||(R=ge<Y.value)}else{const ge=l.valueAsDate||new Date(L),T=z=>new Date(new Date().toDateString()+" "+z),Z=l.type=="time",oe=l.type=="week";Mt(ie.value)&&L&&(te=Z?T(L)>T(ie.value):oe?L>ie.value:ge>new Date(ie.value)),Mt(Y.value)&&L&&(R=Z?T(L)<T(Y.value):oe?L<Y.value:ge<new Date(Y.value))}if((te||R)&&(X(!!te,ie.message,Y.message,$t.max,$t.min),!a))return M(j[g].message),j}if((d||u)&&!U&&(Mt(L)||i&&Array.isArray(L))){const te=vs(d),R=vs(u),ie=!st(te.value)&&L.length>+te.value,Y=!st(R.value)&&L.length<+R.value;if((ie||Y)&&(X(ie,te.message,R.message),!a))return M(j[g].message),j}if(x&&!U&&Mt(L)){const{value:te,message:R}=vs(x);if(Pr(te)&&!L.match(te)&&(j[g]={type:$t.pattern,message:R,ref:l,...re($t.pattern,R)},!a))return M(R),j}if(b){if(wt(b)){const te=await b(L,r),R=En(te,C);if(R&&(j[g]={...R,...re($t.validate,R.message)},!a))return M(R.message),j}else if(Ie(b)){let te={};for(const R in b){if(!lt(te)&&!a)break;const ie=En(await b[R](L,r),C,R);ie&&(te={...ie,...re(R,ie.message)},M(ie.message),a&&(j[g]=te))}if(!lt(te)&&(j[g]={ref:C,...te},!a))return j}}return M(!0),j};const P0={mode:jt.onSubmit,reValidateMode:jt.onChange,shouldFocusError:!0};function $0(s={}){let t={...P0,...s},r={submitCount:0,isDirty:!1,isReady:!1,isLoading:wt(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},n=Ie(t.defaultValues)||Ie(t.values)?qe(t.defaultValues||t.values)||{}:{},i=t.shouldUnregister?{}:qe(n),l={action:!1,mount:!1,watch:!1},o={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const u={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let m={...u};const k={array:wn(),state:wn()},x=t.criteriaMode===jt.all,b=N=>h=>{clearTimeout(d),d=setTimeout(N,h)},g=async N=>{if(!t.disabled&&(u.isValid||m.isValid||N)){const h=t.resolver?lt((await S()).errors):await U(a,!0);h!==r.isValid&&k.state.next({isValid:h})}},w=(N,h)=>{!t.disabled&&(u.isValidating||u.validatingFields||m.isValidating||m.validatingFields)&&((N||Array.from(o.mount)).forEach(A=>{A&&(h?_e(r.validatingFields,A,h):$e(r.validatingFields,A))}),k.state.next({validatingFields:r.validatingFields,isValidating:!lt(r.validatingFields)}))},v=(N,h=[],A,D,$=!0,O=!0)=>{if(D&&A&&!t.disabled){if(l.action=!0,O&&Array.isArray(ae(a,N))){const V=A(ae(a,N),D.argA,D.argB);$&&_e(a,N,V)}if(O&&Array.isArray(ae(r.errors,N))){const V=A(ae(r.errors,N),D.argA,D.argB);$&&_e(r.errors,N,V),I0(r.errors,N)}if((u.touchedFields||m.touchedFields)&&O&&Array.isArray(ae(r.touchedFields,N))){const V=A(ae(r.touchedFields,N),D.argA,D.argB);$&&_e(r.touchedFields,N,V)}(u.dirtyFields||m.dirtyFields)&&(r.dirtyFields=Ws(n,i)),k.state.next({name:N,isDirty:X(N,h),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else _e(i,N,h)},L=(N,h)=>{_e(r.errors,N,h),k.state.next({errors:r.errors})},C=N=>{r.errors=N,k.state.next({errors:r.errors,isValid:!1})},M=(N,h,A,D)=>{const $=ae(a,N);if($){const O=ae(i,N,De(A)?ae(n,N):A);De(O)||D&&D.defaultChecked||h?_e(i,N,h?O:_n($._f)):ie(N,O),l.mount&&g()}},j=(N,h,A,D,$)=>{let O=!1,V=!1;const ee={name:N};if(!t.disabled){if(!A||D){(u.isDirty||m.isDirty)&&(V=r.isDirty,r.isDirty=ee.isDirty=X(),O=V!==ee.isDirty);const J=Zt(ae(n,N),h);V=!!ae(r.dirtyFields,N),J?$e(r.dirtyFields,N):_e(r.dirtyFields,N,!0),ee.dirtyFields=r.dirtyFields,O=O||(u.dirtyFields||m.dirtyFields)&&V!==!J}if(A){const J=ae(r.touchedFields,N);J||(_e(r.touchedFields,N,A),ee.touchedFields=r.touchedFields,O=O||(u.touchedFields||m.touchedFields)&&J!==A)}O&&$&&k.state.next(ee)}return O?ee:{}},p=(N,h,A,D)=>{const $=ae(r.errors,N),O=(u.isValid||m.isValid)&&Ct(h)&&r.isValid!==h;if(t.delayError&&A?(c=b(()=>L(N,A)),c(t.delayError)):(clearTimeout(d),c=null,A?_e(r.errors,N,A):$e(r.errors,N)),(A?!Zt($,A):$)||!lt(D)||O){const V={...D,...O&&Ct(h)?{isValid:h}:{},errors:r.errors,name:N};r={...r,...V},k.state.next(V)}},S=async N=>{w(N,!0);const h=await t.resolver(i,t.context,C0(N||o.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return w(N),h},_=async N=>{const{errors:h}=await S(N);if(N)for(const A of N){const D=ae(h,A);D?_e(r.errors,A,D):$e(r.errors,A)}else r.errors=h;return h},U=async(N,h,A={valid:!0})=>{for(const D in N){const $=N[D];if($){const{_f:O,...V}=$;if(O){const ee=o.array.has(O.name),J=$._f&&A0($._f);J&&u.validatingFields&&w([D],!0);const Q=await Mn($,o.disabled,i,x,t.shouldUseNativeValidation&&!h,ee);if(J&&u.validatingFields&&w([D]),Q[O.name]&&(A.valid=!1,h))break;!h&&(ae(Q,O.name)?ee?R0(r.errors,Q,O.name):_e(r.errors,O.name,Q[O.name]):$e(r.errors,O.name))}!lt(V)&&await U(V,h,A)}}return A.valid},re=()=>{for(const N of o.unMount){const h=ae(a,N);h&&(h._f.refs?h._f.refs.every(A=>!la(A)):!la(h._f.ref))&&be(N)}o.unMount=new Set},X=(N,h)=>!t.disabled&&(N&&h&&_e(i,N,h),!Zt(z(),n)),te=(N,h,A)=>N0(N,o,{...l.mount?i:De(h)?n:Mt(N)?{[N]:h}:h},A,h),R=N=>za(ae(l.mount?i:n,N,t.shouldUnregister?ae(n,N,[]):[])),ie=(N,h,A={})=>{const D=ae(a,N);let $=h;if(D){const O=D._f;O&&(!O.disabled&&_e(i,N,ml(h,O)),$=Ir(O.ref)&&st(h)?"":h,ol(O.ref)?[...O.ref.options].forEach(V=>V.selected=$.includes(V.value)):O.refs?ur(O.ref)?O.refs.forEach(V=>{(!V.defaultChecked||!V.disabled)&&(Array.isArray($)?V.checked=!!$.find(ee=>ee===V.value):V.checked=$===V.value||!!$)}):O.refs.forEach(V=>V.checked=V.value===$):Wa(O.ref)?O.ref.value="":(O.ref.value=$,O.ref.type||k.state.next({name:N,values:qe(i)})))}(A.shouldDirty||A.shouldTouch)&&j(N,$,A.shouldTouch,A.shouldDirty,!0),A.shouldValidate&&oe(N)},Y=(N,h,A)=>{for(const D in h){if(!h.hasOwnProperty(D))return;const $=h[D],O=N+"."+D,V=ae(a,O);(o.array.has(N)||Ie($)||V&&!V._f)&&!cs($)?Y(O,$,A):ie(O,$,A)}},ge=(N,h,A={})=>{const D=ae(a,N),$=o.array.has(N),O=qe(h);_e(i,N,O),$?(k.array.next({name:N,values:qe(i)}),(u.isDirty||u.dirtyFields||m.isDirty||m.dirtyFields)&&A.shouldDirty&&k.state.next({name:N,dirtyFields:Ws(n,i),isDirty:X(N,O)})):D&&!D._f&&!st(O)?Y(N,O,A):ie(N,O,A),Ln(N,o)&&k.state.next({...r,name:N}),k.state.next({name:l.mount?N:void 0,values:qe(i)})},T=async N=>{l.mount=!0;const h=N.target;let A=h.name,D=!0;const $=ae(a,A),O=J=>{D=Number.isNaN(J)||cs(J)&&isNaN(J.getTime())||Zt(J,ae(i,A,J))},V=Cn(t.mode),ee=Cn(t.reValidateMode);if($){let J,Q;const f=h.type?_n($._f):f0(N),I=N.type===jn.BLUR||N.type===jn.FOCUS_OUT,ue=!L0($._f)&&!t.resolver&&!ae(r.errors,A)&&!$._f.deps||M0(I,ae(r.touchedFields,A),r.isSubmitted,ee,V),Ce=Ln(A,o,I);_e(i,A,f),I?(!h||!h.readOnly)&&($._f.onBlur&&$._f.onBlur(N),c&&c(0)):$._f.onChange&&$._f.onChange(N);const Pe=j(A,f,I),Fs=!lt(Pe)||Ce;if(!I&&k.state.next({name:A,type:N.type,values:qe(i)}),ue)return(u.isValid||m.isValid)&&(t.mode==="onBlur"?I&&g():I||g()),Fs&&k.state.next({name:A,...Ce?{}:Pe});if(!I&&Ce&&k.state.next({...r}),t.resolver){const{errors:ys}=await S([A]);if(O(f),D){const mr=Tn(r.errors,a,A),zs=Tn(ys,a,mr.name||A);J=zs.error,A=zs.name,Q=lt(ys)}}else w([A],!0),J=(await Mn($,o.disabled,i,x,t.shouldUseNativeValidation))[A],w([A]),O(f),D&&(J?Q=!1:(u.isValid||m.isValid)&&(Q=await U(a,!0)));D&&($._f.deps&&oe($._f.deps),p(A,Q,J,Pe))}},Z=(N,h)=>{if(ae(r.errors,h)&&N.focus)return N.focus(),1},oe=async(N,h={})=>{let A,D;const $=Zs(N);if(t.resolver){const O=await _(De(N)?N:$);A=lt(O),D=N?!$.some(V=>ae(O,V)):A}else N?(D=(await Promise.all($.map(async O=>{const V=ae(a,O);return await U(V&&V._f?{[O]:V}:V)}))).every(Boolean),!(!D&&!r.isValid)&&g()):D=A=await U(a);return k.state.next({...!Mt(N)||(u.isValid||m.isValid)&&A!==r.isValid?{}:{name:N},...t.resolver||!N?{isValid:A}:{},errors:r.errors}),h.shouldFocus&&!D&&Ks(a,Z,N?$:o.mount),D},z=N=>{const h={...l.mount?i:n};return De(N)?h:Mt(N)?ae(h,N):N.map(A=>ae(h,A))},F=(N,h)=>({invalid:!!ae((h||r).errors,N),isDirty:!!ae((h||r).dirtyFields,N),error:ae((h||r).errors,N),isValidating:!!ae(r.validatingFields,N),isTouched:!!ae((h||r).touchedFields,N)}),me=N=>{N&&Zs(N).forEach(h=>$e(r.errors,h)),k.state.next({errors:N?r.errors:{}})},Se=(N,h,A)=>{const D=(ae(a,N,{_f:{}})._f||{}).ref,$=ae(r.errors,N)||{},{ref:O,message:V,type:ee,...J}=$;_e(r.errors,N,{...J,...h,ref:D}),k.state.next({name:N,errors:r.errors,isValid:!1}),A&&A.shouldFocus&&D&&D.focus&&D.focus()},nt=(N,h)=>wt(N)?k.state.subscribe({next:A=>"values"in A&&N(te(void 0,h),A)}):te(N,h,!0),pe=N=>k.state.subscribe({next:h=>{E0(N.name,h.name,N.exact)&&T0(h,N.formState||u,it,N.reRenderRoot)&&N.callback({values:{...i},...r,...h,defaultValues:n})}}).unsubscribe,We=N=>(l.mount=!0,m={...m,...N.formState},pe({...N,formState:m})),be=(N,h={})=>{for(const A of N?Zs(N):o.mount)o.mount.delete(A),o.array.delete(A),h.keepValue||($e(a,A),$e(i,A)),!h.keepError&&$e(r.errors,A),!h.keepDirty&&$e(r.dirtyFields,A),!h.keepTouched&&$e(r.touchedFields,A),!h.keepIsValidating&&$e(r.validatingFields,A),!t.shouldUnregister&&!h.keepDefaultValue&&$e(n,A);k.state.next({values:qe(i)}),k.state.next({...r,...h.keepDirty?{isDirty:X()}:{}}),!h.keepIsValid&&g()},ce=({disabled:N,name:h})=>{(Ct(N)&&l.mount||N||o.disabled.has(h))&&(N?o.disabled.add(h):o.disabled.delete(h))},Ae=(N,h={})=>{let A=ae(a,N);const D=Ct(h.disabled)||Ct(t.disabled);return _e(a,N,{...A||{},_f:{...A&&A._f?A._f:{ref:{name:N}},name:N,mount:!0,...h}}),o.mount.add(N),A?ce({disabled:Ct(h.disabled)?h.disabled:t.disabled,name:N}):M(N,!0,h.value),{...D?{disabled:h.disabled||t.disabled}:{},...t.progressive?{required:!!h.required,min:Vs(h.min),max:Vs(h.max),minLength:Vs(h.minLength),maxLength:Vs(h.maxLength),pattern:Vs(h.pattern)}:{},name:N,onChange:T,onBlur:T,ref:$=>{if($){Ae(N,h),A=ae(a,N);const O=De($.value)&&$.querySelectorAll&&$.querySelectorAll("input,select,textarea")[0]||$,V=k0(O),ee=A._f.refs||[];if(V?ee.find(J=>J===O):O===A._f.ref)return;_e(a,N,{_f:{...A._f,...V?{refs:[...ee.filter(la),O,...Array.isArray(ae(n,N))?[{}]:[]],ref:{type:O.type,name:N}}:{ref:O}}}),M(N,!1,void 0,O)}else A=ae(a,N,{}),A._f&&(A._f.mount=!1),(t.shouldUnregister||h.shouldUnregister)&&!(y0(o.array,N)&&l.action)&&o.unMount.add(N)}}},Ke=()=>t.shouldFocusError&&Ks(a,Z,o.mount),Ut=N=>{Ct(N)&&(k.state.next({disabled:N}),Ks(a,(h,A)=>{const D=ae(a,A);D&&(h.disabled=D._f.disabled||N,Array.isArray(D._f.refs)&&D._f.refs.forEach($=>{$.disabled=D._f.disabled||N}))},0,!1))},kt=(N,h)=>async A=>{let D;A&&(A.preventDefault&&A.preventDefault(),A.persist&&A.persist());let $=qe(i);if(k.state.next({isSubmitting:!0}),t.resolver){const{errors:O,values:V}=await S();r.errors=O,$=qe(V)}else await U(a);if(o.disabled.size)for(const O of o.disabled)$e($,O);if($e(r.errors,"root"),lt(r.errors)){k.state.next({errors:{}});try{await N($,A)}catch(O){D=O}}else h&&await h({...r.errors},A),Ke(),setTimeout(Ke);if(k.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:lt(r.errors)&&!D,submitCount:r.submitCount+1,errors:r.errors}),D)throw D},gt=(N,h={})=>{ae(a,N)&&(De(h.defaultValue)?ge(N,qe(ae(n,N))):(ge(N,h.defaultValue),_e(n,N,qe(h.defaultValue))),h.keepTouched||$e(r.touchedFields,N),h.keepDirty||($e(r.dirtyFields,N),r.isDirty=h.defaultValue?X(N,qe(ae(n,N))):X()),h.keepError||($e(r.errors,N),u.isValid&&g()),k.state.next({...r}))},P=(N,h={})=>{const A=N?qe(N):n,D=qe(A),$=lt(N),O=$?n:D;if(h.keepDefaultValues||(n=A),!h.keepValues){if(h.keepDirtyValues){const V=new Set([...o.mount,...Object.keys(Ws(n,i))]);for(const ee of Array.from(V))ae(r.dirtyFields,ee)?_e(O,ee,ae(i,ee)):ge(ee,ae(O,ee))}else{if(Fa&&De(N))for(const V of o.mount){const ee=ae(a,V);if(ee&&ee._f){const J=Array.isArray(ee._f.refs)?ee._f.refs[0]:ee._f.ref;if(Ir(J)){const Q=J.closest("form");if(Q){Q.reset();break}}}}if(h.keepFieldsRef)for(const V of o.mount)ge(V,ae(O,V));else a={}}i=t.shouldUnregister?h.keepDefaultValues?qe(n):{}:qe(O),k.array.next({values:{...O}}),k.state.next({values:{...O}})}o={mount:h.keepDirtyValues?o.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},l.mount=!u.isValid||!!h.keepIsValid||!!h.keepDirtyValues,l.watch=!!t.shouldUnregister,k.state.next({submitCount:h.keepSubmitCount?r.submitCount:0,isDirty:$?!1:h.keepDirty?r.isDirty:!!(h.keepDefaultValues&&!Zt(N,n)),isSubmitted:h.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:$?{}:h.keepDirtyValues?h.keepDefaultValues&&i?Ws(n,i):r.dirtyFields:h.keepDefaultValues&&N?Ws(n,N):h.keepDirty?r.dirtyFields:{},touchedFields:h.keepTouched?r.touchedFields:{},errors:h.keepErrors?r.errors:{},isSubmitSuccessful:h.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:n})},de=(N,h)=>P(wt(N)?N(i):N,h),Ve=(N,h={})=>{const A=ae(a,N),D=A&&A._f;if(D){const $=D.refs?D.refs[0]:D.ref;$.focus&&($.focus(),h.shouldSelect&&wt($.select)&&$.select())}},it=N=>{r={...r,...N}},Le={control:{register:Ae,unregister:be,getFieldState:F,handleSubmit:kt,setError:Se,_subscribe:pe,_runSchema:S,_focusError:Ke,_getWatch:te,_getDirty:X,_setValid:g,_setFieldArray:v,_setDisabledField:ce,_setErrors:C,_getFieldArray:R,_reset:P,_resetDefaultValues:()=>wt(t.defaultValues)&&t.defaultValues().then(N=>{de(N,t.resetOptions),k.state.next({isLoading:!1})}),_removeUnmounted:re,_disableForm:Ut,_subjects:k,_proxyFormState:u,get _fields(){return a},get _formValues(){return i},get _state(){return l},set _state(N){l=N},get _defaultValues(){return n},get _names(){return o},set _names(N){o=N},get _formState(){return r},get _options(){return t},set _options(N){t={...t,...N}}},subscribe:We,trigger:oe,register:Ae,handleSubmit:kt,watch:nt,setValue:ge,getValues:z,reset:de,resetField:gt,clearErrors:me,unregister:be,setError:Se,setFocus:Ve,getFieldState:F};return{...Le,formControl:Le}}function B0(s={}){const t=ze.useRef(void 0),r=ze.useRef(void 0),[a,n]=ze.useState({isDirty:!1,isValidating:!1,isLoading:wt(s.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1,isReady:!1,defaultValues:wt(s.defaultValues)?void 0:s.defaultValues});if(!t.current)if(s.formControl)t.current={...s.formControl,formState:a},s.defaultValues&&!wt(s.defaultValues)&&s.formControl.reset(s.defaultValues,s.resetOptions);else{const{formControl:l,...o}=$0(s);t.current={...o,formState:a}}const i=t.current.control;return i._options=s,w0(()=>{const l=i._subscribe({formState:i._proxyFormState,callback:()=>n({...i._formState}),reRenderRoot:!0});return n(o=>({...o,isReady:!0})),i._formState.isReady=!0,l},[i]),ze.useEffect(()=>i._disableForm(s.disabled),[i,s.disabled]),ze.useEffect(()=>{s.mode&&(i._options.mode=s.mode),s.reValidateMode&&(i._options.reValidateMode=s.reValidateMode)},[i,s.mode,s.reValidateMode]),ze.useEffect(()=>{s.errors&&(i._setErrors(s.errors),i._focusError())},[i,s.errors]),ze.useEffect(()=>{s.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[i,s.shouldUnregister]),ze.useEffect(()=>{if(i._proxyFormState.isDirty){const l=i._getDirty();l!==a.isDirty&&i._subjects.state.next({isDirty:l})}},[i,a.isDirty]),ze.useEffect(()=>{s.values&&!Zt(s.values,r.current)?(i._reset(s.values,{keepFieldsRef:!0,...i._options.resetOptions}),r.current=s.values,n(l=>({...l}))):i._resetDefaultValues()},[i,s.values]),ze.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),t.current.formState=j0(a,i),t.current}const In=(s,t,r)=>{if(s&&"reportValidity"in s){const a=ae(r,t);s.setCustomValidity(a&&a.message||""),s.reportValidity()}},xl=(s,t)=>{for(const r in t.fields){const a=t.fields[r];a&&a.ref&&"reportValidity"in a.ref?In(a.ref,r,s):a.refs&&a.refs.forEach(n=>In(n,r,s))}},D0=(s,t)=>{t.shouldUseNativeValidation&&xl(s,t);const r={};for(const a in s){const n=ae(t.fields,a),i=Object.assign(s[a]||{},{ref:n&&n.ref});if(O0(t.names||Object.keys(s),a)){const l=Object.assign({},ae(r,a));_e(l,"root",i),_e(r,a,l)}else _e(r,a,i)}return r},O0=(s,t)=>s.some(r=>r.startsWith(t+"."));var F0=function(s,t){for(var r={};s.length;){var a=s[0],n=a.code,i=a.message,l=a.path.join(".");if(!r[l])if("unionErrors"in a){var o=a.unionErrors[0].errors[0];r[l]={message:o.message,type:o.code}}else r[l]={message:i,type:n};if("unionErrors"in a&&a.unionErrors.forEach(function(u){return u.errors.forEach(function(m){return s.push(m)})}),t){var c=r[l].types,d=c&&c[a.code];r[l]=ll(l,t,r,n,d?[].concat(d,a.message):a.message)}s.shift()}return r},z0=function(s,t,r){return r===void 0&&(r={}),function(a,n,i){try{return Promise.resolve(function(l,o){try{var c=Promise.resolve(s[r.mode==="sync"?"parse":"parseAsync"](a,t)).then(function(d){return i.shouldUseNativeValidation&&xl({},i),{errors:{},values:r.raw?a:d}})}catch(d){return o(d)}return c&&c.then?c.then(void 0,o):c}(0,function(l){if(function(o){return Array.isArray(o==null?void 0:o.errors)}(l))return{values:{},errors:D0(F0(l.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw l}))}catch(l){return Promise.reject(l)}}},ke;(function(s){s.assertEqual=n=>{};function t(n){}s.assertIs=t;function r(n){throw new Error}s.assertNever=r,s.arrayToEnum=n=>{const i={};for(const l of n)i[l]=l;return i},s.getValidEnumValues=n=>{const i=s.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),l={};for(const o of i)l[o]=n[o];return s.objectValues(l)},s.objectValues=n=>s.objectKeys(n).map(function(i){return n[i]}),s.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const l in n)Object.prototype.hasOwnProperty.call(n,l)&&i.push(l);return i},s.find=(n,i)=>{for(const l of n)if(i(l))return l},s.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function a(n,i=" | "){return n.map(l=>typeof l=="string"?`'${l}'`:l).join(i)}s.joinValues=a,s.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(ke||(ke={}));var Rn;(function(s){s.mergeShapes=(t,r)=>({...t,...r})})(Rn||(Rn={}));const ne=ke.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ht=s=>{switch(typeof s){case"undefined":return ne.undefined;case"string":return ne.string;case"number":return Number.isNaN(s)?ne.nan:ne.number;case"boolean":return ne.boolean;case"function":return ne.function;case"bigint":return ne.bigint;case"symbol":return ne.symbol;case"object":return Array.isArray(s)?ne.array:s===null?ne.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?ne.promise:typeof Map<"u"&&s instanceof Map?ne.map:typeof Set<"u"&&s instanceof Set?ne.set:typeof Date<"u"&&s instanceof Date?ne.date:ne.object;default:return ne.unknown}},K=ke.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class zt extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(i){return i.message},a={_errors:[]},n=i=>{for(const l of i.issues)if(l.code==="invalid_union")l.unionErrors.map(n);else if(l.code==="invalid_return_type")n(l.returnTypeError);else if(l.code==="invalid_arguments")n(l.argumentsError);else if(l.path.length===0)a._errors.push(r(l));else{let o=a,c=0;for(;c<l.path.length;){const d=l.path[c];c===l.path.length-1?(o[d]=o[d]||{_errors:[]},o[d]._errors.push(r(l))):o[d]=o[d]||{_errors:[]},o=o[d],c++}}};return n(this),a}static assert(t){if(!(t instanceof zt))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ke.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r={},a=[];for(const n of this.issues)if(n.path.length>0){const i=n.path[0];r[i]=r[i]||[],r[i].push(t(n))}else a.push(t(n));return{formErrors:a,fieldErrors:r}}get formErrors(){return this.flatten()}}zt.create=s=>new zt(s);const Sa=(s,t)=>{let r;switch(s.code){case K.invalid_type:s.received===ne.undefined?r="Required":r=`Expected ${s.expected}, received ${s.received}`;break;case K.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(s.expected,ke.jsonStringifyReplacer)}`;break;case K.unrecognized_keys:r=`Unrecognized key(s) in object: ${ke.joinValues(s.keys,", ")}`;break;case K.invalid_union:r="Invalid input";break;case K.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ke.joinValues(s.options)}`;break;case K.invalid_enum_value:r=`Invalid enum value. Expected ${ke.joinValues(s.options)}, received '${s.received}'`;break;case K.invalid_arguments:r="Invalid function arguments";break;case K.invalid_return_type:r="Invalid function return type";break;case K.invalid_date:r="Invalid date";break;case K.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(r=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?r=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?r=`Invalid input: must end with "${s.validation.endsWith}"`:ke.assertNever(s.validation):s.validation!=="regex"?r=`Invalid ${s.validation}`:r="Invalid";break;case K.too_small:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="bigint"?r=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:r="Invalid input";break;case K.too_big:s.type==="array"?r=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?r=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?r=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?r=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?r=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:r="Invalid input";break;case K.custom:r="Invalid input";break;case K.invalid_intersection_types:r="Intersection results could not be merged";break;case K.not_multiple_of:r=`Number must be a multiple of ${s.multipleOf}`;break;case K.not_finite:r="Number must be finite";break;default:r=t.defaultError,ke.assertNever(s)}return{message:r}};let U0=Sa;function W0(){return U0}const V0=s=>{const{data:t,path:r,errorMaps:a,issueData:n}=s,i=[...r,...n.path||[]],l={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="";const c=a.filter(d=>!!d).slice().reverse();for(const d of c)o=d(l,{data:t,defaultError:o}).message;return{...n,path:i,message:o}};function se(s,t){const r=W0(),a=V0({issueData:t,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,r,r===Sa?void 0:Sa].filter(n=>!!n)});s.common.issues.push(a)}class xt{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(t,r){const a=[];for(const n of r){if(n.status==="aborted")return he;n.status==="dirty"&&t.dirty(),a.push(n.value)}return{status:t.value,value:a}}static async mergeObjectAsync(t,r){const a=[];for(const n of r){const i=await n.key,l=await n.value;a.push({key:i,value:l})}return xt.mergeObjectSync(t,a)}static mergeObjectSync(t,r){const a={};for(const n of r){const{key:i,value:l}=n;if(i.status==="aborted"||l.status==="aborted")return he;i.status==="dirty"&&t.dirty(),l.status==="dirty"&&t.dirty(),i.value!=="__proto__"&&(typeof l.value<"u"||n.alwaysSet)&&(a[i.value]=l.value)}return{status:t.value,value:a}}}const he=Object.freeze({status:"aborted"}),Hs=s=>({status:"dirty",value:s}),pt=s=>({status:"valid",value:s}),Pn=s=>s.status==="aborted",$n=s=>s.status==="dirty",Is=s=>s.status==="valid",$r=s=>typeof Promise<"u"&&s instanceof Promise;var le;(function(s){s.errToObj=t=>typeof t=="string"?{message:t}:t||{},s.toString=t=>typeof t=="string"?t:t==null?void 0:t.message})(le||(le={}));class ts{constructor(t,r,a,n){this._cachedPath=[],this.parent=t,this.data=r,this._path=a,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Bn=(s,t)=>{if(Is(t))return{success:!0,data:t.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const r=new zt(s.common.issues);return this._error=r,this._error}}};function ve(s){if(!s)return{};const{errorMap:t,invalid_type_error:r,required_error:a,description:n}=s;if(t&&(r||a))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return t?{errorMap:t,description:n}:{errorMap:(l,o)=>{const{message:c}=s;return l.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:c??a??o.defaultError}:l.code!=="invalid_type"?{message:o.defaultError}:{message:c??r??o.defaultError}},description:n}}class we{get description(){return this._def.description}_getType(t){return Ht(t.data)}_getOrReturnCtx(t,r){return r||{common:t.parent.common,data:t.data,parsedType:Ht(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new xt,ctx:{common:t.parent.common,data:t.data,parsedType:Ht(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){const r=this._parse(t);if($r(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(t){const r=this._parse(t);return Promise.resolve(r)}parse(t,r){const a=this.safeParse(t,r);if(a.success)return a.data;throw a.error}safeParse(t,r){const a={common:{issues:[],async:(r==null?void 0:r.async)??!1,contextualErrorMap:r==null?void 0:r.errorMap},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ht(t)},n=this._parseSync({data:t,path:a.path,parent:a});return Bn(a,n)}"~validate"(t){var a,n;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ht(t)};if(!this["~standard"].async)try{const i=this._parseSync({data:t,path:[],parent:r});return Is(i)?{value:i.value}:{issues:r.common.issues}}catch(i){(n=(a=i==null?void 0:i.message)==null?void 0:a.toLowerCase())!=null&&n.includes("encountered")&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:r}).then(i=>Is(i)?{value:i.value}:{issues:r.common.issues})}async parseAsync(t,r){const a=await this.safeParseAsync(t,r);if(a.success)return a.data;throw a.error}async safeParseAsync(t,r){const a={common:{issues:[],contextualErrorMap:r==null?void 0:r.errorMap,async:!0},path:(r==null?void 0:r.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ht(t)},n=this._parse({data:t,path:a.path,parent:a}),i=await($r(n)?n:Promise.resolve(n));return Bn(a,i)}refine(t,r){const a=n=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(n):r;return this._refinement((n,i)=>{const l=t(n),o=()=>i.addIssue({code:K.custom,...a(n)});return typeof Promise<"u"&&l instanceof Promise?l.then(c=>c?!0:(o(),!1)):l?!0:(o(),!1)})}refinement(t,r){return this._refinement((a,n)=>t(a)?!0:(n.addIssue(typeof r=="function"?r(a,n):r),!1))}_refinement(t){return new Ps({schema:this,typeName:xe.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return es.create(this,this._def)}nullable(){return $s.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return It.create(this)}promise(){return Fr.create(this,this._def)}or(t){return Dr.create([this,t],this._def)}and(t){return Or.create(this,t,this._def)}transform(t){return new Ps({...ve(this._def),schema:this,typeName:xe.ZodEffects,effect:{type:"transform",transform:t}})}default(t){const r=typeof t=="function"?t:()=>t;return new Ca({...ve(this._def),innerType:this,defaultValue:r,typeName:xe.ZodDefault})}brand(){return new hu({typeName:xe.ZodBranded,type:this,...ve(this._def)})}catch(t){const r=typeof t=="function"?t:()=>t;return new Aa({...ve(this._def),innerType:this,catchValue:r,typeName:xe.ZodCatch})}describe(t){const r=this.constructor;return new r({...this._def,description:t})}pipe(t){return Ha.create(this,t)}readonly(){return La.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const H0=/^c[^\s-]{8,}$/i,q0=/^[0-9a-z]+$/,Z0=/^[0-9A-HJKMNP-TV-Z]{26}$/i,K0=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,G0=/^[a-z0-9_-]{21}$/i,J0=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Q0=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,X0=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Y0="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let oa;const eu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,tu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,su=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ru=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,au=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nu=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,gl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",iu=new RegExp(`^${gl}$`);function fl(s){let t="[0-5]\\d";s.precision?t=`${t}\\.\\d{${s.precision}}`:s.precision==null&&(t=`${t}(\\.\\d+)?`);const r=s.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}function lu(s){return new RegExp(`^${fl(s)}$`)}function ou(s){let t=`${gl}T${fl(s)}`;const r=[];return r.push(s.local?"Z?":"Z"),s.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,new RegExp(`^${t}$`)}function cu(s,t){return!!((t==="v4"||!t)&&eu.test(s)||(t==="v6"||!t)&&su.test(s))}function du(s,t){if(!J0.test(s))return!1;try{const[r]=s.split(".");if(!r)return!1;const a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(a));return!(typeof n!="object"||n===null||"typ"in n&&(n==null?void 0:n.typ)!=="JWT"||!n.alg||t&&n.alg!==t)}catch{return!1}}function uu(s,t){return!!((t==="v4"||!t)&&tu.test(s)||(t==="v6"||!t)&&ru.test(s))}class Yt extends we{_parse(t){if(this._def.coerce&&(t.data=String(t.data)),this._getType(t)!==ne.string){const i=this._getOrReturnCtx(t);return se(i,{code:K.invalid_type,expected:ne.string,received:i.parsedType}),he}const a=new xt;let n;for(const i of this._def.checks)if(i.kind==="min")t.data.length<i.value&&(n=this._getOrReturnCtx(t,n),se(n,{code:K.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="max")t.data.length>i.value&&(n=this._getOrReturnCtx(t,n),se(n,{code:K.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),a.dirty());else if(i.kind==="length"){const l=t.data.length>i.value,o=t.data.length<i.value;(l||o)&&(n=this._getOrReturnCtx(t,n),l?se(n,{code:K.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&se(n,{code:K.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),a.dirty())}else if(i.kind==="email")X0.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"email",code:K.invalid_string,message:i.message}),a.dirty());else if(i.kind==="emoji")oa||(oa=new RegExp(Y0,"u")),oa.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"emoji",code:K.invalid_string,message:i.message}),a.dirty());else if(i.kind==="uuid")K0.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"uuid",code:K.invalid_string,message:i.message}),a.dirty());else if(i.kind==="nanoid")G0.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"nanoid",code:K.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid")H0.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"cuid",code:K.invalid_string,message:i.message}),a.dirty());else if(i.kind==="cuid2")q0.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"cuid2",code:K.invalid_string,message:i.message}),a.dirty());else if(i.kind==="ulid")Z0.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"ulid",code:K.invalid_string,message:i.message}),a.dirty());else if(i.kind==="url")try{new URL(t.data)}catch{n=this._getOrReturnCtx(t,n),se(n,{validation:"url",code:K.invalid_string,message:i.message}),a.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"regex",code:K.invalid_string,message:i.message}),a.dirty())):i.kind==="trim"?t.data=t.data.trim():i.kind==="includes"?t.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(t,n),se(n,{code:K.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),a.dirty()):i.kind==="toLowerCase"?t.data=t.data.toLowerCase():i.kind==="toUpperCase"?t.data=t.data.toUpperCase():i.kind==="startsWith"?t.data.startsWith(i.value)||(n=this._getOrReturnCtx(t,n),se(n,{code:K.invalid_string,validation:{startsWith:i.value},message:i.message}),a.dirty()):i.kind==="endsWith"?t.data.endsWith(i.value)||(n=this._getOrReturnCtx(t,n),se(n,{code:K.invalid_string,validation:{endsWith:i.value},message:i.message}),a.dirty()):i.kind==="datetime"?ou(i).test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{code:K.invalid_string,validation:"datetime",message:i.message}),a.dirty()):i.kind==="date"?iu.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{code:K.invalid_string,validation:"date",message:i.message}),a.dirty()):i.kind==="time"?lu(i).test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{code:K.invalid_string,validation:"time",message:i.message}),a.dirty()):i.kind==="duration"?Q0.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"duration",code:K.invalid_string,message:i.message}),a.dirty()):i.kind==="ip"?cu(t.data,i.version)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"ip",code:K.invalid_string,message:i.message}),a.dirty()):i.kind==="jwt"?du(t.data,i.alg)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"jwt",code:K.invalid_string,message:i.message}),a.dirty()):i.kind==="cidr"?uu(t.data,i.version)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"cidr",code:K.invalid_string,message:i.message}),a.dirty()):i.kind==="base64"?au.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"base64",code:K.invalid_string,message:i.message}),a.dirty()):i.kind==="base64url"?nu.test(t.data)||(n=this._getOrReturnCtx(t,n),se(n,{validation:"base64url",code:K.invalid_string,message:i.message}),a.dirty()):ke.assertNever(i);return{status:a.value,value:t.data}}_regex(t,r,a){return this.refinement(n=>t.test(n),{validation:r,code:K.invalid_string,...le.errToObj(a)})}_addCheck(t){return new Yt({...this._def,checks:[...this._def.checks,t]})}email(t){return this._addCheck({kind:"email",...le.errToObj(t)})}url(t){return this._addCheck({kind:"url",...le.errToObj(t)})}emoji(t){return this._addCheck({kind:"emoji",...le.errToObj(t)})}uuid(t){return this._addCheck({kind:"uuid",...le.errToObj(t)})}nanoid(t){return this._addCheck({kind:"nanoid",...le.errToObj(t)})}cuid(t){return this._addCheck({kind:"cuid",...le.errToObj(t)})}cuid2(t){return this._addCheck({kind:"cuid2",...le.errToObj(t)})}ulid(t){return this._addCheck({kind:"ulid",...le.errToObj(t)})}base64(t){return this._addCheck({kind:"base64",...le.errToObj(t)})}base64url(t){return this._addCheck({kind:"base64url",...le.errToObj(t)})}jwt(t){return this._addCheck({kind:"jwt",...le.errToObj(t)})}ip(t){return this._addCheck({kind:"ip",...le.errToObj(t)})}cidr(t){return this._addCheck({kind:"cidr",...le.errToObj(t)})}datetime(t){return typeof t=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:t}):this._addCheck({kind:"datetime",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,offset:(t==null?void 0:t.offset)??!1,local:(t==null?void 0:t.local)??!1,...le.errToObj(t==null?void 0:t.message)})}date(t){return this._addCheck({kind:"date",message:t})}time(t){return typeof t=="string"?this._addCheck({kind:"time",precision:null,message:t}):this._addCheck({kind:"time",precision:typeof(t==null?void 0:t.precision)>"u"?null:t==null?void 0:t.precision,...le.errToObj(t==null?void 0:t.message)})}duration(t){return this._addCheck({kind:"duration",...le.errToObj(t)})}regex(t,r){return this._addCheck({kind:"regex",regex:t,...le.errToObj(r)})}includes(t,r){return this._addCheck({kind:"includes",value:t,position:r==null?void 0:r.position,...le.errToObj(r==null?void 0:r.message)})}startsWith(t,r){return this._addCheck({kind:"startsWith",value:t,...le.errToObj(r)})}endsWith(t,r){return this._addCheck({kind:"endsWith",value:t,...le.errToObj(r)})}min(t,r){return this._addCheck({kind:"min",value:t,...le.errToObj(r)})}max(t,r){return this._addCheck({kind:"max",value:t,...le.errToObj(r)})}length(t,r){return this._addCheck({kind:"length",value:t,...le.errToObj(r)})}nonempty(t){return this.min(1,le.errToObj(t))}trim(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(t=>t.kind==="datetime")}get isDate(){return!!this._def.checks.find(t=>t.kind==="date")}get isTime(){return!!this._def.checks.find(t=>t.kind==="time")}get isDuration(){return!!this._def.checks.find(t=>t.kind==="duration")}get isEmail(){return!!this._def.checks.find(t=>t.kind==="email")}get isURL(){return!!this._def.checks.find(t=>t.kind==="url")}get isEmoji(){return!!this._def.checks.find(t=>t.kind==="emoji")}get isUUID(){return!!this._def.checks.find(t=>t.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(t=>t.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(t=>t.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(t=>t.kind==="cuid2")}get isULID(){return!!this._def.checks.find(t=>t.kind==="ulid")}get isIP(){return!!this._def.checks.find(t=>t.kind==="ip")}get isCIDR(){return!!this._def.checks.find(t=>t.kind==="cidr")}get isBase64(){return!!this._def.checks.find(t=>t.kind==="base64")}get isBase64url(){return!!this._def.checks.find(t=>t.kind==="base64url")}get minLength(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxLength(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}Yt.create=s=>new Yt({checks:[],typeName:xe.ZodString,coerce:(s==null?void 0:s.coerce)??!1,...ve(s)});function mu(s,t){const r=(s.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=r>a?r:a,i=Number.parseInt(s.toFixed(n).replace(".","")),l=Number.parseInt(t.toFixed(n).replace(".",""));return i%l/10**n}class er extends we{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(t){if(this._def.coerce&&(t.data=Number(t.data)),this._getType(t)!==ne.number){const i=this._getOrReturnCtx(t);return se(i,{code:K.invalid_type,expected:ne.number,received:i.parsedType}),he}let a;const n=new xt;for(const i of this._def.checks)i.kind==="int"?ke.isInteger(t.data)||(a=this._getOrReturnCtx(t,a),se(a,{code:K.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(a=this._getOrReturnCtx(t,a),se(a,{code:K.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(a=this._getOrReturnCtx(t,a),se(a,{code:K.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?mu(t.data,i.value)!==0&&(a=this._getOrReturnCtx(t,a),se(a,{code:K.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(t.data)||(a=this._getOrReturnCtx(t,a),se(a,{code:K.not_finite,message:i.message}),n.dirty()):ke.assertNever(i);return{status:n.value,value:t.data}}gte(t,r){return this.setLimit("min",t,!0,le.toString(r))}gt(t,r){return this.setLimit("min",t,!1,le.toString(r))}lte(t,r){return this.setLimit("max",t,!0,le.toString(r))}lt(t,r){return this.setLimit("max",t,!1,le.toString(r))}setLimit(t,r,a,n){return new er({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:a,message:le.toString(n)}]})}_addCheck(t){return new er({...this._def,checks:[...this._def.checks,t]})}int(t){return this._addCheck({kind:"int",message:le.toString(t)})}positive(t){return this._addCheck({kind:"min",value:0,inclusive:!1,message:le.toString(t)})}negative(t){return this._addCheck({kind:"max",value:0,inclusive:!1,message:le.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:0,inclusive:!0,message:le.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:0,inclusive:!0,message:le.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:le.toString(r)})}finite(t){return this._addCheck({kind:"finite",message:le.toString(t)})}safe(t){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:le.toString(t)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:le.toString(t)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}get isInt(){return!!this._def.checks.find(t=>t.kind==="int"||t.kind==="multipleOf"&&ke.isInteger(t.value))}get isFinite(){let t=null,r=null;for(const a of this._def.checks){if(a.kind==="finite"||a.kind==="int"||a.kind==="multipleOf")return!0;a.kind==="min"?(r===null||a.value>r)&&(r=a.value):a.kind==="max"&&(t===null||a.value<t)&&(t=a.value)}return Number.isFinite(r)&&Number.isFinite(t)}}er.create=s=>new er({checks:[],typeName:xe.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...ve(s)});class tr extends we{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(t){if(this._def.coerce)try{t.data=BigInt(t.data)}catch{return this._getInvalidInput(t)}if(this._getType(t)!==ne.bigint)return this._getInvalidInput(t);let a;const n=new xt;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?t.data<i.value:t.data<=i.value)&&(a=this._getOrReturnCtx(t,a),se(a,{code:K.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?t.data>i.value:t.data>=i.value)&&(a=this._getOrReturnCtx(t,a),se(a,{code:K.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?t.data%i.value!==BigInt(0)&&(a=this._getOrReturnCtx(t,a),se(a,{code:K.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):ke.assertNever(i);return{status:n.value,value:t.data}}_getInvalidInput(t){const r=this._getOrReturnCtx(t);return se(r,{code:K.invalid_type,expected:ne.bigint,received:r.parsedType}),he}gte(t,r){return this.setLimit("min",t,!0,le.toString(r))}gt(t,r){return this.setLimit("min",t,!1,le.toString(r))}lte(t,r){return this.setLimit("max",t,!0,le.toString(r))}lt(t,r){return this.setLimit("max",t,!1,le.toString(r))}setLimit(t,r,a,n){return new tr({...this._def,checks:[...this._def.checks,{kind:t,value:r,inclusive:a,message:le.toString(n)}]})}_addCheck(t){return new tr({...this._def,checks:[...this._def.checks,t]})}positive(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:le.toString(t)})}negative(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:le.toString(t)})}nonpositive(t){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:le.toString(t)})}nonnegative(t){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:le.toString(t)})}multipleOf(t,r){return this._addCheck({kind:"multipleOf",value:t,message:le.toString(r)})}get minValue(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t}get maxValue(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t}}tr.create=s=>new tr({checks:[],typeName:xe.ZodBigInt,coerce:(s==null?void 0:s.coerce)??!1,...ve(s)});class Dn extends we{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==ne.boolean){const a=this._getOrReturnCtx(t);return se(a,{code:K.invalid_type,expected:ne.boolean,received:a.parsedType}),he}return pt(t.data)}}Dn.create=s=>new Dn({typeName:xe.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...ve(s)});class Br extends we{_parse(t){if(this._def.coerce&&(t.data=new Date(t.data)),this._getType(t)!==ne.date){const i=this._getOrReturnCtx(t);return se(i,{code:K.invalid_type,expected:ne.date,received:i.parsedType}),he}if(Number.isNaN(t.data.getTime())){const i=this._getOrReturnCtx(t);return se(i,{code:K.invalid_date}),he}const a=new xt;let n;for(const i of this._def.checks)i.kind==="min"?t.data.getTime()<i.value&&(n=this._getOrReturnCtx(t,n),se(n,{code:K.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),a.dirty()):i.kind==="max"?t.data.getTime()>i.value&&(n=this._getOrReturnCtx(t,n),se(n,{code:K.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),a.dirty()):ke.assertNever(i);return{status:a.value,value:new Date(t.data.getTime())}}_addCheck(t){return new Br({...this._def,checks:[...this._def.checks,t]})}min(t,r){return this._addCheck({kind:"min",value:t.getTime(),message:le.toString(r)})}max(t,r){return this._addCheck({kind:"max",value:t.getTime(),message:le.toString(r)})}get minDate(){let t=null;for(const r of this._def.checks)r.kind==="min"&&(t===null||r.value>t)&&(t=r.value);return t!=null?new Date(t):null}get maxDate(){let t=null;for(const r of this._def.checks)r.kind==="max"&&(t===null||r.value<t)&&(t=r.value);return t!=null?new Date(t):null}}Br.create=s=>new Br({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:xe.ZodDate,...ve(s)});class On extends we{_parse(t){if(this._getType(t)!==ne.symbol){const a=this._getOrReturnCtx(t);return se(a,{code:K.invalid_type,expected:ne.symbol,received:a.parsedType}),he}return pt(t.data)}}On.create=s=>new On({typeName:xe.ZodSymbol,...ve(s)});class Fn extends we{_parse(t){if(this._getType(t)!==ne.undefined){const a=this._getOrReturnCtx(t);return se(a,{code:K.invalid_type,expected:ne.undefined,received:a.parsedType}),he}return pt(t.data)}}Fn.create=s=>new Fn({typeName:xe.ZodUndefined,...ve(s)});class zn extends we{_parse(t){if(this._getType(t)!==ne.null){const a=this._getOrReturnCtx(t);return se(a,{code:K.invalid_type,expected:ne.null,received:a.parsedType}),he}return pt(t.data)}}zn.create=s=>new zn({typeName:xe.ZodNull,...ve(s)});class Un extends we{constructor(){super(...arguments),this._any=!0}_parse(t){return pt(t.data)}}Un.create=s=>new Un({typeName:xe.ZodAny,...ve(s)});class Wn extends we{constructor(){super(...arguments),this._unknown=!0}_parse(t){return pt(t.data)}}Wn.create=s=>new Wn({typeName:xe.ZodUnknown,...ve(s)});class ss extends we{_parse(t){const r=this._getOrReturnCtx(t);return se(r,{code:K.invalid_type,expected:ne.never,received:r.parsedType}),he}}ss.create=s=>new ss({typeName:xe.ZodNever,...ve(s)});class Vn extends we{_parse(t){if(this._getType(t)!==ne.undefined){const a=this._getOrReturnCtx(t);return se(a,{code:K.invalid_type,expected:ne.void,received:a.parsedType}),he}return pt(t.data)}}Vn.create=s=>new Vn({typeName:xe.ZodVoid,...ve(s)});class It extends we{_parse(t){const{ctx:r,status:a}=this._processInputParams(t),n=this._def;if(r.parsedType!==ne.array)return se(r,{code:K.invalid_type,expected:ne.array,received:r.parsedType}),he;if(n.exactLength!==null){const l=r.data.length>n.exactLength.value,o=r.data.length<n.exactLength.value;(l||o)&&(se(r,{code:l?K.too_big:K.too_small,minimum:o?n.exactLength.value:void 0,maximum:l?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),a.dirty())}if(n.minLength!==null&&r.data.length<n.minLength.value&&(se(r,{code:K.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),a.dirty()),n.maxLength!==null&&r.data.length>n.maxLength.value&&(se(r,{code:K.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),a.dirty()),r.common.async)return Promise.all([...r.data].map((l,o)=>n.type._parseAsync(new ts(r,l,r.path,o)))).then(l=>xt.mergeArray(a,l));const i=[...r.data].map((l,o)=>n.type._parseSync(new ts(r,l,r.path,o)));return xt.mergeArray(a,i)}get element(){return this._def.type}min(t,r){return new It({...this._def,minLength:{value:t,message:le.toString(r)}})}max(t,r){return new It({...this._def,maxLength:{value:t,message:le.toString(r)}})}length(t,r){return new It({...this._def,exactLength:{value:t,message:le.toString(r)}})}nonempty(t){return this.min(1,t)}}It.create=(s,t)=>new It({type:s,minLength:null,maxLength:null,exactLength:null,typeName:xe.ZodArray,...ve(t)});function js(s){if(s instanceof Be){const t={};for(const r in s.shape){const a=s.shape[r];t[r]=es.create(js(a))}return new Be({...s._def,shape:()=>t})}else return s instanceof It?new It({...s._def,type:js(s.element)}):s instanceof es?es.create(js(s.unwrap())):s instanceof $s?$s.create(js(s.unwrap())):s instanceof ps?ps.create(s.items.map(t=>js(t))):s}class Be extends we{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const t=this._def.shape(),r=ke.objectKeys(t);return this._cached={shape:t,keys:r},this._cached}_parse(t){if(this._getType(t)!==ne.object){const d=this._getOrReturnCtx(t);return se(d,{code:K.invalid_type,expected:ne.object,received:d.parsedType}),he}const{status:a,ctx:n}=this._processInputParams(t),{shape:i,keys:l}=this._getCached(),o=[];if(!(this._def.catchall instanceof ss&&this._def.unknownKeys==="strip"))for(const d in n.data)l.includes(d)||o.push(d);const c=[];for(const d of l){const u=i[d],m=n.data[d];c.push({key:{status:"valid",value:d},value:u._parse(new ts(n,m,n.path,d)),alwaysSet:d in n.data})}if(this._def.catchall instanceof ss){const d=this._def.unknownKeys;if(d==="passthrough")for(const u of o)c.push({key:{status:"valid",value:u},value:{status:"valid",value:n.data[u]}});else if(d==="strict")o.length>0&&(se(n,{code:K.unrecognized_keys,keys:o}),a.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const u of o){const m=n.data[u];c.push({key:{status:"valid",value:u},value:d._parse(new ts(n,m,n.path,u)),alwaysSet:u in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const d=[];for(const u of c){const m=await u.key,k=await u.value;d.push({key:m,value:k,alwaysSet:u.alwaysSet})}return d}).then(d=>xt.mergeObjectSync(a,d)):xt.mergeObjectSync(a,c)}get shape(){return this._def.shape()}strict(t){return le.errToObj,new Be({...this._def,unknownKeys:"strict",...t!==void 0?{errorMap:(r,a)=>{var i,l;const n=((l=(i=this._def).errorMap)==null?void 0:l.call(i,r,a).message)??a.defaultError;return r.code==="unrecognized_keys"?{message:le.errToObj(t).message??n}:{message:n}}}:{}})}strip(){return new Be({...this._def,unknownKeys:"strip"})}passthrough(){return new Be({...this._def,unknownKeys:"passthrough"})}extend(t){return new Be({...this._def,shape:()=>({...this._def.shape(),...t})})}merge(t){return new Be({unknownKeys:t._def.unknownKeys,catchall:t._def.catchall,shape:()=>({...this._def.shape(),...t._def.shape()}),typeName:xe.ZodObject})}setKey(t,r){return this.augment({[t]:r})}catchall(t){return new Be({...this._def,catchall:t})}pick(t){const r={};for(const a of ke.objectKeys(t))t[a]&&this.shape[a]&&(r[a]=this.shape[a]);return new Be({...this._def,shape:()=>r})}omit(t){const r={};for(const a of ke.objectKeys(this.shape))t[a]||(r[a]=this.shape[a]);return new Be({...this._def,shape:()=>r})}deepPartial(){return js(this)}partial(t){const r={};for(const a of ke.objectKeys(this.shape)){const n=this.shape[a];t&&!t[a]?r[a]=n:r[a]=n.optional()}return new Be({...this._def,shape:()=>r})}required(t){const r={};for(const a of ke.objectKeys(this.shape))if(t&&!t[a])r[a]=this.shape[a];else{let i=this.shape[a];for(;i instanceof es;)i=i._def.innerType;r[a]=i}return new Be({...this._def,shape:()=>r})}keyof(){return pl(ke.objectKeys(this.shape))}}Be.create=(s,t)=>new Be({shape:()=>s,unknownKeys:"strip",catchall:ss.create(),typeName:xe.ZodObject,...ve(t)});Be.strictCreate=(s,t)=>new Be({shape:()=>s,unknownKeys:"strict",catchall:ss.create(),typeName:xe.ZodObject,...ve(t)});Be.lazycreate=(s,t)=>new Be({shape:s,unknownKeys:"strip",catchall:ss.create(),typeName:xe.ZodObject,...ve(t)});class Dr extends we{_parse(t){const{ctx:r}=this._processInputParams(t),a=this._def.options;function n(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return r.common.issues.push(...o.ctx.common.issues),o.result;const l=i.map(o=>new zt(o.ctx.common.issues));return se(r,{code:K.invalid_union,unionErrors:l}),he}if(r.common.async)return Promise.all(a.map(async i=>{const l={...r,common:{...r.common,issues:[]},parent:null};return{result:await i._parseAsync({data:r.data,path:r.path,parent:l}),ctx:l}})).then(n);{let i;const l=[];for(const c of a){const d={...r,common:{...r.common,issues:[]},parent:null},u=c._parseSync({data:r.data,path:r.path,parent:d});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:d}),d.common.issues.length&&l.push(d.common.issues)}if(i)return r.common.issues.push(...i.ctx.common.issues),i.result;const o=l.map(c=>new zt(c));return se(r,{code:K.invalid_union,unionErrors:o}),he}}get options(){return this._def.options}}Dr.create=(s,t)=>new Dr({options:s,typeName:xe.ZodUnion,...ve(t)});function _a(s,t){const r=Ht(s),a=Ht(t);if(s===t)return{valid:!0,data:s};if(r===ne.object&&a===ne.object){const n=ke.objectKeys(t),i=ke.objectKeys(s).filter(o=>n.indexOf(o)!==-1),l={...s,...t};for(const o of i){const c=_a(s[o],t[o]);if(!c.valid)return{valid:!1};l[o]=c.data}return{valid:!0,data:l}}else if(r===ne.array&&a===ne.array){if(s.length!==t.length)return{valid:!1};const n=[];for(let i=0;i<s.length;i++){const l=s[i],o=t[i],c=_a(l,o);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return r===ne.date&&a===ne.date&&+s==+t?{valid:!0,data:s}:{valid:!1}}class Or extends we{_parse(t){const{status:r,ctx:a}=this._processInputParams(t),n=(i,l)=>{if(Pn(i)||Pn(l))return he;const o=_a(i.value,l.value);return o.valid?(($n(i)||$n(l))&&r.dirty(),{status:r.value,value:o.data}):(se(a,{code:K.invalid_intersection_types}),he)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([i,l])=>n(i,l)):n(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}}Or.create=(s,t,r)=>new Or({left:s,right:t,typeName:xe.ZodIntersection,...ve(r)});class ps extends we{_parse(t){const{status:r,ctx:a}=this._processInputParams(t);if(a.parsedType!==ne.array)return se(a,{code:K.invalid_type,expected:ne.array,received:a.parsedType}),he;if(a.data.length<this._def.items.length)return se(a,{code:K.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),he;!this._def.rest&&a.data.length>this._def.items.length&&(se(a,{code:K.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),r.dirty());const i=[...a.data].map((l,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new ts(a,l,a.path,o)):null}).filter(l=>!!l);return a.common.async?Promise.all(i).then(l=>xt.mergeArray(r,l)):xt.mergeArray(r,i)}get items(){return this._def.items}rest(t){return new ps({...this._def,rest:t})}}ps.create=(s,t)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ps({items:s,typeName:xe.ZodTuple,rest:null,...ve(t)})};class Hn extends we{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){const{status:r,ctx:a}=this._processInputParams(t);if(a.parsedType!==ne.map)return se(a,{code:K.invalid_type,expected:ne.map,received:a.parsedType}),he;const n=this._def.keyType,i=this._def.valueType,l=[...a.data.entries()].map(([o,c],d)=>({key:n._parse(new ts(a,o,a.path,[d,"key"])),value:i._parse(new ts(a,c,a.path,[d,"value"]))}));if(a.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of l){const d=await c.key,u=await c.value;if(d.status==="aborted"||u.status==="aborted")return he;(d.status==="dirty"||u.status==="dirty")&&r.dirty(),o.set(d.value,u.value)}return{status:r.value,value:o}})}else{const o=new Map;for(const c of l){const d=c.key,u=c.value;if(d.status==="aborted"||u.status==="aborted")return he;(d.status==="dirty"||u.status==="dirty")&&r.dirty(),o.set(d.value,u.value)}return{status:r.value,value:o}}}}Hn.create=(s,t,r)=>new Hn({valueType:t,keyType:s,typeName:xe.ZodMap,...ve(r)});class sr extends we{_parse(t){const{status:r,ctx:a}=this._processInputParams(t);if(a.parsedType!==ne.set)return se(a,{code:K.invalid_type,expected:ne.set,received:a.parsedType}),he;const n=this._def;n.minSize!==null&&a.data.size<n.minSize.value&&(se(a,{code:K.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),r.dirty()),n.maxSize!==null&&a.data.size>n.maxSize.value&&(se(a,{code:K.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),r.dirty());const i=this._def.valueType;function l(c){const d=new Set;for(const u of c){if(u.status==="aborted")return he;u.status==="dirty"&&r.dirty(),d.add(u.value)}return{status:r.value,value:d}}const o=[...a.data.values()].map((c,d)=>i._parse(new ts(a,c,a.path,d)));return a.common.async?Promise.all(o).then(c=>l(c)):l(o)}min(t,r){return new sr({...this._def,minSize:{value:t,message:le.toString(r)}})}max(t,r){return new sr({...this._def,maxSize:{value:t,message:le.toString(r)}})}size(t,r){return this.min(t,r).max(t,r)}nonempty(t){return this.min(1,t)}}sr.create=(s,t)=>new sr({valueType:s,minSize:null,maxSize:null,typeName:xe.ZodSet,...ve(t)});class qn extends we{get schema(){return this._def.getter()}_parse(t){const{ctx:r}=this._processInputParams(t);return this._def.getter()._parse({data:r.data,path:r.path,parent:r})}}qn.create=(s,t)=>new qn({getter:s,typeName:xe.ZodLazy,...ve(t)});class Zn extends we{_parse(t){if(t.data!==this._def.value){const r=this._getOrReturnCtx(t);return se(r,{received:r.data,code:K.invalid_literal,expected:this._def.value}),he}return{status:"valid",value:t.data}}get value(){return this._def.value}}Zn.create=(s,t)=>new Zn({value:s,typeName:xe.ZodLiteral,...ve(t)});function pl(s,t){return new Rs({values:s,typeName:xe.ZodEnum,...ve(t)})}class Rs extends we{_parse(t){if(typeof t.data!="string"){const r=this._getOrReturnCtx(t),a=this._def.values;return se(r,{expected:ke.joinValues(a),received:r.parsedType,code:K.invalid_type}),he}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(t.data)){const r=this._getOrReturnCtx(t),a=this._def.values;return se(r,{received:r.data,code:K.invalid_enum_value,options:a}),he}return pt(t.data)}get options(){return this._def.values}get enum(){const t={};for(const r of this._def.values)t[r]=r;return t}get Values(){const t={};for(const r of this._def.values)t[r]=r;return t}get Enum(){const t={};for(const r of this._def.values)t[r]=r;return t}extract(t,r=this._def){return Rs.create(t,{...this._def,...r})}exclude(t,r=this._def){return Rs.create(this.options.filter(a=>!t.includes(a)),{...this._def,...r})}}Rs.create=pl;class Kn extends we{_parse(t){const r=ke.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==ne.string&&a.parsedType!==ne.number){const n=ke.objectValues(r);return se(a,{expected:ke.joinValues(n),received:a.parsedType,code:K.invalid_type}),he}if(this._cache||(this._cache=new Set(ke.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){const n=ke.objectValues(r);return se(a,{received:a.data,code:K.invalid_enum_value,options:n}),he}return pt(t.data)}get enum(){return this._def.values}}Kn.create=(s,t)=>new Kn({values:s,typeName:xe.ZodNativeEnum,...ve(t)});class Fr extends we{unwrap(){return this._def.type}_parse(t){const{ctx:r}=this._processInputParams(t);if(r.parsedType!==ne.promise&&r.common.async===!1)return se(r,{code:K.invalid_type,expected:ne.promise,received:r.parsedType}),he;const a=r.parsedType===ne.promise?r.data:Promise.resolve(r.data);return pt(a.then(n=>this._def.type.parseAsync(n,{path:r.path,errorMap:r.common.contextualErrorMap})))}}Fr.create=(s,t)=>new Fr({type:s,typeName:xe.ZodPromise,...ve(t)});class Ps extends we{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===xe.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){const{status:r,ctx:a}=this._processInputParams(t),n=this._def.effect||null,i={addIssue:l=>{se(a,l),l.fatal?r.abort():r.dirty()},get path(){return a.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){const l=n.transform(a.data,i);if(a.common.async)return Promise.resolve(l).then(async o=>{if(r.value==="aborted")return he;const c=await this._def.schema._parseAsync({data:o,path:a.path,parent:a});return c.status==="aborted"?he:c.status==="dirty"||r.value==="dirty"?Hs(c.value):c});{if(r.value==="aborted")return he;const o=this._def.schema._parseSync({data:l,path:a.path,parent:a});return o.status==="aborted"?he:o.status==="dirty"||r.value==="dirty"?Hs(o.value):o}}if(n.type==="refinement"){const l=o=>{const c=n.refinement(o,i);if(a.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(a.common.async===!1){const o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return o.status==="aborted"?he:(o.status==="dirty"&&r.dirty(),l(o.value),{status:r.value,value:o.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>o.status==="aborted"?he:(o.status==="dirty"&&r.dirty(),l(o.value).then(()=>({status:r.value,value:o.value}))))}if(n.type==="transform")if(a.common.async===!1){const l=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Is(l))return he;const o=n.transform(l.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:r.value,value:o}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(l=>Is(l)?Promise.resolve(n.transform(l.value,i)).then(o=>({status:r.value,value:o})):he);ke.assertNever(n)}}Ps.create=(s,t,r)=>new Ps({schema:s,typeName:xe.ZodEffects,effect:t,...ve(r)});Ps.createWithPreprocess=(s,t,r)=>new Ps({schema:t,effect:{type:"preprocess",transform:s},typeName:xe.ZodEffects,...ve(r)});class es extends we{_parse(t){return this._getType(t)===ne.undefined?pt(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}es.create=(s,t)=>new es({innerType:s,typeName:xe.ZodOptional,...ve(t)});class $s extends we{_parse(t){return this._getType(t)===ne.null?pt(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}}$s.create=(s,t)=>new $s({innerType:s,typeName:xe.ZodNullable,...ve(t)});class Ca extends we{_parse(t){const{ctx:r}=this._processInputParams(t);let a=r.data;return r.parsedType===ne.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:r.path,parent:r})}removeDefault(){return this._def.innerType}}Ca.create=(s,t)=>new Ca({innerType:s,typeName:xe.ZodDefault,defaultValue:typeof t.default=="function"?t.default:()=>t.default,...ve(t)});class Aa extends we{_parse(t){const{ctx:r}=this._processInputParams(t),a={...r,common:{...r.common,issues:[]}},n=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return $r(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new zt(a.common.issues)},input:a.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new zt(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}}Aa.create=(s,t)=>new Aa({innerType:s,typeName:xe.ZodCatch,catchValue:typeof t.catch=="function"?t.catch:()=>t.catch,...ve(t)});class Gn extends we{_parse(t){if(this._getType(t)!==ne.nan){const a=this._getOrReturnCtx(t);return se(a,{code:K.invalid_type,expected:ne.nan,received:a.parsedType}),he}return{status:"valid",value:t.data}}}Gn.create=s=>new Gn({typeName:xe.ZodNaN,...ve(s)});class hu extends we{_parse(t){const{ctx:r}=this._processInputParams(t),a=r.data;return this._def.type._parse({data:a,path:r.path,parent:r})}unwrap(){return this._def.type}}class Ha extends we{_parse(t){const{status:r,ctx:a}=this._processInputParams(t);if(a.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?he:i.status==="dirty"?(r.dirty(),Hs(i.value)):this._def.out._parseAsync({data:i.value,path:a.path,parent:a})})();{const n=this._def.in._parseSync({data:a.data,path:a.path,parent:a});return n.status==="aborted"?he:n.status==="dirty"?(r.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:a.path,parent:a})}}static create(t,r){return new Ha({in:t,out:r,typeName:xe.ZodPipeline})}}class La extends we{_parse(t){const r=this._def.innerType._parse(t),a=n=>(Is(n)&&(n.value=Object.freeze(n.value)),n);return $r(r)?r.then(n=>a(n)):a(r)}unwrap(){return this._def.innerType}}La.create=(s,t)=>new La({innerType:s,typeName:xe.ZodReadonly,...ve(t)});var xe;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(xe||(xe={}));const pr=Yt.create;ss.create;It.create;const xu=Be.create;Dr.create;Or.create;ps.create;Rs.create;Fr.create;es.create;$s.create;const gu=xu({email:pr().email("请输入有效的邮箱地址"),password:pr().min(6,"密码至少6位字符"),username:pr().min(2,"用户名至少2位字符").optional(),confirmPassword:pr().optional()}).refine(s=>s.confirmPassword!==void 0?s.password===s.confirmPassword:!0,{message:"两次输入的密码不一致",path:["confirmPassword"]}),fu=()=>{var j,p;const[s,t]=y.useState(!0),r=dt(),a=zr(),{login:n,register:i,isLoading:l}=Je(),{theme:o,toggleTheme:c}=ea(),{language:d,setLanguage:u,t:m}=ns(),{register:k,handleSubmit:x,formState:{errors:b},reset:g}=B0({resolver:z0(gu)}),w=((p=(j=a.state)==null?void 0:j.from)==null?void 0:p.pathname)||"/",v=async S=>{try{const _=await Je.getState().loginWithGoogle(S.credential);_.success?(E.success("Google登录成功！"),r(w,{replace:!0})):E.error(_.message||"Google登录失败")}catch(_){console.error("Google login error:",_),E.error("Google登录出错，请重试")}},L=()=>{console.error("Google登录失败"),E.error("Google登录失败，请重试")},C=async S=>{try{let _=!1;if(s){const U=await i({username:S.username||S.email.split("@")[0],email:S.email,password:S.password,confirmPassword:S.confirmPassword||S.password});if(_=U.success,!_){E.error(U.message||"注册失败");return}}else{const U=await n({email:S.email,password:S.password});if(_=U.success,!_){E.error(U.message||"登录失败");return}}_&&(E.success(s?"注册成功！":"登录成功！"),r(w,{replace:!0}))}catch(_){console.error("Authentication error:",_),E.error("操作失败，请重试")}},M=()=>{t(!s),g()};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-8 flex items-center justify-center transition-colors",children:e.jsxs("div",{className:"w-full max-w-5xl min-h-[800px] bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 relative transition-colors",children:[e.jsxs("div",{className:"absolute top-4 right-8 flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>u("zh"),className:`px-2 py-1 text-sm rounded-md transition-colors ${d==="zh"?"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:"中"}),e.jsx("button",{onClick:()=>u("en"),className:`px-2 py-1 text-sm rounded-md transition-colors ${d==="en"?"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400"}`,children:"EN"})]}),e.jsx("div",{className:"border-l border-gray-300 dark:border-gray-600 h-6"}),e.jsx("button",{onClick:c,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-400 transition-colors",children:o==="light"?e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})}):e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"})]})})]}),e.jsx("header",{className:"py-6 px-8 flex justify-center border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-9 h-9 mr-3 text-blue-600 dark:text-blue-400",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M7 12h10M12 7v10",stroke:"currentColor",strokeWidth:"2",fill:"none"})]}),e.jsx("h1",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400",children:"Trademe"})]})}),e.jsx("main",{className:"flex flex-col items-center justify-center py-16",children:e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsx("h2",{className:"text-center text-2xl font-bold mb-8 text-gray-800 dark:text-white",children:m("accountLogin")}),e.jsx("div",{className:"mb-6",children:e.jsx(u0,{onSuccess:v,onError:L,useOneTap:!1,theme:o==="dark"?"filled_black":"outline",size:"large",width:"100%",text:s?"signup_with":"signin_with",shape:"rectangular"})}),e.jsxs("div",{className:"relative flex justify-center mb-6",children:[e.jsx("hr",{className:"w-full border-gray-300 dark:border-gray-600"}),e.jsx("span",{className:"absolute px-4 bg-white dark:bg-gray-800 -top-3 text-gray-500 dark:text-gray-400",children:m("orContinueWith")})]}),e.jsxs("form",{onSubmit:x(C),children:[s&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("username")}),e.jsx("input",{type:"text",placeholder:m("enterUsername"),...k("username"),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 dark:bg-gray-700 dark:text-white transition-colors"}),b.username&&e.jsx("p",{className:"text-red-500 dark:text-red-400 text-sm mt-1",children:b.username.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("email")}),e.jsx("input",{type:"email",placeholder:m("enterEmail"),...k("email"),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 dark:bg-gray-700 dark:text-white transition-colors"}),b.email&&e.jsx("p",{className:"text-red-500 dark:text-red-400 text-sm mt-1",children:b.email.message})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("password")}),e.jsx("input",{type:"password",placeholder:m("enterPassword"),...k("password"),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 dark:bg-gray-700 dark:text-white transition-colors"}),b.password&&e.jsx("p",{className:"text-red-500 dark:text-red-400 text-sm mt-1",children:b.password.message})]}),s&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:m("confirmPassword")}),e.jsx("input",{type:"password",placeholder:m("enterPasswordAgain"),...k("confirmPassword"),className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50 dark:bg-gray-700 dark:text-white transition-colors"}),b.confirmPassword&&e.jsx("p",{className:"text-red-500 dark:text-red-400 text-sm mt-1",children:b.confirmPassword.message})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full py-3 mb-6 text-white font-medium rounded-lg transition-colors disabled:opacity-50 bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700",children:m(l?"processing":s?"createAccount":"login")})]}),e.jsx("div",{className:"text-center mb-4",children:e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[m(s?"haveAccount":"noAccount"),e.jsx("button",{type:"button",onClick:M,className:"text-blue-600 dark:text-blue-400 hover:underline ml-1",children:m(s?"loginNow":"registerNow")})]})}),s&&e.jsx("div",{className:"text-center text-xs text-gray-500 dark:text-gray-400",children:e.jsxs("p",{children:[m("byRegisteringAgree"),e.jsx("a",{href:"/terms",className:"text-blue-600 dark:text-blue-400 hover:underline",children:m("termsOfService")}),m("and"),e.jsx("a",{href:"/privacy",className:"text-blue-600 dark:text-blue-400 hover:underline",children:m("privacyPolicy")})]})})]})})]})})},Rt=({size:s="md",color:t="primary",className:r=""})=>{const a={sm:"w-4 h-4",md:"w-8 h-8",lg:"w-12 h-12"},n={primary:"text-brand-500",secondary:"text-gray-500",white:"text-white"};return e.jsx("div",{className:`inline-block ${r}`,children:e.jsxs("svg",{className:`animate-spin ${a[s]} ${n[t]}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})},ht=({variant:s="primary",size:t="md",loading:r=!1,children:a,className:n="",disabled:i,...l})=>{const o="btn",c={primary:"btn-primary",secondary:"btn-secondary",outline:"btn-outline",ghost:"btn-ghost",danger:"bg-red-500 text-white hover:bg-red-600 active:bg-red-700"},d={sm:"btn-sm",md:"btn-md",lg:"btn-lg"},u=i||r;return e.jsxs("button",{className:`
        ${o}
        ${c[s]}
        ${d[t]}
        ${u?"opacity-50 cursor-not-allowed":""}
        ${n}
      `,disabled:u,...l,children:[r&&e.jsx(Rt,{size:"sm",color:s==="primary"?"white":"primary",className:"mr-2"}),a]})},pu=()=>{const s=dt();return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 transition-colors",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 p-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900 dark:text-white",children:"邮箱验证"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"请检查您的邮箱以完成账户验证"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.2a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"我们已向您的邮箱发送了验证链接，请点击链接完成账户激活。"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"如果您没有收到邮件，请检查垃圾邮件箱或稍后重试。"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ht,{onClick:()=>window.location.reload(),variant:"outline",className:"w-full",children:"重新发送验证邮件"}),e.jsx(ht,{onClick:()=>s("/login"),variant:"primary",className:"w-full",children:"返回登录"})]})]})})]})})},yu={async getKlineData(s,t,r="okx",a=500){try{const n=await fetch(`/klines/${s}?timeframe=${t}&limit=${a}`);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);return(await n.json()).klines.map(l=>({timestamp:l[0],open:l[1],high:l[2],low:l[3],close:l[4],volume:l[5]}))}catch(n){throw console.error("获取K线数据失败:",n),n}},async getTicker(s,t="okx"){try{const r=await fetch(`/stats/${s}`);if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);const a=await r.json();return{symbol:a.symbol,price:a.price,change:a.change_24h,change_percent:a.change_percent||0,high_24h:a.high_24h,low_24h:a.low_24h,volume_24h:a.volume_24h,timestamp:a.timestamp}}catch(r){throw console.error("获取价格数据失败:",r),r}},async getTickers(s,t){try{const r=await G.post("/market/tickers",{symbols:s,exchange:t});return q(r)}catch(r){H(r)}},async getOrderBook(s,t,r=20){try{const a=await G.get("/market/orderbook",{params:{symbol:s,exchange:t,depth:r}});return q(a)}catch(a){H(a)}},async getExchanges(){try{const s=await G.get("/market/exchanges");return q(s)}catch(s){H(s)}},async getTradingPairs(s){try{const t=await G.get("/market/pairs",{params:{exchange:s}});return q(t)}catch(t){H(t)}},async searchTradingPairs(s,t){try{const r=await G.get("/market/pairs/search",{params:{query:s,exchange:t}});return q(r)}catch(r){H(r)}},async getHistoricalData(s,t,r,a,n="1d"){try{const i=await G.get("/market/historical",{params:{symbol:s,exchange:t,start_date:r,end_date:a,timeframe:n}});return q(i)}catch(i){H(i)}},async getMarketStats(s){try{const t=await G.get("/market/stats",{params:{exchange:s}});return q(t)}catch(t){H(t)}},async getTechnicalIndicators(s,t,r,a,n=20){try{const i=await G.post("/market/indicators",{symbol:s,exchange:t,timeframe:r,indicators:a,period:n});return q(i)}catch(i){H(i)}}};class bu{constructor(t){Te(this,"connections",new Map);Te(this,"config");Te(this,"heartbeatTimer",null);this.config=t,this.startHeartbeat()}connect(t,r,a={},n){try{this.connections.has(t)&&this.disconnect(t);const i=`${this.config.baseUrl}${r}`,o={ws:new WebSocket(i),url:i,key:t,isActive:!1,reconnectAttempts:0,maxReconnectAttempts:this.config.maxReconnectAttempts,reconnectDelay:this.config.reconnectDelay,authToken:n,...a};return this.setupWebSocketHandlers(o),this.connections.set(t,o),console.log(`WebSocket connecting: ${t} -> ${i}`),!0}catch(i){return console.error(`Failed to create WebSocket connection for ${t}:`,i),!1}}disconnect(t){const r=this.connections.get(t);return r?(r.isActive=!1,(r.ws.readyState===WebSocket.OPEN||r.ws.readyState===WebSocket.CONNECTING)&&r.ws.close(1e3,"Manual disconnect"),this.connections.delete(t),console.log(`WebSocket disconnected: ${t}`),!0):!1}disconnectAll(){for(const t of this.connections.keys())this.disconnect(t);this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null)}send(t,r){const a=this.connections.get(t);if(!a||a.ws.readyState!==WebSocket.OPEN)return console.warn(`WebSocket not ready for sending: ${t}`),!1;try{const n=typeof r=="string"?r:JSON.stringify(r);return a.ws.send(n),!0}catch(n){return console.error(`Failed to send message to ${t}:`,n),!1}}getConnectionStatus(t){const r=this.connections.get(t);return r?{isConnected:r.ws.readyState===WebSocket.OPEN,readyState:r.ws.readyState,reconnectAttempts:r.reconnectAttempts}:{isConnected:!1,readyState:null,reconnectAttempts:0}}getAllConnectionStatus(){const t={};for(const[r]of this.connections)t[r]=this.getConnectionStatus(r);return t}setupWebSocketHandlers(t){const{ws:r}=t;r.onopen=a=>{var n;if(t.isActive=!0,t.reconnectAttempts=0,console.log(`WebSocket connected: ${t.key}`),t.authToken){const i={type:"auth",token:t.authToken};r.send(JSON.stringify(i)),console.log(`🔐 Sent auth message for connection: ${t.key}`)}(n=t.onOpen)==null||n.call(t)},r.onmessage=a=>{var n,i;try{const l=JSON.parse(a.data);(n=t.onMessage)==null||n.call(t,l)}catch(l){console.error(`Failed to parse WebSocket message from ${t.key}:`,l),(i=t.onMessage)==null||i.call(t,a.data)}},r.onerror=a=>{var n;console.error(`WebSocket error on ${t.key}:`,a),(n=t.onError)==null||n.call(t,a)},r.onclose=a=>{var n;console.log(`WebSocket closed: ${t.key}, code: ${a.code}, reason: ${a.reason}`),(n=t.onClose)==null||n.call(t),t.isActive&&t.reconnectAttempts<t.maxReconnectAttempts&&a.code!==1e3?this.scheduleReconnect(t):t.reconnectAttempts>=t.maxReconnectAttempts&&(console.warn(`Max reconnect attempts reached for ${t.key}`),this.connections.delete(t.key))}}scheduleReconnect(t){t.reconnectAttempts++;const r=t.reconnectDelay*Math.pow(2,t.reconnectAttempts-1);console.log(`Scheduling reconnect for ${t.key} in ${r}ms (attempt ${t.reconnectAttempts})`),setTimeout(()=>{if(t.isActive){console.log(`Attempting to reconnect ${t.key}...`);const a=new WebSocket(t.url);t.ws=a,this.setupWebSocketHandlers(t)}},r)}startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>{for(const[t,r]of this.connections)r.ws.readyState===WebSocket.OPEN?this.send(t,{type:"ping",timestamp:Date.now()}):r.ws.readyState===WebSocket.CLOSED&&r.isActive&&r.reconnectAttempts<r.maxReconnectAttempts&&(console.log(`Heartbeat detected closed connection, triggering reconnect: ${t}`),this.scheduleReconnect(r))},this.config.heartbeatInterval)}getStats(){const t=Array.from(this.connections.values()).map(r=>({key:r.key,url:r.url,isActive:r.isActive,readyState:this.getReadyStateString(r.ws.readyState),reconnectAttempts:r.reconnectAttempts}));return{totalConnections:this.connections.size,activeConnections:t.filter(r=>r.readyState==="OPEN").length,connectionDetails:t}}getReadyStateString(t){switch(t){case WebSocket.CONNECTING:return"CONNECTING";case WebSocket.OPEN:return"OPEN";case WebSocket.CLOSING:return"CLOSING";case WebSocket.CLOSED:return"CLOSED";default:return"UNKNOWN"}}}const ws=new bu({baseUrl:"wss://api.trademe.app/ws",maxReconnectAttempts:5,reconnectDelay:1e3,heartbeatInterval:3e4});typeof window<"u"&&window.addEventListener("beforeunload",()=>{ws.disconnectAll()});const qs=as((s,t)=>({currentPrices:{},klineData:{},selectedSymbol:"BTC/USDT",selectedTimeframe:"1h",selectedExchange:"okx",isLoading:!1,isConnected:!1,lastUpdate:null,error:null,subscribedTickers:new Set,connectionStats:null,setSelectedSymbol:r=>{s({selectedSymbol:r});const{selectedTimeframe:a,selectedExchange:n,fetchKlineData:i}=t();i(r,a,n)},setSelectedTimeframe:r=>{s({selectedTimeframe:r});const{selectedSymbol:a,selectedExchange:n,fetchKlineData:i}=t();i(a,r,n)},setSelectedExchange:r=>{s({selectedExchange:r});const{selectedSymbol:a,selectedTimeframe:n,fetchKlineData:i}=t();i(a,n,r)},fetchKlineData:async(r,a,n)=>{var i,l;s({isLoading:!0});try{const o=await yu.getKlineData(r,a,n);s(c=>({klineData:{...c.klineData,[`${n}:${r}:${a}`]:o},isLoading:!1,lastUpdate:new Date}))}catch(o){s({isLoading:!1});const c=((l=(i=o.response)==null?void 0:i.data)==null?void 0:l.message)||"获取K线数据失败";E.error(c)}},subscribeToTicker:(r,a)=>{const n=`${a}:${r}`,i=`/market/${a}/${r}/ticker`;ws.connect(n,i,{onOpen:()=>{s(o=>({isConnected:!0,subscribedTickers:new Set([...o.subscribedTickers,n]),error:null})),console.log(`Subscribed to ticker: ${n}`)},onMessage:o=>{t().updatePrice(r,o)},onError:o=>{console.error(`WebSocket error for ${n}:`,o),s({error:`${r} 价格订阅失败`}),E.error(`${r} 价格订阅失败`)},onClose:()=>{s(o=>{const c=new Set(o.subscribedTickers);return c.delete(n),{subscribedTickers:c,isConnected:c.size>0}}),console.log(`Unsubscribed from ticker: ${n}`)}})||(E.error(`无法连接到 ${r} 价格推送`),s({error:`WebSocket连接失败: ${r}`}))},unsubscribeFromTicker:(r,a)=>{const n=`${a}:${r}`;ws.disconnect(n)&&s(l=>{const o=new Set(l.subscribedTickers);return o.delete(n),{subscribedTickers:o,isConnected:o.size>0}})},connectWebSocket:()=>{const{selectedSymbol:r,selectedExchange:a}=t();t().subscribeToTicker(r,a)},disconnectWebSocket:()=>{ws.disconnectAll(),s({subscribedTickers:new Set,isConnected:!1,connectionStats:null})},updatePrice:(r,a)=>{s(n=>({currentPrices:{...n.currentPrices,[r]:a},lastUpdate:new Date,error:null}))},clearError:()=>{s({error:null})},getConnectionStats:()=>{const r=ws.getStats();return s({connectionStats:r}),r},reset:()=>{ws.disconnectAll(),s({currentPrices:{},klineData:{},selectedSymbol:"BTC/USDT",selectedTimeframe:"1h",selectedExchange:"okx",isLoading:!1,isConnected:!1,lastUpdate:null,error:null,subscribedTickers:new Set,connectionStats:null})}})),rt={async getStrategies(s){try{const t=await G.get("/strategies",{params:s});return q(t)}catch(t){H(t)}},async getStrategy(s){try{const t=await G.get(`/strategies/${s}`);return q(t)}catch(t){H(t)}},async createStrategy(s){try{const t=await G.post("/strategies",s);return q(t)}catch(t){H(t)}},async updateStrategy(s,t){try{const r=await G.put(`/strategies/${s}`,t);return q(r)}catch(r){H(r)}},async deleteStrategy(s){try{const t=await G.delete(`/strategies/${s}`);return q(t)}catch(t){H(t)}},async startStrategy(s){try{const t=await G.post(`/strategies/${s}/start`);return q(t)}catch(t){H(t)}},async stopStrategy(s){try{const t=await G.post(`/strategies/${s}/stop`);return q(t)}catch(t){H(t)}},async pauseStrategy(s){try{const t=await G.post(`/strategies/${s}/pause`);return q(t)}catch(t){H(t)}},async runBacktest(s,t){try{const r=await G.post(`/strategies/${s}/backtest`,t);return q(r)}catch(r){H(r)}},async getBacktestResults(s){try{const t=await G.get(`/strategies/${s}/backtests`);return q(t)}catch(t){H(t)}},async getBacktestResult(s,t){try{const r=await G.get(`/strategies/${s}/backtests/${t}`);return q(r)}catch(r){H(r)}},async getStrategyTrades(s,t){try{const r=await G.get(`/strategies/${s}/trades`,{params:t});return q(r)}catch(r){H(r)}},async getStrategyPerformance(s,t){try{const r=await G.get(`/strategies/${s}/performance`,{params:{period:t}});return q(r)}catch(r){H(r)}},async cloneStrategy(s,t){try{const r=await G.post(`/strategies/${s}/clone`,{name:t});return q(r)}catch(r){H(r)}},async exportStrategy(s){try{const t=await G.get(`/strategies/${s}/export`);return q(t)}catch(t){H(t)}},async importStrategy(s){try{const t=await G.post("/strategies/import",s);return q(t)}catch(t){H(t)}},async getStrategyLiveDetails(s){try{const t=await G.get(`/strategies/${s}/live-details`);return q(t)}catch(t){H(t)}},async createStrategyFromAI(s){try{const t=await G.post("/strategies/from-ai",s);return q(t)}catch(t){H(t)}},async getStrategiesByType(s,t){try{const r=await G.get(`/strategies/by-type/${s}`,{params:t});return q(r)}catch(r){H(r)}}},vu=as((s,t)=>({strategies:[],selectedStrategy:null,isLoading:!1,backtestResults:[],isBacktesting:!1,fetchStrategies:async()=>{var r,a;s({isLoading:!0});try{const n=await rt.getStrategies();s({strategies:n.strategies,isLoading:!1})}catch(n){s({isLoading:!1});const i=((a=(r=n.response)==null?void 0:r.data)==null?void 0:a.message)||"获取策略列表失败";E.error(i)}},createStrategy:async r=>{var a,n;try{const i=await rt.createStrategy(r);return s(l=>({strategies:[...l.strategies,i]})),E.success("策略创建成功"),!0}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"创建策略失败";return E.error(l),!1}},updateStrategy:async(r,a)=>{var n,i;try{const l=await rt.updateStrategy(r,a);return s(o=>{var c;return{strategies:o.strategies.map(d=>d.id===r?l:d),selectedStrategy:((c=o.selectedStrategy)==null?void 0:c.id)===r?l:o.selectedStrategy}}),E.success("策略更新成功"),!0}catch(l){const o=((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.message)||"更新策略失败";return E.error(o),!1}},deleteStrategy:async r=>{var a,n;try{return await rt.deleteStrategy(r),s(i=>{var l;return{strategies:i.strategies.filter(o=>o.id!==r),selectedStrategy:((l=i.selectedStrategy)==null?void 0:l.id)===r?null:i.selectedStrategy}}),E.success("策略删除成功"),!0}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"删除策略失败";return E.error(l),!1}},selectStrategy:r=>{s({selectedStrategy:r})},runBacktest:async(r,a)=>{var n,i;s({isBacktesting:!0});try{const l=await rt.runBacktest(r,a);return s(o=>({backtestResults:[...o.backtestResults,l],isBacktesting:!1})),E.success("回测完成"),!0}catch(l){s({isBacktesting:!1});const o=((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.message)||"回测失败";return E.error(o),!1}},fetchBacktestResults:async r=>{var a,n;try{const i=await rt.getBacktestResults(r);s({backtestResults:i})}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"获取回测结果失败";E.error(l)}},startStrategy:async r=>{var a,n;try{return await rt.startStrategy(r),s(i=>{var l;return{strategies:i.strategies.map(o=>o.id===r?{...o,status:"running"}:o),selectedStrategy:((l=i.selectedStrategy)==null?void 0:l.id)===r?{...i.selectedStrategy,status:"running"}:i.selectedStrategy}}),E.success("策略已启动"),!0}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"启动策略失败";return E.error(l),!1}},stopStrategy:async r=>{var a,n;try{return await rt.stopStrategy(r),s(i=>{var l;return{strategies:i.strategies.map(o=>o.id===r?{...o,status:"stopped"}:o),selectedStrategy:((l=i.selectedStrategy)==null?void 0:l.id)===r?{...i.selectedStrategy,status:"stopped"}:i.selectedStrategy}}),E.success("策略已停止"),!0}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"停止策略失败";return E.error(l),!1}}})),Fe={async createSession(s){try{const t=await G.post("/ai/sessions",s);return q(t)}catch(t){throw H(t),t}},async getSessions(s){try{const t=await G.get(`/ai/sessions?ai_mode=${s}`);return q(t)}catch(t){H(t)}},async updateSessionStatus(s,t,r){try{const a=r!==void 0?`?progress=${r}`:"",n=await G.put(`/ai/sessions/${s}/status${a}`,{status:t});return q(n)}catch(a){H(a)}},async deleteSession(s){try{const t=await G.delete(`/ai/sessions/${s}`);return q(t)}catch(t){H(t)}},async sendChatMessage(s,t,r="developer",a="strategy",n){try{const i=await G.post("/ai/chat",{content:s,session_id:t,ai_mode:r,session_type:a,context:n||{}});return q(i)}catch(i){H(i)}},async getChatHistory(s,t=50){try{const r=new URLSearchParams;s&&r.append("session_id",s),r.append("limit",t.toString());const a=await G.get(`/ai/chat/history?${r}`);return q(a)}catch(r){H(r)}},async clearChatSession(s){try{const t=await G.delete(`/ai/chat/${s}`);return q(t)}catch(t){H(t)}},async generateStrategy(s){try{const t=await G.post("/ai/strategy/generate",{description:s.description,indicators:s.indicators||[],timeframe:s.timeframe||"1h",risk_level:s.risk_level||"medium"});return q(t)}catch(t){H(t)}},async getUsageStats(s=30){try{const t=await G.get(`/ai/usage/stats?days=${s}`);return q(t)}catch(t){H(t)}},async generateTradingInsights(s,t="1d"){try{const r=await G.post(`/ai/insights/generate?symbol=${s}&timeframe=${t}`);return q(r)}catch(r){H(r)}},async analyzeMarket(s){try{const t=await G.post("/ai/market/analyze",{symbols:s.symbols,timeframe:s.timeframe||"1d",analysis_type:s.analysis_type||"technical"});return q(t)}catch(t){H(t)}},async analyzeBacktestResults(s){try{const t=await G.post(`/ai/backtest/analyze?backtest_id=${s}`);return q(t)}catch(t){H(t)}},async getLatestAIStrategy(s){try{const t=await G.get(`/strategies/latest-ai-strategy/${s}`);return q(t)}catch(t){throw H(t),t}},async autoBacktest(s){try{const t=await G.post("/ai/strategy/auto-backtest",s);return q(t)}catch(t){throw H(t),t}},async getBacktestProgress(s){try{const t=await G.get(`/realtime-backtest/ai-strategy/progress/${s}`);return q(t)}catch(t){throw H(t),t}},async getBacktestResults(s){try{const t=await G.get(`/realtime-backtest/ai-strategy/results/${s}`);return q(t)}catch(t){throw H(t),t}},async getAISessionBacktestHistory(s){try{const t=await G.get(`/ai/strategy/backtest-history/${s}`);return q(t)}catch(t){throw H(t),t}}};class ju{constructor(t){Te(this,"ws",null);Te(this,"config");Te(this,"events",{});Te(this,"isConnected",!1);Te(this,"isAuthenticated",!1);Te(this,"reconnectAttempts",0);Te(this,"connectionId",null);Te(this,"userId",null);Te(this,"heartbeatTimer",null);Te(this,"reconnectTimer",null);this.config={reconnectInterval:3e3,maxReconnectAttempts:5,heartbeatInterval:3e4,...t}}on(t){this.events={...this.events,...t}}async connect(){return new Promise((t,r)=>{try{console.log("🔗 正在连接WebSocket AI服务:",this.config.url),this.ws=new WebSocket(this.config.url),this.ws.onopen=()=>{var a,n;console.log("✅ WebSocket连接已建立"),this.isConnected=!0,this.reconnectAttempts=0,(n=(a=this.events).onOpen)==null||n.call(a),this.authenticate().then(t).catch(r)},this.ws.onclose=a=>{var n,i;console.log("❌ WebSocket连接已断开:",a.code,a.reason),this.isConnected=!1,this.isAuthenticated=!1,this.connectionId=null,this.userId=null,this.clearTimers(),(i=(n=this.events).onClose)==null||i.call(n,a),a.code!==1e3&&this.handleReconnect(),this.reconnectAttempts===0&&r(new Error(`WebSocket连接失败: ${a.reason||"未知原因"} (Code: ${a.code})`))},this.ws.onerror=a=>{var n,i;console.error("❌ WebSocket错误:",a),(i=(n=this.events).onError)==null||i.call(n,a),r(a)},this.ws.onmessage=a=>{try{const n=JSON.parse(a.data);if(!n||typeof n!="object"){console.error("❌ WebSocket消息格式无效:",n);return}if(!n.type){console.error("❌ WebSocket消息缺少type字段:",n);return}this.handleMessage(n)}catch(n){console.error("❌ 解析WebSocket消息失败:",n,"Original data:",a.data)}}}catch(a){console.error("❌ WebSocket连接失败:",a),r(a)}})}async authenticate(){return new Promise((t,r)=>{var l;if(!this.ws||this.ws.readyState!==WebSocket.OPEN){r(new Error("WebSocket未连接"));return}const a=setTimeout(()=>{console.error("❌ [WebSocketClient] 认证超时，30秒内未收到认证响应"),r(new Error("认证超时"))},3e4),n=this.events.onAuthenticated;console.log("🔐 [WebSocketClient] 设置临时认证处理器"),this.events.onAuthenticated=o=>{console.log("🎉 [WebSocketClient] 认证回调被触发！",o),clearTimeout(a),this.isAuthenticated=!0,this.connectionId=o.connection_id||`user_${o.user_id}_${Date.now()}`,this.userId=o.user_id,this.startHeartbeat(),console.log("✅ WebSocket认证成功:",{connectionId:this.connectionId,userId:this.userId}),this.events.onAuthenticated=n,n==null||n(o),t(!0)};const i={type:"auth",token:this.config.token};console.log("📤 [WebSocketClient] 发送认证消息:",{type:i.type,tokenLength:(l=i.token)==null?void 0:l.length}),this.send(i)})}async sendAIChat(t,r="trader",a="strategy",n){if(console.log("🚀 [WebSocketClient] sendAIChat called:",{content:t.substring(0,100)+"...",aiMode:r,sessionType:a,sessionId:n,isConnected:this.isConnected,isAuthenticated:this.isAuthenticated}),!this.isConnected||!this.isAuthenticated){const o=`WebSocket状态异常 - 连接:${this.isConnected}, 认证:${this.isAuthenticated}`;throw console.error("❌ [WebSocketClient]",o),new Error(o)}const i=this.generateRequestId(),l={type:"ai_chat",request_id:i,content:t,ai_mode:r,session_type:a,session_id:n};return console.log("📤 [WebSocketClient] 发送AI消息:",l),this.send(l),i}cancelAIRequest(t){!this.isConnected||!this.isAuthenticated||this.send({type:"cancel_request",request_id:t})}ping(){this.isConnected&&this.send({type:"ping"})}disconnect(){this.clearTimers(),this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1,this.isAuthenticated=!1,this.connectionId=null,this.userId=null}getConnectionInfo(){return{isConnected:this.isConnected,isAuthenticated:this.isAuthenticated,connectionId:this.connectionId,userId:this.userId,reconnectAttempts:this.reconnectAttempts}}handleMessage(t){var a,n,i,l,o,c,d,u,m,k,x,b,g,w,v,L,C,M,j,p,S,_;const r={type:t.type,request_id:t.request_id||"N/A",...t.type==="ai_progress_update"&&{step:t.step,total_steps:t.total_steps,status:t.status,message:t.message},...t.type==="ai_stream_chunk"&&{chunk_length:((a=t.chunk)==null?void 0:a.length)||0},...t.type==="ai_stream_end"&&{response_length:((n=t.content)==null?void 0:n.length)||0,tokens_used:t.tokens_used,cost_usd:t.cost_usd}};switch(console.log("📨 收到WebSocket消息:",r),t.type){case"connection_established":console.log("✅ [WebSocketClient] 连接已建立:",t),this.isAuthenticated=!0,this.connectionId=t.connection_id||null,this.userId=t.user_id||null,this.events.onAuthenticated&&(console.log("🎯 [WebSocketClient] 触发onAuthenticated回调 (connection_established)"),this.events.onAuthenticated(t));break;case"auth_success":console.log("✅ [WebSocketClient] 认证成功:",t),this.isAuthenticated=!0,this.connectionId=t.connection_id||null,this.userId=t.user_id||null,this.events.onAuthenticated?(console.log("🎯 [WebSocketClient] 调用onAuthenticated回调"),this.events.onAuthenticated(t)):console.warn("⚠️ [WebSocketClient] onAuthenticated回调未设置");break;case"ai_chat_start":(l=(i=this.events).onAIStart)==null||l.call(i,t);break;case"ai_complexity_analysis":(c=(o=this.events).onComplexityAnalysis)==null||c.call(o,t);break;case"ai_progress_update":(u=(d=this.events).onProgressUpdate)==null||u.call(d,t);break;case"ai_chat_success":(k=(m=this.events).onAISuccess)==null||k.call(m,t);break;case"ai_chat_error":(b=(x=this.events).onAIError)==null||b.call(x,t);break;case"ai_stream_start":console.log("🌊 [WebSocketClient] 流式AI开始:",t),(w=(g=this.events).onStreamStart)==null||w.call(g,t);break;case"ai_stream_chunk":console.log("📝 [WebSocketClient] 流式AI数据块:",(t==null?void 0:t.chunk)||"[chunk为空]"),(L=(v=this.events).onStreamChunk)==null||L.call(v,t);break;case"ai_stream_end":console.log("✅ [WebSocketClient] 流式AI结束:",t),console.log("🔄 [WebSocketClient] 准备调用onStreamEnd回调"),this.events.onStreamEnd?(console.log("🎯 [WebSocketClient] onStreamEnd回调存在，正在调用..."),this.events.onStreamEnd(t),console.log("✅ [WebSocketClient] onStreamEnd回调调用完成")):console.log("⚠️ [WebSocketClient] onStreamEnd回调不存在!");break;case"ai_stream_error":const U={error:(t==null?void 0:t.error)||"Unknown error",error_type:(t==null?void 0:t.error_type)||"UNKNOWN",message:(t==null?void 0:t.message)||"No error message",request_id:(t==null?void 0:t.request_id)||"No request ID"};console.log("❌ [WebSocketClient] 流式AI错误:",U),console.log("❌ [WebSocketClient] 原始错误数据:",JSON.stringify(t,null,2)),(M=(C=this.events).onStreamError)==null||M.call(C,t);break;case"heartbeat":case"pong":(p=(j=this.events).onHeartbeat)==null||p.call(j,t);break;default:(_=(S=this.events).onMessage)==null||_.call(S,t);break}}send(t){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("⚠️ WebSocket未连接，无法发送消息:",t);return}try{this.ws.send(JSON.stringify(t)),console.log("📤 发送WebSocket消息:",t.type)}catch(r){console.error("❌ 发送WebSocket消息失败:",r)}}startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>{this.ping()},this.config.heartbeatInterval)}clearTimers(){this.heartbeatTimer&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=null),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null)}handleReconnect(){if(this.reconnectAttempts>=this.config.maxReconnectAttempts){console.error("❌ 达到最大重连次数，停止重连");return}this.reconnectAttempts++,console.log(`🔄 尝试重连 (${this.reconnectAttempts}/${this.config.maxReconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect().catch(console.error)},this.config.reconnectInterval)}generateRequestId(){return Math.random().toString(36).substring(2)+Date.now().toString(36)}}class wu{constructor(t){Te(this,"client");Te(this,"pendingRequests",new Map);Te(this,"isInitialized",!1);let r=t.baseUrl;r=r.replace(/\/api\/v1$/,""),r.match(/^https?:\/\//)||(r=window.location.protocol+"//"+r);const a=r.replace(/^http/,"ws")+"/api/v1/ai/ws/chat";console.log("🔗 [WebSocketAI] 构建的WebSocket URL:",a),this.client=new ju({url:a,token:t.token,reconnectInterval:3e3,maxReconnectAttempts:5,heartbeatInterval:3e4}),this.setupEventHandlers()}async initialize(){if(this.isInitialized)return!0;try{return await this.client.connect(),this.isInitialized=!0,!0}catch(t){return console.error("❌ WebSocket AI服务初始化失败:",t),!1}}async sendChatMessage(t,r,a="trader",n="strategy",i){if(!this.isInitialized&&!await this.initialize())throw new Error("WebSocket连接失败");return new Promise(async(l,o)=>{try{const c=await this.client.sendAIChat(t,a,n,r);this.pendingRequests.set(c,{requestId:c,resolve:l,reject:o,callbacks:i}),setTimeout(()=>{this.pendingRequests.has(c)&&(this.pendingRequests.delete(c),o({type:"ai_chat_error",request_id:c,error:"WebSocket请求超时",error_code:"WEBSOCKET_TIMEOUT",message:"WebSocket请求超时，请重试"}))},6e5)}catch(c){console.error("❌ [WebSocketAI] sendChatMessage异常:",c),o({type:"ai_chat_error",error:c instanceof Error?c.message:"未知错误",error_code:"WEBSOCKET_ERROR",message:"WebSocket发送失败"})}})}cancelRequest(t){this.client.cancelAIRequest(t),this.pendingRequests.has(t)&&this.pendingRequests.delete(t)}getConnectionStatus(){return this.client.getConnectionInfo()}disconnect(){this.client.disconnect(),this.isInitialized=!1,this.pendingRequests.clear()}async reconnect(){return this.disconnect(),this.initialize()}setupEventHandlers(){this.client.on({onOpen:()=>{console.log("🔗 WebSocket AI服务已连接")},onClose:t=>{console.log("❌ WebSocket AI服务已断开:",t.code,t.reason),this.isInitialized=!1,this.pendingRequests.forEach(({reject:r,requestId:a})=>{r({type:"ai_chat_error",request_id:a,error:"WebSocket连接断开",error_code:"WEBSOCKET_DISCONNECTED",message:"WebSocket连接断开，请重试"})}),this.pendingRequests.clear()},onError:t=>{console.error("❌ WebSocket AI服务错误:",t)},onAuthenticated:t=>{console.log("✅ WebSocket AI服务认证成功:",t)},onAIStart:t=>{var a,n;const r=this.findRequestById(t.request_id);(n=(a=r==null?void 0:r.callbacks)==null?void 0:a.onStart)==null||n.call(a,t)},onComplexityAnalysis:t=>{var a,n;const r=this.findRequestById(t.request_id);(n=(a=r==null?void 0:r.callbacks)==null?void 0:a.onComplexityAnalysis)==null||n.call(a,t)},onProgressUpdate:t=>{var a,n;const r=this.findRequestById(t.request_id);(n=(a=r==null?void 0:r.callbacks)==null?void 0:a.onProgress)==null||n.call(a,t)},onAISuccess:t=>{var a,n;const r=this.findRequestById(t.request_id);r&&(this.pendingRequests.delete(r.requestId),(n=(a=r.callbacks)==null?void 0:a.onSuccess)==null||n.call(a,t),r.resolve(t))},onAIError:t=>{var a,n;const r=this.findRequestById(t.request_id);r&&(this.pendingRequests.delete(r.requestId),(n=(a=r.callbacks)==null?void 0:a.onError)==null||n.call(a,t),r.reject(t))},onStreamStart:t=>{var a,n;const r=this.findRequestById(t.request_id);(n=(a=r==null?void 0:r.callbacks)==null?void 0:a.onStreamStart)==null||n.call(a,t)},onStreamChunk:t=>{var a,n;const r=this.findRequestById(t.request_id);(n=(a=r==null?void 0:r.callbacks)==null?void 0:a.onStreamChunk)==null||n.call(a,t)},onStreamEnd:t=>{var a,n;const r=this.findRequestById(t.request_id);if(r){this.pendingRequests.delete(r.requestId),(n=(a=r.callbacks)==null?void 0:a.onStreamEnd)==null||n.call(a,t);const i={type:"ai_chat_success",request_id:t.request_id,response:t.content,session_id:t.session_id,tokens_used:t.tokens_used,model:"claude-3-5-sonnet-20241022",cost_usd:t.cost_usd,message:"对话成功"};r.resolve(i)}},onStreamError:t=>{var a,n;const r=this.findRequestById(t.request_id);if(r){this.pendingRequests.delete(r.requestId),(n=(a=r.callbacks)==null?void 0:a.onStreamError)==null||n.call(a,t);const i={type:"ai_chat_error",request_id:t.request_id,error:t.error,message:t.message};r.reject(i)}},onHeartbeat:()=>{}})}findRequestById(t){if(t)return this.pendingRequests.get(t)}}let yr=null;function Jn(s){if(!yr&&s&&(yr=new wu(s)),!yr)throw new Error("WebSocket AI服务未初始化，请提供配置");return yr}const Ar=as()(Bs((s,t)=>({currentAIMode:"trader",chatSessions:{developer:[],trader:[]},currentSession:null,messages:[],isTyping:!1,messagesLoading:!1,messagesLoaded:!1,useWebSocket:!0,wsConnected:!1,wsConnectionId:null,aiProgress:null,streamingMessage:null,generatedStrategies:[],isGenerating:!1,currentGeneratedStrategy:null,marketAnalyses:{},isAnalyzing:!1,usageStats:null,generatedStrategy:null,showBacktestPrompt:!1,backtestProgress:null,backtestResults:null,showBacktestResults:!1,isBacktestRunning:!1,isLoading:!1,error:null,networkStatus:"connected",retryCount:0,setAIMode:r=>{s({currentAIMode:r,currentSession:null,messages:[],error:null})},createChatSession:async r=>{var a,n;s({isLoading:!0,error:null});try{const i=await Fe.createSession(r),l={session_id:i.session_id,name:r.name,description:r.description,ai_mode:r.ai_mode,session_type:r.session_type,status:"active",progress:0,message_count:0,cost_total:0,created_at:i.created_at,updated_at:i.created_at,last_activity_at:i.created_at};if(s(o=>({chatSessions:{...o.chatSessions,[r.ai_mode]:[l,...o.chatSessions[r.ai_mode]]},currentSession:l,messages:[],isLoading:!1})),r.description&&r.description.trim()){const{sendMessage:o}=t();await o(r.description.trim())}return E.success(`创建${r.session_type==="strategy"?"策略":r.session_type==="indicator"?"指标":""}会话成功`),!0}catch(i){const l=String(((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"创建会话失败");return s({error:l,isLoading:!1}),E.error(l),!1}},loadChatSessions:async r=>{var a,n;s({isLoading:!0,error:null});try{const i=await Fe.getSessions(r);s(l=>({chatSessions:{...l.chatSessions,[r]:i.sessions},isLoading:!1}))}catch(i){const l=String(((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"加载会话列表失败");s({error:l,isLoading:!1}),console.error("Load chat sessions error:",i)}},selectChatSession:async r=>{var a;if(s({currentSession:r,messages:[],error:null,messagesLoading:!!r,messagesLoaded:!1}),r)try{console.log("📥 [AIStore] 开始加载聊天历史:",r.session_id);const n=await Fe.getChatHistory(r.session_id,20),l=((n==null?void 0:n.messages)||[]).map(c=>({role:c.message_type||c.role,content:String(c.content||""),timestamp:c.created_at||c.timestamp})).reverse();((a=t().currentSession)==null?void 0:a.session_id)===r.session_id?(console.log("✅ [AIStore] 聊天历史加载完成:",{sessionId:r.session_id,messageCount:l.length}),s({messages:l,messagesLoading:!1,messagesLoaded:!0})):(console.log("⚠️ [AIStore] 会话已切换，忽略历史消息加载"),s({messagesLoading:!1,messagesLoaded:!0}))}catch(n){console.error("❌ [AIStore] 加载聊天历史失败:",n),s({error:"加载聊天历史失败，请刷新重试",messagesLoading:!1,messagesLoaded:!0})}else s({messagesLoading:!1,messagesLoaded:!0})},sendMessage:async r=>{var d;const{useWebSocket:a}=t();if(a)return t().sendMessageWebSocket(r);let{currentSession:n,currentAIMode:i,retryCount:l}=t();if(n)console.log("✅ [DEBUG] Using existing currentSession:",n.session_id);else{console.log("❌ [DEBUG] No currentSession, creating default session");try{const u=i==="trader"?"市场分析对话":"策略开发对话";if(!await t().createChatSession({name:u,ai_mode:i,session_type:"strategy",description:"自动创建的对话会话"}))return E.error("创建对话会话失败"),!1;if(n=t().currentSession,!n)return E.error("会话创建失败"),!1;console.log("✅ [DEBUG] Auto-created session:",n.session_id),E.success("已自动创建新对话")}catch(u){return console.log("❌ [DEBUG] Exception in session creation:",u),E.error("创建对话会话失败"),!1}}const o={role:"user",content:String(r||""),timestamp:new Date().toISOString()};s(u=>({messages:[...u.messages,o],isTyping:!0,error:null,networkStatus:"checking",retryCount:0}));const c=r0(2,1500);try{const m=await c(async()=>{const x=new Promise((g,w)=>{setTimeout(()=>w(new Error("TIMEOUT")),45e3)});console.log("📤 [DEBUG] Calling aiApi.sendChatMessage with:",{message:r,sessionId:n.session_id,aiMode:n.ai_mode,sessionType:n.session_type});const b=Fe.sendChatMessage(r,n.session_id,n.ai_mode,n.session_type);return await Promise.race([b,x])},"ai-chat"),k={role:"assistant",content:String(m.response||""),timestamp:new Date().toISOString()};return s(x=>({messages:[...x.messages,k],isTyping:!1,error:null,networkStatus:"connected",retryCount:0})),m.cost_usd>0&&(t().updateUsageStatsRealtime(m.cost_usd,m.tokens_used||0),E.success(`AI回复完成 (消耗 $${m.cost_usd.toFixed(4)})`,{icon:"🧠",duration:3e3})),!0}catch(u){const m=()=>{s(g=>({isTyping:!1,networkStatus:"disconnected",retryCount:g.retryCount+1}))},k=Oa.handle(u,"ai-chat-send",!1);let x="",b=!1;switch(k.type){case _r.NETWORK:x="AI服务暂时不可用，请检查网络连接",b=!0;break;case _r.SERVER:k.code===504?(x="Claude AI服务繁忙，请稍后重试",b=!0):x="AI服务器错误，请稍后再试";break;case _r.AUTH:x="AI使用权限不足，请检查会员状态";break;default:u.message==="TIMEOUT"?(x="AI响应超时，服务可能繁忙",b=!0):(d=u.message)!=null&&d.includes("AI回复超时")?(x="AI回复超时，请稍后重试",b=!0):x=k.message||"发送消息失败"}return m(),s({error:x}),E.error(x,{duration:b?8e3:5e3,icon:b?"🔄":"❌",id:`ai-error-${Date.now()}`}),b&&setTimeout(()=>{E("可尝试重新发送消息或检查网络连接",{icon:"💡",duration:6e3,style:{background:"#FEF3C7",color:"#92400E",border:"1px solid #FCD34D"}})},1e3),!1}},updateSessionStatus:async(r,a,n)=>{var i,l;try{return await Fe.updateSessionStatus(r,a,n),s(o=>{var d;const c={...o.chatSessions};return Object.keys(c).forEach(u=>{c[u]=c[u].map(m=>m.session_id===r?{...m,status:a,progress:n??m.progress}:m)}),{chatSessions:c,currentSession:((d=o.currentSession)==null?void 0:d.session_id)===r?{...o.currentSession,status:a,progress:n??o.currentSession.progress}:o.currentSession}}),E.success("会话状态更新成功"),!0}catch(o){const c=((l=(i=o.response)==null?void 0:i.data)==null?void 0:l.message)||"更新会话状态失败";return E.error(c),!1}},deleteChatSession:async r=>{var a,n;try{return await Fe.deleteSession(r),s(i=>{var o,c;const l={...i.chatSessions};return Object.keys(l).forEach(d=>{l[d]=l[d].filter(u=>u.session_id!==r)}),{chatSessions:l,currentSession:((o=i.currentSession)==null?void 0:o.session_id)===r?null:i.currentSession,messages:((c=i.currentSession)==null?void 0:c.session_id)===r?[]:i.messages}}),E.success("会话删除成功"),!0}catch(i){const l=((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"删除会话失败";return E.error(l),!1}},loadUsageStats:async(r=30)=>{var a,n;s({isLoading:!0,error:null});try{const i=await Fe.getUsageStats(r);s({usageStats:i,isLoading:!1})}catch(i){const l=String(((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"获取使用统计失败");s({error:l,isLoading:!1}),console.error("Load usage stats error:",i)}},updateUsageStatsRealtime:(r,a)=>{s(n=>n.usageStats?{usageStats:{...n.usageStats,total_requests:(n.usageStats.total_requests||0)+1,total_cost_usd:(n.usageStats.total_cost_usd||0)+r,daily_cost_usd:(n.usageStats.daily_cost_usd||0)+r,monthly_cost_usd:(n.usageStats.monthly_cost_usd||0)+r}}:{usageStats:{period_days:1,total_requests:1,total_cost_usd:r,daily_cost_usd:r,monthly_cost_usd:r,remaining_daily_quota:1e3,remaining_monthly_quota:3e4,by_feature:{},by_session:{}}}),console.log(`💰 [AIStore] 实时更新统计: +$${r.toFixed(4)}, +${a} tokens`)},clearCurrentMessages:()=>{s({messages:[],currentSession:null})},generateStrategy:async r=>{var a,n;s({isGenerating:!0,error:null});try{const i=await Fe.generateStrategy(r),l={name:r.description.split(" ").slice(0,3).join(" ")+" Strategy",description:r.description,code:i.code,explanation:i.explanation,parameters:i.parameters,risk_assessment:{level:r.risk_level||"medium",factors:i.warnings||[],recommendations:["Review and test thoroughly before live trading"]}};return s(o=>({generatedStrategies:[l,...o.generatedStrategies],currentGeneratedStrategy:l,isGenerating:!1})),E.success("策略生成成功"),l}catch(i){const l=String(((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"策略生成失败");return s({error:l,isGenerating:!1}),E.error(l),null}},optimizeStrategy:async(r,a)=>{var n,i;s({isLoading:!0,error:null});try{const l=`请优化以下策略代码，优化目标：${a.join(", ")}

代码：
${r}`,o=await Fe.sendChatMessage(l,void 0,"developer","strategy");return s({isLoading:!1}),E.success("策略优化完成"),{code:o.response,explanation:"通过AI聊天优化生成",improvements:a}}catch(l){const o=String(((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.message)||"策略优化失败");throw s({error:o,isLoading:!1}),E.error(o),l}},explainStrategy:async r=>{var a,n;s({isLoading:!0,error:null});try{const i=`请详细解释以下策略代码的逻辑和功能：

${r}`,l=await Fe.sendChatMessage(i,void 0,"developer","strategy");return s({isLoading:!1}),{explanation:l.response,complexity:"medium",features:[]}}catch(i){const l=String(((n=(a=i.response)==null?void 0:a.data)==null?void 0:n.message)||"策略解释失败");throw s({error:l,isLoading:!1}),E.error(l),i}},clearGeneratedStrategies:()=>{s({generatedStrategies:[],currentGeneratedStrategy:null})},analyzeMarket:async(r,a,n)=>{var l,o;const i=`${r}-${n}`;s({isAnalyzing:!0,error:null});try{const c=await Fe.analyzeMarket({symbols:[r],timeframe:n,analysis_type:"technical"}),d={symbol:r,timeframe:n,trend_direction:"neutral",strength:.5,support_levels:[],resistance_levels:[],technical_indicators:c.risk_assessment||{},summary:c.summary,recommendations:c.recommendations,confidence:.75};return s(u=>({marketAnalyses:{...u.marketAnalyses,[i]:d},isAnalyzing:!1})),E.success(`${r} 市场分析完成`),d}catch(c){const d=String(((o=(l=c.response)==null?void 0:l.data)==null?void 0:o.message)||"市场分析失败");return s({error:d,isAnalyzing:!1}),E.error(d),null}},getTradingSignals:async(r,a,n)=>{var i,l;s({isLoading:!0,error:null});try{const o=[];for(const c of n){const d=await Fe.analyzeMarket({symbols:[r],timeframe:c,analysis_type:"technical"});o.push({symbol:r,timeframe:c,signals:d.signals||[],summary:d.summary,recommendations:d.recommendations})}return s({isLoading:!1}),E.success(`${r} 交易信号获取成功`),o}catch(o){const c=String(((l=(i=o.response)==null?void 0:i.data)==null?void 0:l.message)||"获取交易信号失败");throw s({error:c,isLoading:!1}),E.error(c),o}},assessRisk:async(r,a)=>{var n,i;s({isLoading:!0,error:null});try{const l=r?`请评估以下策略代码的风险：
${r}`:`请评估以下投资组合的风险：
${JSON.stringify(a,null,2)}`,o=await Fe.sendChatMessage(l,void 0,"trader","strategy"),c={riskLevel:"medium",riskFactors:["市场波动风险","流动性风险"],recommendations:o.response.split(`
`).filter(d=>d.trim()),score:.6};return s({isLoading:!1}),E.success("风险评估完成"),c}catch(l){const o=String(((i=(n=l.response)==null?void 0:n.data)==null?void 0:i.message)||"风险评估失败");throw s({error:o,isLoading:!1}),E.error(o),l}},clearError:()=>{s({error:null})},reset:()=>{s({currentAIMode:"developer",chatSessions:{developer:[],trader:[]},currentSession:null,messages:[],isTyping:!1,generatedStrategies:[],isGenerating:!1,currentGeneratedStrategy:null,marketAnalyses:{},isAnalyzing:!1,usageStats:null,isLoading:!1,error:null,networkStatus:"connected",retryCount:0})},toggleWebSocket:()=>{s(a=>({useWebSocket:!a.useWebSocket,aiProgress:null}));const{useWebSocket:r}=t();E.success(r?"已切换到WebSocket模式 (实时对话)":"已切换到HTTP模式")},initializeWebSocket:async()=>{var a,n;const{useWebSocket:r}=t();if(!r)return console.log("🔄 [AIStore] WebSocket未启用，跳过初始化"),!1;try{s({isLoading:!0,error:null});const i=localStorage.getItem("auth-storage");if(!i)throw new Error("未找到认证信息，请重新登录");const l=JSON.parse(i),o=((a=l==null?void 0:l.state)==null?void 0:a.token)||"",c=((n=l==null?void 0:l.state)==null?void 0:n.isAuthenticated)||!1;if(!o||!c)throw new Error("认证token无效或已过期，请重新登录");console.log("🔗 [AIStore] 开始初始化WebSocket连接..."),console.log("🔑 [AIStore] 使用token:",o.substring(0,20)+"...");const d=Jn({baseUrl:window.location.origin,token:o});if(console.log("🔄 [AIStore] WebSocket服务实例已创建，开始连接..."),await d.initialize()){const m=d.getConnectionStatus();return console.log("✅ [AIStore] WebSocket连接成功:",m),s({wsConnected:!0,wsConnectionId:m.connectionId,isLoading:!1,networkStatus:"connected"}),E.success("🌊 WebSocket AI服务连接成功!",{icon:"🔗",duration:3e3}),!0}else throw new Error("WebSocket连接失败")}catch(i){const l=String((i==null?void 0:i.message)||i||"WebSocket连接失败");return console.error("❌ [AIStore] WebSocket初始化失败:",i),s({wsConnected:!1,wsConnectionId:null,error:l,isLoading:!1,networkStatus:"disconnected"}),l.includes("认证")||l.includes("登录")?E.error(`🔐 ${l}`,{icon:"🔑",duration:6e3}):E.error(`🔌 WebSocket连接失败: ${l}`,{icon:"❌",duration:5e3}),!1}},sendMessageWebSocket:async r=>{var o;const{currentSession:a,currentAIMode:n,useWebSocket:i,wsConnected:l}=t();if(!i)return t().sendMessage(r);if(!l&&!await t().initializeWebSocket())return E.error("WebSocket未连接，请检查网络连接"),!1;if(!a){const c=n==="trader"?"市场分析对话":"策略开发对话";if(!await t().createChatSession({name:c,ai_mode:n,session_type:"strategy",description:"自动创建的WebSocket对话会话"}))return E.error("创建对话会话失败"),!1}s(c=>{const d={role:"user",content:String(r||""),timestamp:new Date().toISOString()};return{messages:[...c.messages,d],isTyping:!0,error:null,aiProgress:{isProcessing:!0,step:0,totalSteps:4,status:"preparing",message:"正在准备发送..."}}});try{const c=localStorage.getItem("auth-storage");if(!c)throw new Error("认证信息丢失，请重新登录");const d=JSON.parse(c),u=((o=d==null?void 0:d.state)==null?void 0:o.token)||"";if(!u)throw new Error("认证token无效，请重新登录");const m=Jn({baseUrl:window.location.origin,token:u}),k=t().currentSession;return await m.sendChatMessage(r,k.session_id,k.ai_mode,k.session_type,{onStart:x=>{s(b=>({aiProgress:{...b.aiProgress,status:"started",message:x.message||"AI开始处理..."}}))},onComplexityAnalysis:x=>{s(b=>({aiProgress:{...b.aiProgress,complexity:x.complexity,estimatedTime:x.estimated_time_seconds,message:x.message}}))},onProgress:x=>{s(b=>({aiProgress:{...b.aiProgress,step:x.step,totalSteps:x.total_steps,status:x.status,message:x.message}}))},onSuccess:x=>{let b;if(typeof x.response=="string"&&x.response)b=x.response;else if(x.response&&typeof x.response=="object"){const w=x.response;b=w.content||w.message||JSON.stringify(w)}else x.message?b=String(x.message):b="AI响应错误";b=String(b||"AI响应为空");const g={role:"assistant",content:b,timestamp:new Date().toISOString()};b&&b.includes("```")&&(g.metadata={codeBlock:b}),s(w=>{const v={role:"assistant",content:String(g.content),timestamp:String(g.timestamp)};return g.metadata&&(v.metadata={codeBlock:String(g.metadata.codeBlock||"")}),{messages:[...w.messages,v],isTyping:!1,aiProgress:null}}),x.cost_usd>0&&(t().updateUsageStatsRealtime(x.cost_usd,x.tokens_used||0),E.success(`AI回复完成 (消耗 $${x.cost_usd.toFixed(4)}, ${x.tokens_used} tokens)`,{icon:"🚀",duration:4e3}))},onStreamStart:x=>{console.log("🌊 [AIStore] 流式开始:",x),s(b=>{const g={role:"assistant",content:"🤔 AI正在深度思考中，马上开始回复...",timestamp:new Date().toISOString(),metadata:{isStreaming:!0,isWaitingFirstChunk:!0}};return{messages:[...b.messages,g],isTyping:!1,streamingMessage:{isStreaming:!0,requestId:x.request_id,accumulatedContent:"",messageIndex:b.messages.length},aiProgress:{...b.aiProgress,status:"stream_waiting",message:"🌊 AI正在深度分析，即将开始流式回复..."}}})},onStreamChunk:x=>{console.log("📝 [AIStore] 流式数据块:",x.chunk),s(b=>{var L;const{streamingMessage:g}=b;if(!(g!=null&&g.isStreaming)||g.messageIndex===void 0)return b;const w=[...b.messages];let v=g.accumulatedContent;if(w[g.messageIndex]){const C=w[g.messageIndex];v=((L=C.metadata)==null?void 0:L.isWaitingFirstChunk)?x.chunk:g.accumulatedContent+x.chunk,w[g.messageIndex]={...C,content:v,metadata:{isStreaming:!0,isWaitingFirstChunk:!1}}}return{messages:w,streamingMessage:{...g,accumulatedContent:v},aiProgress:{...b.aiProgress,status:"streaming_active",message:"✍️ AI正在实时生成回复..."}}})},onStreamEnd:x=>{console.log("✅ [AIStore] 流式结束:",x),s(b=>{console.log("🚀 [AIStore] 立即强制更新messages数组以触发React重新渲染");const g={role:"assistant",content:x.content||"流式消息完成",timestamp:new Date().toISOString(),metadata:{streamCompleted:!0,completedAt:Date.now(),forceRender:Math.random()}};return{...b,messages:[...b.messages,g],isTyping:!1,streamingMessage:null,aiProgress:null}}),x.cost_usd>0&&(t().updateUsageStatsRealtime(x.cost_usd,x.tokens_used||0),E.success(`🌊 流式AI回复完成 (消耗 $${x.cost_usd.toFixed(4)}, ${x.tokens_used} tokens)`,{icon:"🚀",duration:4e3}))},onStreamError:x=>{const b=v=>{if(!v)return"undefined";if(typeof v=="string")return v;if(typeof v=="number"||typeof v=="boolean")return String(v);if(typeof v=="object")try{if(v.message)return v.message;if(v.error)return String(v.error);if(v.toString&&typeof v.toString=="function"){const L=v.toString();if(L!=="[object Object]")return L}return JSON.stringify(v,null,2)}catch{return"[Complex Error Object]"}return String(v)};console.log("❌ [AIStore] 流式错误:",{error:b(x==null?void 0:x.error),error_type:x==null?void 0:x.error_type,message:x==null?void 0:x.message,request_id:x==null?void 0:x.request_id});const g={...x,error:b(x==null?void 0:x.error),message:(x==null?void 0:x.message)||b(x==null?void 0:x.error)||"流式处理失败"};s(v=>({...v,isTyping:!1,streamingMessage:null,aiProgress:null,error:g.message}));const w=t().getErrorMessage(g);E.error(w,{duration:6e3,id:`stream-error-${Date.now()}`})},onError:x=>{console.log("❌ [AIStore] onError - 处理AI对话错误:",x);const b=C=>{if(!C)return"undefined";if(typeof C=="string")return C;if(typeof C=="number"||typeof C=="boolean")return String(C);if(typeof C=="object")try{if(C.message)return C.message;if(C.error)return String(C.error);if(C.toString&&typeof C.toString=="function"){const M=C.toString();if(M!=="[object Object]")return M}return JSON.stringify(C,null,2)}catch{return"[Complex Error Object]"}return String(C)},g={...x,error:b(x==null?void 0:x.error),message:(x==null?void 0:x.message)||b(x==null?void 0:x.error)||"AI处理失败"},w=t().getErrorMessage(g),v=`抱歉，${w}`;s(C=>{const M={role:"assistant",content:String(v),timestamp:new Date().toISOString(),metadata:{isError:!0}};return{messages:[...C.messages,M],isTyping:!1,error:String(v),aiProgress:null}});const L=x.retry_suggested?`${w} (可以重试)`:w;E.error(L,{duration:x.retry_suggested?8e3:5e3,icon:x.retry_suggested?"🔄":"❌"})}}),!0}catch(c){return console.error("❌ [DEBUG] WebSocket发送异常:",c),console.error("❌ [DEBUG] Error stack:",c.stack),console.error("❌ [DEBUG] Error details:",{message:c.message,name:c.name,type:typeof c,error:c}),s({isTyping:!1,error:c.message||"WebSocket发送失败",aiProgress:null}),E.error(`WebSocket发送失败: ${c.message}`),!1}},checkNetworkStatus:async()=>{try{s({networkStatus:"checking"});const r=new AbortController,a=setTimeout(()=>r.abort(),5e3);return await fetch("/api/v1/health",{method:"HEAD",signal:r.signal}),clearTimeout(a),s({networkStatus:"connected"}),!0}catch{return s({networkStatus:"disconnected"}),!1}},getErrorMessage:r=>{if(!r)return"未知错误，请重试";const a=r.error_code||r.code;let n=r.error||r.message||"";switch(n=(o=>{if(!o)return"";if(typeof o=="string")return o;if(typeof o=="number"||typeof o=="boolean")return String(o);if(typeof o=="object")try{if(o.message&&typeof o.message=="string")return o.message;if(o.error&&typeof o.error=="string")return o.error;if(o.detail&&typeof o.detail=="string")return o.detail;if(o.description&&typeof o.description=="string")return o.description;if(o.toString&&typeof o.toString=="function"){const d=o.toString();if(d!=="[object Object]"&&d!=="[object Error]")return d}if(o instanceof Error)return o.name?`${o.name}: ${o.message}`:o.message;const c=JSON.stringify(o,Object.getOwnPropertyNames(o),2);return c&&c!=="{}"&&c!=="null"&&c!=="[]"?c:""}catch{return"[Serialization Error]"}return String(o)})(n),a){case"WEBSOCKET_TIMEOUT":return"⏰ AI响应超时，请重试或检查网络连接";case"WEBSOCKET_DISCONNECTED":return"🔌 连接断开，正在重新连接...";case"WEBSOCKET_ERROR":return"📡 网络连接出现问题，请检查网络设置";case"AI_PROCESSING_FAILED":return"🤖 AI处理失败，请稍后重试";case"RATE_LIMIT_EXCEEDED":return"⚡ 请求过于频繁，请稍等片刻再试";case"INSUFFICIENT_CREDITS":return"💳 AI对话额度不足，请升级会员";case"INVALID_SESSION":return"🔄 会话已过期，将为您创建新会话"}if(n.includes("timeout")||n.includes("超时"))return"⏰ 请求超时，请重试";if(n.includes("network")||n.includes("网络"))return"📡 网络连接异常，请检查网络设置";if(n.includes("quota")||n.includes("额度"))return"💳 AI对话额度已用尽，请明日再试或升级会员";if(n.includes("session")||n.includes("会话"))return"🔄 会话异常，请刷新页面重试";if(n.includes("auth")||n.includes("认证"))return"🔐 身份认证失败，请重新登录";if(n.includes("busy")||n.includes("繁忙")||n.includes("服务繁忙"))return"🚀 AI服务繁忙，请稍后重试";if(n.includes("unavailable")||n.includes("不可用"))return"⚠️ AI服务暂时不可用，请稍后重试";if(!n||n.trim()===""||n==="undefined"||n==="null"||n==="[object Object]"||n==="[object Error]")return"⚠️ 服务暂时不可用，请稍后重试";const l=n.replace(/^(Error:|ERROR:|错误:)\s*/i,"").trim();return l?`❌ ${l}`:"⚠️ 服务暂时不可用，请稍后重试"},getLatestAIStrategy:async r=>{s({isLoading:!0,error:null});try{const a=await Fe.getLatestAIStrategy(r);return s({generatedStrategy:a,isLoading:!1}),a}catch(a){const n=t().getErrorMessage(a);return s({error:n,isLoading:!1}),E.error(`获取策略失败: ${n}`),null}},autoBacktest:async r=>{s({isBacktestRunning:!0,backtestProgress:null,error:null});try{const a=await Fe.autoBacktest(r);if(a.success&&a.task_id)return t().startBacktestMonitoring(a.task_id),E.success("回测已启动，正在后台运行...",{icon:"🚀",duration:4e3}),!0;throw new Error(a.message||"回测启动失败")}catch(a){const n=t().getErrorMessage(a);return s({isBacktestRunning:!1,error:n}),E.error(`回测启动失败: ${n}`),!1}},getBacktestProgress:async r=>{try{const a=await Fe.getBacktestProgress(r);return s({backtestProgress:a}),a}catch(a){const n=t().getErrorMessage(a);return console.error("获取回测进度失败:",n),null}},getBacktestResults:async r=>{try{const a=await Fe.getBacktestResults(r);return s({backtestResults:a,showBacktestResults:!0,isBacktestRunning:!1}),a}catch(a){const n=t().getErrorMessage(a);return s({error:n,isBacktestRunning:!1}),E.error(`获取回测结果失败: ${n}`),null}},startBacktestMonitoring:r=>{const a=t();a.backtestMonitorInterval&&clearInterval(a.backtestMonitorInterval);const n=setInterval(async()=>{try{const i=await t().getBacktestProgress(r);i&&(i.status==="completed"?(clearInterval(n),await t().getBacktestResults(r),E.success("🎉 回测完成！",{icon:"✅",duration:5e3})):i.status==="failed"&&(clearInterval(n),s({isBacktestRunning:!1,error:i.error_message||"回测执行失败"}),E.error(`回测失败: ${i.error_message||"未知错误"}`)))}catch(i){console.error("监控回测进度时出错:",i)}},3e3);t().backtestMonitorInterval=n,setTimeout(()=>{clearInterval(n),t().isBacktestRunning&&(s({isBacktestRunning:!1,error:"回测监控超时，请手动刷新查看结果"}),E.error("回测监控超时，请刷新页面查看结果"))},30*60*1e3)},stopBacktestMonitoring:()=>{const r=t();r.backtestMonitorInterval&&(clearInterval(r.backtestMonitorInterval),delete r.backtestMonitorInterval),s({isBacktestRunning:!1})},handleStrategyGenerated:async r=>{try{await t().getLatestAIStrategy(r)&&(s({showBacktestPrompt:!0}),E.success("🎯 策略生成完成！现在可以配置回测参数了",{icon:"🚀",duration:6e3}))}catch(a){console.error("处理策略生成后逻辑失败:",a)}},handleQuickBacktest:async r=>{const{currentSession:a,generatedStrategy:n}=t();if(!a||!n){E.error("缺少会话或策略信息，无法启动回测");return}const i={ai_session_id:a.session_id,strategy_code:n.code,strategy_name:n.name,auto_config:!0,exchange:"binance",symbols:["BTC/USDT"],timeframes:["1h"],initial_capital:1e4,start_date:"2024-01-01",end_date:"2024-12-31",fee_rate:"vip0",...r};await t().autoBacktest(i)&&s({showBacktestPrompt:!1})},setShowBacktestPrompt:r=>{s({showBacktestPrompt:r})},setShowBacktestResults:r=>{s({showBacktestResults:r})}}),{name:"ai-storage",partialize:s=>({currentAIMode:s.currentAIMode,chatSessions:s.chatSessions,generatedStrategies:s.generatedStrategies,marketAnalyses:s.marketAnalyses,usageStats:s.usageStats})})),He={async getAccountBalance(s){try{const t=await G.get(`/trading/accounts/${s}/balance`);return q(t)}catch(t){H(t)}},async getSupportedExchanges(){try{const s=await G.get("/trading/exchanges");return q(s)}catch(s){H(s)}},async getSymbols(s){try{const t=await G.get(`/trading/exchanges/${s}/symbols`);return q(t)}catch(t){H(t)}},async createOrder(s){try{const t=await G.post("/trading/orders",s);return q(t)}catch(t){H(t)}},async getOrders(s){try{const t=await G.get("/trading/orders",{params:s});return q(t)}catch(t){H(t)}},async getOrder(s){try{const t=await G.get(`/trading/orders/${s}`);return q(t)}catch(t){H(t)}},async cancelOrder(s){try{const t=await G.delete(`/trading/orders/${s}`);return q(t)}catch(t){H(t)}},async getOrderStatistics(s=30){try{const t=await G.get(`/trading/orders/statistics?days=${s}`);return q(t)}catch(t){H(t)}},async getPositions(s){try{const t=s?`/trading/positions?exchange=${s}`:"/trading/positions",r=await G.get(t);return q(r)}catch(t){H(t)}},async getPositionPnL(s,t,r){try{const a=await G.get(`/trading/positions/${t}/${s}/pnl`,{params:{current_price:r}});return q(a)}catch(a){H(a)}},async getTradingSummary(s=30){try{const t=await G.get(`/trading/summary?days=${s}`);return q(t)}catch(t){H(t)}},async getDailyPnL(s=30){try{const t=await G.get(`/trading/daily-pnl?days=${s}`);return q(t)}catch(t){H(t)}},async getTrades(s){try{const t=await G.get("/trading/trades",{params:s});return q(t)}catch(t){H(t)}},async createTradingSession(s){try{const t=await G.post("/trading/sessions",s);return q(t)}catch(t){H(t)}},async getTradingSessions(){try{const s=await G.get("/trading/sessions");return q(s)}catch(s){H(s)}},async startTradingSession(s){try{const t=await G.post(`/trading/sessions/${s}/start`);return q(t)}catch(t){H(t)}},async stopTradingSession(s){try{const t=await G.post(`/trading/sessions/${s}/stop`);return q(t)}catch(t){H(t)}},async validateOrder(s){try{const t=await G.post("/trading/risk/validate-order",s);return q(t)}catch(t){H(t)}},async getPortfolioRisk(){try{const s=await G.get("/trading/risk/portfolio");return q(s)}catch(s){H(s)}},async getMarketData(s,t,r,a=100){try{const n=await G.get("/trading/market-data",{params:{exchange:s,symbol:t,timeframe:r,limit:a}});return q(n)}catch(n){H(n)}},async getTradingFees(s){try{const t=await G.get(`/trading/fees/${s}`);return q(t)}catch(t){H(t)}}},ca={exchange:"okx",symbol:"BTC/USDT",side:"buy",order_type:"limit",price:"",quantity:"",amount:""},Qn=as()(Bs((s,t)=>({accounts:{},selectedExchange:"okx",supportedExchanges:[],availableSymbols:[],orders:[],activeOrders:[],orderHistory:[],orderStats:null,positions:[],totalPortfolioValue:0,totalUnrealizedPnL:0,totalRealizedPnL:0,tradingSummary:null,dailyPnLData:[],recentTrades:[],tradingSessions:[],activeSessions:[],tradingForm:ca,lastRiskAssessment:null,selectedTimeframe:"15m",showAdvancedOptions:!1,isLoading:!1,isPlacingOrder:!1,isLoadingPositions:!1,isLoadingOrders:!1,error:null,loadSupportedExchanges:async()=>{try{s({isLoading:!0,error:null});const r=await He.getSupportedExchanges();s({supportedExchanges:r,isLoading:!1})}catch(r){s({error:r instanceof Error?r.message:"Failed to load exchanges",isLoading:!1})}},loadAccountBalance:async r=>{try{s({isLoading:!0,error:null});const a=await He.getAccountBalance(r);s(n=>({accounts:{...n.accounts,[r]:a},isLoading:!1}))}catch(a){s({error:a instanceof Error?a.message:"Failed to load account balance",isLoading:!1})}},loadAvailableSymbols:async r=>{try{const a=await He.getSymbols(r);s({availableSymbols:a})}catch(a){console.error("Failed to load symbols:",a)}},switchExchange:r=>{s({selectedExchange:r}),t().loadAccountBalance(r),t().loadAvailableSymbols(r),t().loadPositions(r)},createOrder:async r=>{try{s({isPlacingOrder:!0,error:null});const a=await He.createOrder(r);return s(n=>({orders:[a,...n.orders],activeOrders:a.status==="filled"?n.activeOrders:[a,...n.activeOrders],isPlacingOrder:!1})),t().loadPositions(),t().loadAccountBalance(r.exchange),a}catch(a){return s({error:a instanceof Error?a.message:"Failed to create order",isPlacingOrder:!1}),null}},loadOrders:async(r={})=>{try{s({isLoadingOrders:!0,error:null});const a=await He.getOrders(r),n=a.filter(l=>!["filled","canceled","rejected","failed"].includes(l.status)),i=a.filter(l=>["filled","canceled","rejected","failed"].includes(l.status));s({orders:a,activeOrders:n,orderHistory:i,isLoadingOrders:!1})}catch(a){s({error:a instanceof Error?a.message:"Failed to load orders",isLoadingOrders:!1})}},cancelOrder:async r=>{try{s({isLoading:!0,error:null}),await He.cancelOrder(r),s(a=>({orders:a.orders.map(n=>n.id===r?{...n,status:"canceled"}:n),activeOrders:a.activeOrders.filter(n=>n.id!==r),isLoading:!1}))}catch(a){s({error:a instanceof Error?a.message:"Failed to cancel order",isLoading:!1})}},refreshOrder:async r=>{try{const a=await He.getOrder(r);s(n=>({orders:n.orders.map(i=>i.id===r?a:i),activeOrders:n.activeOrders.map(i=>i.id===r?a:i)}))}catch(a){console.error("Failed to refresh order:",a)}},loadOrderStatistics:async(r=30)=>{try{const a=await He.getOrderStatistics(r);s({orderStats:a})}catch(a){console.error("Failed to load order statistics:",a)}},loadPositions:async r=>{try{s({isLoadingPositions:!0,error:null});const a=await He.getPositions(r),n=a.reduce((o,c)=>o+c.current_value,0),i=a.reduce((o,c)=>o+c.unrealized_pnl,0),l=a.reduce((o,c)=>o+c.realized_pnl,0);s({positions:a,totalPortfolioValue:n,totalUnrealizedPnL:i,totalRealizedPnL:l,isLoadingPositions:!1})}catch(a){s({error:a instanceof Error?a.message:"Failed to load positions",isLoadingPositions:!1})}},refreshPositions:async()=>{const{selectedExchange:r}=t();await t().loadPositions(r)},calculatePositionPnL:async(r,a,n)=>{try{const i=await He.getPositionPnL(r,a,n);s(l=>({positions:l.positions.map(o=>o.symbol===r&&o.exchange===a?i:o)}))}catch(i){console.error("Failed to calculate position PnL:",i)}},loadTradingSummary:async(r=30)=>{try{s({isLoading:!0,error:null});const a=await He.getTradingSummary(r);s({tradingSummary:a,isLoading:!1})}catch(a){s({error:a instanceof Error?a.message:"Failed to load trading summary",isLoading:!1})}},loadDailyPnL:async(r=30)=>{try{const a=await He.getDailyPnL(r);s({dailyPnLData:a})}catch(a){console.error("Failed to load daily PnL:",a)}},loadRecentTrades:async(r={})=>{try{const a=await He.getTrades({...r,limit:50});s({recentTrades:a})}catch(a){console.error("Failed to load recent trades:",a)}},createTradingSession:async r=>{try{s({isLoading:!0,error:null});const a=await He.createTradingSession(r);return s(n=>({tradingSessions:[a,...n.tradingSessions],isLoading:!1})),a}catch(a){return s({error:a instanceof Error?a.message:"Failed to create trading session",isLoading:!1}),null}},loadTradingSessions:async()=>{try{const r=await He.getTradingSessions(),a=r.filter(n=>n.status==="active");s({tradingSessions:r,activeSessions:a})}catch(r){console.error("Failed to load trading sessions:",r)}},startTradingSession:async r=>{try{s({isLoading:!0,error:null}),await He.startTradingSession(r),s(a=>({tradingSessions:a.tradingSessions.map(n=>n.id===r?{...n,status:"active"}:n),isLoading:!1}))}catch(a){s({error:a instanceof Error?a.message:"Failed to start trading session",isLoading:!1})}},stopTradingSession:async r=>{try{s({isLoading:!0,error:null}),await He.stopTradingSession(r),s(a=>({tradingSessions:a.tradingSessions.map(n=>n.id===r?{...n,status:"stopped"}:n),isLoading:!1}))}catch(a){s({error:a instanceof Error?a.message:"Failed to stop trading session",isLoading:!1})}},updateTradingForm:(r,a)=>{s(n=>({tradingForm:{...n.tradingForm,[r]:a}})),(r==="price"||r==="quantity")&&t().calculateOrderAmount()},resetTradingForm:()=>{s({tradingForm:ca,lastRiskAssessment:null})},calculateOrderAmount:()=>{const{tradingForm:r}=t(),{price:a,quantity:n}=r;if(a&&n){const i=(parseFloat(a)*parseFloat(n)).toFixed(2);s(l=>({tradingForm:{...l.tradingForm,amount:i}}))}},validateOrder:async()=>{try{const{tradingForm:r}=t();if(!r.quantity||!r.price)return null;const a={exchange:r.exchange,symbol:r.symbol,order_type:r.order_type,side:r.side,amount:parseFloat(r.quantity),price:r.order_type==="limit"?parseFloat(r.price):void 0},n=await He.validateOrder(a);return s({lastRiskAssessment:n}),n}catch(r){return console.error("Failed to validate order:",r),null}},setSelectedTimeframe:r=>{s({selectedTimeframe:r})},toggleAdvancedOptions:()=>{s(r=>({showAdvancedOptions:!r.showAdvancedOptions}))},setLoading:r=>s({isLoading:r}),setError:r=>s({error:r}),clearError:()=>s({error:null}),reset:()=>s({accounts:{},orders:[],activeOrders:[],orderHistory:[],positions:[],tradingSessions:[],activeSessions:[],tradingForm:ca,lastRiskAssessment:null,isLoading:!1,isPlacingOrder:!1,isLoadingPositions:!1,isLoadingOrders:!1,error:null})}),{name:"trading-store",partialize:s=>({selectedExchange:s.selectedExchange,tradingForm:s.tradingForm,selectedTimeframe:s.selectedTimeframe,showAdvancedOptions:s.showAdvancedOptions})})),_t={async createBacktest(s){try{const t=await G.post("/backtests",s);return q(t)}catch(t){H(t)}},async getBacktests(s){try{const t=await G.get("/backtests",{params:s});return q(t)}catch(t){H(t)}},async getBacktest(s){try{const t=await G.get(`/backtests/${s}`);return q(t)}catch(t){H(t)}},async getBacktestStatus(s){try{const t=await G.get(`/backtests/${s}/status`);return q(t)}catch(t){H(t)}},async stopBacktest(s){try{const t=await G.post(`/backtests/${s}/stop`);return q(t)}catch(t){H(t)}},async deleteBacktest(s){try{const t=await G.delete(`/backtests/${s}`);return q(t)}catch(t){H(t)}},async downloadBacktestReport(s,t="html"){try{return(await G.get(`/backtests/${s}/report`,{params:{format:t},responseType:"blob"})).data}catch(r){H(r)}},async compareBacktests(s){try{const t=await G.post("/backtests/compare",{backtest_ids:s});return q(t)}catch(t){H(t)}}},da={strategy_id:"",symbol:"BTC/USDT",exchange:"okx",start_date:"2024-01-01",end_date:"2024-03-31",initial_capital:1e4,commission_rate:.001,timeframe:"1h"},rr=as()(Bs((s,t)=>({backtests:[],currentBacktest:null,loading:!1,error:null,configForm:da,isCreatingBacktest:!1,runningBacktests:new Map,selectedForComparison:[],comparisonResult:null,pagination:{page:1,per_page:10,total:0,total_pages:0},filters:{},fetchBacktests:async r=>{s({loading:!0,error:null});try{const{page:a=1,per_page:n=10}=r||{},i=await _t.getBacktests({page:a,per_page:n,...t().filters}),l=Array.isArray(i)?i:[];s({backtests:l,pagination:{page:a,per_page:n,total:l.length,total_pages:Math.ceil(l.length/n)},loading:!1})}catch(a){console.error("Error fetching backtests:",a),s({backtests:[],error:a instanceof Error?a.message:"Failed to fetch backtests",loading:!1})}},fetchBacktest:async r=>{s({loading:!0,error:null});try{const a=await _t.getBacktest(r);s({currentBacktest:a,loading:!1})}catch(a){s({error:a instanceof Error?a.message:"Failed to fetch backtest",loading:!1})}},refreshBacktest:async r=>{try{const a=await _t.getBacktest(r);s(n=>{var i;return{backtests:n.backtests.map(l=>l.id===r?a:l),currentBacktest:((i=n.currentBacktest)==null?void 0:i.id)===r?a:n.currentBacktest}})}catch(a){console.error("Failed to refresh backtest:",a)}},deleteBacktest:async r=>{s({loading:!0,error:null});try{await _t.deleteBacktest(r),s(a=>{var n;return{backtests:a.backtests.filter(i=>i.id!==r),currentBacktest:((n=a.currentBacktest)==null?void 0:n.id)===r?null:a.currentBacktest,loading:!1}})}catch(a){s({error:a instanceof Error?a.message:"Failed to delete backtest",loading:!1})}},createBacktest:async r=>{s({isCreatingBacktest:!0,error:null});try{const a=await _t.createBacktest(r);return s(n=>({backtests:[a,...n.backtests],currentBacktest:a,isCreatingBacktest:!1})),a.status==="running"&&t().pollBacktestStatus(a.id),a}catch(a){return s({error:a instanceof Error?a.message:"Failed to create backtest",isCreatingBacktest:!1}),null}},stopBacktest:async r=>{try{await _t.stopBacktest(r),s(a=>{var n;return{backtests:a.backtests.map(i=>i.id===r?{...i,status:"failed"}:i),currentBacktest:((n=a.currentBacktest)==null?void 0:n.id)===r?{...a.currentBacktest,status:"failed"}:a.currentBacktest}})}catch(a){s({error:a instanceof Error?a.message:"Failed to stop backtest"})}},updateBacktestForm:(r,a)=>{s(n=>({configForm:{...n.configForm,[r]:a}}))},resetBacktestForm:()=>{s({configForm:da})},updateBacktestStatus:(r,a,n)=>{s(i=>({runningBacktests:new Map(i.runningBacktests).set(r,{status:a,progress:n})}))},pollBacktestStatus:async r=>{const n=async()=>{try{const i=await _t.getBacktestStatus(r);if(t().updateBacktestStatus(r,i.status,i.progress),i.status==="completed"||i.status==="failed"){t().refreshBacktest(r);return}setTimeout(n,3e3)}catch(i){console.error("Failed to poll backtest status:",i)}};n()},toggleComparisonSelection:r=>{s(a=>({selectedForComparison:a.selectedForComparison.includes(r)?a.selectedForComparison.filter(n=>n!==r):[...a.selectedForComparison,r].slice(0,5)}))},compareBacktests:async()=>{const{selectedForComparison:r}=t();if(!(r.length<2)){s({loading:!0,error:null});try{const a=await _t.compareBacktests(r);s({comparisonResult:a,loading:!1})}catch(a){s({error:a instanceof Error?a.message:"Failed to compare backtests",loading:!1})}}},clearComparison:()=>{s({selectedForComparison:[],comparisonResult:null})},downloadReport:async(r,a="html")=>{try{const n=await _t.downloadBacktestReport(r,a),i=window.URL.createObjectURL(n),l=document.createElement("a");l.href=i,l.download=`backtest-report-${r}.${a}`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(i)}catch(n){s({error:n instanceof Error?n.message:"Failed to download report"})}},setLoading:r=>s({loading:r}),setError:r=>s({error:r}),clearError:()=>s({error:null}),reset:()=>s({backtests:[],currentBacktest:null,loading:!1,error:null,configForm:da,isCreatingBacktest:!1,runningBacktests:new Map,selectedForComparison:[],comparisonResult:null,pagination:{page:1,per_page:10,total:0,total_pages:0},filters:{}})}),{name:"backtest-store",partialize:s=>({configForm:s.configForm,selectedForComparison:s.selectedForComparison})})),Nu=()=>rr(s=>({backtests:s.backtests,loading:s.loading,error:s.error,pagination:s.pagination,fetchBacktests:s.fetchBacktests,deleteBacktest:s.deleteBacktest,downloadReport:s.downloadReport})),ku=()=>rr(s=>({configForm:s.configForm,isCreatingBacktest:s.isCreatingBacktest,createBacktest:s.createBacktest,updateBacktestForm:s.updateBacktestForm,resetBacktestForm:s.resetBacktestForm})),Su=()=>rr(s=>({selectedForComparison:s.selectedForComparison,comparisonResult:s.comparisonResult,toggleComparisonSelection:s.toggleComparisonSelection,compareBacktests:s.compareBacktests,clearComparison:s.clearComparison})),qa=()=>{const s=Je(u=>u.isLoading),t=qs(u=>u.isLoading),r=vu(u=>u.isLoading),a=Ar(u=>u.isLoading),n=Ar(u=>u.isGenerating),i=Ar(u=>u.isAnalyzing),l=Qn(u=>u.isLoading),o=Qn(u=>u.isPlacingOrder),c=rr(u=>u.loading),d=rr(u=>u.isCreatingBacktest);return{isLoading:s||t||r||a||l||c,isGenerating:n,isAnalyzing:i,isPlacingOrder:o,isCreatingBacktest:d,loadingStates:{auth:s,market:t,strategy:r,ai:a,aiGenerating:n,aiAnalyzing:i,trading:l,placingOrder:o,backtest:c,creatingBacktest:d}}},Za=()=>{const s=qs(a=>a.isConnected),t=qs(a=>a.subscribedTickers),r=qs(a=>a.connectionStats);return{isConnected:s,subscribedCount:t.size,subscribedTickers:Array.from(t),connectionStats:r,refreshStats:qs.getState().getConnectionStats}},is=()=>{const s=Je(a=>a.user),t=Je(a=>a.isAuthenticated),r=(s==null?void 0:s.membership_level)||"basic";return{user:s,isAuthenticated:t,membershipLevel:r,isPremium:r==="premium"||r==="professional",isProfessional:r==="professional"}},_u=()=>{const s=dt(),{user:t,isPremium:r}=is(),{isConnected:a}=Za();qa();const{t:n}=ns(),[i,l]=y.useState({totalStrategies:0,runningStrategies:0,totalIndicators:0,totalTrades:0,totalProfit:0,winRate:0,dailyPnl:0}),[o,c]=y.useState([]),[d,u]=y.useState(!1),m=async()=>{if(r)try{u(!0);const g=await rt.getStrategies();let w=[];g&&typeof g=="object"&&(w=Array.isArray(g)?g:g.strategies||[]),c(w);const v=w.filter(C=>{var M;return!C.name.includes("指标")&&!C.name.includes("RSI")&&!C.name.includes("MACD")&&!((M=C.description)!=null&&M.includes("指标"))}),L=w.filter(C=>{var M;return C.name.includes("指标")||C.name.includes("RSI")||C.name.includes("MACD")||((M=C.description)==null?void 0:M.includes("指标"))});l({totalStrategies:v.length,runningStrategies:3,totalTrades:0,totalProfit:1234.56,winRate:68.5,dailyPnl:123.45,totalIndicators:L.length})}catch(g){console.error("Failed to load overview data:",g),E.error("加载概览数据失败")}finally{u(!1)}};y.useEffect(()=>{m()},[r]);const k=[{title:n("strategiesManagement"),description:n("viewAndManageStrategies"),icon:"strategy",color:"blue",action:()=>s("/strategies")},{title:n("liveTrading"),description:n("startAutomatedTrading"),icon:"trading",color:"green",action:()=>s("/trading")},{title:n("strategyBacktest"),description:n("testStrategyPerformance"),icon:"backtest",color:"purple",action:()=>s("/backtest")},{title:n("aiAssistant"),description:n("getIntelligentTradingAdvice"),icon:"ai",color:"orange",action:()=>s("/ai-chat")}],x=g=>{const w={strategy:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M6 6V5a3 3 0 013-3h2a3 3 0 013 3v1h2a2 2 0 012 2v3.57A22.952 22.952 0 0110 13a22.95 22.95 0 01-8-1.43V8a2 2 0 012-2h2zm2-1a1 1 0 011-1h2a1 1 0 011 1v1H8V5zm1 5a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z",clipRule:"evenodd"})}),trading:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})}),backtest:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z",clipRule:"evenodd"})}),ai:e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})})};return w[g]||w.strategy},b=g=>{const w={blue:{bg:"from-blue-50 to-blue-100",text:"text-blue-900",icon:"bg-blue-200 text-blue-600",hover:"hover:from-blue-100 hover:to-blue-200"},green:{bg:"from-green-50 to-green-100",text:"text-green-900",icon:"bg-green-200 text-green-600",hover:"hover:from-green-100 hover:to-green-200"},purple:{bg:"from-purple-50 to-purple-100",text:"text-purple-900",icon:"bg-purple-200 text-purple-600",hover:"hover:from-purple-100 hover:to-purple-200"},orange:{bg:"from-orange-50 to-orange-100",text:"text-orange-900",icon:"bg-orange-200 text-orange-600",hover:"hover:from-orange-100 hover:to-orange-200"}};return w[g]||w.blue};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:n("tradingOverview")}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[n("welcomeBack"),"，",t==null?void 0:t.username,"！",n("checkTradingDataAndQuickActions")]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${a?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:"text-sm text-gray-600",children:n(a?"realTimeConnected":"connectionLost")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:n("totalStrategies")}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:i.totalStrategies})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center",children:x("strategy")})]})}),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:n("running")}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:i.runningStrategies})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-200 flex items-center justify-center",children:x("trading")})]})}),e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-indigo-100 rounded-xl p-4 border border-indigo-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-indigo-600",children:"指标数量"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-900",children:i.totalIndicators})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-indigo-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-indigo-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11.707 4.707a1 1 0 00-1.414-1.414L10 9.586 8.707 8.293a1 1 0 00-1.414 0l-2 2a1 1 0 001.414 1.414L8 10.414l1.293 1.293a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-purple-600",children:n("totalProfit")}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900",children:["+",i.totalProfit.toFixed(2)]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-200 flex items-center justify-center",children:e.jsxs("svg",{className:"w-5 h-5 text-purple-600",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"}),e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z",clipRule:"evenodd"})]})})]})}),e.jsx("div",{className:"bg-gradient-to-r from-orange-50 to-orange-100 rounded-xl p-4 border border-orange-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-600",children:n("winRate")}),e.jsxs("p",{className:"text-2xl font-bold text-orange-900",children:[i.winRate,"%"]})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-orange-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-orange-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})})]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:n("quickActions")}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:k.map(g=>{const w=b(g.color);return e.jsx("div",{onClick:g.action,className:`bg-gradient-to-r ${w.bg} rounded-xl p-6 border cursor-pointer transition-all ${w.hover} hover:shadow-md`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${w.icon}`,children:x(g.icon)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold ${w.text} mb-1`,children:g.title}),e.jsx("p",{className:"text-sm text-gray-600",children:g.description})]})]})},g.title)})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:n("recentStrategies")}),e.jsxs("button",{onClick:()=>s("/strategies"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:[n("viewAll")," →"]})]}),d?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center animate-spin",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("p",{className:"text-gray-500",children:n("loadingStrategies")})]}):o.length>0?e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:o.slice(0,4).map(g=>{var w,v;return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-shadow p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:g.name}),e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${g.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:g.is_active?n("running"):n("stopped")})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:g.description}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsxs("span",{children:[n("tradingPair"),": ",((w=g.parameters)==null?void 0:w.symbol)||"N/A"]}),e.jsx("span",{className:"mx-2",children:"•"}),e.jsxs("span",{children:[n("timeframe"),": ",((v=g.parameters)==null?void 0:v.timeframe)||"N/A"]})]})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>s("/strategies"),className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:n("viewDetails")})})]},g.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:n("noStrategies")}),e.jsx("p",{className:"text-gray-500 mb-4",children:n("createFirstStrategy")}),r?e.jsx("button",{onClick:()=>s("/strategies"),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors",children:n("createStrategy")}):e.jsx("button",{onClick:()=>E.error(n("createStrategyRequiresPremium")),className:"inline-flex items-center px-4 py-2 bg-gray-300 text-gray-500 font-medium rounded-lg cursor-not-allowed",children:n("upgradeToCreate")})]})]})]})},Gs={async getLiveStrategies(s){try{const t=await G.get("/strategies",{params:s}),r=q(t);return{strategies:r.strategies.map(n=>{var i,l;return{id:n.id.toString(),name:n.name,description:n.description,trading_pair:((i=n.parameters)==null?void 0:i.symbol)||"BTC/USDT",exchange:((l=n.parameters)==null?void 0:l.exchange)||"binance",status:n.is_active?"running":"stopped",profit_rate:Math.random()*20-5,signal_count:Math.floor(Math.random()*50),created_at:n.created_at,win_rate:Math.random()*100,total_trades:Math.floor(Math.random()*100),parameters:n.parameters}}),total:r.total,page:(s==null?void 0:s.page)||1,per_page:(s==null?void 0:s.per_page)||20}}catch(t){H(t)}},async getLiveStrategyStats(){try{const s=await G.get("/trading/stats");return q(s)}catch(s){H(s)}},async getLiveStrategyDetails(s){try{const t=await G.get(`/strategies/${s}/live-details`);return q(t)}catch(t){H(t)}},async executeStrategyAction(s,t){try{const r=await G.post(`/strategies/${s}/action`,t);return q(r)}catch(r){H(r)}},async createLiveStrategy(s){try{const t=await G.post("/strategies",{...s,type:"live"});return q(t)}catch(t){H(t)}},async updateStrategyParameters(s,t){try{const r=await G.put(`/strategies/${s}/parameters`,{parameters:t});return q(r)}catch(r){H(r)}},async getStrategyTrades(s,t){try{const r=await G.get(`/strategies/${s}/trades`,{params:t});return q(r)}catch(r){H(r)}},async getStrategyPerformance(s,t){try{const r=await G.get(`/strategies/${s}/performance`,{params:{period:t}});return q(r)}catch(r){H(r)}},async getUserLiveStrategies(s){try{const t=await G.get("/trading/live-strategies",{params:s});return q(t).map(a=>{var n,i;return{id:a.id.toString(),name:a.name,description:a.description||"",trading_pair:((n=a.parameters)==null?void 0:n.symbol)||"BTC/USDT",exchange:((i=a.parameters)==null?void 0:i.exchange)||"binance",status:a.status,profit_rate:a.profit_loss||0,signal_count:a.total_trades||0,created_at:a.created_at,total_trades:a.total_trades||0,win_rate:Math.random()*100,parameters:a.parameters}})}catch(t){H(t)}},async deleteLiveStrategy(s){try{const t=await G.delete(`/trading/live-strategies/${s}`);return q(t)}catch(t){H(t)}}},Cu=()=>{const s=dt(),{isPremium:t}=is();Za(),qa();const{t:r}=ns(),[a,n]=y.useState(null),[i,l]=y.useState(""),[o,c]=y.useState("all"),[d,u]=y.useState([]),[m,k]=y.useState(!1),x=async()=>{if(t)try{k(!0);const S=(await Gs.getUserLiveStrategies()).map(_=>{const U=_.profit_rate/1e3||0;return{id:parseInt(_.id),name:_.name,description:_.description,code:"",parameters:{symbol:_.trading_pair,exchange:_.exchange,..._.parameters},is_active:_.status!=="stopped",user_id:9,created_at:_.created_at,status:_.status,profit:U>=0?`+${U.toFixed(2)}`:U.toFixed(2),profitPercent:U,lastUpdate:_.created_at,runningTime:_.status==="running"?"运行中":_.status==="paused"?"已暂停":"已停止",totalTrades:_.total_trades||0,winRate:_.win_rate||0}});u(S),E.success(`加载了 ${S.length} 个实盘策略`)}catch(p){console.error("Failed to load live strategies:",p),E.error("加载实盘策略失败")}finally{k(!1)}};y.useEffect(()=>{x()},[t]);const b={total:d.length,running:d.filter(p=>p.status==="running").length,stopped:d.filter(p=>p.status==="stopped").length,paused:d.filter(p=>p.status==="paused").length},g=d.filter(p=>{var re;const S=((re=p.parameters)==null?void 0:re.symbol)||"",_=p.name.toLowerCase().includes(i.toLowerCase())||p.description.toLowerCase().includes(i.toLowerCase())||S.toLowerCase().includes(i.toLowerCase()),U=o==="all"||p.status===o;return _&&U}),w=p=>{if(!t){E.error(r("startStrategyRequiresPremium"));return}u(S=>S.map(_=>_.id===p.id?{..._,status:"running",lastUpdate:new Date().toLocaleString("zh-CN")}:_)),E.success(`${p.name} ${r("strategyStarted")}`)},v=p=>{u(S=>S.map(_=>_.id===p.id?{..._,status:"stopped",lastUpdate:new Date().toLocaleString("zh-CN")}:_)),E.success(`${p.name} ${r("strategyStopped")}`)},L=p=>{u(S=>S.map(_=>_.id===p.id?{..._,status:"paused",lastUpdate:new Date().toLocaleString("zh-CN")}:_)),E.success(`${p.name} ${r("strategyPaused")}`)},C=async p=>{if(p.status!=="stopped"){E.error("只能删除已停止的实盘策略");return}if(window.confirm(`确认删除实盘策略 "${p.name}"?
此操作不可撤销。`))try{await Gs.deleteLiveStrategy(p.id.toString()),u(S=>S.filter(_=>_.id!==p.id)),E.success(`实盘策略 "${p.name}" 删除成功`)}catch(S){console.error("Delete strategy failed:",S),E.error("删除实盘策略失败")}},M=p=>{switch(p){case"running":return r("runningLive");case"stopped":return r("stoppedLive");case"paused":return r("pausedLive");default:return"Unknown"}},j=p=>{s(`/strategy/${p.id}/live`)};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:r("liveTrading")}),e.jsx("p",{className:"text-gray-600",children:r("monitorRunningStrategies")})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:`bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200 cursor-pointer transition-all hover:shadow-md ${o==="all"?"ring-2 ring-blue-500 shadow-md":""}`,onClick:()=>c("all"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:r("totalLiveStrategies")}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:b.total})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z",clipRule:"evenodd"})})})]}),o==="all"&&e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:r("selected")})})]}),e.jsxs("div",{className:`bg-gradient-to-r from-green-50 to-green-100 rounded-xl p-4 border border-green-200 cursor-pointer transition-all hover:shadow-md ${o==="running"?"ring-2 ring-green-500 shadow-md":""}`,onClick:()=>c("running"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-green-600",children:r("runningLive")}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:b.running})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z",clipRule:"evenodd"})})})]}),o==="running"&&e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-xs text-green-600 font-medium",children:r("selected")})})]}),e.jsxs("div",{className:`bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-xl p-4 border border-yellow-200 cursor-pointer transition-all hover:shadow-md ${o==="paused"?"ring-2 ring-yellow-500 shadow-md":""}`,onClick:()=>c("paused"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-600",children:r("pausedLive")}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:b.paused})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-yellow-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]}),o==="paused"&&e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-xs text-yellow-600 font-medium",children:r("selected")})})]}),e.jsxs("div",{className:`bg-gradient-to-r from-red-50 to-red-100 rounded-xl p-4 border border-red-200 cursor-pointer transition-all hover:shadow-md ${o==="stopped"?"ring-2 ring-red-500 shadow-md":""}`,onClick:()=>c("stopped"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-600",children:r("stoppedLive")}),e.jsx("p",{className:"text-2xl font-bold text-red-900",children:b.stopped})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-red-200 flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z",clipRule:"evenodd"})})})]}),o==="stopped"&&e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-xs text-red-600 font-medium",children:r("selected")})})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",placeholder:r("searchStrategies"),value:i,onChange:p=>l(p.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent"}),e.jsx("svg",{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),e.jsxs("select",{value:o,onChange:p=>c(p.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:r("allStatus")}),e.jsx("option",{value:"running",children:r("runningLive")}),e.jsx("option",{value:"paused",children:r("pausedLive")}),e.jsx("option",{value:"stopped",children:r("stoppedLive")})]})]}),o!=="all"&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"inline-flex items-center px-3 py-2 rounded-lg bg-gray-100 text-gray-700",children:[e.jsxs("span",{className:"text-sm",children:[r("currentFilter"),": "]}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs font-medium ${o==="running"?"bg-green-100 text-green-800":o==="paused"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:r(o==="running"?"runningLive":o==="paused"?"pausedLive":"stoppedLive")}),e.jsx("button",{onClick:()=>c("all"),className:"ml-2 text-gray-500 hover:text-gray-700",title:r("clearFilter"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{children:m?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center animate-spin",children:e.jsx("svg",{className:"w-10 h-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:r("loadingStrategies")}),e.jsx("p",{className:"text-gray-500",children:r("monitorRunningStrategies")})]}):g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:r("noStrategiesMessage")}),e.jsx("p",{className:"text-gray-500 mb-6",children:r("createFirstStrategyMessage")})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:g.map(p=>{var S;return e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm hover:shadow-md transition-shadow cursor-pointer",onClick:()=>j(p),children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:p.name}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p.status==="running"?"bg-green-100 text-green-800":p.status==="paused"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:M(p.status)})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:p.description})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:r("tradingPair")}),e.jsx("p",{className:"font-medium",children:((S=p.parameters)==null?void 0:S.symbol)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:r("profitLoss")}),e.jsxs("p",{className:`font-medium ${p.profitPercent>=0?"text-green-600":"text-red-600"}`,children:[p.profit," (",p.profitPercent>=0?"+":"",p.profitPercent,"%)"]})]}),p.runningTime&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:r("runningTime")}),e.jsx("p",{className:"font-medium",children:p.runningTime})]}),p.totalTrades!==void 0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:r("totalTrades")}),e.jsxs("p",{className:"font-medium",children:[p.totalTrades,"次"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"flex items-center space-x-2",children:p.status==="stopped"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:_=>{_.stopPropagation(),w(p)},disabled:!t,className:`px-3 py-1.5 rounded text-sm font-medium transition-colors ${t?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:r("start")}),e.jsx("button",{onClick:_=>{_.stopPropagation(),C(p)},className:"px-3 py-1.5 bg-red-100 text-red-700 rounded text-sm font-medium hover:bg-red-200 transition-colors",title:"删除实盘策略",children:"删除"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:_=>{_.stopPropagation(),v(p)},className:"px-3 py-1.5 bg-red-100 text-red-700 rounded text-sm font-medium hover:bg-red-200 transition-colors",children:r("stop")}),p.status==="running"&&e.jsx("button",{onClick:_=>{_.stopPropagation(),L(p)},className:"px-3 py-1.5 bg-yellow-100 text-yellow-700 rounded text-sm font-medium hover:bg-yellow-200 transition-colors",children:r("pause")}),p.status==="paused"&&e.jsx("button",{onClick:_=>{_.stopPropagation(),w(p)},disabled:!t,className:`px-3 py-1.5 rounded text-sm font-medium transition-colors ${t?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,children:r("start")})]})}),e.jsx("div",{className:"text-xs text-gray-500",children:r("viewDetails")})]})]})},p.id)})})})]})]})},Au=()=>{const{strategyId:s}=di(),t=dt(),{isPremium:r}=is(),[a,n]=y.useState(null),[i,l]=y.useState([]),[o,c]=y.useState(!0),[d,u]=y.useState(!1),[m,k]=y.useState(0),[x,b]=y.useState(!0),g=20,w=async()=>{if(s)try{c(!0);const X=await rt.getStrategyLiveDetails(parseInt(s));n(X)}catch(X){console.error("Failed to load live details:",X),E.error("加载实盘详情失败")}finally{c(!1)}},v=async(X=0,te=!1)=>{if(s)try{u(!0);const R=await rt.getStrategyTrades(s,{page:X+1,per_page:g});l(te?Y=>[...Y,...R.items]:R.items);const ie=R.items?R.items.length===g:!1;b(ie)}catch(R){console.error("Failed to load trades:",R),E.error("加载交易记录失败")}finally{u(!1)}};y.useEffect(()=>{if(!r){E.error("查看实盘详情需要高级版本"),t("/strategies");return}w(),v()},[s,r,t]);const L=()=>{const X=m+1;k(X),v(X,!0)},C=(X,te=2)=>X.toFixed(te),M=X=>new Date(X).toLocaleString("zh-CN"),j=X=>X==="BUY"?"bg-green-100 text-green-800":"bg-red-100 text-red-800",p=X=>X>=0?"text-green-600":"text-red-600";if(o)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center animate-spin",children:e.jsx("svg",{className:"w-10 h-10 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"加载实盘详情中..."}),e.jsx("p",{className:"text-gray-500",children:"正在获取策略运行数据"})]})});if(!a)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"实盘详情不存在"}),e.jsx("button",{onClick:()=>t("/strategies"),className:"text-blue-600 hover:text-blue-800",children:"返回策略列表"})]})});const{strategy:S,live_stats:_,performance:U,status:re}=a;return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("button",{onClick:()=>t("/strategies"),className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:S.name}),e.jsx("p",{className:"text-gray-600",children:"实盘运行详情"})]}),e.jsx("div",{className:"flex-1"}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${re==="running"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:re==="running"?"运行中":"已停止"})]}),e.jsx("p",{className:"text-gray-600",children:S.description})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总收益"}),e.jsx("p",{className:`text-2xl font-bold ${p(_.profit_loss)}`,children:C(_.profit_loss,4)}),e.jsxs("p",{className:`text-sm ${p(_.profit_percentage)}`,children:[_.profit_percentage>=0?"+":"",C(_.profit_percentage),"%"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"})})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"交易次数"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:_.total_trades}),e.jsx("p",{className:"text-sm text-gray-500",children:"总成交量"})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z",clipRule:"evenodd"})})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"买入量"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C(_.buy_volume,4)}),e.jsx("p",{className:"text-sm text-gray-500",children:"总买入金额"})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsxs("svg",{className:"w-6 h-6 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20",children:[e.jsx("path",{d:"M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"}),e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z",clipRule:"evenodd"})]})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"手续费"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:C(_.total_fees,4)}),e.jsx("p",{className:"text-sm text-gray-500",children:"总费用"})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})})})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"性能指标"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"总回报率"}),e.jsxs("p",{className:`text-xl font-bold ${p(U.total_return)}`,children:[U.total_return>=0?"+":"",C(U.total_return),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"胜率"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:[C(U.win_rate),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"最大回撤"}),e.jsxs("p",{className:"text-xl font-bold text-red-600",children:[C(U.max_drawdown),"%"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"夏普比率"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:C(U.sharpe_ratio,3)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"交易记录"}),e.jsx("p",{className:"text-sm text-gray-600",children:"最近的实盘交易明细"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"时间"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"交易对"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"方向"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"数量"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"价格"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"总额"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"手续费"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"订单ID"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:"暂无交易记录"})}):i.map(X=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:M(X.timestamp)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:X.symbol}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${j(X.side)}`,children:X.side})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:C(X.quantity,6)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:C(X.price,4)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:C(X.total_amount,4)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600",children:C(X.fee,6)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:X.order_id||"N/A"})]},X.id))})]})}),x&&i.length>0&&e.jsx("div",{className:"p-6 border-t border-gray-200 text-center",children:e.jsx("button",{onClick:L,disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed",children:d?"加载中...":"加载更多"})})]}),_.first_trade&&e.jsxs("div",{className:"mt-8 bg-gray-50 rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"运行信息"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"首次交易"}),e.jsx("p",{className:"font-medium",children:M(_.first_trade)})]}),_.last_trade&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"最新交易"}),e.jsx("p",{className:"font-medium",children:M(_.last_trade)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"平均成交价"}),e.jsx("p",{className:"font-medium",children:C(_.avg_price,4)})]})]})]})]})},Lu=()=>{var w,v,L,C,M,j,p,S;const s=dt(),{user:t}=is();Za(),qa();const[r,a]=y.useState(""),[n,i]=y.useState(null),[l,o]=y.useState(!1),[c,d]=y.useState([]),[u,m]=y.useState(null),[k,x]=y.useState(!0);y.useEffect(()=>{(async()=>{try{x(!0);const[U,re]=await Promise.all([Gs.getLiveStrategies({per_page:100}),Gs.getLiveStrategyStats()]);d(U.strategies),m(re)}catch(U){console.error("加载实盘策略数据失败:",U),E.error("加载实盘策略数据失败，使用模拟数据"),d([{id:"1",name:"EMA交叉策略",trading_pair:"BTC/USDT",exchange:"binance",status:"running",profit_rate:8.2,signal_count:16,created_at:"2024-05-10",win_rate:68.4,total_trades:16},{id:"2",name:"RSI超买超卖策略",trading_pair:"ETH/USDT",exchange:"okx",status:"paused",profit_rate:5.7,signal_count:12,created_at:"2024-05-12"}]),m({active_strategies:1,total_return:15.8,max_drawdown:-6.3,last_trade_time:"2小时前",total_trades:28,win_rate:65.2})}finally{x(!1)}})()},[]);const b=async(_,U)=>{try{const re={action:U==="start"?"start":U},X=await Gs.executeStrategyAction(_,re);X.success?(E.success(`策略${U==="pause"?"已暂停":U==="stop"?"已停止":"已启动"}`),d(te=>te.map(R=>R.id===_?{...R,status:X.new_status||U}:R))):E.error(X.message||"操作失败")}catch(re){console.error("策略操作失败:",re),E.error("策略操作失败，请稍后重试")}},g=_=>{const U={running:"bg-green-50 text-green-700 border-green-200",paused:"bg-yellow-50 text-yellow-700 border-yellow-200",stopped:"bg-gray-50 text-gray-700 border-gray-200"},re={running:"运行中",paused:"已暂停",stopped:"已停止"};return e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium border ${U[_]}`,children:re[_]})};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-7xl min-h-screen bg-white rounded-xl shadow-xl border border-gray-200 mx-auto",children:[e.jsxs("header",{className:"py-4 px-8 flex justify-between border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-7 h-7 mr-3 flex items-center justify-center",children:e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-full h-full",style:{color:"#1a3d7c"},children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",fill:"none",stroke:"currentColor",strokeWidth:"2"}),e.jsx("path",{d:"M8 12h8M12 8v8",stroke:"currentColor",strokeWidth:"2"})]})}),e.jsx("h1",{className:"text-xl font-bold",style:{color:"#1a3d7c"},children:"Trademe"})]}),e.jsxs("nav",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>s("/"),className:"px-4 py-2 text-blue-600 font-medium hover:bg-blue-50 rounded-lg",children:"首页"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg",children:"策略交易"}),e.jsx("button",{onClick:()=>s("/trading"),className:"px-4 py-2 text-blue-600 font-medium hover:bg-blue-50 rounded-lg",children:"图表交易"}),e.jsx("button",{onClick:()=>s("/api-keys"),className:"px-4 py-2 text-blue-600 font-medium hover:bg-blue-50 rounded-lg",children:"API管理"}),e.jsx("button",{className:"px-4 py-2 text-blue-600 font-medium hover:bg-blue-50 rounded-lg",children:"交易心得"}),e.jsx("button",{onClick:()=>s("/profile"),className:"px-4 py-2 text-blue-600 font-medium hover:bg-blue-50 rounded-lg",children:"账户中心"})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"w-9 h-9 rounded-full bg-gray-200 overflow-hidden",children:t!=null&&t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:"User avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-100 text-blue-600 font-medium",children:((w=t==null?void 0:t.username)==null?void 0:w.charAt(0).toUpperCase())||"U"})})})]}),e.jsxs("div",{className:"p-8",children:[k&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"加载实盘策略数据中..."})]}),!k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs("button",{onClick:()=>s("/strategies"),className:"text-blue-600 hover:underline flex items-center mr-2",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"返回策略列表"]}),e.jsx("span",{className:"text-gray-500",children:"/ 实盘管理"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{color:"#1a3d7c"},children:"实盘策略管理"}),e.jsx("p",{className:"text-gray-500",children:"管理您当前运行中的实盘策略"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex items-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mr-4",style:{backgroundColor:"#e9f1fe"},children:e.jsx("svg",{className:"w-6 h-6",style:{color:"#1a3d7c"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-1",children:"活跃策略"}),e.jsx("p",{className:"text-2xl font-bold",children:(u==null?void 0:u.active_strategies)||0})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex items-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mr-4",style:{backgroundColor:"#e9faf3"},children:e.jsx("svg",{className:"w-6 h-6",style:{color:"#21ce90"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-1",children:"总收益率"}),e.jsx("p",{className:"text-2xl font-bold",children:e.jsxs("span",{className:"bg-green-50 text-green-600 px-2 py-1 rounded",children:["+",(u==null?void 0:u.total_return)||0,"%"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex items-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mr-4",style:{backgroundColor:"#f8f3d6"},children:e.jsx("svg",{className:"w-6 h-6",style:{color:"#f0b90b"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-1",children:"最大回撤"}),e.jsx("p",{className:"text-2xl font-bold",children:e.jsxs("span",{className:"bg-red-50 text-red-600 px-2 py-1 rounded",children:[(u==null?void 0:u.max_drawdown)||0,"%"]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 flex items-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center mr-4",style:{backgroundColor:"#fef1f1"},children:e.jsx("svg",{className:"w-6 h-6",style:{color:"#f53d3d"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm text-gray-500 mb-1",children:"上次交易"}),e.jsx("p",{className:"text-lg font-bold",children:(u==null?void 0:u.last_trade_time)||"暂无"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"#1a3d7c"},children:"实盘策略列表"}),e.jsxs("div",{className:"flex",children:[e.jsxs("button",{className:"bg-blue-600 text-white rounded-lg px-4 py-2 font-medium hover:bg-blue-700 transition-colors flex items-center mr-2",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"添加策略"]}),e.jsx("input",{type:"text",className:"border border-gray-200 bg-gray-50 rounded-lg px-4 py-2 w-64 text-sm focus:border-blue-600 focus:outline-none focus:bg-white",placeholder:"搜索策略...",value:r,onChange:_=>a(_.target.value)})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"bg-gray-50 border-b border-gray-200 px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"策略名称"}),e.jsx("th",{className:"bg-gray-50 border-b border-gray-200 px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"交易对"}),e.jsx("th",{className:"bg-gray-50 border-b border-gray-200 px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"交易所"}),e.jsx("th",{className:"bg-gray-50 border-b border-gray-200 px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"状态"}),e.jsx("th",{className:"bg-gray-50 border-b border-gray-200 px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"收益率"}),e.jsx("th",{className:"bg-gray-50 border-b border-gray-200 px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"信号数量"}),e.jsx("th",{className:"bg-gray-50 border-b border-gray-200 px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"创建时间"}),e.jsx("th",{className:"bg-gray-50 border-b border-gray-200 px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{children:c.filter(_=>_.name.toLowerCase().includes(r.toLowerCase())).map(_=>e.jsxs("tr",{className:"cursor-pointer hover:bg-blue-50 border-b border-gray-100",onClick:()=>i(n===_.id?null:_.id),children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:_.name}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:_.trading_pair}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:_.exchange}),e.jsx("td",{className:"px-4 py-3 text-sm",children:g(_.status)}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:`px-2 py-1 rounded ${_.profit_rate>0?"bg-green-50 text-green-600":"bg-red-50 text-red-600"}`,children:[_.profit_rate>0?"+":"",_.profit_rate,"%"]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:_.signal_count}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:_.created_at}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex space-x-2",children:[_.status==="running"?e.jsx("button",{onClick:U=>{U.stopPropagation(),b(_.id,"pause")},className:"text-blue-600 hover:text-blue-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 9v6m4-6v6"})})}):e.jsx("button",{onClick:U=>{U.stopPropagation(),b(_.id,"start")},className:"text-green-600 hover:text-green-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h1.586a1 1 0 01.707.293l2.414 2.414a1 1 0 00.707.293H15"})})}),e.jsx("button",{onClick:U=>{U.stopPropagation(),b(_.id,"stop")},className:"text-red-600 hover:text-red-800",children:e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 10h6v4H9z"})]})}),e.jsx("button",{className:"text-gray-600 hover:text-gray-800",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})})]},_.id))})]})})]}),n&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold mb-2",style:{color:"#1a3d7c"},children:[(v=c.find(_=>_.id===n))==null?void 0:v.name," 详情"]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm text-gray-600",children:(L=c.find(_=>_.id===n))==null?void 0:L.trading_pair}),e.jsx("span",{className:"text-sm text-gray-600",children:(C=c.find(_=>_.id===n))==null?void 0:C.exchange}),g(((M=c.find(_=>_.id===n))==null?void 0:M.status)||"stopped")]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"border border-blue-600 text-blue-600 rounded-lg px-4 py-2 text-sm font-medium hover:bg-blue-50",children:"暂停"}),e.jsx("button",{className:"border border-red-600 text-red-600 rounded-lg px-4 py-2 text-sm font-medium hover:bg-red-50",children:"终止"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-2 text-sm",children:"总收益率"}),e.jsx("p",{className:"text-2xl font-bold",children:e.jsxs("span",{className:"bg-green-50 text-green-600 px-2 py-1 rounded",children:["+",(j=c.find(_=>_.id===n))==null?void 0:j.profit_rate,"%"]})})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-2 text-sm",children:"胜率"}),e.jsxs("p",{className:"text-2xl font-bold",children:[((p=c.find(_=>_.id===n))==null?void 0:p.win_rate)||0,"%"]})]}),e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg",children:[e.jsx("p",{className:"text-gray-500 mb-2 text-sm",children:"交易次数"}),e.jsx("p",{className:"text-2xl font-bold",children:((S=c.find(_=>_.id===n))==null?void 0:S.total_trades)||0})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-bold mb-4",children:"策略收益曲线"}),e.jsx("div",{className:"h-64 bg-gray-50 rounded-lg border border-gray-200 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"📈 收益曲线图表（需要ECharts集成）"})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-6",style:{color:"#1a3d7c"},children:"策略参数设置"}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"策略类型"}),e.jsxs("select",{className:"w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 text-sm focus:border-blue-600 focus:outline-none focus:bg-white",children:[e.jsx("option",{children:"EMA交叉策略"}),e.jsx("option",{children:"RSI超买超卖策略"}),e.jsx("option",{children:"布林带突破策略"}),e.jsx("option",{children:"MACD背离策略"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"交易对"}),e.jsxs("select",{className:"w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 text-sm focus:border-blue-600 focus:outline-none focus:bg-white",children:[e.jsx("option",{children:"BTC/USDT"}),e.jsx("option",{children:"ETH/USDT"}),e.jsx("option",{children:"SOL/USDT"}),e.jsx("option",{children:"DOGE/USDT"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"交易所"}),e.jsxs("select",{className:"w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 text-sm focus:border-blue-600 focus:outline-none focus:bg-white",children:[e.jsx("option",{children:"币安"}),e.jsx("option",{children:"OKX"}),e.jsx("option",{children:"火币"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"EMA短周期"}),e.jsx("input",{type:"number",className:"w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 text-sm focus:border-blue-600 focus:outline-none focus:bg-white",defaultValue:"10"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"EMA长周期"}),e.jsx("input",{type:"number",className:"w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 text-sm focus:border-blue-600 focus:outline-none focus:bg-white",defaultValue:"50"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"止损比例"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",className:"w-full border border-gray-200 bg-gray-50 rounded-lg px-4 py-3 pr-8 text-sm focus:border-blue-600 focus:outline-none focus:bg-white",defaultValue:"1.5"}),e.jsx("span",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 text-sm",children:"%"})]})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-6 mt-6 flex justify-end",children:[e.jsx("button",{className:"border border-gray-300 rounded-lg px-4 py-2 text-gray-700 font-medium mr-3 hover:bg-gray-50",children:"取消"}),e.jsx("button",{className:"bg-blue-600 text-white rounded-lg px-4 py-2 font-medium hover:bg-blue-700 transition-colors",children:"更新策略参数"})]})]})]})]})]})})},et=({children:s,requireMembership:t})=>{const r=zr(),{isAuthenticated:a,isLoading:n,user:i,checkAuth:l}=Je();if(y.useEffect(()=>{!a&&!n&&l()},[a,n,l]),n)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx(Rt,{size:"lg"})});if(!a)return e.jsx(_l,{to:"/login",state:{from:r},replace:!0});if(t&&i){const o={basic:1,premium:2,professional:3},c=o[i.membership_level]||0,d=o[t]||0;if(c<d)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"w-16 h-16 mx-auto bg-yellow-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"})})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"需要升级会员"}),e.jsxs("p",{className:"text-gray-500 mb-4",children:["此功能需要 ",t==="premium"?"高级版":"专业版"," 会员权限"]}),e.jsx("button",{onClick:()=>window.location.href="/profile/membership",className:"btn btn-primary btn-md",children:"升级会员"})]})})}return e.jsx(e.Fragment,{children:s})},Tu=y.forwardRef(({label:s,error:t,helperText:r,icon:a,iconPosition:n="left",className:i="",...l},o)=>{const c=!!a,u=`
    input
    ${c&&n==="left"?"pl-10":""}
    ${c&&n==="right"?"pr-10":""}
    ${!!t?"border-red-300 focus-visible:ring-red-500":""}
    ${i}
  `;return e.jsxs("div",{className:"w-full",children:[s&&e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:s}),e.jsxs("div",{className:"relative",children:[c&&n==="left"&&e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-400 sm:text-sm",children:a})}),e.jsx("input",{ref:o,className:u,...l}),c&&n==="right"&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-400 sm:text-sm",children:a})})]}),t&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t}),r&&!t&&e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r})]})});Tu.displayName="Input";const Ta=(s,t="",r=2)=>{const a=new Intl.NumberFormat("zh-CN",{minimumFractionDigits:r,maximumFractionDigits:r}).format(s);return t?`${t}${a}`:a},yl=(s,t=1,r=!1)=>`${(r?s:s*100).toFixed(t)}%`,Ea=(s,t="datetime")=>{const r=new Date(s);if(isNaN(r.getTime()))return"无效日期";const a=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),i=String(r.getDate()).padStart(2,"0"),l=String(r.getHours()).padStart(2,"0"),o=String(r.getMinutes()).padStart(2,"0"),c=String(r.getSeconds()).padStart(2,"0");switch(t){case"date":return`${a}-${n}-${i}`;case"time":return`${l}:${o}:${c}`;case"short":return`${n}-${i} ${l}:${o}`;case"datetime":default:return`${a}-${n}-${i} ${l}:${o}:${c}`}},Eu=()=>{const{user:s}=Je(),{t}=ns(),[r,a]=y.useState("create"),{backtests:n,loading:i,error:l,fetchBacktests:o,deleteBacktest:c,downloadReport:d}=Nu(),{configForm:u,isCreatingBacktest:m,createBacktest:k,updateBacktestForm:x,resetBacktestForm:b}=ku(),{selectedForComparison:g,toggleComparisonSelection:w,compareBacktests:v,clearComparison:L}=Su(),[C,M]=y.useState([]),[j,p]=y.useState(!1),S=Array.isArray(n)?n:[],_=async()=>{try{p(!0);const R=await rt.getStrategies({active_only:!0});R&&R.strategies&&M(R.strategies)}catch(R){console.error(t("getStrategiesError"),R)}finally{p(!1)}};y.useEffect(()=>{o(),_()},[]);const U=async()=>{if(!u.strategy_id){alert(t("strategyRequired"));return}await k(u)&&a("history")},re=async R=>{confirm(t("confirmDeleteBacktest"))&&await c(R)},X=R=>{switch(R){case"completed":return"bg-green-100 text-green-800";case"running":return"bg-yellow-100 text-yellow-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},te=R=>{switch(R){case"completed":return t("completed");case"running":return t("running");case"failed":return t("failed");default:return t("unknown")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t("strategyBacktest")}),e.jsx("p",{className:"text-gray-600 mt-1",children:t("verifyTradingStrategy")})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:t("totalBacktests")}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:S.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-50 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:t("completedSuccessfully")}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:S.filter(R=>R.status==="completed").length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-green-50 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:t("running")}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:S.filter(R=>R.status==="running").length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-yellow-50 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-all duration-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:t("executionFailed")}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:S.filter(R=>R.status==="failed").length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-50 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})})]}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-sm",children:[e.jsxs("div",{className:"flex border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>a("create"),className:`flex-1 px-6 py-4 font-medium transition-all duration-200 relative ${r==="create"?"text-blue-600 bg-blue-50":"text-gray-700 hover:text-gray-900 hover:bg-gray-50"}`,children:[t("createBacktest"),r==="create"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 rounded-t-full"})]}),e.jsxs("button",{onClick:()=>a("history"),className:`flex-1 px-6 py-4 font-medium transition-all duration-200 relative ${r==="history"?"text-blue-600 bg-blue-50":"text-gray-700 hover:text-gray-900 hover:bg-gray-50"}`,children:[t("backtestHistory"),r==="history"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 rounded-t-full"})]})]}),e.jsxs("div",{className:"p-6",children:[r==="create"?e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:t("backtestConfig")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[t("selectStrategy")," *"]}),e.jsxs("select",{value:u.strategy_id,onChange:R=>x("strategy_id",R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",required:!0,disabled:j,children:[e.jsx("option",{value:"",children:j?"加载策略中...":"请选择策略"}),C.map(R=>{var ie;return e.jsxs("option",{value:R.id,children:[R.name," - ",((ie=R.parameters)==null?void 0:ie.symbol)||"N/A"]},R.id)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"开始日期 *"}),e.jsx("input",{type:"date",value:u.start_date,onChange:R=>x("start_date",R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"结束日期 *"}),e.jsx("input",{type:"date",value:u.end_date,onChange:R=>x("end_date",R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"交易对 *"}),e.jsxs("select",{value:u.symbol,onChange:R=>x("symbol",R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"请选择交易对"}),e.jsx("option",{value:"BTC/USDT",children:"BTC/USDT"}),e.jsx("option",{value:"ETH/USDT",children:"ETH/USDT"}),e.jsx("option",{value:"BNB/USDT",children:"BNB/USDT"}),e.jsx("option",{value:"ADA/USDT",children:"ADA/USDT"}),e.jsx("option",{value:"SOL/USDT",children:"SOL/USDT"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"交易所 *"}),e.jsxs("select",{value:u.exchange,onChange:R=>x("exchange",R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"请选择交易所"}),e.jsx("option",{value:"binance",children:"Binance"}),e.jsx("option",{value:"okx",children:"OKX"}),e.jsx("option",{value:"huobi",children:"Huobi"}),e.jsx("option",{value:"kraken",children:"Kraken"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"时间周期 *"}),e.jsxs("select",{value:u.timeframe,onChange:R=>x("timeframe",R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"请选择时间周期"}),e.jsx("option",{value:"1m",children:"1分钟"}),e.jsx("option",{value:"5m",children:"5分钟"}),e.jsx("option",{value:"15m",children:"15分钟"}),e.jsx("option",{value:"1h",children:"1小时"}),e.jsx("option",{value:"4h",children:"4小时"}),e.jsx("option",{value:"1d",children:"1天"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"手续费率 *"}),e.jsx("input",{type:"number",value:u.commission_rate,onChange:R=>x("commission_rate",parseFloat(R.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",placeholder:"0.001",min:"0",max:"0.01",step:"0.0001",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"初始资金 *"}),e.jsx("input",{type:"number",value:u.initial_capital,onChange:R=>x("initial_capital",parseFloat(R.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",placeholder:"10000",min:"1000",step:"1000",required:!0})]}),e.jsx("button",{onClick:U,disabled:m,className:`w-full py-3 px-4 rounded-xl font-medium transition-all duration-200 ${m?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 hover:shadow-lg transform hover:scale-[1.02]"}`,children:m?"创建中...":"开始回测"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"回测说明"}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-600 text-sm font-bold",children:"1"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"选择策略"}),e.jsx("p",{className:"text-sm text-gray-600",children:"选择您要回测的交易策略"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-600 text-sm font-bold",children:"2"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"设定回测周期"}),e.jsx("p",{className:"text-sm text-gray-600",children:"选择回测的开始和结束日期"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-600 text-sm font-bold",children:"3"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"设定初始资金"}),e.jsx("p",{className:"text-sm text-gray-600",children:"设定回测使用的初始资金金额"})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-blue-600 text-sm font-bold",children:"4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"开始回测"}),e.jsx("p",{className:"text-sm text-gray-600",children:"点击开始回测，查看策略历史表现"})]})]})]})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"回测历史"}),g.length>=2&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:v,className:"px-4 py-2 bg-blue-600 text-white text-sm rounded-xl hover:bg-blue-700 hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200",children:["比较回测 (",g.length,")"]}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-gray-500 text-white text-sm rounded-xl hover:bg-gray-600 hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200",children:"清除选择"})]})]}),i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Rt,{}),e.jsx("span",{className:"ml-2 text-gray-600",children:"加载回测数据..."})]}):S.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无回测记录"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"开始您的第一次策略回测"}),e.jsxs("button",{onClick:()=>a("create"),className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 hover:shadow-lg transform hover:scale-[1.02] transition-all duration-200",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"创建回测"]})]}):e.jsx("div",{className:"grid grid-cols-1 gap-6",children:S.map(R=>{var ie,Y,ge,T,Z,oe;return e.jsxs("div",{className:"bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md transition-all duration-200 p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("input",{type:"checkbox",checked:g.includes(R.id),onChange:()=>w(R.id),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:((ie=R.config)==null?void 0:ie.strategy_id)||"未知策略"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${X(R.status)}`,children:te(R.status)})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"回测周期:"}),e.jsxs("p",{className:"font-medium",children:[(Y=R.config)==null?void 0:Y.start_date," - ",(ge=R.config)==null?void 0:ge.end_date]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"初始资金:"}),e.jsx("p",{className:"font-medium",children:Ta(((T=R.config)==null?void 0:T.initial_capital)||0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"总收益:"}),e.jsx("p",{className:`font-medium ${(((Z=R.results)==null?void 0:Z.total_return)||0)>=0?"text-green-600":"text-red-600"}`,children:yl(((oe=R.results)==null?void 0:oe.total_return)||0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"创建时间:"}),e.jsx("p",{className:"font-medium",children:Ea(R.created_at,"short")})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-100",children:[e.jsx("div",{className:"flex items-center space-x-2",children:R.status==="completed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(R.id),className:"px-4 py-2 text-sm text-blue-600 border border-blue-200 rounded-xl hover:bg-blue-50 hover:border-blue-300 transition-all duration-200",children:"下载报告"}),e.jsx(Ge,{to:`/backtest/${R.id}/details`,className:"px-4 py-2 text-sm text-green-600 border border-green-200 rounded-xl hover:bg-green-50 hover:border-green-300 transition-all duration-200",children:"查看详情"})]})}),e.jsx("button",{onClick:()=>re(R.id),className:"text-gray-500 hover:text-red-500 transition-colors",title:"删除回测",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},R.id)})})]}),l&&e.jsx("div",{className:"mt-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:l})})]})]})]})},Mu=()=>{const{id:s}=di(),t=dt(),[r,a]=y.useState(null),[n,i]=y.useState(!0),[l,o]=y.useState(null),[c,d]=y.useState("overview"),[u,m]=y.useState(!1),[k,x]=y.useState(null),[b,g]=y.useState(!1);y.useEffect(()=>{if(!s)return;(async()=>{try{i(!0);const p=await _t.getBacktest(s),S={id:s,strategy_name:"BTC均线策略",symbol:"BTC/USDT",exchange:"binance",start_date:"2024-01-01",end_date:"2024-12-31",initial_capital:1e4,final_capital:12500,total_return:25,status:"completed",created_at:"2024-01-01T00:00:00Z",metrics:{total_return:25,annual_return:22.3,max_drawdown:-8.5,sharpe_ratio:1.35,sortino_ratio:1.62,calmar_ratio:2.63,volatility:16.5,var_95:-3.2,cvar_95:-4.8,win_rate:62.5,profit_factor:1.45,total_trades:156,avg_win:2.8,avg_loss:-1.9,max_consecutive_wins:8,max_consecutive_losses:4,avg_trade_duration:2.5,max_trade_duration:12},equity_curve:w(),monthly_returns:v(),trades:L()};a(S)}catch(p){o("加载回测详情失败"),console.error("Failed to fetch backtest details:",p)}finally{i(!1)}})()},[s]);const w=()=>{const j=[];let p=1e4,S=1e4;const _=new Date("2024-01-01");for(let U=0;U<365;U++){const re=new Date(_);re.setDate(re.getDate()+U);const X=(Math.random()-.45)*.02;p*=1+X,S=Math.max(S,p);const te=(p-S)/S*100;j.push({timestamp:re.toISOString(),equity:Math.round(p),drawdown:te,rolling_max:Math.round(S)})}return j},v=()=>{const j=[];for(let p=2024;p<=2024;p++)for(let S=1;S<=12;S++)j.push({year:p,month:S,return:(Math.random()-.4)*10});return j},L=()=>{const j=[],p=new Date("2024-01-01");for(let S=0;S<156;S++){const _=new Date(p);_.setDate(_.getDate()+Math.floor(S*2.3));const U=Math.random()>.5?"buy":"sell",re=45e3+Math.random()*2e4,X=.01+Math.random()*.09,te=(Math.random()-.4)*500;j.push({timestamp:_.toISOString(),side:U,price:Math.round(re),quantity:parseFloat(X.toFixed(4)),pnl:Math.round(te*100)/100})}return j},C=async()=>{if(!(!r||!s))try{m(!0),E.loading("正在发送回测结果给AI分析...",{id:"ai-analysis"});const j=await Fe.analyzeBacktestResults(parseInt(s));x(j),E.success("AI分析完成！点击查看分析报告",{id:"ai-analysis",duration:3e3}),g(!1),d("analysis")}catch(j){console.error("AI分析失败:",j),E.error("AI分析失败，请稍后重试",{id:"ai-analysis"})}finally{m(!1)}},M=()=>{if(!k||!r)return;const j={backtestId:s,strategyName:r.strategy_name,analysisResult:k,action:"optimize_strategy"};t("/ai-chat",{state:{context:j,autoStart:!0}})};return n?e.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[e.jsx(Rt,{size:"lg"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"加载回测详情中..."})]}):l||!r?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"加载失败"}),e.jsx("p",{className:"text-gray-500 mb-4",children:l||"回测不存在"}),e.jsx(Ge,{to:"/backtest",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"返回回测页面"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Ge,{to:"/backtest",className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"回测详情"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.status==="completed"?"bg-green-100 text-green-800":r.status==="running"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:r.status==="completed"?"已完成":r.status==="running"?"运行中":"已失败"})]}),e.jsxs("p",{className:"text-gray-600",children:[r.strategy_name," - ",r.symbol," (",r.exchange,")"]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(ht,{variant:"outline",className:"px-4 py-2",children:"下载报告"}),e.jsx(ht,{variant:"outline",className:"px-4 py-2",children:"复制配置"}),r.status==="completed"&&e.jsx(ht,{variant:"primary",className:"px-4 py-2 bg-purple-600 hover:bg-purple-700",onClick:()=>g(!0),disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"AI分析中..."]}):e.jsx(e.Fragment,{children:"🤖 发送结果给AI分析"})}),k&&e.jsx(ht,{variant:"primary",className:"px-4 py-2 bg-green-600 hover:bg-green-700",onClick:M,children:"🚀 基于分析优化策略"})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"回测周期"}),e.jsxs("div",{className:"font-medium",children:[r.start_date," 至 ",r.end_date]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"初始资金"}),e.jsx("div",{className:"font-medium",children:Ta(r.initial_capital)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"最终资金"}),e.jsx("div",{className:"font-medium",children:Ta(r.final_capital)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"总收益"}),e.jsx("div",{className:`font-medium ${r.total_return>=0?"text-green-600":"text-red-600"}`,children:yl(r.total_return/100)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"交易次数"}),e.jsx("div",{className:"font-medium",children:r.metrics.total_trades})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:"创建时间"}),e.jsx("div",{className:"font-medium",children:Ea(r.created_at,"short")})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl shadow-sm",children:[e.jsxs("div",{className:"flex border-b border-gray-100",children:[e.jsxs("button",{onClick:()=>d("overview"),className:`flex-1 px-6 py-4 font-medium transition-all duration-200 relative ${c==="overview"?"text-blue-600 bg-blue-50":"text-gray-700 hover:text-gray-900 hover:bg-gray-50"}`,children:["概览分析",c==="overview"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 rounded-t-full"})]}),e.jsxs("button",{onClick:()=>d("analysis"),className:`flex-1 px-6 py-4 font-medium transition-all duration-200 relative ${c==="analysis"?"text-blue-600 bg-blue-50":"text-gray-700 hover:text-gray-900 hover:bg-gray-50"}`,children:["深度分析",c==="analysis"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 rounded-t-full"})]}),e.jsxs("button",{onClick:()=>d("trades"),className:`flex-1 px-6 py-4 font-medium transition-all duration-200 relative ${c==="trades"?"text-blue-600 bg-blue-50":"text-gray-700 hover:text-gray-900 hover:bg-gray-50"}`,children:["交易记录",c==="trades"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 rounded-t-full"})]})]}),e.jsxs("div",{className:"p-6",children:[c==="overview"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"性能概览"}),e.jsx(x0,{metrics:r.metrics,equityCurve:r.equity_curve,monthlyReturns:r.monthly_returns})]}),c==="analysis"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"深度分析"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"风险指标分析"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"最大回撤"}),e.jsxs("span",{className:"font-medium text-red-600",children:[r.metrics.max_drawdown.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"VaR (95%)"}),e.jsxs("span",{className:"font-medium text-red-600",children:[r.metrics.var_95.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"CVaR (95%)"}),e.jsxs("span",{className:"font-medium text-red-600",children:[r.metrics.cvar_95.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"波动率"}),e.jsxs("span",{className:"font-medium",children:[r.metrics.volatility.toFixed(2),"%"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-4",children:"收益质量分析"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"夏普比率"}),e.jsx("span",{className:`font-medium ${r.metrics.sharpe_ratio>=1?"text-green-600":"text-orange-600"}`,children:r.metrics.sharpe_ratio.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"索提诺比率"}),e.jsx("span",{className:"font-medium text-blue-600",children:r.metrics.sortino_ratio.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"卡尔玛比率"}),e.jsx("span",{className:"font-medium text-purple-600",children:r.metrics.calmar_ratio.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"盈亏比"}),e.jsx("span",{className:"font-medium",children:r.metrics.profit_factor.toFixed(2)})]})]})]})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-6",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-3",children:"策略评估总结"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-2",children:[e.jsxs("p",{children:["• 该策略在回测期间表现",r.metrics.sharpe_ratio>=1?"优秀":"一般","，年化收益率达到 ",r.metrics.annual_return.toFixed(1),"%"]}),e.jsxs("p",{children:["• 风险控制",Math.abs(r.metrics.max_drawdown)<=10?"良好":"需要改进","，最大回撤控制在 ",Math.abs(r.metrics.max_drawdown).toFixed(1),"% 以内"]}),e.jsxs("p",{children:["• 交易胜率为 ",r.metrics.win_rate.toFixed(1),"%，",r.metrics.win_rate>=60?"表现出色":"有提升空间"]}),e.jsx("p",{children:"• 建议在实盘交易前进一步优化参数，控制单笔交易风险"})]})]})]}),c==="trades"&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"交易记录"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"时间"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"方向"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"价格"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"数量"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"盈亏"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.trades.slice(0,50).map((j,p)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:Ea(j.timestamp,"short")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j.side==="buy"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:j.side==="buy"?"买入":"卖出"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",j.price.toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:j.quantity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("span",{className:j.pnl>=0?"text-green-600":"text-red-600",children:[j.pnl>=0?"+":"","$",j.pnl.toFixed(2)]})})]},p))})]})}),r.trades.length>50&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx(ht,{variant:"outline",className:"px-4 py-2",children:"加载更多交易记录"})})]})]})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-purple-100 rounded-full",children:e.jsx("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsx("h3",{className:"text-lg font-medium text-center text-gray-900 mb-2",children:"发送回测结果给AI分析？"}),e.jsx("p",{className:"text-center text-gray-600 mb-6",children:"AI将深度分析您的回测结果，识别策略的优势和改进空间，并提供具体的优化建议。"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(ht,{variant:"outline",className:"flex-1",onClick:()=>g(!1),children:"取消"}),e.jsx(ht,{variant:"primary",className:"flex-1 bg-purple-600 hover:bg-purple-700",onClick:C,children:"确认发送"})]})]})}),k&&e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl border border-purple-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 bg-purple-600 rounded-full mr-3",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"🤖 AI深度分析报告"})]}),e.jsx("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:"📊 性能总结"}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsx("p",{className:"text-blue-800 text-sm leading-relaxed",children:k.performance_summary||"正在生成性能分析..."})})]}),k.strengths&&k.strengths.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:"✅ 策略优势"}),e.jsx("div",{className:"space-y-2",children:k.strengths.map((j,p)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-2 h-2 bg-green-500 rounded-full mt-2 mr-3"}),e.jsx("p",{className:"text-gray-700 text-sm",children:j})]},p))})]}),k.improvement_suggestions&&k.improvement_suggestions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center",children:"💡 改进建议"}),e.jsx("div",{className:"space-y-3",children:k.improvement_suggestions.map((j,p)=>e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg",children:e.jsx("p",{className:"text-amber-800 text-sm font-medium",children:j})},p))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200",children:[e.jsx(ht,{variant:"outline",onClick:()=>x(null),children:"关闭分析"}),e.jsx(ht,{variant:"primary",className:"bg-green-600 hover:bg-green-700",onClick:M,children:"🚀 基于分析优化策略"})]})]})})]})]})};class Xn extends ze.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return console.error("🚨 ErrorBoundary捕获错误:",t),{hasError:!0,error:t}}componentDidCatch(t,r){console.error("🚨 ErrorBoundary详细信息:",t,r),console.error("🚨 组件堆栈:",r.componentStack),this.setState({error:t,errorInfo:r})}render(){var t,r;return this.state.hasError?e.jsxs("div",{className:"error-boundary p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"React渲染错误"}),e.jsxs("div",{className:"text-sm text-red-700 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"错误:"})," ",((t=this.state.error)==null?void 0:t.message)||"Unknown error"]}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:"错误详情"}),e.jsx("pre",{className:"mt-2 text-xs bg-red-100 p-2 rounded overflow-auto",children:(r=this.state.error)==null?void 0:r.stack}),this.state.errorInfo&&e.jsx("pre",{className:"mt-2 text-xs bg-red-100 p-2 rounded overflow-auto",children:this.state.errorInfo.componentStack})]})]}),e.jsx("button",{onClick:()=>this.setState({hasError:!1}),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"重试渲染"})]}):this.props.children}}function Iu({title:s,titleId:t,...r},a){return y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),s?y.createElement("title",{id:t},s):null,y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const Ru=y.forwardRef(Iu);function Pu({title:s,titleId:t,...r},a){return y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),s?y.createElement("title",{id:t},s):null,y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"}))}const $u=y.forwardRef(Pu);function Bu({title:s,titleId:t,...r},a){return y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),s?y.createElement("title",{id:t},s):null,y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"}))}const Du=y.forwardRef(Bu);function Ou({title:s,titleId:t,...r},a){return y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),s?y.createElement("title",{id:t},s):null,y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const Ma=y.forwardRef(Ou);function Fu({title:s,titleId:t,...r},a){return y.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},r),s?y.createElement("title",{id:t},s):null,y.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const zu=y.forwardRef(Fu),Uu=({result:s,className:t=""})=>{var c,d,u,m,k,x,b,g,w;const[r,a]=y.useState(!1),n=(s.final_value-s.initial_capital)/s.initial_capital*100,i=n>0,l=v=>{switch(v==null?void 0:v.toLowerCase()){case"low":return"text-green-600";case"medium":return"text-yellow-600";case"high":return"text-red-600";default:return"text-gray-600"}},o=v=>v>10?"text-green-600":v>0?"text-green-500":"text-red-500";return e.jsxs("div",{className:`bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm ${t}`,children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"📊 回测结果"}),e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${s.performance_grade==="A"?"bg-green-100 text-green-700":s.performance_grade==="B"?"bg-blue-100 text-blue-700":s.performance_grade==="C"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[s.performance_grade," 级"]})]}),e.jsxs("button",{onClick:()=>a(!r),className:"flex items-center text-sm text-blue-600 hover:text-blue-800",children:[r?"收起详情":"查看详情",r?e.jsx($u,{className:"w-4 h-4 ml-1"}):e.jsx(Ru,{className:"w-4 h-4 ml-1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${o(n)}`,children:[n.toFixed(2),"%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"总收益率"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-800",children:((c=s.sharpe_ratio)==null?void 0:c.toFixed(2))||"N/A"}),e.jsx("div",{className:"text-xs text-gray-500",children:"夏普比率"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-red-600",children:["-",((d=s.max_drawdown)==null?void 0:d.toFixed(2))||"N/A","%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"最大回撤"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:[((u=s.win_rate)==null?void 0:u.toFixed(1))||"N/A","%"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"胜率"})]})]}),e.jsx("div",{className:"mt-3 p-2 bg-white rounded border-l-4 border-blue-400",children:e.jsx("p",{className:"text-sm text-gray-700",children:s.meets_expectations?`✅ 策略表现达到预期，建议关注${((m=s.optimization_suggestions)==null?void 0:m[0])||"风险管理"}`:`⚠️ 策略需要优化，主要问题：${((k=s.optimization_suggestions)==null?void 0:k[0])||"收益不稳定"}`})})]}),r&&e.jsx("div",{className:"border-t border-blue-200 bg-white",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"📈 详细性能指标"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"初始资金："}),e.jsxs("span",{className:"font-medium",children:["$",(x=s.initial_capital)==null?void 0:x.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"最终价值："}),e.jsxs("span",{className:`font-medium ${i?"text-green-600":"text-red-600"}`,children:["$",(b=s.final_value)==null?void 0:b.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"交易次数："}),e.jsx("span",{className:"font-medium",children:s.total_trades||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"盈利交易："}),e.jsx("span",{className:"font-medium text-green-600",children:s.winning_trades||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"亏损交易："}),e.jsx("span",{className:"font-medium text-red-600",children:s.losing_trades||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"平均收益："}),e.jsxs("span",{className:"font-medium",children:[((g=s.avg_profit)==null?void 0:g.toFixed(2))||"N/A","%"]})]})]})]}),s.optimization_suggestions&&s.optimization_suggestions.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"💡 优化建议"}),e.jsx("ul",{className:"text-sm space-y-1",children:s.optimization_suggestions.slice(0,3).map((v,L)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-500 mr-2",children:"•"}),e.jsx("span",{className:"text-gray-700",children:v})]},L))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"⚠️ 风险分析"}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"风险等级："}),e.jsx("span",{className:`font-medium ${l(s.risk_level)}`,children:s.risk_level||"未评估"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"波动率："}),e.jsxs("span",{className:"font-medium",children:[((w=s.volatility)==null?void 0:w.toFixed(2))||"N/A","%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"VaR(95%)："}),e.jsx("span",{className:"font-medium text-red-600",children:s.var_95?`${s.var_95.toFixed(2)}%`:"N/A"})]})]})]}),e.jsxs("div",{className:"flex space-x-3 pt-2 border-t border-gray-100",children:[e.jsx("button",{className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700 transition-colors",children:"查看完整报告"}),e.jsx("button",{className:"flex-1 bg-green-600 text-white px-4 py-2 rounded text-sm hover:bg-green-700 transition-colors",children:"启动实盘交易"}),e.jsx("button",{className:"flex-1 bg-yellow-600 text-white px-4 py-2 rounded text-sm hover:bg-yellow-700 transition-colors",children:"优化策略"})]})]})})]})};class Wu{constructor(){Te(this,"cache",{});Te(this,"REQUIRED_BASE_CLASSES",["BaseStrategy","EnhancedBaseStrategy","UserStrategy","TradingStrategy"]);Te(this,"REQUIRED_METHODS",["on_data_update","get_data_requirements"]);Te(this,"STRATEGY_PATTERNS",{imports:[/from.*BaseStrategy.*import/i,/from.*EnhancedBaseStrategy.*import/i,/import.*TradingSignal/i,/import.*SignalType/i,/import.*DataRequest/i,/import.*DataType/i],classes:[/class\s+(\w*Strategy)\s*\(/i,/class\s+(\w+)\s*\(\s*(BaseStrategy|EnhancedBaseStrategy|UserStrategy)/i],methods:[/def\s+(on_data_update)\s*\(/i,/def\s+(get_data_requirements)\s*\(/i,/def\s+(calculate_\w+)\s*\(/i,/def\s+(execute_trade)\s*\(/i],signals:[/TradingSignal\s*\(/i,/SignalType\./i,/return\s+TradingSignal/i,/signal\s*=\s*TradingSignal/i],indicators:{MACD:[/macd/i,/ema12|ema26/i,/signal.*line/i,/histogram/i],MA:[/sma|simple.*moving/i,/ema|exponential.*moving/i,/ma_short|ma_long/i,/golden_cross|death_cross/i],RSI:[/rsi/i,/relative.*strength/i,/overbought|oversold/i],BOLL:[/bollinger/i,/upper.*band|lower.*band/i,/std.*dev/i],KDJ:[/kdj/i,/%k.*%d.*%j/i,/stochastic/i],CCI:[/cci/i,/commodity.*channel/i]},tradingFeatures:[/position\s*=|position\./i,/trades\s*=\s*\[\]/i,/fee_rate\s*=/i,/stop_loss|take_profit/i,/buy.*signal|sell.*signal/i]})}analyzeMessage(t){const r=this.extractCodeBlock(t);return r?this.analyzeCode(r):{isStrategy:!1,confidence:0,strategyType:"none",indicators:[],methods:[],errors:["No Python code block found"]}}analyzeCode(t){const r=this.hashCode(t);if(this.cache[r])return this.cache[r];const a={isStrategy:!1,confidence:0,strategyType:"unknown",indicators:[],methods:[],errors:[]};try{const n=this.analyzeStructure(t,a),i=this.analyzeIndicators(t,a),l=this.analyzeTradingFeatures(t,a),o=this.analyzeSyntax(t,a);a.confidence=this.calculateConfidence(n,i,l,o),a.isStrategy=a.confidence>=.6,a.strategyType=this.determineStrategyType(a.indicators)}catch(n){a.errors.push(`Analysis error: ${n instanceof Error?n.message:"Unknown error"}`)}return this.cache[r]=a,a}analyzeStructure(t,r){let a=0;this.STRATEGY_PATTERNS.imports.some(l=>l.test(t))&&(a+=.2);for(const l of this.STRATEGY_PATTERNS.classes){const o=t.match(l);if(o){r.className=o[1],a+=.4;break}}for(const l of this.STRATEGY_PATTERNS.methods){const o=t.match(l);o&&(r.methods.push(o[1]),a+=.1)}return this.STRATEGY_PATTERNS.signals.some(l=>l.test(t))&&(a+=.1),Math.min(a,1)}analyzeIndicators(t,r){let a=0;for(const[n,i]of Object.entries(this.STRATEGY_PATTERNS.indicators))i.some(o=>o.test(t))&&(r.indicators.push(n),a+=.2);return Math.min(a,1)}analyzeTradingFeatures(t,r){let a=0;for(const n of this.STRATEGY_PATTERNS.tradingFeatures)n.test(t)&&(a+=.15);return Math.min(a,1)}analyzeSyntax(t,r){let a=0;const n=[/class\s+\w+.*:/i,/def\s+\w+.*:/i,/return\s+/i,/if\s+.*:/i];for(const i of n)i.test(t)&&(a+=.2);return t.length>500&&t.length<1e4&&(a+=.2),Math.min(a,1)}calculateConfidence(t,r,a,n){return t*.4+r*.25+a*.25+n*.1}determineStrategyType(t){return t.length===0?"generic":t.length===1?t[0].toLowerCase():t.includes("MACD")&&t.includes("RSI")?"macd-rsi":t.includes("MA")&&t.includes("KDJ")?"ma-kdj":t.includes("BOLL")&&t.includes("CCI")?"boll-cci":"multi-indicator"}extractCodeBlock(t){const r=[/```python\s*([\s\S]*?)\s*```/i,/```\s*(class.*?[\s\S]*?)\s*```/i,/```\s*(def.*?[\s\S]*?)\s*```/i,/```\s*([\s\S]*?)\s*```/i];for(const a of r){const n=t.match(a);if(n&&n[1].trim().length>100)return n[1].trim()}return null}hashCode(t){let r=0;for(let a=0;a<t.length;a++){const n=t.charCodeAt(a);r=(r<<5)-r+n,r=r&r}return r.toString()}clearCache(){this.cache={}}getCacheStats(){return{size:Object.keys(this.cache).length,hitRate:0}}}const Vu=new Wu,Hu=s=>Vu.analyzeMessage(s),qu=s=>{if(!s||s<0)return"计算中...";if(s<60)return`${Math.round(s)} 秒`;if(s<3600)return`${Math.round(s/60)} 分钟`;{const t=Math.floor(s/3600),r=Math.round(s%3600/60);return`${t}小时${r}分钟`}},bl=s=>`strategy_state_${s}`,Yn=(s,t)=>{try{const r=bl(s);sessionStorage.setItem(r,JSON.stringify(t)),console.log("💾 [AIChatPage] 保存策略状态:",{sessionId:s,phase:t.phase})}catch(r){console.error("❌ [AIChatPage] 保存策略状态失败:",r)}},Zu=s=>{try{const t=bl(s),r=sessionStorage.getItem(t);if(r){const a=JSON.parse(r);return console.log("📥 [AIChatPage] 加载策略状态:",{sessionId:s,phase:a.phase}),a}}catch(t){console.error("❌ [AIChatPage] 加载策略状态失败:",t)}return null},Ku=s=>{try{if(!["回测结果","回测完成","策略性能","收益率","夏普比率","最大回撤"].some(d=>s.includes(d)))return null;const a={initial_capital:1e4,final_value:1e4,performance_grade:"C"},n=s.match(/收益率[：:]?\s*([+-]?\d+\.?\d*)%/);if(n){const d=parseFloat(n[1]);a.final_value=a.initial_capital*(1+d/100),a.total_return=d}const i=s.match(/夏普比率[：:]?\s*([+-]?\d+\.?\d*)/);i&&(a.sharpe_ratio=parseFloat(i[1]));const l=s.match(/最大回撤[：:]?\s*([+-]?\d+\.?\d*)%/);l&&(a.max_drawdown=parseFloat(l[1]));const o=s.match(/胜率[：:]?\s*([+-]?\d+\.?\d*)%/);o&&(a.win_rate=parseFloat(o[1])),a.total_return&&a.total_return>20?a.performance_grade="A":a.total_return&&a.total_return>10?a.performance_grade="B":a.total_return&&a.total_return>0?a.performance_grade="C":a.performance_grade="D";const c=s.match(/建议[：:]?(.+?)(?:\n|$)/g);return c&&(a.optimization_suggestions=c.map(d=>d.replace(/建议[：:]?/,"").trim())),a}catch(t){return console.warn("提取回测结果失败:",t),null}},Gu=(s,t)=>{if(s==null)return console.warn("filterMessageContent: content is undefined or null"),"";if(typeof s!="string"){console.warn("filterMessageContent: content is not a string, converting:",typeof s,s);try{return typeof s=="object"&&s!==null?JSON.stringify(s):String(s||"")}catch(i){return console.error("Failed to stringify content:",i),"[Invalid Content]"}}if(t==="user")return s;const r=/```[\s\S]*?```/g;return r.test(s)?s.replace(r,`
🎯 **策略开发完成**

策略已在后台生成并保存至系统。您现在可以：
• 点击下方"回测策略"来验证策略性能
• 回测完成后，我将帮您分析结果并提供优化建议
• 根据分析结果，我们可以进一步优化策略
`).trim():s},vl=s=>{const t=performance.now(),r=Hu(s),n=performance.now()-t,i={hasStrategyCode:r.isStrategy,hasSuccessMessage:Qu(s),analysisResult:r,showBacktestButton:r.isStrategy&&r.confidence>=.6,extractedCode:r.isStrategy?Ju(s):void 0};return{messageState:i,confidence:r.confidence,debugInfo:{codeExtracted:!!i.extractedCode,analysisTime:n,cacheHit:!1,errors:r.errors}}},jl=s=>vl(s).messageState.extractedCode||null,Ju=s=>{const t=s.match(/```(?:python)?\s*([\s\S]*?)\s*```/);return t?t[1].trim():null},Qu=s=>[/✅.*策略.*成功.*生成/i,/策略.*生成.*成功/i,/🎯.*开始.*生成.*策略/i,/🚀.*开始.*生成/i,/策略代码.*已.*保存/i].some(r=>r.test(s))||s.includes("策略")&&s.includes("```python")&&s.length>1e3,Xu=(s,t,r)=>{const a=jl(s);if(!a)return null;const n=r.length+1,i=new Date,l=s.match(/class\s+(\w*Strategy)/i),o=l?l[1]:`策略${n}`,c=Yu(s);return{id:`strategy_v${n}_${i.getTime()}`,version:n,code:a,messageIndex:t,timestamp:i,title:o,description:c}},Yu=s=>{const t=[];return(s.includes("MACD")||s.includes("macd"))&&t.push("MACD指标"),(s.includes("RSI")||s.includes("rsi"))&&t.push("RSI指标"),(s.includes("移动平均")||s.includes("MA"))&&t.push("移动平均线"),(s.includes("布林带")||s.includes("BOLL"))&&t.push("布林带指标"),(s.includes("金叉")||s.includes("死叉"))&&t.push("金叉死叉信号"),(s.includes("背离")||s.includes("divergence"))&&t.push("背离信号"),t.length>0?`基于 ${t.join("、")} 的交易策略`:"量化交易策略"},em=({isOpen:s,onClose:t,onCreateSession:r,aiMode:a})=>{const[n,i]=y.useState(""),[l,o]=y.useState("strategy"),[c,d]=y.useState(""),[u,m]=y.useState(!1),k=async x=>{if(x.preventDefault(),!!n.trim()){m(!0);try{await r({name:n,ai_mode:"trader",session_type:l,description:c||void 0}),i(""),d(""),t()}finally{m(!1)}}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"创建新对话"}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"对话名称"}),e.jsx("input",{type:"text",value:n,onChange:x=>i(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"为你的对话起个名字",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"对话类型"}),e.jsxs("select",{value:l,onChange:x=>o(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"strategy",children:"策略开发"}),e.jsx("option",{value:"indicator",children:"指标开发"}),e.jsx("option",{value:"trading_system",children:"交易系统搭建"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"描述 (可选)"}),e.jsx("textarea",{value:c,onChange:x=>d(x.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:"简单描述这个对话的目的"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:t,className:"flex-1 px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"取消"}),e.jsx("button",{type:"submit",disabled:!n.trim()||u,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:u?"创建中...":"创建"})]})]})]})}):null},tm=()=>{var Le,N;const s=zr(),{user:t,isPremium:r}=is(),{chatSessions:a,currentSession:n,messages:i,messagesLoading:l,messagesLoaded:o,isTyping:c,isLoading:d,error:u,clearError:m,createChatSession:k,loadChatSessions:x,selectChatSession:b,sendMessage:g,loadUsageStats:w,usageStats:v,deleteChatSession:L,networkStatus:C,retryCount:M,checkNetworkStatus:j,useWebSocket:p,wsConnected:S,initializeWebSocket:_}=Ar(),[U,re]=y.useState(!1),[X,te]=y.useState(!1),[R,ie]=y.useState(!1),[Y,ge]=y.useState(""),[T,Z]=y.useState([]),[oe,z]=y.useState(!1),[F,me]=y.useState(()=>({phase:"discussion",currentSession:void 0})),Se=(Le=s.state)==null?void 0:Le.context,[nt,pe]=y.useState(!1),[We,be]=y.useState(null),[ce,Ae]=y.useState({isRunning:!1,progress:0,currentStep:"",detailsExpanded:!1,executionLogs:[]}),[Ke,Ut]=y.useState({versions:[],selectedVersion:void 0}),[kt,gt]=y.useState({isOpen:!1,selectedVersion:null});if(y.useEffect(()=>{r&&w(1)},[r]),y.useEffect(()=>{if(i.length>0&&n&&o){const h=i.slice().reverse().find(A=>A.role==="assistant");if(h){const A=h.content.toLowerCase();if(console.log("🔄 [AIChatPage] 非策略状态转换检测:",{currentPhase:F.phase,messagePreview:h.content.substring(0,100)+"..."}),A.includes("是否可以")&&A.includes("开发")&&F.phase==="discussion"){console.log("✅ [AIChatPage] 检测到开发确认询问"),me(D=>({...D,phase:"development_confirmed"}));return}if((A.includes("优化建议")||A.includes("建议"))&&F.phase==="analyzing_results"){console.log("✅ [AIChatPage] 检测到优化建议"),me(D=>({...D,phase:"optimization_suggested"}));return}if(A.includes("数据")&&A.includes("分析")&&F.phase==="backtest_completed"){console.log("✅ [AIChatPage] 检测到分析请求"),me(D=>({...D,phase:"analysis_requested"}));return}}}},[i,n,F.phase,o]),y.useEffect(()=>{var h,A,D,$,O,V,ee,J,Q,f;if(console.log("🔄 [GlobalMessageTracker] 消息数组发生变化:",{messagesCount:i.length,messagesLoaded:o,currentSession:n==null?void 0:n.session_id,timestamp:new Date().toISOString(),lastMessage:i.length>0?{role:(h=i[i.length-1])==null?void 0:h.role,content:((D=(A=i[i.length-1])==null?void 0:A.content)==null?void 0:D.substring(0,200))+"...",isStrategyRelated:(O=($=i[i.length-1])==null?void 0:$.content)==null?void 0:O.includes("策略"),metadata:(V=i[i.length-1])==null?void 0:V.metadata}:null}),i.length>0){const I=i[i.length-1];(ee=I==null?void 0:I.metadata)!=null&&ee.streamCompleted&&console.log("🎯 [GlobalMessageTracker] 检测到流式完成标记!",{streamCompleted:I.metadata.streamCompleted,completedAt:I.metadata.completedAt,messageContent:(J=I.content)==null?void 0:J.substring(0,300)})}if(i.length>0){const I=i[i.length-1];if((I==null?void 0:I.role)==="assistant"&&I.content){const ue=I.content.includes("策略生成成功")||I.content.includes("策略代码已生成并通过验证"),Ce=(Q=I.metadata)==null?void 0:Q.streamCompleted;ue&&console.log("🎯 [GlobalMessageTracker] 检测到策略成功消息!",{messageIndex:i.length-1,content:I.content.substring(0,500),fullContent:I.content,streamCompleted:Ce,metadata:I.metadata}),Ce&&console.log("🌊 [GlobalMessageTracker] 检测到流式完成标记!",{messageIndex:i.length-1,completedAt:(f=I.metadata)==null?void 0:f.completedAt,hasStrategyKeywords:I.content.includes("策略"),isStrategySuccess:ue})}}},[i]),y.useEffect(()=>{if(i.length>0&&n&&o){const h=[];i.forEach((A,D)=>{if(A.role==="assistant"&&!Ke.versions.some(O=>O.messageIndex===D)){const O=Xu(A.content,D,Ke.versions);O&&(h.push(O),console.log("🎯 [StrategyVersions] 发现新策略版本:",{version:O.version,title:O.title,messageIndex:D,id:O.id}))}}),h.length>0&&(Ut(A=>({...A,versions:[...A.versions,...h],selectedVersion:A.selectedVersion||h[0].id})),console.log("✅ [StrategyVersions] 版本状态已更新:",{newVersionsCount:h.length,totalVersions:Ke.versions.length+h.length}))}},[i,n,o,Ke.versions]),y.useEffect(()=>{if(n){console.log("🔄 [AIChatPage] 会话变化，开始策略状态检测",{sessionId:n.session_id,messagesLoading:l,messagesLoaded:o,messagesLength:i.length});const h=async()=>{var A,D;if((n.session_id==="ma5"||n.session_id==="ma6")&&i.length===0){console.log(`🎯 [QuickFix] 检测到${n.session_id}会话且无历史消息，查询数据库中的真实策略ID`);let $=n.session_id;try{const ee=(await rt.getStrategies({page:1,per_page:100})).strategies.find(J=>{var Q;return(Q=J.name)==null?void 0:Q.includes(n.session_id)});ee&&($=String(ee.id),console.log(`✅ [QuickFix] ${n.session_id}会话找到真实策略ID:`,$))}catch(V){console.warn(`⚠️ [QuickFix] ${n.session_id}会话查询策略失败:`,V)}const O={phase:"ready_for_backtest",strategyId:$,currentSession:n.session_id};me(O),Yn(n.session_id,O);return}if(i.length>0){let $=!1,O=!1;for(const V of i)if(V.role==="assistant"||V.role===null&&(V.content.includes("✅ **策略")||V.content.includes("📊 **策略")||V.content.includes("🚀 **")||V.content.includes("我来为你")||V.content.includes("您好！")||V.content.includes("**策略代码已生成")||V.content.includes("策略讨论分析"))){console.log("🔧 [AIChatPage] 检测AI消息:",{role:V.role,preview:V.content.substring(0,50)});const J=vl(V.content);if(J.messageState.hasStrategyCode&&($=!0,console.log("✅ [AIChatPage] 智能分析在历史消息中发现策略代码",{confidence:J.confidence,strategyType:(A=J.messageState.analysisResult)==null?void 0:A.strategyType,indicators:(D=J.messageState.analysisResult)==null?void 0:D.indicators,analysisTime:`${J.debugInfo.analysisTime.toFixed(2)}ms`})),J.messageState.hasSuccessMessage&&(O=!0,console.log("✅ [AIChatPage] 智能分析在历史消息中发现策略生成成功标记")),$&&O)break}if($||O){console.log("✅ [AIChatPage] 智能分析检测到会话中有策略代码或成功标记，设置为ready_for_backtest状态"),console.log("🔧 [DEBUG] 智能策略检测详情:",{hasCodeInSession:$,hasStrategySuccessInSession:O,sessionId:n.session_id,messagesCount:i.length,currentPhase:F.phase});let V=F.strategyId;if(!V||V.includes("strategy_")||V.includes("_"))try{const Q=(await rt.getStrategies({page:1,per_page:100})).strategies.find(f=>{var I,ue,Ce;return((I=f.name)==null?void 0:I.includes("ma6"))||((ue=f.name)==null?void 0:ue.includes(n.name||""))||((Ce=f.name)==null?void 0:Ce.includes(n.session_id))});Q&&(V=String(Q.id),console.log("🔍 [AIChatPage] 从数据库找到匹配策略ID:",V,"策略名称:",Q.name))}catch(J){console.warn("⚠️ [AIChatPage] 查询策略列表失败，使用会话ID作为临时ID:",J),V=n.session_id}const ee={phase:"ready_for_backtest",strategyId:V||n.session_id,currentSession:n.session_id};console.log("🎯 [DEBUG] 智能分析后设置新的策略状态:",ee),me(ee),setTimeout(()=>{console.log("⏱️ [DEBUG] 策略状态更新后检查:",F)},100);return}}console.log("📝 [AIChatPage] 未检测到策略消息，设置为discussion状态"),me({phase:"discussion",currentSession:n.session_id})};o?(console.log("✅ [AIChatPage] 消息加载完成，开始策略状态检测"),h().catch(console.error)):!l&&i.length===0&&(console.log("📝 [AIChatPage] 没有消息且不在加载中，直接设置为discussion状态"),me({phase:"discussion",currentSession:n.session_id})),Ae({isRunning:!1,progress:0,currentStep:"",detailsExpanded:!1,executionLogs:[]})}},[n==null?void 0:n.session_id,l,o,i]),u)return e.jsx("div",{className:"flex h-[calc(100vh-140px)] items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-semibold text-red-600 mb-4",children:"加载出错"}),e.jsx("p",{className:"text-gray-600 mb-4",children:u}),e.jsx("button",{onClick:()=>{m(),window.location.reload()},className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"重新加载"})]})});if(!r)return e.jsx("div",{className:"flex h-[calc(100vh-140px)] items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"AI功能需要高级版"}),e.jsx("p",{className:"text-gray-600",children:"AI对话助手是高级版专享功能，升级后即可使用智能策略生成和交易分析"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-left bg-gray-50 p-4 rounded-lg mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{children:"AI策略代码生成"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{children:"智能市场分析"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{children:"专业交易建议"})]})]}),e.jsx("button",{onClick:()=>window.location.href="/profile",className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"升级到高级版"})]})});y.useEffect(()=>{r&&x("trader")},[r]),y.useEffect(()=>{var h;Se&&((h=s.state)!=null&&h.autoStart)&&r&&(console.log("检测到优化上下文:",Se),pe(!0),be(Se),(async()=>{try{const $={name:`策略优化 - ${Se.strategyName||"未知策略"}`,ai_mode:"trader",session_type:"strategy",description:`基于回测ID ${Se.backtestId} 的策略优化讨论`};await k($),E.success("已创建策略优化会话"),setTimeout(async()=>{var V,ee,J,Q,f;const O=`我刚刚完成了策略"${Se.strategyName}"的回测，AI分析报告如下：

📊 **性能总结**: ${((V=Se.analysisResult)==null?void 0:V.performance_summary)||"分析中..."}

✅ **策略优势**:
${((J=(ee=Se.analysisResult)==null?void 0:ee.strengths)==null?void 0:J.map(I=>`• ${I}`).join(`
`))||"暂无"}

💡 **改进建议**:
${((f=(Q=Se.analysisResult)==null?void 0:Q.improvement_suggestions)==null?void 0:f.map(I=>`• ${I}`).join(`
`))||"暂无"}

现在我想基于这些分析结果来优化策略。请帮我分析如何改进这个策略。`;await g(O)},1e3)}catch(D){console.error("创建优化会话失败:",D),E.error("创建优化会话失败")}})(),window.history.replaceState({},document.title))},[Se,s.state,r,k,g]),y.useEffect(()=>{const A=setTimeout(async()=>{var ee,J;const D=localStorage.getItem("auth-storage");if(!D){console.log("⚠️ [AIChatPage] 未找到认证信息，跳过WebSocket初始化");return}let $;try{$=JSON.parse(D)}catch(Q){console.error("❌ [AIChatPage] 认证数据解析失败:",Q);return}const O=(ee=$==null?void 0:$.state)==null?void 0:ee.token,V=(J=$==null?void 0:$.state)==null?void 0:J.isAuthenticated;if(!O||!V){console.log("⚠️ [AIChatPage] 用户未认证或token无效，跳过WebSocket初始化");return}if(r&&p&&!S&&!d){console.log("🔄 [AIChatPage] 自动初始化WebSocket连接..."),console.log("🔑 [AIChatPage] 使用token:",O.substring(0,20)+"...");try{const Q=await _();console.log(Q?"✅ [AIChatPage] WebSocket自动连接成功":"❌ [AIChatPage] WebSocket自动连接失败，将回退到HTTP模式")}catch(Q){console.error("❌ [AIChatPage] WebSocket自动连接异常:",Q)}}},1e3);return()=>clearTimeout(A)},[r,p,S,d]),y.useEffect(()=>{if(n&&n.session_id&&o){const h=Zu(n.session_id);h?(console.log("🔄 [AIChatPage] 恢复保存的策略状态:",h),me(h)):(console.log("📝 [AIChatPage] 无保存的策略状态，使用默认状态"),me({phase:"discussion",currentSession:n.session_id}))}},[n==null?void 0:n.session_id,o]),y.useEffect(()=>(window.triggerBacktestModal=()=>(console.log("🌍 [AIChatPage] 外部触发回测模态框"),F.phase==="ready_for_backtest"||F.phase==="strategy_ready"?(te(!0),!0):(console.log("⚡ [AIChatPage] 强制设置策略就绪状态"),me(h=>({...h,phase:"ready_for_backtest"})),setTimeout(()=>{te(!0)},100),!0)),()=>{delete window.triggerBacktestModal}),[F.phase]),y.useEffect(()=>{F.currentSession&&(console.log("💾 [AIChatPage] 策略状态变化，准备保存:",{sessionId:F.currentSession,phase:F.phase,strategyId:F.strategyId}),Yn(F.currentSession,F))},[F]);const P=a.trader||[],de=async h=>{await k(h)},Ve=async h=>{var $;const A=($=h.clipboardData)==null?void 0:$.items;if(!A)return;const D=[];for(let O=0;O<A.length;O++){const V=A[O];if(V.type.startsWith("image/")){const ee=V.getAsFile();ee&&D.push(ee)}}D.length>0&&(h.preventDefault(),Z(O=>[...O,...D]),E.success(`已粘贴 ${D.length} 张图片`))},it=h=>{Z(A=>A.filter((D,$)=>$!==h))},Me=async h=>{if(h.preventDefault(),console.log("🎯 [DEBUG] handleSendMessage called:",{messageInput:Y,isTyping:c,currentSession:n}),!Y.trim()&&T.length===0||c){console.log("⚠️ [DEBUG] Early return:",{emptyMessage:!Y.trim(),isTyping:c,noImages:T.length===0});return}let A=Y;T.length>0&&(A+=`

📷 [已上传 ${T.length} 张图片，请帮我分析]`),console.log("📨 [DEBUG] Calling sendMessage with:",A);const D=await g(A);console.log("📬 [DEBUG] sendMessage result:",D),D&&(ge(""),Z([]))};return e.jsxs("div",{className:"flex h-[calc(100vh-140px)]",children:[e.jsxs("div",{className:"w-60 border-r border-gray-200 bg-gray-50 flex flex-col",children:[e.jsx("div",{className:"p-3 border-b border-gray-200 bg-white",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-emerald-500 via-teal-500 to-cyan-500 rounded-lg flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-white text-sm font-bold",children:"T"})}),e.jsx("div",{className:"text-sm font-medium text-gray-800",children:"Trademe助手"})]})})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"对话列表"}),e.jsx("button",{onClick:()=>re(!0),className:"px-2 py-1 bg-blue-500 text-white text-xs rounded-md hover:bg-blue-600 transition-colors",children:"+ 新建"})]}),d?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"加载中..."}):P.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2",children:"💬"}),e.jsx("p",{className:"text-xs mb-2",children:"还没有对话"}),e.jsx("button",{onClick:()=>re(!0),className:"text-xs text-blue-600 hover:text-blue-700 font-medium",children:"创建第一个对话"})]}):e.jsx("div",{className:"space-y-1",children:P.map(h=>e.jsx("div",{onClick:()=>b(h),className:`group p-2 rounded-md cursor-pointer transition-colors ${(n==null?void 0:n.session_id)===h.session_id?"bg-blue-50 border-blue-200 border":"bg-white hover:bg-gray-50 border border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-xs text-gray-900 truncate",children:h.name}),e.jsxs("div",{className:"flex items-center space-x-2 mt-0.5",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[h.message_count,"条"]}),e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${h.status==="active"?"bg-green-400":"bg-gray-300"}`}),e.jsx("span",{className:"text-xs text-gray-400 capitalize",children:h.session_type})]})]}),e.jsx("button",{onClick:A=>{A.stopPropagation(),window.confirm("确定要删除这个对话吗？")&&L(h.session_id)},className:"opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-red-500 transition-all duration-200",title:"删除对话",children:e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})},h.session_id))})]})})]}),e.jsx("div",{className:"flex-1 flex flex-col",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-gray-900",children:n.name}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Trademe助手"}),e.jsx("span",{className:"px-2 py-0.5 bg-gradient-to-r from-blue-500 to-purple-500 text-white text-xs font-bold rounded-full",children:"Claude 4"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1.5 bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-4 h-4 bg-gradient-to-br from-emerald-500 via-teal-500 to-cyan-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"T"})}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:(t==null?void 0:t.membership_level)==="premium"?"高级版":"专业版"})]}),e.jsx("div",{className:"h-3 w-px bg-gray-300"}),e.jsxs("div",{className:"text-xs text-gray-600",children:["已用 ",e.jsxs("span",{className:"font-semibold text-blue-600",children:["$",((N=v==null?void 0:v.daily_cost_usd)==null?void 0:N.toFixed(2))||"0.00"]}),e.jsx("span",{className:"text-gray-400",children:"/"}),e.jsx("span",{className:"text-gray-500",children:(t==null?void 0:t.membership_level)==="premium"?"$100":"$200"})]}),e.jsx("div",{className:"w-12 bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-cyan-500 h-1 rounded-full transition-all duration-300",style:{width:`${v?Math.min(100,v.daily_cost_usd/((t==null?void 0:t.membership_level)==="premium"?100:200)*100):0}%`}})})]}),e.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 text-xs rounded-full transition-all duration-200 ${C==="connected"?"bg-green-100 text-green-700":C==="checking"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${C==="connected"?"bg-green-500":C==="checking"?"bg-yellow-500 animate-pulse":"bg-red-500 animate-pulse"}`}),e.jsx("span",{children:C==="connected"?"AI在线":C==="checking"?"检查中":"AI离线"}),M>0&&e.jsxs("span",{className:"text-orange-600",children:["(",M,"次重试)"]})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${n.status==="active"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:n.status==="active"?"进行中":"已完成"})]})]})}),(u||C==="disconnected")&&e.jsx("div",{className:"bg-red-50 border-b border-red-200 px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full flex-shrink-0 animate-pulse"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-red-800 font-medium",children:u||"AI服务连接中断"}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Claude AI服务可能正在维护，请稍后重试或检查网络连接"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:async()=>{m(),await j()?E.success("网络连接已恢复",{icon:"🔗"}):E.error("网络仍然不可用，请检查连接",{icon:"⚠️"})},className:"px-3 py-1 bg-red-100 hover:bg-red-200 text-red-700 text-xs rounded-md transition-colors duration-200 flex items-center space-x-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"重试连接"})]}),e.jsx("button",{onClick:()=>m(),className:"text-red-600 hover:text-red-800 p-1",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})}),e.jsx(Xn,{children:e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-3",children:"🤖"}),e.jsx("p",{children:"开始你的AI对话吧！"})]}):i.map((h,A)=>{if(!h||typeof h!="object")return console.warn("Invalid message object at index",A,":",h),null;const D=h.role||"assistant",$=h.content||"",O=h.timestamp||new Date().toISOString();return e.jsx(Xn,{children:e.jsx("div",{className:`flex ${D==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg px-4 py-2 ${D==="user"?"bg-blue-600 text-white":"bg-white border border-gray-200 text-gray-900"}`,children:[e.jsx("div",{className:"whitespace-pre-wrap",children:(()=>{var V,ee;try{const J=Gu($,D),Q=typeof J=="string"?J:String(J||""),f=D==="assistant"&&(Q.includes("策略生成成功")||Q.includes("策略代码已生成并通过验证")||Q.includes("✅ **策略生成成功！**")||Q.includes("📊 **性能评级**")&&Q.includes("📈 **策略代码已生成并通过验证**")||Q.includes("您可以在策略管理页面查看和使用生成的策略"));if(D==="assistant"&&(console.log("🔍 [StrategyDetection] 完整消息分析:",{messageIndex:A,timestamp:new Date().toISOString(),isStrategySuccess:f,messageObjectType:typeof h,messageKeys:Object.keys(h||{}),originalContent:($==null?void 0:$.substring(0,300))+"...",filteredContent:Q.substring(0,300)+"...",keywordResults:{hasStrategy:Q.includes("策略"),hasGenerate:Q.includes("生成"),hasSuccess:Q.includes("成功"),hasSuccessMessage:Q.includes("策略生成成功"),hasValidated:Q.includes("策略代码已生成并通过验证"),hasCheckmark:Q.includes("✅"),hasBold:Q.includes("**")},detailedChecks:{check1:Q.includes("✅ **策略已成功生成并保存**"),check2:Q.includes("策略已成功生成"),check3:Q.includes("策略生成成功"),check4:Q.includes("✅ **策略生成成功！**"),check5:Q.includes("**策略代码已生成并通过验证**"),streamCompleted:(V=h==null?void 0:h.metadata)==null?void 0:V.streamCompleted,completedAt:(ee=h==null?void 0:h.metadata)==null?void 0:ee.completedAt,check6:Q.includes("**策略代码已保存到数据库**"),check7:Q.includes("📊 **性能评级**: 未知"),check8:Q.includes("📈 **策略代码已生成并通过验证**"),check9:Q.includes("您可以在策略管理页面查看和使用生成的策略")},lengths:{original:($==null?void 0:$.length)||0,filtered:Q.length,difference:(($==null?void 0:$.length)||0)-Q.length}}),Q.includes("策略")&&!f&&console.warn("⚠️ [StrategyDetection] 检测到策略相关消息但未匹配成功条件:",{content:Q,reason:"可能需要添加更多匹配条件"})),D==="assistant"){const I=Ku(Q);if(I)return e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm",children:Q}),e.jsx(Uu,{result:I})]})}return D==="assistant"&&Q.includes("```")?e.jsx("div",{className:"space-y-2",children:Q.split(/```[\s\S]*?```/g).map((I,ue,Ce)=>{const Pe=Q.match(/```[\s\S]*?```/g)||[],Fs=ue<Pe.length;return e.jsxs(ze.Fragment,{children:[I&&e.jsx("div",{children:I}),Fs&&e.jsxs("div",{className:"bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm overflow-x-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"策略代码"}),e.jsx("button",{onClick:()=>{const ys=Pe[ue].replace(/```(?:python)?\s*/,"").replace(/\s*```$/,"");navigator.clipboard.writeText(ys),E.success("代码已复制到剪贴板")},className:"text-xs text-blue-400 hover:text-blue-300",children:"复制代码"})]}),e.jsx("pre",{className:"whitespace-pre-wrap",children:Pe[ue].replace(/```(?:python)?\s*/,"").replace(/\s*```$/,"")})]})]},ue)})}):f?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:"flex-1",children:Q}),e.jsxs("button",{onClick:async()=>{try{const I=await Fe.getLatestAIStrategy((n==null?void 0:n.session_id)||"");if(I){const ue={id:`strategy_${I.strategy_id}`,version:I.strategy_id,code:I.code,messageIndex:A,timestamp:new Date,title:I.name,description:I.description||"策略生成成功"};gt({isOpen:!0,selectedVersion:ue})}}catch(I){console.error("获取策略信息失败:",I),E.error("获取策略信息失败")}},className:"ml-2 flex-shrink-0 inline-flex items-center gap-1 px-2 py-1 text-xs bg-green-100 text-green-700 rounded-full hover:bg-green-200 transition-colors",title:"点击查看策略代码",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})}),"代码"]})]})}):Q}catch(J){return console.error("Error filtering message content:",J),"[消息显示错误]"}})()}),e.jsx("div",{className:`text-xs mt-1 ${D==="user"?"text-blue-100":"text-gray-400"}`,children:(()=>{try{return new Date(O).toLocaleTimeString()}catch{return new Date().toLocaleTimeString()}})()})]})})},`msg-${A}-${O}`)}).filter(Boolean),c&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200 rounded-lg px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-emerald-500 via-teal-500 to-cyan-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"T"})}),e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-cyan-400 animate-ping"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-full animate-bounce"}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-full animate-bounce",style:{animationDelay:"0.15s"}}),e.jsx("div",{className:"w-1.5 h-1.5 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-full animate-bounce",style:{animationDelay:"0.3s"}})]}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Trademe助手正在思考"})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"分析中...请稍候"})]})]})})})]})}),ce.isRunning&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full animate-pulse"}),e.jsx("h3",{className:"font-medium text-blue-900",children:"回测执行中"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("span",{className:"text-sm text-blue-600 font-medium",children:[ce.progress,"%"]}),e.jsx("button",{onClick:()=>Ae(h=>({...h,detailsExpanded:!h.detailsExpanded})),className:"text-blue-600 hover:text-blue-800 transition-colors",title:ce.detailsExpanded?"收起详情":"展开详情",children:e.jsx("svg",{className:`w-4 h-4 transform transition-transform duration-200 ${ce.detailsExpanded?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2 mb-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-indigo-600 h-2 rounded-full transition-all duration-300 ease-out",style:{width:`${ce.progress}%`}})}),ce.currentStep&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-blue-700 mb-2",children:[e.jsx("svg",{className:"w-4 h-4 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a7.646 7.646 0 110 15.292"})}),e.jsx("span",{children:ce.currentStep})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-blue-600",children:[e.jsxs("span",{children:["预计剩余时间: ",qu(ce.estimatedRemainingSeconds)]}),e.jsx("span",{children:new Date().toLocaleTimeString()})]}),ce.detailsExpanded&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"执行日志"}),e.jsx("div",{className:"bg-gray-900 text-green-400 rounded-lg p-3 font-mono text-xs max-h-32 overflow-y-auto",children:ce.executionLogs&&ce.executionLogs.length>0?ce.executionLogs.map((h,A)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"text-gray-500",children:["[",new Date().toLocaleTimeString(),"]"]})," ",h]},A)):e.jsx("div",{className:"text-gray-500",children:"等待执行日志..."})})]})]})}),ce.results&&F.phase==="analysis"&&e.jsx("div",{className:"px-4 pb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full"}),e.jsx("h3",{className:"font-medium text-green-900",children:"✅ 回测完成"}),e.jsxs("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs rounded-full font-medium",children:[ce.results.totalTrades||0,"笔交易"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>Ae(h=>({...h,detailsExpanded:!h.detailsExpanded})),className:"text-green-600 hover:text-green-800 transition-colors text-sm",title:ce.detailsExpanded?"收起详情":"查看详情",children:e.jsx("svg",{className:`w-4 h-4 transform transition-transform duration-200 ${ce.detailsExpanded?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),e.jsxs("button",{onClick:async()=>{const h=ce.results,A=`📊 **回测分析请求**

回测已完成，请帮我详细分析以下结果：

**关键指标**：
• 总收益率: +${h.totalReturn}%
• 夏普比率: ${h.sharpeRatio}
• 最大回撤: -${h.maxDrawdown}%
• 胜率: ${h.winRate}%
• 交易次数: ${h.totalTrades}次
• 盈亏比: ${h.profitFactor}
• 平均盈利: +${h.avgWin}%
• 平均亏损: -${h.avgLoss}%

**分析要求**：
1. 评估策略表现的优缺点
2. 识别风险管理问题
3. 提供具体的优化建议
4. 建议参数调整方向

如果您认为策略需要优化，请直接提供改进方案。我将根据您的建议决定是否进行策略优化。`;me($=>({...$,phase:"analysis",backtestResults:h})),await g(A)||ge(A)},className:"flex items-center space-x-1 px-3 py-1 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("span",{children:"AI智能分析"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 text-center border border-green-100",children:[e.jsx("div",{className:"text-xs font-medium text-green-600 mb-1",children:"总收益率"}),e.jsxs("div",{className:`text-lg font-bold ${parseFloat(ce.results.totalReturn)>=0?"text-green-600":"text-red-600"}`,children:[parseFloat(ce.results.totalReturn)>=0?"+":"",ce.results.totalReturn||0,"%"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 text-center border border-green-100",children:[e.jsx("div",{className:"text-xs font-medium text-green-600 mb-1",children:"夏普比率"}),e.jsx("div",{className:`text-lg font-bold ${parseFloat(ce.results.sharpeRatio)>=1.5?"text-green-600":parseFloat(ce.results.sharpeRatio)>=1?"text-yellow-600":"text-red-600"}`,children:ce.results.sharpeRatio||0})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 text-center border border-green-100",children:[e.jsx("div",{className:"text-xs font-medium text-green-600 mb-1",children:"最大回撤"}),e.jsxs("div",{className:`text-lg font-bold ${parseFloat(ce.results.maxDrawdown)<=10?"text-green-600":parseFloat(ce.results.maxDrawdown)<=20?"text-yellow-600":"text-red-600"}`,children:["-",ce.results.maxDrawdown||0,"%"]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-3 text-center border border-green-100",children:[e.jsx("div",{className:"text-xs font-medium text-green-600 mb-1",children:"胜率"}),e.jsxs("div",{className:`text-lg font-bold ${parseFloat(ce.results.winRate)>=60?"text-green-600":parseFloat(ce.results.winRate)>=50?"text-yellow-600":"text-red-600"}`,children:[ce.results.winRate||0,"%"]})]})]}),ce.detailsExpanded&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-green-200 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"bg-white rounded p-2 border border-green-100",children:[e.jsx("div",{className:"text-xs text-green-600 mb-1",children:"交易次数"}),e.jsxs("div",{className:"font-bold text-gray-800",children:[ce.results.totalTrades||0,"次"]})]}),e.jsxs("div",{className:"bg-white rounded p-2 border border-green-100",children:[e.jsx("div",{className:"text-xs text-green-600 mb-1",children:"盈亏比"}),e.jsx("div",{className:"font-bold text-gray-800",children:ce.results.profitFactor||0})]}),e.jsxs("div",{className:"bg-white rounded p-2 border border-green-100",children:[e.jsx("div",{className:"text-xs text-green-600 mb-1",children:"平均盈利"}),e.jsxs("div",{className:"font-bold text-green-600",children:["+",ce.results.avgWin||0,"%"]})]}),e.jsxs("div",{className:"bg-white rounded p-2 border border-green-100",children:[e.jsx("div",{className:"text-xs text-green-600 mb-1",children:"平均亏损"}),e.jsxs("div",{className:"font-bold text-red-600",children:["-",ce.results.avgLoss||0,"%"]})]})]}),ce.executionLogs&&ce.executionLogs.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-green-800 mb-2",children:"📋 执行日志"}),e.jsx("div",{className:"bg-gray-900 text-green-400 rounded-lg p-3 font-mono text-xs max-h-32 overflow-y-auto",children:ce.executionLogs.map((h,A)=>e.jsxs("div",{className:"mb-1",children:[e.jsxs("span",{className:"text-gray-500",children:["[",new Date().toLocaleTimeString(),"]"]})," ",h]},A))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:[e.jsxs("button",{className:"flex items-center space-x-1 px-3 py-1.5 bg-blue-100 text-blue-700 text-xs rounded-lg hover:bg-blue-200 transition-colors",onClick:()=>{E("导出功能开发中...")},children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{children:"导出报告"})]}),e.jsxs("button",{className:"flex items-center space-x-1 px-3 py-1.5 bg-purple-100 text-purple-700 text-xs rounded-lg hover:bg-purple-200 transition-colors",onClick:()=>{E("交易明细功能开发中...")},children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("span",{children:"交易明细"})]}),e.jsxs("button",{className:"flex items-center space-x-1 px-3 py-1.5 bg-indigo-100 text-indigo-700 text-xs rounded-lg hover:bg-indigo-200 transition-colors",onClick:()=>{E("图表功能开发中...")},children:[e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("span",{children:"可视化图表"})]})]})]})]})}),e.jsxs("div",{className:"px-4 py-2 border-t border-gray-100 bg-gray-50",children:[F.phase!=="discussion"&&e.jsx("div",{className:"mb-3 p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full flex items-center justify-center",children:[F.phase==="development_confirmed"&&"🤝",F.phase==="developing"&&"🔄",F.phase==="strategy_ready"&&"✅",F.phase==="ready_for_backtest"&&"🚀",F.phase==="backtesting"&&"📊",F.phase==="backtest_completed"&&"📈",F.phase==="analysis_requested"&&"🔍",F.phase==="analyzing_results"&&"🤖",F.phase==="optimization_suggested"&&"💡",F.phase==="modification_confirmed"&&"🔧"]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-blue-900",children:[F.phase==="development_confirmed"&&"开发确认阶段",F.phase==="developing"&&"策略开发中",F.phase==="strategy_ready"&&"策略就绪",F.phase==="ready_for_backtest"&&"就绪待回测",F.phase==="backtesting"&&"回测执行中",F.phase==="backtest_completed"&&"回测完成",F.phase==="analysis_requested"&&"等待分析确认",F.phase==="analyzing_results"&&"AI分析中",F.phase==="optimization_suggested"&&"优化建议就绪",F.phase==="modification_confirmed"&&"策略修改中"]}),e.jsxs("p",{className:"text-xs text-blue-600 mt-0.5",children:[F.optimizationCount&&F.optimizationCount>0&&`第${F.optimizationCount}轮优化 • `,"策略ID: ",F.strategyId||"生成中..."]})]})]}),e.jsx("div",{className:"text-xs text-blue-500",children:F.currentSession&&`会话: ${F.currentSession.slice(-8)}`})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[F.phase==="analysis"&&e.jsxs("button",{onClick:async()=>{const h=`🔄 **策略优化请求**

基于刚才的回测分析，我希望对策略进行优化改进。

**优化要求**：
1. 请根据您刚才提出的建议修改策略代码
2. 重点关注风险管理和收益率提升
3. 保持策略的核心逻辑不变，主要优化参数和细节
4. 提供优化后的完整策略代码

优化完成后，我将进行新的回测来验证改进效果。`;me(D=>({...D,phase:"optimization"})),await g(h)||ge(h)},className:"flex items-center space-x-2 px-3 py-1.5 bg-white border border-orange-300 rounded-lg text-sm text-orange-600 hover:bg-orange-50 hover:border-orange-400 transition-colors shadow-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"优化策略"})]}),(F.phase==="ready_for_backtest"||F.phase==="backtesting"||F.phase==="analysis"||F.phase==="optimization")&&e.jsxs("button",{onClick:async()=>{if(!n){E.error("请先选择会话");return}const h=(n==null?void 0:n.session_type)==="indicator",A=h?"指标":"策略",D=h?"指标库":"策略库",$=F.strategyId;if(!$){E.error(`未找到${A}ID`);return}let O=`AI生成的${A}_${Date.now()}`;const V=i.slice().reverse().find(ee=>ee.role==="assistant");if(V){const ee=V.content.match(/(?:策略|指标)名称[:：]\s*([^\n]+)/i);ee&&(O=ee[1].trim())}try{E.loading(`正在保存${A}到${D}...`);const ee=await rt.createStrategyFromAI({name:O,description:`从AI会话生成的${A}`,code:`// Strategy ID: ${$}`,parameters:{},strategy_type:h?"indicator":"strategy",ai_session_id:n.session_id});ee&&ee.id&&(console.log("✅ [AIChatPage] 策略保存成功，更新策略状态使用真实ID:",ee.id),me(J=>({...J,strategyId:String(ee.id)}))),E.dismiss(),E.success(`${A}已成功添加到${D}`)}catch(ee){E.dismiss(),console.error("保存策略/指标失败:",ee),E.error(`保存失败: ${ee.message||"未知错误"}`)}},className:"flex items-center space-x-2 px-3 py-1.5 bg-white border border-green-300 rounded-lg text-sm text-green-600 hover:bg-green-50 hover:border-green-400 transition-colors shadow-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:(n==null?void 0:n.session_type)==="indicator"?"保存指标":"保存策略"})]}),(F.phase==="ready_for_backtest"||F.phase==="backtesting"||F.phase==="analysis"||F.phase==="optimization")&&e.jsxs("button",{onClick:()=>{F.strategyId?te(!0):ge("请先完成策略开发，然后再进行回测")},className:"flex items-center space-x-2 px-3 py-1.5 bg-white border border-blue-300 rounded-lg text-sm text-blue-600 hover:bg-blue-50 hover:border-blue-400 transition-colors shadow-sm",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("span",{children:"回测策略"})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 bg-white",children:[T.length>0&&e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["已粘贴的图片 (",T.length,")"]}),e.jsx("button",{onClick:()=>Z([]),className:"text-xs text-red-500 hover:text-red-700",children:"清除全部"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:T.map((h,A)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center border overflow-hidden",children:e.jsx("img",{src:URL.createObjectURL(h),alt:`粘贴图片 ${A+1}`,className:"w-full h-full object-cover",onLoad:D=>URL.revokeObjectURL(D.target.src)})}),e.jsx("button",{onClick:()=>it(A),className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white rounded-full text-xs opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:"×"}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 text-center truncate w-16",children:h.name.split(".")[0]})]},A))})]}),e.jsxs("form",{onSubmit:Me,className:"flex space-x-3",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:Y,onChange:h=>ge(h.target.value),onPaste:Ve,placeholder:T.length>0?"添加描述文字（可选）...":"与Trademe助手对话，支持直接粘贴图片...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent",disabled:c}),T.length>0&&e.jsxs("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-cyan-100 text-cyan-600 px-2 py-1 rounded text-xs",children:["📷 ",T.length]})]}),e.jsx("button",{type:"submit",disabled:!Y.trim()&&T.length===0||c,className:"px-4 py-2 bg-gradient-to-r from-emerald-500 to-cyan-500 text-white rounded-lg hover:from-emerald-600 hover:to-cyan-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:c?"发送中":T.length>0?`发送 📷${T.length}`:"发送"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-400 text-center",children:"💡 提示：直接粘贴图片到输入框即可上传分析"})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:"🤖"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Trademe助手"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"选择或创建对话开始智能交流"}),e.jsx("button",{onClick:()=>re(!0),className:"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"创建新对话"})]})})}),e.jsx(em,{isOpen:U,onClose:()=>re(!1),onCreateSession:de,aiMode:"trader"}),e.jsx(sm,{isOpen:X,onClose:()=>te(!1),strategyVersions:Ke,onOpenStrategyModal:h=>{Ut(A=>({...A,selectedVersion:h})),ie(!0)},onSubmit:async h=>{var D,$,O,V,ee;const A=()=>{const J=[{progress:10,step:"加载策略代码...",logs:["📄 读取策略文件...","✅ 策略代码验证通过","🔍 检查策略依赖项..."]},{progress:25,step:"下载历史数据...",logs:[`📊 连接${h.exchange}交易所...`,`📥 下载${h.symbols.join(", ")}数据...`,"⏰ 数据时间范围验证..."]},{progress:45,step:"执行回测逻辑...",logs:["🧮 初始化交易引擎...","📈 开始模拟交易...","⚡ 处理交易信号..."]},{progress:70,step:"计算性能指标...",logs:["📊 计算收益率...","📉 分析回撤风险...","🎯 评估策略表现..."]},{progress:90,step:"生成分析报告...",logs:["📋 汇总交易记录...","📈 生成图表数据...","💡 准备优化建议..."]},{progress:100,step:"回测完成！",logs:["✅ 回测执行完成","📊 结果数据已保存","🎉 等待用户查看..."]}];let Q=0;const f=setInterval(()=>{if(Q<J.length){const I=J[Q];Ae(ue=>({...ue,progress:I.progress,currentStep:I.step,executionLogs:[...ue.executionLogs||[],...I.logs]})),Q++}else clearInterval(f),setTimeout(()=>{const I={totalReturn:(Math.random()*50+10).toFixed(2),sharpeRatio:(Math.random()*2+.5).toFixed(2),maxDrawdown:(Math.random()*20+5).toFixed(2),winRate:(Math.random()*40+40).toFixed(0),totalTrades:Math.floor(Math.random()*200+50),profitFactor:(Math.random()*2+1).toFixed(2),avgWin:(Math.random()*3+1).toFixed(2),avgLoss:(Math.random()*2+.5).toFixed(2)};Ae(ue=>({...ue,isRunning:!1,results:I,executionLogs:[...ue.executionLogs||[],`🎯 总收益率: +${I.totalReturn}%`,`⚡ 夏普比率: ${I.sharpeRatio}`,`📉 最大回撤: -${I.maxDrawdown}%`,`🎲 胜率: ${I.winRate}%`,`📈 交易次数: ${I.totalTrades}次`,"✅ 回测分析完成！"]})),me(ue=>({...ue,phase:"analysis"})),E.success("🎉 回测完成！您可以查看结果并请求AI分析",{duration:4e3})},1e3)},3e3)};try{const Q=await(async()=>{try{if(!(n!=null&&n.session_id))return console.warn("⚠️ 没有当前会话ID，无法获取策略代码"),"# 错误：没有找到会话ID";console.log("🔍 从API获取策略代码，会话ID:",n.session_id);const je=(await G.get(`/strategies/latest-ai-strategy/${n.session_id}`)).data;return!je||!je.code?(console.warn("⚠️ API未返回策略代码"),"# 错误：未找到策略代码"):(console.log("✅ 成功获取策略代码，长度:",je.code.length,"字符"),console.log("📄 策略名称:",je.name),je.code)}catch(Qe){console.error("❌ 获取策略代码失败:",Qe),console.log("🔄 API失败，尝试从消息历史中提取...");for(let je=i.length-1;je>=0;je--){const ut=i[je];if(ut.role==="assistant"){const bs=jl(ut.content);if(bs)return console.log("🎯 从消息中找到策略代码，长度:",bs.length,"字符"),bs}}return F.strategyId?`# 策略ID: ${F.strategyId}
# API获取失败，请重新生成策略
# 错误: ${Qe.message}`:"# 错误：无法获取策略代码"}})(),f=(Qe,je,ut)=>Qe.map(bs=>ut==="okx"&&je==="perpetual"?bs.replace("/","-")+"-SWAP":bs),I={strategy_code:Q,exchange:h.exchange,product_type:h.productType,symbols:f(h.symbols,h.productType,h.exchange),timeframes:h.timeframes,fee_rate:h.feeRate,initial_capital:h.initialCapital,start_date:h.startDate,end_date:h.endDate,data_type:h.dataType};console.log("🔍 DEBUG: Using tradingServiceClient for backtest request"),console.log("🔍 DEBUG: Request payload:",JSON.stringify(I,null,2)),console.log("🔧 [VERSION-1925-FINAL-FIX-V3] 发送回测请求...");const Pe=(await G.post("/realtime-backtest/start",I)).data.task_id;console.log("🔧 [VERSION-1925-ULTIMATE-FIX] API请求成功，taskId:",Pe),me(Qe=>({...Qe,phase:"backtesting"})),Ae({isRunning:!0,progress:0,currentStep:"准备回测环境...",detailsExpanded:!1,executionLogs:["🚀 回测任务已启动...","⚙️ 初始化回测环境..."]});const Fs=window.location.protocol==="https:"?"wss:":"ws:",ys=window.location.host;let mr=null;const zs=localStorage.getItem("auth-storage");if(zs)try{const Qe=JSON.parse(zs);mr=((D=Qe.state)==null?void 0:D.token)||Qe.token}catch(Qe){console.error("解析认证数据失败:",Qe)}const Ka=`${Fs}//${ys}/api/v1/realtime-backtest/ws/${Pe}?token=${encodeURIComponent(mr||"")}`;console.log("🔍 DEBUG: WebSocket URL (token masked):",Ka.replace(/token=[^&]+/,"token=***"));const hr=new WebSocket(Ka);hr.onmessage=Qe=>{try{const je=JSON.parse(Qe.data);if(je.type==="auth_success"){console.log("✅ WebSocket认证成功:",je.message),E.success("实时进度连接已建立");return}if(je.error){console.error("WebSocket错误:",je.error,"Code:",je.code),je.code===4001?E.error("认证超时，请重新登录"):je.code===4003?E.error("缺少认证信息"):je.code===4004?je.error.includes("回测任务不存在")?E.error("回测任务不存在或已过期"):E.error("认证失败，请重新登录"):E.error(`连接错误: ${je.error}`),je.code>=4001&&je.code<=4005&&A();return}if(je.type==="task_finished"){console.log("📋 回测任务完成:",je.final_status);return}Ae(ut=>({...ut,progress:je.progress||ut.progress,currentStep:je.current_step||je.currentStep||ut.currentStep,executionLogs:je.logs||ut.executionLogs,estimatedRemainingSeconds:je.estimated_remaining_seconds||je.estimatedRemainingSeconds})),je.status==="completed"&&je.results&&(Ae(ut=>({...ut,isRunning:!1,results:je.results})),me(ut=>({...ut,phase:"analysis"})),E.success("🎉 回测完成！您可以查看结果并请求AI分析",{duration:4e3}),hr.close())}catch(je){console.error("解析WebSocket消息失败:",je)}},hr.onerror=Qe=>{console.error("WebSocket连接错误:",Qe),E.error("实时进度连接失败，将使用模拟进度"),A()},hr.onclose=()=>{console.log("WebSocket连接已关闭")};const gm=`🚀 正在执行回测分析...

**回测配置**：
• 交易所：${h.exchange}
• 品种类型：${h.productType}
• 交易品种：${h.symbols.join(", ")} ${h.exchange==="okx"&&h.productType==="perpetual"?"(已转换为OKX永续合约格式)":""}
• 时间周期：${h.timeframes.join(", ")}
• 数据类型：${h.dataType==="tick"?"Tick数据回测（高精度）":"K线数据回测（标准）"}
• 手续费率：${h.feeRate}
• 初始资金：${h.initialCapital} USDT
• 回测时间：${h.startDate} 至 ${h.endDate}

回测正在后台执行中，您可以在下方查看实时进度。回测完成后，我将为您详细分析结果并提供优化建议。`;console.log("🔧 [VERSION-1925-FINAL-FIX-V3] 添加成功消息并启动进度监控"),te(!1),A()}catch(J){console.error("🔧 [VERSION-1925-FINAL-FIX-V4] 启动实时回测失败:",J);const Q=J.response&&(J.response.status===400||J.response.status===422)||J.code===400||J.code===422||J.type==="validation"&&J.code===400;if(console.log("🔧 [VERSION-1925-FINAL-FIX-V4] 错误类型检测:",{isValidationError:Q,errorType:J.type,errorCode:J.code,responseStatus:($=J.response)==null?void 0:$.status,fullError:J}),Q){const f=((V=(O=J.response)==null?void 0:O.data)==null?void 0:V.detail)||((ee=J.details)==null?void 0:ee.message)||J.message||"数据验证失败";console.log("🔧 [VERSION-1925-FINAL-FIX-V4] 验证错误处理 - 只关闭弹窗，绝不启动任何回测逻辑:",f),E.error(f,{duration:5e3}),te(!1);return}console.log("🔧 [VERSION-1925-FINAL-FIX-V4] 非验证错误，启动模拟模式"),E.error("回测启动失败，将使用模拟模式"),te(!1),A()}}}),e.jsx(ei,{isOpen:R,onClose:()=>ie(!1),strategyVersion:Ke.versions.find(h=>h.id===Ke.selectedVersion)||null}),e.jsx(ei,{isOpen:kt.isOpen,onClose:()=>gt({isOpen:!1,selectedVersion:null}),strategyVersion:kt.selectedVersion})]})},sm=({isOpen:s,onClose:t,onSubmit:r,strategyVersions:a,onOpenStrategyModal:n})=>{const{user:i}=is(),[l,o]=y.useState(!1),[c,d]=y.useState({exchange:"binance",productType:"spot",symbols:["BTC/USDT"],timeframes:["1h"],feeRate:"vip0",initialCapital:1e4,startDate:new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],dataType:"kline"}),u=[{value:"binance",label:"币安 (Binance)"},{value:"okx",label:"OKX"},{value:"huobi",label:"火币 (Huobi)"},{value:"bybit",label:"Bybit"}],m=[{value:"spot",label:"现货"},{value:"perpetual",label:"永续合约"},{value:"delivery",label:"交割合约"}],k=[{value:"1m",label:"1分钟"},{value:"5m",label:"5分钟"},{value:"15m",label:"15分钟"},{value:"30m",label:"30分钟"},{value:"1h",label:"1小时"},{value:"4h",label:"4小时"},{value:"1d",label:"1天"}],x={spot:[{value:"vip0",label:"VIP0 现货 (0.1%/0.1%)"},{value:"vip1",label:"VIP1 现货 (0.09%/0.09%)"},{value:"vip2",label:"VIP2 现货 (0.08%/0.08%)"},{value:"vip3",label:"VIP3 现货 (0.07%/0.07%)"},{value:"vip4",label:"VIP4 现货 (0.06%/0.06%)"}],perpetual:[{value:"vip0_perp",label:"VIP0 合约 (0.02%/0.04%)"},{value:"vip1_perp",label:"VIP1 合约 (0.016%/0.04%)"},{value:"vip2_perp",label:"VIP2 合约 (0.012%/0.035%)"},{value:"vip3_perp",label:"VIP3 合约 (0.008%/0.03%)"},{value:"vip4_perp",label:"VIP4 合约 (0.004%/0.025%)"}],delivery:[{value:"vip0_delivery",label:"VIP0 交割 (0.02%/0.05%)"},{value:"vip1_delivery",label:"VIP1 交割 (0.016%/0.045%)"},{value:"vip2_delivery",label:"VIP2 交割 (0.012%/0.04%)"},{value:"vip3_delivery",label:"VIP3 交割 (0.008%/0.035%)"},{value:"vip4_delivery",label:"VIP4 交割 (0.004%/0.03%)"}]},b=()=>x[c.productType]||x.spot,g={spot:"vip0",perpetual:"vip0_perp",delivery:"vip0_delivery"},w=["BTC/USDT","ETH/USDT","BNB/USDT","ADA/USDT","DOT/USDT","SOL/USDT","MATIC/USDT","LINK/USDT","UNI/USDT","LTC/USDT"],v=p=>{d(S=>({...S,symbols:S.symbols.includes(p)?S.symbols.filter(_=>_!==p):[...S.symbols,p]}))},L=p=>{d(S=>({...S,timeframes:S.timeframes.includes(p)?S.timeframes.filter(_=>_!==p):[...S.timeframes,p]}))},C=()=>{var S;switch((S=i==null?void 0:i.membership_level)==null?void 0:S.toLowerCase()){case"premium":return 30;case"professional":return 100;default:return 0}},M=()=>{var p;return((p=i==null?void 0:i.membership_level)==null?void 0:p.toLowerCase())==="basic"},j=async()=>{if(c.symbols.length===0){alert("请至少选择一个交易品种");return}if(c.timeframes.length===0){alert("请至少选择一个时间周期");return}if(c.dataType==="tick"&&M()){alert("Tick数据回测需要高级版或专业版会员");return}o(!0);try{await r(c)}catch(p){console.error("回测配置提交失败:",p)}finally{o(!1)}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"回测参数配置"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"交易所"}),e.jsx("select",{value:c.exchange,onChange:p=>d(S=>({...S,exchange:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:u.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"品种类型"}),e.jsx("select",{value:c.productType,onChange:p=>{const S=p.target.value,_=g[S];d(U=>({...U,productType:S,feeRate:_})),console.log(`💰 [BacktestConfig] 产品类型切换: ${S}, 自动调整手续费率: ${_}`)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:m.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["数据类型",c.dataType==="tick"&&!M()&&e.jsxs("span",{className:"text-xs text-orange-600 ml-2",children:["(本月剩余 ",C()," 次)"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:"kline",checked:c.dataType==="kline",onChange:p=>d(S=>({...S,dataType:p.target.value})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),e.jsxs("span",{className:"ml-3 text-sm",children:["K线数据回测",e.jsx("span",{className:"text-gray-500",children:"(标准精度，免费)"})]})]}),e.jsxs("label",{className:`flex items-center ${M()?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("input",{type:"radio",value:"tick",checked:c.dataType==="tick",onChange:p=>!M()&&d(S=>({...S,dataType:p.target.value})),disabled:M(),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 disabled:opacity-50"}),e.jsxs("span",{className:"ml-3 text-sm",children:["Tick数据回测",e.jsxs("span",{className:"text-gray-500",children:["(最高精度，",M()?"需要高级版":`每月${C()}次`,")"]}),M()&&e.jsx("span",{className:"ml-2 px-2 py-0.5 bg-orange-100 text-orange-700 text-xs rounded",children:"升级解锁"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["手续费率等级",e.jsxs("span",{className:"text-sm font-normal text-gray-500 ml-2",children:["(",c.productType==="spot"?"现货":c.productType==="perpetual"?"永续合约":"交割合约","专用费率)"]})]}),e.jsx("select",{value:c.feeRate,onChange:p=>d(S=>({...S,feeRate:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:b().map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:c.productType==="spot"?"💡 现货交易：Maker费率/Taker费率":"💡 合约交易：Maker费率/Taker费率，通常更低"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"初始资金 (USDT)"}),e.jsx("input",{type:"number",value:c.initialCapital,onChange:p=>d(S=>({...S,initialCapital:Number(p.target.value)})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"100",step:"100"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"回测时间期间"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 mb-4",children:[{label:"1个月",months:1},{label:"3个月",months:3},{label:"6个月",months:6},{label:"1年",months:12}].map(({label:p,months:S})=>e.jsx("button",{type:"button",onClick:()=>{const _=new Date,U=new Date(_);U.setMonth(_.getMonth()-S),d(re=>({...re,startDate:U.toISOString().split("T")[0],endDate:_.toISOString().split("T")[0]}))},className:"px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",children:p},S))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"开始时间"}),e.jsx("input",{type:"date",value:c.startDate,onChange:p=>d(S=>({...S,startDate:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"结束时间"}),e.jsx("input",{type:"date",value:c.endDate,onChange:p=>d(S=>({...S,endDate:p.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(()=>{const p=new Date(c.startDate),S=new Date(c.endDate),_=Math.floor((S.getTime()-p.getTime())/(1e3*60*60*24));return p>=S?e.jsxs("div",{className:"flex items-center text-red-600 text-sm",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"请确保结束时间晚于开始时间"]}):_>0?e.jsxs("div",{className:"flex items-center text-green-600 text-sm",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"回测期间：",_," 天 (",Math.floor(_/30)," 个月 ",_%30," 天)"]}):null})()]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["交易品种 (已选择 ",c.symbols.length," 个)"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:w.map(p=>e.jsx("button",{onClick:()=>v(p),className:`px-3 py-2 text-sm rounded-md border transition-colors ${c.symbols.includes(p)?"bg-blue-50 border-blue-300 text-blue-700":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:p},p))})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["时间周期 (已选择 ",c.timeframes.length," 个)"]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-7 gap-2",children:k.map(p=>e.jsx("button",{onClick:()=>L(p.value),className:`px-3 py-2 text-sm rounded-md border transition-colors ${c.timeframes.includes(p.value)?"bg-green-50 border-green-300 text-green-700":"bg-white border-gray-300 text-gray-600 hover:bg-gray-50"}`,children:p.label},p.value))})]}),a.versions.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:["策略版本选择 (",a.versions.length," 个版本可用)"]}),e.jsx("div",{className:"space-y-2",children:a.versions.map((p,S)=>e.jsx("div",{className:`border rounded-lg p-3 cursor-pointer transition-colors ${c.selectedStrategyVersion===p.id?"border-blue-500 bg-blue-50":"border-gray-300 bg-white hover:border-gray-400 hover:bg-gray-50"}`,onClick:()=>d(_=>({..._,selectedStrategyVersion:p.id})),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${c.selectedStrategyVersion===p.id?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"}`,children:["V",p.version]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:p.title}),e.jsx("div",{className:"text-sm text-gray-500",children:p.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs text-gray-400",children:p.timestamp.toLocaleString()}),e.jsx("button",{onClick:_=>{_.stopPropagation(),n(p.id)},className:"text-blue-600 hover:text-blue-800 text-sm underline",children:"查看代码"})]})]})},p.id))}),!c.selectedStrategyVersion&&a.versions.length>0&&e.jsxs("div",{className:"mt-2 text-sm text-amber-600 flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),"请选择一个策略版本进行回测"]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200",children:[e.jsx("button",{onClick:t,disabled:l,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"取消"}),e.jsx("button",{onClick:j,disabled:l,className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:l?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"正在发送..."})]}):"开始回测分析"})]})]})})}):null},ei=({isOpen:s,onClose:t,strategyVersion:r})=>{if(!s||!r)return null;const a=()=>{navigator.clipboard.writeText(r.code),E.success("策略代码已复制到剪贴板",{icon:"📋"})};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-sm font-bold",children:["V",r.version]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r.title}),e.jsx("p",{className:"text-sm text-gray-500",children:r.description})]})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["创建时间: ",r.timestamp.toLocaleString()]}),e.jsxs("span",{children:["代码长度: ",r.code.length," 字符"]})]}),e.jsxs("button",{onClick:a,className:"flex items-center space-x-2 px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-md text-sm text-gray-700 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),e.jsx("span",{children:"复制代码"})]})]}),e.jsx("div",{className:"bg-gray-900 rounded-lg overflow-hidden",children:e.jsx("pre",{className:"p-4 text-sm text-gray-100 overflow-auto max-h-96 scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",children:e.jsx("code",{className:"language-python",children:r.code})})})]}),e.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"关闭"})})]})})},br=()=>{try{const s=localStorage.getItem("auth-storage");if(s){const{state:t}=JSON.parse(s);return(t==null?void 0:t.token)||null}}catch(s){console.error("Failed to parse auth data:",s)}return null},ti=()=>{const{isPremium:s}=is(),{t}=ns(),[r,a]=y.useState({name:"",exchange:"okx",api_key:"",secret_key:"",passphrase:""}),[n,i]=y.useState([]),[l,o]=y.useState(!1),[c,d]=y.useState(!1),[u,m]=y.useState({}),k=[{value:"okx",label:"OKX",icon:"🟢"},{value:"binance",label:"Binance",icon:"🟡"},{value:"huobi",label:"Huobi",icon:"🔴"},{value:"bybit",label:"Bybit",icon:"🟠"},{value:"kraken",label:"Kraken",icon:"🟣"},{value:"coinbase",label:"Coinbase",icon:"🔵"}],x=async()=>{if(s)try{o(!0);const j=await fetch("/api/v1/api-keys/",{headers:{Authorization:`Bearer ${br()}`}});if(j.ok){let p={api_keys:[]};try{const S=await j.text();p=S?JSON.parse(S):{api_keys:[]}}catch{console.log("Response is not JSON, using empty array")}i(p.api_keys||[])}else{let p="Failed to load API keys";try{const S=await j.text(),_=S?JSON.parse(S):null;p=(_==null?void 0:_.detail)||`HTTP ${j.status}: ${j.statusText}`}catch{p=`HTTP ${j.status}: ${j.statusText}`}throw new Error(p)}}catch(j){console.error("Error loading API keys:",j),E.error("加载API密钥失败")}finally{o(!1)}},b=async j=>{if(j.preventDefault(),!s){E.error("添加API密钥需要高级版本");return}if(!r.api_key||!r.secret_key||!r.name){E.error("请填写完整的信息");return}try{d(!0);const p=await fetch("/api/v1/api-keys/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${br()}`},body:JSON.stringify({name:r.name,exchange:r.exchange,api_key:r.api_key,secret_key:r.secret_key,passphrase:r.passphrase||void 0})});if(p.ok){let S=null;try{const _=await p.text();S=_?JSON.parse(_):{}}catch{console.log("Response is not JSON, treating as success")}E.success("API密钥添加成功"),a({name:"",exchange:"okx",api_key:"",secret_key:"",passphrase:""}),x()}else{let S={detail:"Unknown error"};try{const _=await p.text();S=_?JSON.parse(_):{detail:`HTTP ${p.status}: ${p.statusText}`}}catch{S={detail:`HTTP ${p.status}: ${p.statusText}`}}throw new Error(S.detail||"Failed to add API key")}}catch(p){console.error("Error adding API key:",p),E.error(`添加API密钥失败: ${p instanceof Error?p.message:"未知错误"}`)}finally{d(!1)}},g=async(j,p)=>{if(window.confirm(`确定要删除API密钥 "${p}" 吗？`))try{if((await fetch(`/api/v1/api-keys/${j}`,{method:"DELETE",headers:{Authorization:`Bearer ${br()}`}})).ok)E.success("API密钥删除成功"),x();else throw new Error("Failed to delete API key")}catch(S){console.error("Error deleting API key:",S),E.error("删除API密钥失败")}},w=async(j,p)=>{try{const S=await fetch(`/api/v1/api-keys/${j}/test`,{method:"POST",headers:{Authorization:`Bearer ${br()}`}});if(S.ok){const _=await S.json();E.success(`${p} 连接测试成功`)}else{const _=await S.json();E.error(`${p} 连接测试失败: ${_.detail}`)}}catch(S){console.error("Error testing API key:",S),E.error("连接测试失败")}},v=j=>{m(p=>({...p,[j]:!p[j]}))},L=j=>{switch(j){case"active":return e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"});case"inactive":return e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"});case"error":return e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"});default:return e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})}},C=j=>{switch(j){case"active":return"有效";case"inactive":return"无效";case"error":return"错误";default:return"未知"}},M=()=>{a({name:"OKX测试账户",exchange:"okx",api_key:"76ba9b3a-38b6-4ed3-9ce7-44d603188b13",secret_key:"4021858325F5A3BEC3F64B6D0533E412",passphrase:"Woaiziji..123"}),E("已填充OKX测试数据")};return y.useEffect(()=>{x()},[s]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"API密钥管理"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"管理您的交易所API密钥，确保安全可靠的交易连接"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:s?`高级版最多可添加5个API密钥 (已使用${n.length}/5)`:"升级到高级版以添加API密钥"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-lg p-6 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"新增API密钥"}),e.jsx("button",{onClick:M,className:"text-sm text-blue-600 hover:text-blue-700 font-medium px-3 py-1 rounded-md hover:bg-blue-50 transition-colors",children:"填充测试数据"})]}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"交易所"}),e.jsx("select",{value:r.exchange,onChange:j=>a({...r,exchange:j.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-sm",children:k.map(j=>e.jsxs("option",{value:j.value,children:[j.icon," ",j.label]},j.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API名称"}),e.jsx("input",{type:"text",value:r.name,onChange:j=>a({...r,name:j.target.value}),placeholder:"例如：OKX现货账户",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"公钥 (API KEY)"}),e.jsx("input",{type:"text",value:r.api_key,onChange:j=>a({...r,api_key:j.target.value}),placeholder:"输入API公钥",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm font-mono"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"密钥 (SECRET KEY)"}),e.jsx("input",{type:"password",value:r.secret_key,onChange:j=>a({...r,secret_key:j.target.value}),placeholder:"输入API密钥",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm font-mono"})]}),(r.exchange==="okx"||r.exchange==="bybit")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["密码短语 ",r.exchange==="okx"?"(Passphrase)":"(可选)"]}),e.jsx("input",{type:"password",value:r.passphrase,onChange:j=>a({...r,passphrase:j.target.value}),placeholder:r.exchange==="okx"?"输入Passphrase密码":"输入密码短语(可选)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsx("button",{type:"submit",disabled:!s||c,className:`w-full py-3 rounded-lg font-medium transition-colors ${s?"bg-blue-600 text-white hover:bg-blue-700 disabled:bg-blue-400":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:c?"添加中...":s?"添加API密钥":"升级后可添加"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-lg p-6 backdrop-blur-sm",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"已添加API密钥"}),l?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center animate-spin",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("p",{className:"text-gray-500",children:"加载API密钥中..."})]}):n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(j=>{var p;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:((p=k.find(S=>S.value===j.exchange))==null?void 0:p.icon)||"🔧"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:j.name}),e.jsx("p",{className:"text-sm text-gray-500",children:j.exchange.toUpperCase()})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[L(j.status),e.jsx("span",{className:"text-sm text-gray-600",children:C(j.status)})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"API KEY:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded font-mono",children:u[j.id]?j.api_key:`${j.api_key.slice(0,8)}...${j.api_key.slice(-4)}`}),e.jsx("button",{onClick:()=>v(j.id),className:"text-xs text-blue-600 hover:text-blue-700",children:u[j.id]?"隐藏":"显示"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["权限: ",j.permissions||"交易权限"]}),e.jsxs("span",{children:["添加时间: ",new Date(j.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>w(j.id,j.name),className:"px-3 py-1 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors",children:"测试连接"}),e.jsx("button",{onClick:()=>g(j.id,j.name),className:"px-3 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:"删除"})]})]},j.id)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无API密钥"}),e.jsx("p",{className:"text-gray-500",children:"添加您的第一个交易所API密钥以开始交易"})]})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-5 h-5 text-yellow-600 mt-0.5",children:e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-1",children:"安全提示"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"• API密钥采用安全加密存储，但请确保您的账户安全"}),e.jsx("li",{children:"• 建议为API密钥设置最小必要权限（仅交易权限，禁用提现）"}),e.jsx("li",{children:"• 定期检查API密钥状态，及时更新或删除不用的密钥"}),e.jsx("li",{children:"• 不要在公共场所或他人面前输入API密钥信息"})]})]})]})})]})},vr=[{level:"basic",name:"初级会员",price:19,period:"月",color:"green",description:"入门级功能套餐",highlight:"适合刚开始量化交易的新手用户",features:["AI交易员模式/AI开发者模式","AI交易心得功能","每天使用$20额度的AI助手","绑定1个交易所API KEY","包含1个免费实盘"],benefits:["✅ AI交易员模式","✅ AI开发者模式","✅ AI交易心得功能","✅ 每日$20 AI助手额度","✅ 1个交易所API密钥","✅ 1个免费实盘交易","✅ 基础策略模板库","✅ 邮件技术支持"],limitations:["❌ 无Tick级别数据回测","❌ 多API密钥管理","❌ 大量AI对话额度","❌ 高级策略优化"]},{level:"premium",name:"高级会员",price:99,period:"月",color:"blue",popular:!0,description:"全功能专业套餐",highlight:"热门选择，功能全面且性价比高",features:["初级会员所有功能","每天使用$100额度的AI助手","每月可使用Tick级别数据回测30次","绑定5个API交易所API KEY","包含5个免费实盘"],benefits:["✅ 初级会员所有功能","✅ 每日$100 AI助手额度","✅ 每月30次Tick级别回测","✅ 5个交易所API密钥","✅ 5个免费实盘交易","✅ 高级技术指标","✅ 策略性能分析","✅ 7×24小时技术支持"],limitations:["❌ AI图表交易模式","❌ 企业定制服务","❌ 专属客户经理"]},{level:"professional",name:"专业会员",price:199,period:"月",color:"purple",popular:!1,description:"专业交易者首选",highlight:"专业交易者和机构用户的完整解决方案",features:["高级会员所有功能","AI图表交易模式","每天使用$200额度的AI对话","每月可使用Tick级别数据回测100次","绑定10个交易所API KEY","包含10个免费实盘"],benefits:["✅ 高级会员所有功能","✅ AI图表交易模式","✅ 每日$200 AI对话额度","✅ 每月100次Tick级别回测","✅ 10个交易所API密钥","✅ 10个免费实盘交易","✅ 定制化策略开发","✅ 专属客户经理","✅ 7×24小时VIP支持","✅ 优先技术服务"],limitations:[]}],rm=()=>{var ge;const{user:s}=is(),{token:t,logout:r}=Je(),{t:a}=ns(),n=dt(),[i,l]=y.useState(null),[o,c]=y.useState([]),[d,u]=y.useState(!1),[m,k]=y.useState(!1),[x,b]=y.useState(!1),[g,w]=y.useState(""),v=async()=>{try{u(!0),console.log("🔍 ProfilePage - 获取token:",t?"已获取":"未获取"),console.log("🔍 ProfilePage - API URL:","/api/v1/membership/usage-stats");const T=await fetch("/api/v1/membership/usage-stats",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(console.log("🔍 ProfilePage - 响应状态:",T.status),T.ok){const Z=await T.json();console.log("🔍 ProfilePage - 获取数据成功:",Z),l(Z.data)}else{const Z=await T.text();console.error("🔍 ProfilePage - 请求失败:",T.status,Z),T.status===401?console.warn("Token已过期，需要重新登录"):T.status===500&&console.error("服务器内部错误，请稍后重试")}}catch(T){console.error("Load usage stats error:",T),T instanceof Error&&console.error("网络连接异常:",T.message)}finally{u(!1)}},L=async()=>{if(t)try{k(!0);const T=await fetch("/api/v1/api-keys/",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(T.ok){let Z={api_keys:[]};try{const z=await T.text();Z=z?JSON.parse(z):{api_keys:[]}}catch{console.log("Response is not JSON, using empty array")}const oe=(Z.api_keys||[]).map((z,F)=>({...z,balance:{total:1e4+F*5e3,available:8e3+F*4e3,currency:"USDT"},performance:{total_return:15.6+F*8.2,daily_return:.8+F*.3,win_rate:68.5+F*5.1,created_days:Math.floor(Math.random()*90)+30}}));c(oe)}else console.error("Failed to load API keys:",T.status)}catch(T){console.error("Error loading API keys:",T)}finally{k(!1)}},C=(T,Z)=>{var z;const oe={gray:{bg:"bg-gray-50",text:"text-gray-700",border:"border-gray-200"},blue:{bg:"bg-blue-50",text:"text-blue-700",border:"border-blue-200"},purple:{bg:"bg-purple-50",text:"text-purple-700",border:"border-purple-200"},gold:{bg:"bg-yellow-50",text:"text-yellow-700",border:"border-yellow-200"}};return((z=oe[T])==null?void 0:z[Z])||oe.gray[Z]},M=(T,Z)=>Z===0?0:Math.min(T/Z*100,100),j=()=>vr.find(T=>T.level===(s==null?void 0:s.membership_level))||vr[0],p=T=>{w(T),b(!0)},S=async()=>{try{E.success("支付成功！会员权益已更新"),b(!1),w(""),v()}catch{E.error("支付失败，请重试")}},_=()=>{window.confirm("确定要退出登录吗？")&&(r(),n("/login"))},U=()=>{n("/api-keys")},re=async(T,Z)=>{if(window.confirm(`确定要删除API密钥 "${Z}" 吗？`))try{if((await fetch(`/api/v1/api-keys/${T}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)E.success("API密钥删除成功"),L();else throw new Error("Failed to delete API key")}catch(oe){console.error("Error deleting API key:",oe),E.error("删除API密钥失败")}},X=T=>{switch(T){case"active":return e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"});case"inactive":return e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"});case"error":return e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"});default:return e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full"})}},te=T=>{switch(T){case"active":return"正常";case"inactive":return"无效";case"error":return"错误";default:return"未知"}},R=T=>({okx:"🟢",binance:"🟡",huobi:"🔴",bybit:"🟠",kraken:"🟣",coinbase:"🔵"})[T.toLowerCase()]||"🔧";y.useEffect(()=>{t&&s&&(v(),L())},[t,s]);const ie=j(),Y=vr.find(T=>T.level===g);return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"账户中心"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"管理您的账户信息、会员权益和使用状况"})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:s!=null&&s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"Avatar",className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-2xl font-bold text-white",children:((ge=s==null?void 0:s.username)==null?void 0:ge.charAt(0).toUpperCase())||"U"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:s==null?void 0:s.username}),e.jsx("p",{className:"text-gray-500 mb-4",children:s==null?void 0:s.email}),e.jsxs("div",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${C(ie.color,"bg")} ${C(ie.color,"text")}`,children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732L14.146 12.8l-1.179 4.456a1 1 0 01-1.934 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732L9.854 7.2l1.179-4.456A1 1 0 0112 2z",clipRule:"evenodd"})}),ie.name]}),(s==null?void 0:s.membership_expires_at)&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["到期时间: ",new Date(s.membership_expires_at).toLocaleDateString()]}),e.jsxs("button",{onClick:_,className:"mt-4 w-full py-2 px-4 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center justify-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{children:"退出登录"})]})]})}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"当前套餐权益"}),e.jsx("div",{className:"space-y-2",children:ie.features.map((T,Z)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm text-gray-700",children:T})]},Z))})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"使用情况统计"}),d?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center animate-spin",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("p",{className:"text-gray-500",children:"加载统计数据中..."})]}):i?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"API密钥"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i.api_keys_count,"/",i.api_keys_limit]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${M(i.api_keys_count,i.api_keys_limit)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"今日AI对话"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["$",i.ai_usage_today,"/$",i.ai_daily_limit]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full transition-all duration-300",style:{width:`${M(i.ai_usage_today,i.ai_daily_limit)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"本月Tick回测"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i.tick_backtest_today,"/",i.tick_backtest_limit]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${M(i.tick_backtest_today,i.tick_backtest_limit)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"存储空间"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i.storage_used,"MB/",i.storage_limit,"MB"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-yellow-600 h-2 rounded-full transition-all duration-300",style:{width:`${M(i.storage_used,i.storage_limit)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"指标数量"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i.indicators_count,"/",i.indicators_limit]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${M(i.indicators_count,i.indicators_limit)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"策略数量"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i.strategies_count,"/",i.strategies_limit]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-pink-600 h-2 rounded-full transition-all duration-300",style:{width:`${M(i.strategies_count,i.strategies_limit)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"实盘交易"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i.live_trading_count,"/",i.live_trading_limit]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-600 h-2 rounded-full transition-all duration-300",style:{width:`${M(i.live_trading_count,i.live_trading_limit)}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"K线回测"}),e.jsx("span",{className:"text-sm text-gray-500",children:"无限制"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full w-full"})})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"无法加载统计数据"})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"API密钥管理"}),e.jsx("button",{onClick:U,className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-medium hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg text-sm",children:"+ 添加API密钥"})]}),m?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center animate-spin",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),e.jsx("p",{className:"text-gray-500 text-sm",children:"加载API密钥中..."})]}):o.length>0?e.jsx("div",{className:"space-y-4",children:o.map(T=>{var Z,oe,z,F,me,Se,nt,pe,We,be,ce,Ae;return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-lg",children:R(T.exchange)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:T.name}),e.jsx("p",{className:"text-sm text-gray-500",children:T.exchange.toUpperCase()})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[X(T.status),e.jsx("span",{className:"text-sm text-gray-600",children:te(T.status)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"账户余额"}),e.jsxs("div",{className:"font-semibold text-gray-900",children:[((oe=(Z=T.balance)==null?void 0:Z.total)==null?void 0:oe.toLocaleString())||"0"," ",((z=T.balance)==null?void 0:z.currency)||"USDT"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["可用: ",((me=(F=T.balance)==null?void 0:F.available)==null?void 0:me.toLocaleString())||"0"]})]}),e.jsxs("div",{className:"bg-green-50 rounded-lg p-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"总收益率"}),e.jsxs("div",{className:"font-semibold text-green-600",children:["+",((nt=(Se=T.performance)==null?void 0:Se.total_return)==null?void 0:nt.toFixed(2))||"0.00","%"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["日收益: +",((We=(pe=T.performance)==null?void 0:pe.daily_return)==null?void 0:We.toFixed(2))||"0.00","%"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-3 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-500",children:"胜率"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[((ce=(be=T.performance)==null?void 0:be.win_rate)==null?void 0:ce.toFixed(1))||"0.0","%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-500",children:"运行天数"}),e.jsxs("div",{className:"font-medium text-gray-900",children:[((Ae=T.performance)==null?void 0:Ae.created_days)||"0","天"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-500",children:"创建时间"}),e.jsx("div",{className:"font-medium text-gray-900",children:new Date(T.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>n("/trading"),className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:"查看交易"}),e.jsx("button",{onClick:()=>re(T.id,T.name),className:"px-3 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",children:"删除"})]})]},T.id)})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),e.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无API密钥"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"添加您的第一个交易所API密钥以开始自动交易"}),e.jsx("button",{onClick:U,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"添加API密钥"})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"升级套餐"}),e.jsx("div",{className:"space-y-6",children:vr.map(T=>e.jsxs("div",{className:`relative border-2 rounded-xl p-6 transition-all duration-200 hover:shadow-md ${T.level===(s==null?void 0:s.membership_level)?`${C(T.color,"border")} ${C(T.color,"bg")}`:"border-gray-200 hover:border-gray-300"}`,children:[T.popular&&e.jsx("div",{className:"absolute -top-2 left-6",children:e.jsx("span",{className:"bg-purple-600 text-white text-xs font-medium px-3 py-1 rounded-full",children:"推荐"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"text-center lg:text-left",children:[e.jsx("h4",{className:"text-xl font-bold text-gray-900 mb-2",children:T.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:T.description}),e.jsx("div",{className:"mb-4",children:T.price===0?e.jsx("span",{className:"text-3xl font-bold text-gray-900",children:"免费"}):e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["$",T.price]}),e.jsxs("span",{className:"text-gray-500 text-base",children:["/",T.period]})]})}),e.jsx("p",{className:"text-xs text-gray-500 mb-4 italic",children:T.highlight}),T.level===(s==null?void 0:s.membership_level)?e.jsx("button",{disabled:!0,className:"w-full py-3 px-4 bg-gray-300 text-gray-500 rounded-lg font-medium cursor-not-allowed",children:"当前套餐"}):T.price===0?e.jsx("button",{disabled:!0,className:"w-full py-3 px-4 bg-gray-300 text-gray-500 rounded-lg font-medium cursor-not-allowed",children:"免费套餐"}):e.jsx("button",{onClick:()=>p(T.level),className:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg font-medium hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105 shadow-lg",children:"立即升级"})]})}),e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("h5",{className:"font-semibold text-gray-900 mb-3",children:"核心功能"}),e.jsx("div",{className:"space-y-2",children:T.features.map((Z,oe)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-4 h-4 text-blue-500 mr-2 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-sm text-gray-700 font-medium",children:Z})]},oe))})]})]})]},T.level))}),e.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 mr-2 mt-0.5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"💡 会员计划说明"}),e.jsxs("p",{className:"text-blue-700",children:["• ",e.jsx("strong",{children:"初级会员($19/月)"}),": AI交易员/开发者模式、AI交易心得、每日$20 AI额度、1个API、1个实盘",e.jsx("br",{}),"• ",e.jsx("strong",{children:"高级会员($99/月)"}),": 初级所有功能 + 每日$100 AI额度 + 30次/月Tick回测 + 5个API + 5个实盘",e.jsx("br",{}),"• ",e.jsx("strong",{children:"专业会员($199/月)"}),": 高级所有功能 + AI图表交易模式 + 每日$200 AI额度 + 100次/月Tick回测 + 10个API + 10个实盘",e.jsx("br",{})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"🎯 推荐：初级会员适合新手，高级会员性价比最高，专业会员提供完整解决方案"})]})]})})]})]})]}),x&&Y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900",children:["升级到 ",Y.name]}),e.jsx("button",{onClick:()=>b(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["$",Y.price]}),e.jsxs("p",{className:"text-gray-500",children:["/",Y.period]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"套餐包含："}),e.jsxs("ul",{className:"space-y-1",children:[Y.features.slice(0,3).map((T,Z)=>e.jsxs("li",{className:"text-sm text-gray-600 flex items-start",children:[e.jsx("svg",{className:"w-3 h-3 text-green-500 mr-2 mt-1 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),T]},Z)),Y.features.length>3&&e.jsxs("li",{className:"text-sm text-gray-500",children:["+ ",Y.features.length-3," 项更多权益"]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"USDT收款地址"}),e.jsx("div",{className:"bg-white border border-blue-200 rounded p-3 mb-2",children:e.jsx("code",{className:"text-sm text-gray-800 break-all",children:"TQrZ8ZwgQx4Y9FpN8H3rK7LmVx9Rt2NcE8"})}),e.jsxs("p",{className:"text-xs text-blue-700",children:["请向此地址转账 $",Y.price,' USDT，转账完成后点击"确认支付"']})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>b(!1),className:"flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"取消"}),e.jsx("button",{onClick:S,className:"flex-1 py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"确认支付"})]})]})})]})},am=()=>{var w;const s=dt(),{token:t,user:r}=Je(),[a,n]=y.useState(null),[i,l]=y.useState([]),[o,c]=y.useState(!0),[d,u]=y.useState(null);y.useEffect(()=>{if(!r||r.email!=="admin@trademe.com"){s("/");return}},[r,s]);const m=async()=>{try{const v=await fetch("/api/v1/admin/stats/system",{headers:{Authorization:`Bearer ${t}`}});if(v.ok){const L=await v.json();n(L.data)}else throw new Error("获取系统统计失败")}catch(v){u(v instanceof Error?v.message:"获取系统统计失败")}},k=async()=>{try{const v=await fetch("/api/v1/admin/users?limit=5",{headers:{Authorization:`Bearer ${t}`}});if(v.ok){const L=await v.json();l(L.data.users)}else throw new Error("获取用户列表失败")}catch(v){u(v instanceof Error?v.message:"获取用户列表失败")}};y.useEffect(()=>{t&&(async()=>{c(!0),await Promise.all([m(),k()]),c(!1)})()},[t]);const x=v=>new Date(v).toLocaleString("zh-CN"),b=v=>{switch(v.toLowerCase()){case"basic":return"bg-gray-100 text-gray-700 border border-gray-300";case"premium":return"bg-blue-50 text-blue-700 border border-blue-200";case"professional":return"bg-purple-50 text-purple-700 border border-purple-200";default:return"bg-gray-100 text-gray-700 border border-gray-300"}},g=v=>{switch(v.toLowerCase()){case"basic":return"基础版";case"premium":return"高级版";case"professional":return"专业版";default:return v}};return o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Rt,{size:"lg"})}):d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 text-lg mb-4",children:["⚠️ ",d]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"重新加载"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Trademe 管理仪表板"}),e.jsx("p",{className:"text-sm text-gray-600",children:"数据化运营管理中心"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 px-4 py-2 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-blue-700 text-sm font-semibold",children:(w=r==null?void 0:r.username)==null?void 0:w.charAt(0).toUpperCase()})}),e.jsxs("span",{className:"text-sm font-medium text-blue-700",children:["管理员: ",r==null?void 0:r.username]})]}),e.jsxs("button",{onClick:()=>s("/"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-all duration-200 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"返回前台"})]})]})]})})}),e.jsxs("div",{className:"p-6",children:[a&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.users.total.toLocaleString()})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-semibold mb-1",children:"总用户数"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["活跃用户 ",a.users.active," (",a.growth.active_rate,"%)"]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-1000",style:{width:`${Math.min(100,a.users.active/a.users.total*100)}%`}})})})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.users.recent_7days})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-semibold mb-1",children:"7天新增"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"本周新用户注册数"})]}),e.jsx("div",{className:"mt-4 flex justify-between items-end",children:[...Array(7)].map((v,L)=>e.jsx("div",{className:`w-4 rounded-sm transition-all duration-500 ${L<Math.ceil(a.users.recent_7days/7*7)?"bg-green-500":"bg-gray-200"}`,style:{height:`${20+Math.random()*30}px`,animationDelay:`${L*100}ms`}},L))})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[a.growth.verification_rate,"%"]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-semibold mb-1",children:"验证率"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["已验证: ",a.users.verified," / ",a.users.total]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-xs font-semibold inline-block text-amber-600",children:["已验证: ",a.users.verified]})}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-xs font-semibold inline-block text-gray-500",children:["待验证: ",a.users.unverified]})})]}),e.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-amber-100",children:e.jsx("div",{style:{width:`${a.growth.verification_rate}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-amber-500 transition-all duration-1000"})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.membership.premium+a.membership.professional})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-semibold mb-1",children:"付费用户"}),e.jsxs("div",{className:"flex items-center space-x-4 text-gray-600 text-sm",children:[e.jsxs("span",{children:["高级: ",a.membership.premium]}),e.jsxs("span",{children:["专业: ",a.membership.professional]})]})]}),e.jsxs("div",{className:"mt-4 flex space-x-1",children:[e.jsx("div",{className:"h-2 bg-blue-500 rounded-sm flex-1",style:{flexBasis:`${a.membership.premium/(a.membership.premium+a.membership.professional)*100}%`}}),e.jsx("div",{className:"h-2 bg-purple-500 rounded-sm flex-1",style:{flexBasis:`${a.membership.professional/(a.membership.premium+a.membership.professional)*100}%`}})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"最近用户"})]}),e.jsxs("button",{onClick:()=>s("/admin/users"),className:"group flex items-center space-x-2 text-blue-600 hover:text-blue-800 text-sm font-medium transition-all duration-300 hover:scale-105",children:[e.jsx("span",{children:"查看全部"}),e.jsx("svg",{className:"w-4 h-4 group-hover:translate-x-1 transition-transform duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})}),e.jsx("div",{className:"overflow-hidden",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用户"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"会员等级"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"注册时间"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map((v,L)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-white text-sm font-semibold",children:v.username.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:v.username}),e.jsx("div",{className:"text-sm text-gray-500",children:v.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-semibold rounded-full ${b(v.membership_level)}`,children:g(v.membership_level)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${v.is_active?"bg-green-400":"bg-red-400"}`}),e.jsx("span",{className:`text-sm font-medium ${v.is_active?"text-green-700":"text-red-700"}`,children:v.is_active?"活跃":"非活跃"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${v.email_verified?"bg-blue-400":"bg-amber-400"}`}),e.jsx("span",{className:`text-xs ${v.email_verified?"text-blue-600":"text-amber-600"}`,children:v.email_verified?"已验证":"待验证"})]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:x(v.created_at)})]},v.id))})]})})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"快捷操作"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:()=>s("/admin/users"),className:"group w-full text-left px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 border border-gray-200 hover:border-gray-300 transition-all duration-300 hover:scale-[1.02]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center mr-4 group-hover:shadow-lg group-hover:shadow-blue-100 transition-all duration-300",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 group-hover:text-blue-700 transition-colors duration-300",children:"用户管理"}),e.jsx("div",{className:"text-sm text-gray-600",children:"管理用户账户和会员权限"})]}),e.jsx("svg",{className:"w-5 h-5 text-blue-600 group-hover:translate-x-1 transition-transform duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})}),e.jsx("button",{onClick:()=>s("/admin/claude"),className:"group w-full text-left px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 border border-gray-200 hover:border-gray-300 transition-all duration-300 hover:scale-[1.02]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center mr-4 group-hover:shadow-lg group-hover:shadow-green-100 transition-all duration-300",children:e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 group-hover:text-green-700 transition-colors duration-300",children:"AI服务管理"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Claude账号池和使用统计"})]}),e.jsx("svg",{className:"w-5 h-5 text-green-600 group-hover:translate-x-1 transition-transform duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})}),e.jsx("button",{onClick:()=>s("/admin/wallets"),className:"group w-full text-left px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 border border-gray-200 hover:border-gray-300 transition-all duration-300 hover:scale-[1.02]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center mr-4 group-hover:shadow-lg group-hover:shadow-emerald-100 transition-all duration-300",children:e.jsx("svg",{className:"w-5 h-5 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 group-hover:text-emerald-700 transition-colors duration-300",children:"钱包池管理"}),e.jsx("div",{className:"text-sm text-gray-600",children:"USDT钱包生成和智能分配"})]}),e.jsx("svg",{className:"w-5 h-5 text-emerald-600 group-hover:translate-x-1 transition-transform duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})}),e.jsx("button",{onClick:()=>s("/admin/data"),className:"group w-full text-left px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 border border-gray-200 hover:border-gray-300 transition-all duration-300 hover:scale-[1.02]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-100 flex items-center justify-center mr-4 group-hover:shadow-lg group-hover:shadow-orange-100 transition-all duration-300",children:e.jsx("svg",{className:"w-5 h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 group-hover:text-orange-700 transition-colors duration-300",children:"数据管理"}),e.jsx("div",{className:"text-sm text-gray-600",children:"历史数据下载和质量监控"})]}),e.jsx("svg",{className:"w-5 h-5 text-orange-600 group-hover:translate-x-1 transition-transform duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})}),e.jsx("button",{className:"group w-full text-left px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 border border-gray-200 hover:border-gray-300 transition-all duration-300 hover:scale-[1.02]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center mr-4 group-hover:shadow-lg group-hover:shadow-amber-100 transition-all duration-300",children:e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 group-hover:text-amber-700 transition-colors duration-300",children:"支付管理"}),e.jsx("div",{className:"text-sm text-gray-600",children:"USDT钱包和订单管理"})]}),e.jsx("svg",{className:"w-5 h-5 text-amber-600 group-hover:translate-x-1 transition-transform duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})}),e.jsx("button",{className:"group w-full text-left px-4 py-4 rounded-xl bg-gray-50 hover:bg-gray-100 border border-gray-200 hover:border-gray-300 transition-all duration-300 hover:scale-[1.02]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-pink-100 flex items-center justify-center mr-4 group-hover:shadow-lg group-hover:shadow-pink-100 transition-all duration-300",children:e.jsx("svg",{className:"w-5 h-5 text-pink-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 group-hover:text-pink-700 transition-colors duration-300",children:"数据统计"}),e.jsx("div",{className:"text-sm text-gray-600",children:"系统运营数据和报表"})]}),e.jsx("svg",{className:"w-5 h-5 text-pink-600 group-hover:translate-x-1 transition-transform duration-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"系统状态"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-blue-50 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"用户服务"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"运行中"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-purple-50 border border-purple-100",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"交易服务"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"运行中"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-amber-50 border border-amber-100",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"})})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"数据服务"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"运行中"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-emerald-50 border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-emerald-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-emerald-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"})})}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"数据库"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-green-700",children:"正常"})]})]})]})]})]})]})]})]})},nm=()=>{var oe;const s=dt(),{token:t,user:r}=Je(),[a,n]=y.useState([]),[i,l]=y.useState(null),[o,c]=y.useState(null),[d,u]=y.useState(null),[m,k]=y.useState(null),[x,b]=y.useState(!0),[g,w]=y.useState(null),[v,L]=y.useState([]),[C,M]=y.useState(!1),[j,p]=y.useState(""),[S,_]=y.useState("all");y.useEffect(()=>{if(!r||r.email!=="admin@trademe.com"){s("/");return}},[r,s]);const U=async()=>{try{const z=await fetch("/api/v1/admin/users?limit=50",{headers:{Authorization:`Bearer ${t}`}});if(z.ok){const F=await z.json();n(F.data.users)}else throw new Error("获取用户列表失败")}catch(z){w(z instanceof Error?z.message:"获取用户列表失败")}},re=async()=>{try{const z=await fetch("/api/v1/admin/stats/system",{headers:{Authorization:`Bearer ${t}`}});if(z.ok){const F=await z.json();k(F.data)}}catch(z){console.error("获取系统统计失败:",z)}},X=async()=>{try{const z=await fetch("/api/v1/admin/analytics/membership",{headers:{Authorization:`Bearer ${t}`}});if(z.ok){const F=await z.json();u(F.data)}}catch(z){console.error("获取分析数据失败:",z)}},te=async z=>{try{const F=await fetch(`/api/v1/admin/users/${z}/membership-stats`,{headers:{Authorization:`Bearer ${t}`}});if(F.ok){const me=await F.json();c(me.data),M(!0)}else throw new Error("获取用户详情失败")}catch(F){w(F instanceof Error?F.message:"获取用户详情失败")}},R=async(z,F)=>{if(v.length===0){alert("请选择要操作的用户");return}try{const me=await fetch("/api/v1/admin/users/batch",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({user_ids:v,action:z,data:F})});if(me.ok){const Se=await me.json();alert(Se.message),await U(),L([])}else throw new Error("批量操作失败")}catch(me){alert(me instanceof Error?me.message:"批量操作失败")}};y.useEffect(()=>{t&&(async()=>{b(!0),await Promise.all([U(),X(),re()]),b(!1)})()},[t]);const ie=z=>{switch(z.toLowerCase()){case"basic":return"bg-gray-100 text-gray-700 border border-gray-300";case"premium":return"bg-blue-50 text-blue-700 border border-blue-200";case"professional":return"bg-purple-50 text-purple-700 border border-purple-200";default:return"bg-gray-100 text-gray-700 border border-gray-300"}},Y=z=>{switch(z.toLowerCase()){case"basic":return"基础版";case"premium":return"高级版";case"professional":return"专业版";default:return z}},ge=z=>new Date(z).toLocaleString("zh-CN"),T=z=>{if(!z)return null;const F=Math.ceil((new Date(z).getTime()-Date.now())/(24*60*60*1e3));return F>0?F:0},Z=a.filter(z=>{const F=z.username.toLowerCase().includes(j.toLowerCase())||z.email.toLowerCase().includes(j.toLowerCase()),me=S==="all"||S==="active"&&z.is_active||S==="inactive"&&!z.is_active||S==="verified"&&z.email_verified||S==="unverified"&&!z.email_verified;return F&&me});return x?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx(Rt,{size:"lg"})}):g?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 text-lg mb-4",children:["⚠️ ",g]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"重新加载"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"用户管理中心"}),e.jsx("p",{className:"text-sm text-gray-600",children:"数据驱动的用户运营平台"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 px-4 py-2 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("span",{className:"text-green-700 text-sm font-semibold",children:(oe=r==null?void 0:r.username)==null?void 0:oe.charAt(0).toUpperCase()})}),e.jsxs("span",{className:"text-sm font-medium text-green-700",children:["管理员: ",r==null?void 0:r.username]})]}),e.jsxs("button",{onClick:()=>s("/admin"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-all duration-200 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"返回仪表板"})]})]})]})})}),e.jsxs("div",{className:"p-6",children:[m&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总用户数"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:m.users.total.toLocaleString()})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:["活跃: ",m.users.active]}),e.jsxs("span",{className:"text-gray-500",children:["(",m.growth.active_rate,"%)"]})]}),e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-1000",style:{width:`${Math.min(100,m.users.active/m.users.total*100)}%`}})})})]})})}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"7天新增"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:m.users.recent_7days})]})]}),e.jsx("div",{className:"flex justify-between items-end mt-4",children:[...Array(7)].map((z,F)=>e.jsx("div",{className:`w-4 rounded-sm transition-all duration-500 ${F<Math.ceil(m.users.recent_7days/7*7)?"bg-green-500":"bg-gray-200"}`,style:{height:`${20+Math.random()*30}px`,animationDelay:`${F*100}ms`}},F))})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"邮箱验证率"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[m.growth.verification_rate,"%"]})]})]}),e.jsxs("div",{className:"relative pt-1",children:[e.jsxs("div",{className:"flex mb-2 items-center justify-between",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-xs font-semibold inline-block text-amber-600",children:["已验证: ",m.users.verified]})}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"text-xs font-semibold inline-block text-gray-500",children:["待验证: ",m.users.unverified]})})]}),e.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-amber-100",children:e.jsx("div",{style:{width:`${m.growth.verification_rate}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-amber-500 transition-all duration-1000"})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"付费用户"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:m.membership.premium+m.membership.professional})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[e.jsxs("span",{className:"text-blue-600 font-medium",children:["高级: ",m.membership.premium]}),e.jsxs("span",{className:"text-purple-600 font-medium",children:["专业: ",m.membership.professional]})]}),e.jsxs("div",{className:"flex mt-3 space-x-1",children:[e.jsx("div",{className:"h-2 bg-blue-500 rounded-sm flex-1",style:{flexBasis:`${m.membership.premium/(m.membership.premium+m.membership.professional)*100}%`}}),e.jsx("div",{className:"h-2 bg-purple-500 rounded-sm flex-1",style:{flexBasis:`${m.membership.professional/(m.membership.premium+m.membership.professional)*100}%`}})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"用户列表"}),v.length>0&&e.jsxs("span",{className:"px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-full font-medium",children:["已选中 ",v.length," 个用户"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"搜索用户...",value:j,onChange:z=>p(z.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400 absolute left-3 top-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),e.jsxs("select",{value:S,onChange:z=>_(z.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"全部状态"}),e.jsx("option",{value:"active",children:"活跃用户"}),e.jsx("option",{value:"inactive",children:"非活跃"}),e.jsx("option",{value:"verified",children:"已验证"}),e.jsx("option",{value:"unverified",children:"未验证"})]})]})]}),v.length>0&&e.jsxs("div",{className:"flex items-center space-x-2 mt-4",children:[e.jsxs("button",{onClick:()=>R("activate"),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-green-700 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"激活用户"]}),e.jsxs("button",{onClick:()=>R("deactivate"),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-red-700 bg-red-50 border border-red-200 rounded-lg hover:bg-red-100 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"停用用户"]}),e.jsxs("button",{onClick:()=>R("verify_email"),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),"验证邮箱"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2",onChange:z=>{z.target.checked?L(Z.map(F=>F.id)):L([])},checked:v.length===Z.length&&Z.length>0})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用户信息"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"会员等级"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"最后登录"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Z.map(z=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2",checked:v.includes(z.id),onChange:F=>{F.target.checked?L([...v,z.id]):L(v.filter(me=>me!==z.id))}})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold text-sm",children:z.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:z.username}),e.jsx("div",{className:"text-sm text-gray-500",children:z.email})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${ie(z.membership_level)}`,children:Y(z.membership_level)}),z.membership_expires_at&&e.jsxs("div",{className:"text-xs text-amber-600 mt-1",children:[T(z.membership_expires_at)," 天后到期"]})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${z.is_active?"bg-green-400":"bg-gray-400"}`}),e.jsx("span",{className:`text-sm font-medium ${z.is_active?"text-green-700":"text-gray-500"}`,children:z.is_active?"活跃":"非活跃"})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${z.email_verified?"bg-blue-400":"bg-amber-400"}`}),e.jsx("span",{className:`text-xs ${z.email_verified?"text-blue-600":"text-amber-600"}`,children:z.email_verified?"已验证":"待验证"})]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:z.last_login_at?ge(z.last_login_at):"从未登录"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("button",{onClick:()=>{l(z),te(z.id)},className:"inline-flex items-center px-3 py-1 text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors",children:[e.jsxs("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"详情"]})})]},z.id))})]})}),Z.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"没有找到用户"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"请尝试调整搜索条件或筛选器。"})]})]})}),e.jsxs("div",{className:"space-y-6",children:[d&&d.expiring_soon.length>0&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"即将到期"}),e.jsx("span",{className:"px-2 py-1 text-xs bg-amber-100 text-amber-700 rounded-full font-medium",children:d.expiring_soon.length})]}),e.jsx("div",{className:"space-y-3",children:d.expiring_soon.map(z=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-amber-50 border border-amber-100 rounded-lg hover:bg-amber-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-amber-200 flex items-center justify-center text-amber-800 font-semibold text-xs",children:z.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:z.username}),e.jsx("div",{className:"text-xs text-gray-600",children:Y(z.membership_level)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-amber-700",children:[z.days_remaining," 天"]}),e.jsx("div",{className:"text-xs text-amber-600",children:"剩余时间"})]})]},z.id))})]}),d&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"会员分布"})]}),e.jsx("div",{className:"space-y-4",children:d.membership_distribution.map(z=>{const F=d.membership_distribution.reduce((nt,pe)=>nt+pe.count,0),me=Math.round(z.count/F*100),Se={basic:"bg-gray-500",premium:"bg-blue-500",professional:"bg-purple-500"};return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-100 hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:Y(z.level)}),e.jsxs("span",{className:"text-sm font-bold text-gray-900",children:[z.count," 人"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 ${Se[z.level]||Se.basic} rounded-full transition-all duration-1000`,style:{width:`${me}%`}})}),e.jsxs("div",{className:"text-xs text-gray-600",children:[me,"% 占比"]})]},z.level)})}),d.revenue&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-3",children:"收入概览"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"月度收入"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["$",d.revenue.monthly_revenue]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"活跃订阅"}),e.jsx("span",{className:"font-semibold text-blue-600",children:d.revenue.active_subscriptions})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"快速统计"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"今日注册"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"12"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"在线用户"}),e.jsx("span",{className:"text-sm font-semibold text-green-600",children:"1,248"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"待处理"}),e.jsx("span",{className:"text-sm font-semibold text-amber-600",children:"3"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"系统负载"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-green-500 h-1 rounded-full",style:{width:"65%"}})}),e.jsx("span",{className:"text-xs text-gray-500",children:"65%"})]})]})]})]})]})]})]}),C&&o&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>M(!1)}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full sm:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-lg",children:o.user.username.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[o.user.username," 详细信息"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"用户数据详情与使用统计"})]})]}),e.jsx("button",{onClick:()=>M(!1),className:"bg-gray-100 hover:bg-gray-200 rounded-lg p-2 transition-colors",children:e.jsx("svg",{className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"基本信息"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-blue-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"邮箱地址"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.user.email})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-blue-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"会员等级"}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${ie(o.user.membership_level)}`,children:o.limits.name})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-blue-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"邮箱验证"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${o.user.email_verified?"bg-green-400":"bg-amber-400"}`}),e.jsx("span",{className:`text-sm font-medium ${o.user.email_verified?"text-green-600":"text-amber-600"}`,children:o.user.email_verified?"已验证":"待验证"})]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-blue-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"注册时间"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ge(o.user.created_at)})]}),o.user.membership_expires_at&&e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"会员到期"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ge(o.user.membership_expires_at)}),e.jsxs("div",{className:"text-xs text-amber-600",children:[T(o.user.membership_expires_at)," 天后到期"]})]})]})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"使用统计"})]}),e.jsx("div",{className:"space-y-4",children:[{label:"API密钥",current:o.usage.api_keys_count,limit:o.limits.api_keys,color:"blue"},{label:"今日AI使用",current:o.usage.ai_usage_today,limit:o.limits.ai_daily,color:"green",prefix:"$"},{label:"策略数量",current:o.usage.strategies_count,limit:o.limits.strategies,color:"purple"},{label:"指标数量",current:o.usage.indicators_count,limit:o.limits.indicators,color:"amber"},{label:"实盘交易",current:o.usage.live_trading_count,limit:o.limits.live_trading,color:"emerald"},{label:"Tick回测",current:o.usage.tick_backtest_today,limit:o.limits.tick_backtest,color:"rose"}].map((z,F)=>{const me=z.limit>0?Math.min(100,z.current/z.limit*100):0,Se={blue:"bg-blue-500",green:"bg-green-500",purple:"bg-purple-500",amber:"bg-amber-500",emerald:"bg-emerald-500",rose:"bg-rose-500"};return e.jsxs("div",{className:"py-2 border-b border-purple-100 last:border-b-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:z.label}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[z.prefix,z.current,"/",z.limit]})]}),e.jsx("div",{className:"w-full bg-purple-100 rounded-full h-2",children:e.jsx("div",{className:`h-2 ${Se[z.color]} rounded-full transition-all duration-1000`,style:{width:`${me}%`}})})]},F)})})]})]}),e.jsx("div",{className:"mt-6 flex justify-end space-x-3",children:e.jsx("button",{onClick:()=>M(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"关闭"})})]})]})})]})},im=()=>{var Q;const s=dt(),{token:t,user:r}=Je(),[a,n]=y.useState([]),[i,l]=y.useState([]),[o,c]=y.useState(null),[d,u]=y.useState([]),[m,k]=y.useState(null),[x,b]=y.useState(!0),[g,w]=y.useState(null),[v,L]=y.useState([]),[C,M]=y.useState(!1),[j,p]=y.useState(!1),[S,_]=y.useState(null),[U,re]=y.useState(""),[X,te]=y.useState("all"),[R,ie]=y.useState("dashboard"),[Y,ge]=y.useState([]),[T,Z]=y.useState([]),[oe,z]=y.useState(!1),[F,me]=y.useState([]),[Se,nt]=y.useState(!1),[pe,We]=y.useState({step:"initial",authUrl:"",sessionId:"",authCode:"",accountName:"",description:"",dailyLimit:50,priority:50,directToken:"",useManualMode:!1}),[be,ce]=y.useState({account_name:"",api_key:"",account_type:"direct",proxy_base_url:"",proxy_type:"proxy_service",daily_limit:100,proxy_id:""});y.useEffect(()=>{if(!r||r.email!=="admin@trademe.com"){s("/");return}},[r,s]);const Ae=async()=>{try{const f=await fetch("/api/v1/admin/claude/accounts",{headers:{Authorization:`Bearer ${t}`}});if(f.ok){const I=await f.json();n(I.accounts||[])}else throw new Error("获取Claude账号失败")}catch(f){w(f instanceof Error?f.message:"获取Claude账号失败")}},Ke=async()=>{try{const f=await fetch("/api/v1/admin/claude/proxies",{headers:{Authorization:`Bearer ${t}`}});if(f.ok){const I=await f.json();l(I.proxies||[])}}catch(f){console.error("获取代理列表失败:",f)}},Ut=async()=>{try{const f=await fetch("/api/v1/admin/claude/usage-stats?days=30",{headers:{Authorization:`Bearer ${t}`}});if(f.ok){const I=await f.json();c(I.data)}}catch(f){console.error("获取使用统计失败:",f)}},kt=async()=>{try{const f=await fetch("/api/v1/admin/claude/anomaly-detection",{headers:{Authorization:`Bearer ${t}`}});if(f.ok){const I=await f.json();k(I.data)}}catch(f){console.error("获取异常检测失败:",f)}},gt=async()=>{try{const f=await fetch("/api/v1/anthropic-accounts/",{headers:{Authorization:`Bearer ${t}`}});if(f.ok){const I=await f.json();me(I||[])}else throw new Error("获取Anthropic账户失败")}catch(f){console.error("获取Anthropic账户失败:",f),w(f instanceof Error?f.message:"获取Anthropic账户失败")}},P=async()=>{try{b(!0);const f=await fetch("/api/v1/anthropic-accounts/generate-setup-token-url",{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(f.ok){const I=await f.json();We({...pe,step:"auth",authUrl:I.auth_url,sessionId:I.session_id}),w(null)}else{const I=await f.json();throw new Error(I.detail||"生成授权链接失败")}}catch(f){w(f instanceof Error?f.message:"生成授权链接失败")}finally{b(!1)}},de=async()=>{try{b(!0);const f=await fetch("/api/v1/anthropic-accounts/exchange-setup-token",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({session_id:pe.sessionId,authorization_code:pe.authCode,account_name:pe.accountName,description:pe.description,daily_limit:pe.dailyLimit,priority:pe.priority})});if(f.ok){const I=await f.json();We({...pe,step:"success"}),await gt(),w(null),setTimeout(()=>{nt(!1),Ve()},3e3)}else{const I=await f.json();throw new Error(I.detail||"Setup Token交换失败")}}catch(f){w(f instanceof Error?f.message:"Setup Token交换失败")}finally{b(!1)}},Ve=()=>{We({step:"initial",authUrl:"",sessionId:"",authCode:"",accountName:"",description:"",dailyLimit:50,priority:50,directToken:"",useManualMode:!1})},it=async f=>{var I,ue;try{const Pe=await(await fetch(`/api/v1/anthropic-accounts/${f}/test`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).json();Pe.success?alert(`连接测试成功！
响应时间: ${((I=Pe.test_details)==null?void 0:I.response_time_ms)||"N/A"}ms`):alert(`连接测试失败：${((ue=Pe.test_details)==null?void 0:ue.error)||Pe.message||"未知错误"}`),await gt()}catch(Ce){alert("测试连接失败："+(Ce instanceof Error?Ce.message:"网络错误"))}},Me=async(f,I)=>{if(confirm(`确定要删除Anthropic账户 "${I}" 吗？`))try{const Ce=await(await fetch(`/api/v1/anthropic-accounts/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).json();Ce.success?(await gt(),alert("账户删除成功")):alert("删除失败："+(Ce.message||"未知错误"))}catch(ue){alert("删除失败："+(ue instanceof Error?ue.message:"网络错误"))}},Le=async()=>{var f;try{const I=await fetch("/api/v1/admin/users/",{headers:{Authorization:`Bearer ${t}`}});if(I.ok){const ue=await I.json();ge(((f=ue.data)==null?void 0:f.users)||[])}}catch(I){console.error("获取用户列表失败:",I)}},N=async()=>{try{const f=await fetch("/api/v1/admin/claude/users-detailed-stats",{headers:{Authorization:`Bearer ${t}`}});if(f.ok){const I=await f.json();Z(I.data||[])}}catch(f){console.error("获取用户使用统计失败:",f)}},h=async()=>{try{const f={account_name:be.account_name,api_key:be.api_key,daily_limit:be.daily_limit,proxy_base_url:be.account_type==="direct"?"":be.proxy_base_url||"https://claude.cloudcdn7.com/api",proxy_type:be.account_type==="direct"?"":be.account_type==="custom_proxy"?"custom":"proxy_service"},I=await fetch("/api/v1/admin/claude/accounts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(f)});if(I.ok){const ue=await I.json();alert("Claude账号添加成功"),M(!1),ce({account_name:"",api_key:"",account_type:"direct",proxy_base_url:"",proxy_type:"proxy_service",daily_limit:100,proxy_id:""}),await Ae()}else throw new Error("添加Claude账号失败")}catch(f){alert(f instanceof Error?f.message:"添加Claude账号失败")}},A=async f=>{try{const I=await fetch(`/api/v1/admin/claude/accounts/${f}/test`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(I.ok){const ue=await I.json();alert(`测试结果: ${ue.status==="success"?"连接成功":"连接失败"}`),await Ae()}else throw new Error("账号连接测试失败")}catch(I){alert(I instanceof Error?I.message:"账号连接测试失败")}},D=async f=>{if(confirm("确定要删除这个Claude账号吗？"))try{if((await fetch(`/api/v1/admin/claude/accounts/${f}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)alert("Claude账号删除成功"),await Ae();else throw new Error("删除Claude账号失败")}catch(I){alert(I instanceof Error?I.message:"删除Claude账号失败")}};y.useEffect(()=>{t&&(async()=>{b(!0),await Promise.all([Ae(),Ke(),Ut(),kt(),Le(),N(),gt()]),b(!1)})()},[t]);const $=f=>{switch(f){case"active":return"bg-green-100 text-green-700 border-green-200";case"inactive":return"bg-gray-100 text-gray-700 border-gray-200";case"error":return"bg-red-100 text-red-700 border-red-200";case"suspended":return"bg-yellow-100 text-yellow-700 border-yellow-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}},O=f=>{switch(f){case"active":return"活跃";case"inactive":return"非活跃";case"error":return"错误";case"suspended":return"暂停";default:return f}},V=f=>new Date(f).toLocaleString("zh-CN"),ee=f=>`$${f.toFixed(4)}`,J=a.filter(f=>{const I=f.account_name.toLowerCase().includes(U.toLowerCase())||f.api_key.toLowerCase().includes(U.toLowerCase()),ue=X==="all"||f.status===X;return I&&ue});return x?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsx(Rt,{size:"lg"})}):g?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 text-lg mb-4",children:["⚠️ ",g]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"重新加载"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-green-600 to-green-700 flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Claude AI 服务管理"}),e.jsx("p",{className:"text-sm text-gray-600",children:"AI账号池与智能调度管理平台"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 px-4 py-2 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("span",{className:"text-green-700 text-sm font-semibold",children:(Q=r==null?void 0:r.username)==null?void 0:Q.charAt(0).toUpperCase()})}),e.jsxs("span",{className:"text-sm font-medium text-green-700",children:["管理员: ",r==null?void 0:r.username]})]}),e.jsxs("button",{onClick:()=>s("/admin"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-all duration-200 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"返回仪表板"})]})]})]})})}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"px-6",children:e.jsxs("nav",{className:"flex space-x-8",children:[e.jsx("button",{onClick:()=>ie("dashboard"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${R==="dashboard"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("span",{children:"仪表盘"})]})}),e.jsx("button",{onClick:()=>ie("accounts"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${R==="accounts"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),e.jsx("span",{children:"账户管理"}),e.jsx("span",{className:"ml-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:a.length})]})}),e.jsx("button",{onClick:()=>ie("users"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${R==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"})}),e.jsx("span",{children:"用户管理"}),e.jsx("span",{className:"ml-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:Y.length})]})}),e.jsx("button",{onClick:()=>ie("scheduler"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${R==="scheduler"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"智能调度"})]})}),e.jsx("button",{onClick:()=>ie("anomalies"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${R==="anomalies"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.99-.833-2.75 0L4.058 18.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{children:"异常监控"}),(m==null?void 0:m.anomalies.length)>0&&e.jsx("span",{className:"ml-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:m.anomalies.length})]})}),e.jsx("button",{onClick:()=>ie("anthropic"),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${R==="anthropic"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("span",{children:"Anthropic官方API"}),F.length>0&&e.jsx("span",{className:"ml-1 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:F.length})]})})]})})}),e.jsxs("div",{className:"p-6",children:[R==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6 border-l-4 border-blue-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总账户数"}),e.jsx("p",{className:"text-3xl font-semibold text-gray-900",children:a.length}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:[a.filter(f=>f.status==="active").length," 个活跃"]})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 border-l-4 border-green-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总请求数"}),e.jsx("p",{className:"text-3xl font-semibold text-gray-900",children:a.reduce((f,I)=>f+(I.total_requests||0),0).toLocaleString()}),e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:[a.reduce((f,I)=>f+(I.failed_requests||0),0)," 失败"]})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 border-l-4 border-yellow-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"平均响应时间"}),e.jsxs("p",{className:"text-3xl font-semibold text-gray-900",children:[a.length>0?Math.round(a.reduce((f,I)=>f+(I.avg_response_time||0),0)/a.length):0,"ms"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"全部账户平均"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 border-l-4 border-purple-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"平均成功率"}),e.jsxs("p",{className:"text-3xl font-semibold text-gray-900",children:[a.length>0?(a.reduce((f,I)=>f+(I.success_rate||0),0)/a.length).toFixed(1):"0","%"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"全部账户平均"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"账户详细统计"}),e.jsx("div",{className:"space-y-4",children:a.map(f=>{const I=f.daily_limit>0?f.current_usage/f.daily_limit*100:0,ue=I<50?"bg-green-500":I<80?"bg-yellow-500":"bg-red-500";return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:f.account_name}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${f.status==="active"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:f.status})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"请求数:"}),e.jsx("span",{className:"font-medium ml-1",children:(f.total_requests||0).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"成功率:"}),e.jsxs("span",{className:"font-medium ml-1",children:[(f.success_rate||0).toFixed(1),"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"响应时间:"}),e.jsxs("span",{className:"font-medium ml-1",children:[f.avg_response_time||0,"ms"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"使用率:"}),e.jsxs("span",{className:"font-medium ml-1",children:[I.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${ue}`,style:{width:`${Math.min(I,100)}%`}})})]},f.id)})})]})]}),R==="accounts"&&e.jsxs("div",{children:[o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总请求数"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:o.total_requests.toLocaleString()})]})]}),e.jsx("div",{className:"text-sm text-green-600 font-medium",children:"30天统计"})]})})}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总成本"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:ee(o.total_cost_usd)})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["今日: ",ee(o.daily_cost_usd)]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"活跃账号"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.filter(f=>f.status==="active").length})]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["总账号: ",a.length]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.99-.833-2.75 0L4.058 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"异常警告"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:(m==null?void 0:m.anomalies.length)||0})]})]}),e.jsx("div",{className:"text-sm text-red-500",children:"需要关注"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Claude 账号池"}),v.length>0&&e.jsxs("span",{className:"px-3 py-1 text-sm bg-blue-100 text-blue-800 rounded-full font-medium",children:["已选中 ",v.length," 个账号"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"搜索账号...",value:U,onChange:f=>re(f.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),e.jsx("svg",{className:"w-4 h-4 text-gray-400 absolute left-3 top-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),e.jsxs("select",{value:X,onChange:f=>te(f.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[e.jsx("option",{value:"all",children:"全部状态"}),e.jsx("option",{value:"active",children:"活跃"}),e.jsx("option",{value:"inactive",children:"非活跃"}),e.jsx("option",{value:"error",children:"错误"}),e.jsx("option",{value:"suspended",children:"暂停"})]}),e.jsxs("button",{onClick:()=>M(!0),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"添加账号"]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2",onChange:f=>{f.target.checked?L(J.map(I=>I.id)):L([])},checked:v.length===J.length&&J.length>0})}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"账号信息"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"使用情况"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"性能"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:J.map(f=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2",checked:v.includes(f.id),onChange:I=>{I.target.checked?L([...v,f.id]):L(v.filter(ue=>ue!==f.id))}})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-green-500 to-blue-600 flex items-center justify-center text-white font-semibold text-sm",children:f.account_name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.account_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[f.api_key.substring(0,8),"...",f.api_key.substring(f.api_key.length-4)]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"font-medium text-gray-900",children:[ee(f.current_usage)," / ",ee(f.daily_limit)]}),e.jsxs("div",{className:"text-gray-500",children:["使用率: ",f.daily_limit>0?(f.current_usage/f.daily_limit*100).toFixed(1):0,"%"]})]}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${f.current_usage/f.daily_limit>.8?"bg-red-500":f.current_usage/f.daily_limit>.6?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(100,f.current_usage/f.daily_limit*100)}%`}})})})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${$(f.status)}`,children:O(f.status)}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:f.last_used_at?V(f.last_used_at):"从未使用"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-600",children:"响应:"}),e.jsxs("span",{className:`font-medium ${f.avg_response_time>3e3?"text-red-600":f.avg_response_time>1500?"text-yellow-600":"text-green-600"}`,children:[f.avg_response_time,"ms"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-600",children:"成功率:"}),e.jsxs("span",{className:`font-medium ${f.success_rate>95?"text-green-600":f.success_rate>85?"text-yellow-600":"text-red-600"}`,children:[f.success_rate.toFixed(1),"%"]})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:[e.jsxs("button",{onClick:()=>A(f.id),className:"inline-flex items-center px-2 py-1 text-xs text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded transition-colors",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"测试"]}),e.jsxs("button",{onClick:()=>{_(f),p(!0)},className:"inline-flex items-center px-2 py-1 text-xs text-green-600 hover:text-green-800 hover:bg-green-50 rounded transition-colors",children:[e.jsxs("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"详情"]}),e.jsxs("button",{onClick:()=>D(f.id),className:"inline-flex items-center px-2 py-1 text-xs text-red-600 hover:text-red-800 hover:bg-red-50 rounded transition-colors",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"删除"]})]})]},f.id))})]})}),J.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"没有找到Claude账号"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"请尝试调整搜索条件或筛选器。"})]})]})}),e.jsxs("div",{className:"space-y-6",children:[m&&m.anomalies.length>0&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.99-.833-2.75 0L4.058 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"异常警告"}),e.jsx("span",{className:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded-full font-medium",children:m.anomalies.length})]}),e.jsx("div",{className:"space-y-3",children:m.anomalies.slice(0,5).map((f,I)=>e.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-red-50 border border-red-100 rounded-lg",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mt-2 ${f.severity==="high"?"bg-red-500":f.severity==="medium"?"bg-yellow-500":"bg-blue-500"}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.account_name}),e.jsx("div",{className:"text-xs text-gray-600",children:f.description}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:V(f.detected_at)})]})]},I))}),m.recommendations.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-red-100",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"建议"}),e.jsx("ul",{className:"space-y-1",children:m.recommendations.slice(0,3).map((f,I)=>e.jsxs("li",{className:"text-xs text-gray-600 flex items-start",children:[e.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full mt-2 mr-2 flex-shrink-0"}),f]},I))})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"代理状态"})]}),e.jsx("div",{className:"space-y-3",children:i.slice(0,5).map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 border border-purple-100 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${f.status==="active"?"bg-green-400":f.status==="error"?"bg-red-400":"bg-gray-400"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.name}),e.jsxs("div",{className:"text-xs text-gray-600",children:[f.host,":",f.port]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-900",children:[f.success_rate.toFixed(1),"%"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"成功率"})]})]},f.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"快速统计"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"今日请求"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:"1,234"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"平均响应时间"}),e.jsx("span",{className:"text-sm font-semibold text-green-600",children:"1.2s"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"错误率"}),e.jsx("span",{className:"text-sm font-semibold text-red-600",children:"0.3%"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"成本效率"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-green-500 h-1 rounded-full",style:{width:"85%"}})}),e.jsx("span",{className:"text-xs text-gray-500",children:"85%"})]})]})]})]})]})]})]}),R==="users"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6 border-l-4 border-indigo-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总用户数"}),e.jsx("p",{className:"text-3xl font-semibold text-gray-900",children:Y.length}),e.jsxs("p",{className:"text-sm text-green-600 mt-1",children:[Y.filter(f=>f.membership_level==="professional").length," 专业版用户"]})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"})})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 border-l-4 border-purple-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"AI使用总数"}),e.jsx("p",{className:"text-3xl font-semibold text-gray-900",children:T.reduce((f,I)=>f+(I.total_requests||0),0)}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"本月累计"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})})})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6 border-l-4 border-orange-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"活跃用户"}),e.jsx("p",{className:"text-3xl font-semibold text-gray-900",children:Y.filter(f=>new Date(f.last_login_at||0)>new Date(Date.now()-7*24*60*60*1e3)).length}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"近7天"})]}),e.jsx("div",{className:"ml-auto",children:e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"用户Claude使用详情"}),e.jsx("p",{className:"text-sm text-gray-600",children:"各用户的Claude AI使用统计和费用详情"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用户信息"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"会员等级"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"使用次数"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"费用"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"最后使用"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"状态"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Y.map(f=>{var ue,Ce;const I=T.find(Pe=>Pe.user_id===f.id)||{};return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600 flex items-center justify-center text-white font-semibold",children:((ue=f.username)==null?void 0:ue.charAt(0).toUpperCase())||((Ce=f.email)==null?void 0:Ce.charAt(0).toUpperCase())}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.username||"未设置"}),e.jsx("div",{className:"text-sm text-gray-500",children:f.email})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${f.membership_level==="professional"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:f.membership_level==="professional"?"专业版":"免费版"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:I.total_requests||0}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",(I.total_cost||0).toFixed(4)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:f.last_login_at?new Date(f.last_login_at).toLocaleDateString("zh-CN"):"从未登录"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${f.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:f.is_active?"活跃":"已禁用"})})]},f.id)})})]})}),Y.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"})}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"暂无用户数据"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"等待用户注册或检查API连接。"})]})]})]}),C&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>M(!1)}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"添加Claude账号"}),e.jsx("p",{className:"text-sm text-gray-500",children:"添加官方API账号或代理服务账号到账号池"})]}),e.jsx("button",{onClick:()=>M(!1),className:"bg-gray-100 hover:bg-gray-200 rounded-lg p-2 transition-colors",children:e.jsx("svg",{className:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"账号名称"}),e.jsx("input",{type:"text",value:be.account_name,onChange:f=>ce({...be,account_name:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"例如: Claude-Account-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Key"}),e.jsx("input",{type:"password",value:be.api_key,onChange:f=>ce({...be,api_key:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"sk-ant-api... 或 代理服务API密钥"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"账户类型"}),e.jsxs("select",{value:be.account_type,onChange:f=>ce({...be,account_type:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"direct",children:"直接API连接"}),e.jsx("option",{value:"proxy_service",children:"代理服务连接"}),e.jsx("option",{value:"custom_proxy",children:"自定义代理"})]})]}),(be.account_type==="proxy_service"||be.account_type==="custom_proxy")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"代理服务地址"}),be.account_type==="proxy_service"?e.jsxs("select",{value:be.proxy_base_url,onChange:f=>ce({...be,proxy_base_url:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"选择代理服务"}),e.jsx("option",{value:"https://claude.cloudcdn7.com/api",children:"CloudCDN7 代理服务"}),e.jsx("option",{value:"https://api.claude-proxy.com/api",children:"Claude Proxy 服务"}),e.jsx("option",{value:"https://claude-api.proxy.com/v1",children:"通用代理服务"}),e.jsx("option",{value:"custom",children:"自定义URL..."})]}):e.jsx("input",{type:"url",value:be.proxy_base_url,onChange:f=>ce({...be,proxy_base_url:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"https://your-proxy-service.com/api"}),be.account_type==="proxy_service"&&be.proxy_base_url==="custom"&&e.jsx("input",{type:"url",value:"",onChange:f=>ce({...be,proxy_base_url:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mt-2",placeholder:"输入自定义代理服务地址"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:be.account_type==="proxy_service"?"选择可信的Claude代理服务提供商，确保服务稳定性和安全性":"输入您自己搭建或信任的代理服务地址"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"每日限额 ($)"}),e.jsx("input",{type:"number",value:be.daily_limit,onChange:f=>ce({...be,daily_limit:parseFloat(f.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"100"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"代理服务器 (可选)"}),e.jsxs("select",{value:be.proxy_id,onChange:f=>ce({...be,proxy_id:f.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"不使用代理"}),i.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>M(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"取消"}),e.jsx("button",{onClick:h,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:"添加账号"})]})]})]})}),R==="scheduler"&&e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"智能调度配置"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"高级调度算法和负载均衡配置"}),e.jsx("button",{onClick:()=>z(!0),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"配置调度规则"})]})}),R==="anomalies"&&e.jsxs("div",{className:"space-y-6",children:[m!=null&&m.anomalies&&m.anomalies.length>0?e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"系统异常警告"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["发现 ",m.anomalies.length," 个需要关注的异常"]})]}),e.jsx("div",{className:"divide-y divide-gray-200",children:m.anomalies.map((f,I)=>e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:`flex-shrink-0 w-2 h-2 mt-2 rounded-full ${f.severity==="high"?"bg-red-500":f.severity==="medium"?"bg-yellow-500":"bg-blue-500"}`}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:f.account_name}),e.jsx("p",{className:"text-sm text-gray-600",children:f.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["检测时间: ",new Date(f.detected_at).toLocaleString()]})]})]}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f.severity==="high"?"bg-red-100 text-red-800":f.severity==="medium"?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:f.severity==="high"?"高风险":f.severity==="medium"?"中等风险":"低风险"})]})},I))})]}):e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"系统运行正常"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"暂未发现异常，所有账户运行状况良好"})]})}),(m==null?void 0:m.recommendations)&&m.recommendations.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"系统优化建议"}),e.jsx("div",{className:"space-y-3",children:m.recommendations.map((f,I)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-blue-500 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-gray-700",children:f})})]},I))})]})]}),R==="anthropic"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Anthropic官方API管理"}),e.jsx("p",{className:"text-sm text-gray-600",children:"直接对接Anthropic官方API服务，无需代理中转"})]}),e.jsxs("button",{onClick:()=>nt(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),e.jsx("span",{children:"添加官方API账户"})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-purple-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总账户数"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:F.length})]})]})}),e.jsx("div",{className:"bg-green-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"活跃账户"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:F.filter(f=>f.status==="active").length})]})]})}),e.jsx("div",{className:"bg-blue-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"总使用额度"}),e.jsxs("p",{className:"text-2xl font-semibold text-gray-900",children:["$",F.reduce((f,I)=>f+(I.daily_limit||0),0).toFixed(2)]})]})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Anthropic账户列表"})}),F.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"暂无Anthropic官方API账户"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"点击上方按钮添加您的第一个Anthropic官方API账户"})]}):e.jsx("div",{className:"divide-y divide-gray-200",children:F.map((f,I)=>{var ue,Ce,Pe;return e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${f.status==="active"?"bg-green-100":f.status==="error"?"bg-red-100":"bg-gray-100"}`,children:e.jsx("svg",{className:`w-6 h-6 ${f.status==="active"?"text-green-600":f.status==="error"?"text-red-600":"text-gray-600"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:f.account_name}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${f.status==="active"?"bg-green-100 text-green-800":f.status==="error"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:f.status==="active"?"运行中":f.status==="error"?"错误":"停用"}),f.has_valid_api_key&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:"已配置API密钥"})]}),e.jsxs("div",{className:"mt-1 text-sm text-gray-500 flex items-center space-x-4",children:[e.jsxs("span",{children:["API版本: ",f.api_version]}),e.jsxs("span",{children:["使用率: ",((ue=f.usage_percentage)==null?void 0:ue.toFixed(1))||0,"%"]}),e.jsxs("span",{children:["优先级: ",f.priority]}),e.jsxs("span",{children:["响应时间: ",f.avg_response_time||0,"ms"]}),f.last_check_at&&e.jsxs("span",{children:["最近检查: ",new Date(f.last_check_at).toLocaleString()]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"每日额度:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",((Ce=f.current_usage)==null?void 0:Ce.toFixed(2))||0," / $",((Pe=f.daily_limit)==null?void 0:Pe.toFixed(2))||0]})]}),e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(f.usage_percentage||0,100)}%`}})})]})})]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>it(f.id),className:"p-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-colors",title:"测试连接",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),e.jsx("button",{onClick:()=>Me(f.id,f.account_name),className:"p-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-colors",title:"删除账户",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},f.id||I)})})]})]})]}),j&&S&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>p(!1)}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full sm:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-green-500 to-blue-600 flex items-center justify-center text-white font-bold text-lg",children:S.account_name.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[S.account_name," 详细信息"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Claude账号使用详情和性能监控"})]})]}),e.jsx("button",{onClick:()=>p(!1),className:"bg-gray-100 hover:bg-gray-200 rounded-lg p-2 transition-colors",children:e.jsx("svg",{className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"基本信息"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-blue-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"API密钥"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900 font-mono",children:[S.api_key.substring(0,12),"...",S.api_key.substring(S.api_key.length-8)]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-blue-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"状态"}),e.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${$(S.status)}`,children:O(S.status)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-blue-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"每日限额"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ee(S.daily_limit)})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-blue-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"当前使用"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ee(S.current_usage)})]}),S.remaining_balance&&e.jsxs("div",{className:"flex justify-between py-2 border-b border-blue-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"剩余余额"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:ee(S.remaining_balance)})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"创建时间"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:V(S.created_at)})]})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"性能统计"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between py-2 border-b border-green-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"总请求数"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:S.total_requests.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-green-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"失败请求数"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:S.failed_requests.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-green-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"成功率"}),e.jsxs("span",{className:`text-sm font-medium ${S.success_rate>95?"text-green-600":S.success_rate>85?"text-yellow-600":"text-red-600"}`,children:[S.success_rate.toFixed(2),"%"]})]}),e.jsxs("div",{className:"flex justify-between py-2 border-b border-green-100",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"平均响应时间"}),e.jsxs("span",{className:`text-sm font-medium ${S.avg_response_time>3e3?"text-red-600":S.avg_response_time>1500?"text-yellow-600":"text-green-600"}`,children:[S.avg_response_time,"ms"]})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"最后使用"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:S.last_used_at?V(S.last_used_at):"从未使用"})]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"关闭"}),e.jsx("button",{onClick:()=>A(S.id),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:"测试连接"})]})]})]})}),oe&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>z(!1)}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full sm:p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"智能调度配置"}),e.jsx("p",{className:"text-sm text-gray-500",children:"配置Claude账号的负载均衡和智能调度规则"})]})]}),e.jsx("button",{onClick:()=>z(!1),className:"bg-gray-100 hover:bg-gray-200 rounded-lg p-2 transition-colors",children:e.jsx("svg",{className:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"负载均衡策略"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"strategy",className:"form-radio text-blue-600",defaultChecked:!0}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"智能权重分配 - 根据账号性能动态调整权重"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"strategy",className:"form-radio text-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"轮询调度 - 依次使用每个账号"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"strategy",className:"form-radio text-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"最小连接数优先 - 优先使用负载最轻的账号"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"健康检查配置"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"检查间隔(秒)"}),e.jsx("input",{type:"number",defaultValue:300,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"超时时间(秒)"}),e.jsx("input",{type:"number",defaultValue:30,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-900 mb-4",children:"故障转移设置"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-blue-600",defaultChecked:!0}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"启用自动故障转移"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-blue-600",defaultChecked:!0}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"账号失败后自动标记为不可用"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-blue-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"达到日限额时自动切换"})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h5",{className:"text-sm font-medium text-blue-900",children:"当前调度状态"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["智能调度器正在运行，当前有 ",a.filter(f=>f.status==="active").length," 个活跃账号参与负载均衡。"]})]})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>z(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"取消"}),e.jsx("button",{onClick:()=>{alert("调度规则配置已保存"),z(!1)},className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors",children:"保存配置"})]})]})]})}),Se&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"​"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full sm:p-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:text-left",children:[e.jsxs("h3",{className:"text-lg leading-6 font-medium text-gray-900 flex items-center",children:[e.jsx("svg",{className:"w-6 h-6 text-purple-600 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"通过Setup Token添加Anthropic账户"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"使用OAuth2安全授权方式连接Anthropic官方API"})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[g&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.99-.833-2.75 0L4.058 18.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-800",children:g})})]})}),pe.step==="initial"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"🚀 Setup Token OAuth 流程"}),e.jsx("p",{className:"text-sm text-blue-700",children:"我们将使用Anthropic的官方OAuth2授权方式来安全地连接您的Claude账户，无需手动输入API密钥。"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["账户名称 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:pe.accountName,onChange:f=>We({...pe,accountName:f.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-purple-500 focus:border-purple-500",placeholder:"例如：主要生产账户",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"每日限额 (USD)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:pe.dailyLimit,onChange:f=>We({...pe,dailyLimit:parseFloat(f.target.value)||50}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-purple-500 focus:border-purple-500",placeholder:"50.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"优先级 (1-100)"}),e.jsx("input",{type:"number",min:"1",max:"100",value:pe.priority,onChange:f=>We({...pe,priority:parseInt(f.target.value)||50}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-purple-500 focus:border-purple-500",placeholder:"50"})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"描述 (可选)"}),e.jsx("textarea",{rows:2,value:pe.description,onChange:f=>We({...pe,description:f.target.value}),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-purple-500 focus:border-purple-500",placeholder:"账户用途说明..."})]})]})]}),pe.step==="auth"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-green-800 mb-2",children:"✅ 授权链接已生成"}),e.jsx("p",{className:"text-sm text-green-700 mb-3",children:"请点击下面的按钮跳转到Anthropic进行授权："}),e.jsxs("a",{href:pe.authUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),"打开Anthropic授权页面"]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"⚠️ 重要说明"}),e.jsx("p",{className:"text-sm text-yellow-700 mb-2",children:"由于Cloudflare保护，请按以下步骤操作："}),e.jsxs("ol",{className:"list-decimal list-inside text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"在新标签页中完成授权"}),e.jsx("li",{children:"授权后会跳转到一个回调页面"}),e.jsxs("li",{children:["复制",e.jsx("strong",{children:"整个回调URL"}),"（包含#access_token=...的完整地址）"]}),e.jsx("li",{children:"将完整URL粘贴到下方输入框"})]}),e.jsx("p",{className:"text-xs text-yellow-600 mt-2",children:"示例URL格式: https://console.anthropic.com/oauth/code/callback#access_token=xxx&token_type=Bearer..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["回调URL或授权码 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{rows:4,value:pe.authCode,onChange:f=>We({...pe,authCode:f.target.value}),className:"block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-purple-500 focus:border-purple-500 text-xs",placeholder:`请粘贴完整的回调URL，例如：
https://console.anthropic.com/oauth/code/callback#access_token=xxx&token_type=Bearer&expires_in=31536000

或者仅粘贴授权码（如果能自动交换）`,required:!0}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"支持两种模式：1) 完整回调URL（推荐） 2) 仅授权码（可能被Cloudflare阻止）"})]}),e.jsx("button",{onClick:()=>We({...pe,step:"initial"}),className:"text-sm text-gray-500 hover:text-gray-700",children:"← 返回上一步"})]}),pe.step==="success"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100",children:e.jsx("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-gray-900",children:"Setup Token账户创建成功！"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:['账户 "',pe.accountName,'" 已成功添加到系统中']}),e.jsx("p",{className:"mt-2 text-xs text-gray-400",children:"窗口将在 3 秒后自动关闭..."})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{nt(!1),Ve(),w(null)},className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",disabled:x,children:"取消"}),pe.step==="initial"&&e.jsxs("button",{onClick:P,disabled:x||!pe.accountName,className:"px-4 py-2 text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[x&&e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"生成授权链接"})]}),pe.step==="auth"&&e.jsxs("button",{onClick:de,disabled:x||!pe.authCode,className:"px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[x&&e.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"创建账户"})]})]})]})]})})]})},lm=()=>{var ge;const s=dt(),{token:t,user:r}=Je(),[a,n]=y.useState(null),[i,l]=y.useState(null),[o,c]=y.useState([]),[d,u]=y.useState(!0),[m,k]=y.useState(null),[x,b]=y.useState("dashboard"),[g,w]=y.useState({min_amount:10,network:""}),[v,L]=y.useState(!1),[C,M]=y.useState(1),[j]=y.useState(20),[p,S]=y.useState(0);y.useEffect(()=>{var Z;if(!r){s("/");return}if(!(r.email==="admin@trademe.com"||r.username==="admin"||((Z=r.email)==null?void 0:Z.includes("admin")))){k("您没有访问用户钱包管理系统的权限");return}},[r,s]);const _=async()=>{try{const T=await fetch("/api/v1/user-wallets/admin/overview",{headers:{Authorization:`Bearer ${t}`}});if(T.ok){const Z=await T.json();if(Z.success)n(Z.data);else throw new Error(Z.message||"获取用户钱包统计失败")}else throw new Error("获取用户钱包统计失败")}catch(T){k(T instanceof Error?T.message:"获取用户钱包统计失败")}},U=async()=>{try{const T=await fetch("/api/v1/fund-consolidation/statistics",{headers:{Authorization:`Bearer ${t}`}});if(T.ok){const Z=await T.json();Z.success&&l(Z.data)}}catch(T){console.warn("获取归集统计失败:",T)}},re=async()=>{try{if(!(a!=null&&a.users))return;const T=[],Z=a.users.slice((C-1)*j,C*j);for(const oe of Z)try{const z=await fetch(`/api/v1/user-wallets/admin/user/${oe.user_id}/wallets`,{headers:{Authorization:`Bearer ${t}`}});if(z.ok){const F=await z.json();F.success&&T.push({...oe,wallets:F.data.wallets})}}catch(z){console.warn(`获取用户 ${oe.user_id} 钱包失败:`,z)}c(T),S(a.users.length)}catch(T){k(T instanceof Error?T.message:"获取用户钱包列表失败")}};y.useEffect(()=>{t&&(async()=>{u(!0),await _(),await U(),u(!1)})()},[t]),y.useEffect(()=>{a&&x==="users"&&re()},[a,C,x]);const X=async T=>{T.preventDefault(),L(!0);try{const Z=await fetch("/api/v1/fund-consolidation/scan",{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(Z.ok){const oe=await Z.json();if(oe.success&&oe.data.length>0){const z=oe.data.filter(F=>!(g.network&&F.network!==g.network||parseFloat(F.amount)<g.min_amount)).slice(0,10).map(F=>F.task_id);if(z.length>0){const F=await fetch("/api/v1/fund-consolidation/execute",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({task_ids:z,strategy:"THRESHOLD"})});if(F.ok){const me=await F.json();me.success&&(alert(`成功发起 ${me.data.executed_tasks} 个归集任务`),await U(),await _())}}else alert("没有符合条件的归集任务")}else alert("当前没有可归集的资金")}else throw new Error("扫描归集机会失败")}catch(Z){alert(Z instanceof Error?Z.message:"发起归集失败")}finally{L(!1)}},te=async T=>{try{const Z=await fetch(`/api/v1/user-wallets/admin/user/${T}/allocate`,{method:"POST",headers:{Authorization:`Bearer ${t}`}});if(Z.ok){const oe=await Z.json();if(oe.success)alert(`成功为用户 ${T} 分配钱包`),await re();else throw new Error(oe.message||"分配钱包失败")}else throw new Error("分配钱包失败")}catch(Z){alert(Z instanceof Error?Z.message:"分配钱包失败")}},R=async T=>{try{const Z=await fetch("/api/v1/user-wallets/consolidate",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({min_amount:1})});if(Z.ok){const oe=await Z.json();if(oe.success)alert(`成功发起用户 ${T} 的资金归集`),await re(),await U();else throw new Error(oe.message||"发起归集失败")}else throw new Error("发起归集失败")}catch(Z){alert(Z instanceof Error?Z.message:"发起归集失败")}},ie=T=>T?new Date(T).toLocaleString("zh-CN"):"无",Y=Math.ceil(p/j);return d?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Rt,{size:"lg"})}):m?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 text-lg mb-4",children:["⚠️ ",m]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"重新加载"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-green-600 to-green-700 flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 113 0m-3 0V2.25"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"用户钱包管理中心"}),e.jsx("p",{className:"text-sm text-gray-600",children:"用户钱包统计、资金归集和管理系统"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 px-4 py-2 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("span",{className:"text-green-700 text-sm font-semibold",children:(ge=r==null?void 0:r.username)==null?void 0:ge.charAt(0).toUpperCase()})}),e.jsxs("span",{className:"text-sm font-medium text-green-700",children:["管理员: ",r==null?void 0:r.username]})]}),e.jsxs("button",{onClick:()=>s("/admin"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-all duration-200 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"返回控制台"})]})]})]})})}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"px-6",children:e.jsx("nav",{className:"flex space-x-8",children:[{id:"dashboard",name:"概览面板",icon:"📊"},{id:"users",name:"用户钱包",icon:"💰"},{id:"consolidation",name:"资金归集",icon:"⚡"},{id:"analytics",name:"数据分析",icon:"📈"}].map(T=>e.jsxs("button",{onClick:()=>b(T.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${x===T.id?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("span",{className:"mr-2",children:T.icon}),T.name]},T.id))})})}),e.jsxs("div",{className:"p-6",children:[x==="dashboard"&&a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 113 0m-3 0V2.25"})})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.summary.total_users})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-semibold mb-1",children:"注册用户"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["已分配钱包 ",a.summary.total_user_wallets," 个"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.summary.funded_wallets})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-semibold mb-1",children:"有资金钱包"}),e.jsxs("p",{className:"text-gray-600 text-sm",children:["占比 ",a.summary.total_user_wallets>0?(a.summary.funded_wallets/a.summary.total_user_wallets*100).toFixed(1):0,"%"]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:Number(a.summary.total_user_balance).toFixed(2)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-semibold mb-1",children:"用户总余额"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"USDT"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9v-9m0-9v9"})})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:a.summary.networks_count})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-900 font-semibold mb-1",children:"支持网络"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"多网络支持"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"网络分布统计"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:a.network_distribution.map(T=>e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-lg text-gray-900",children:T.network}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:T.wallet_count}),e.jsx("p",{className:"text-sm text-gray-600",children:"钱包数量"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600 mt-2",children:[Number(T.total_balance).toFixed(2)," USDT"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"总余额"})]},T.network))})]}),i&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"资金归集统计"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"可归集钱包"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:i.total_wallets_with_funds}),e.jsx("p",{className:"text-sm text-gray-600",children:"个钱包有资金"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"可归集金额"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:Number(i.total_consolidatable_amount).toFixed(2)}),e.jsx("p",{className:"text-sm text-gray-600",children:"USDT"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"今日归集"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:i.completed_consolidations_today}),e.jsx("p",{className:"text-sm text-gray-600",children:"次归集操作"})]})]})]})]}),x==="users"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["用户钱包列表 (共 ",p," 个用户)"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"用户信息"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"钱包统计"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"钱包地址"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"操作"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(T=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[T.username," (ID: ",T.user_id,")"]}),e.jsx("div",{className:"text-sm text-gray-500",children:T.email})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm text-gray-900",children:["钱包数: ",T.wallet_count]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["总余额: ",T.total_balance.toFixed(2)," USDT"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["创建时间: ",ie(T.last_wallet_created)]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"space-y-2",children:T.wallets&&Object.entries(T.wallets).map(([Z,oe])=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded bg-gray-100 text-gray-700",children:Z}),e.jsxs("span",{className:"font-mono text-xs text-gray-600",children:[oe.address.substring(0,8),"...",oe.address.substring(oe.address.length-6)]})]}),e.jsxs("div",{className:"text-xs text-gray-500 ml-2",children:["余额: ",oe.balance.toFixed(2)," USDT"]})]},Z))})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-2",children:[T.wallet_count===0&&e.jsx("button",{onClick:()=>te(T.user_id),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"分配钱包"}),T.total_balance>0&&e.jsx("button",{onClick:()=>R(T.user_id),className:"text-green-600 hover:text-green-800 text-sm font-medium",children:"归集资金"})]})})]},T.user_id))})]})}),Y>1&&e.jsx("div",{className:"px-6 py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["显示第 ",(C-1)*j+1," 到"," ",Math.min(C*j,p)," 个，共 ",p," 个用户"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>M(Math.max(1,C-1)),disabled:C===1,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200",children:"上一页"}),e.jsxs("span",{className:"px-3 py-1 text-sm bg-green-100 text-green-700 rounded",children:["第 ",C," / ",Y," 页"]}),e.jsx("button",{onClick:()=>M(Math.min(Y,C+1)),disabled:C===Y,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200",children:"下一页"})]})]})})]})}),x==="consolidation"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-8 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"⚡"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"资金归集控制"}),e.jsx("p",{className:"text-gray-600",children:"自动扫描用户钱包并归集资金到主钱包"})]})]}),e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["最小归集金额 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",min:"0.1",max:"10000",step:"0.1",value:g.min_amount,onChange:T=>w(Z=>({...Z,min_amount:parseFloat(T.target.value)})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",placeholder:"最小归集金额 (USDT)",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"网络类型筛选"}),e.jsxs("select",{value:g.network,onChange:T=>w(Z=>({...Z,network:T.target.value})),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"",children:"所有网络"}),e.jsx("option",{value:"TRC20",children:"TRC20 (Tron)"}),e.jsx("option",{value:"ERC20",children:"ERC20 (Ethereum)"}),e.jsx("option",{value:"BEP20",children:"BEP20 (Binance Smart Chain)"})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-400 mt-0.5 mr-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"归集说明"}),e.jsx("div",{className:"mt-2 text-sm text-blue-700",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"系统将自动扫描所有用户钱包的资金情况"}),e.jsx("li",{children:"只有达到最小金额阈值的钱包才会被归集"}),e.jsx("li",{children:"归集过程中会自动预留手续费"}),e.jsx("li",{children:"归集任务将在后台异步执行"}),e.jsx("li",{children:"单次最多执行10个归集任务"})]})})]})]})}),e.jsx("button",{type:"submit",disabled:v,className:"w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 font-medium",children:v?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})}),e.jsx("span",{children:"扫描并执行归集中..."})]}):"开始资金归集"})]})]}),i&&e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"归集规则配置"}),e.jsx("div",{className:"space-y-4",children:Object.entries(i.network_breakdown).map(([T,Z])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-medium text-gray-900",children:[T," 网络"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[Z.wallets_count," 个钱包有资金"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"总余额:"}),e.jsxs("span",{className:"font-medium ml-1",children:[Number(Z.total_balance).toFixed(2)," USDT"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"归集阈值:"}),e.jsxs("span",{className:"font-medium ml-1",children:[Number(Z.consolidation_threshold).toFixed(2)," USDT"]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("span",{className:"text-gray-600",children:"主钱包:"}),e.jsx("span",{className:"font-mono text-xs ml-1",children:Z.master_wallet||"未配置"})]})]})]},T))})]})]})]})]})},om=()=>{var gt;const s=dt(),{token:t,user:r}=Je(),[a,n]=y.useState(null),[i,l]=y.useState(!0),[o,c]=y.useState(null),[d,u]=y.useState("overview"),[m,k]=y.useState("kline"),[x,b]=y.useState("spot"),[g,w]=y.useState(""),[v,L]=y.useState(["BTC/USDT"]),[C,M]=y.useState([]),[j,p]=y.useState(!1),[S,_]=y.useState(()=>{try{return new Date(Date.now()-7*24*60*60*1e3).toISOString().substring(0,10)}catch{return"2025-08-24"}}),[U,re]=y.useState(()=>{try{return new Date().toISOString().substring(0,10)}catch{return"2025-08-31"}}),[X,te]=y.useState([]),[R,ie]=y.useState(null),[Y,ge]=y.useState(null),[T,Z]=y.useState(!1),[oe,z]=y.useState(null),[F,me]=y.useState([]),[Se,nt]=y.useState(!1),pe=(P,de)=>P==="spot"?de==="tick"?["BTC","ETH","LTC","XRP","BCH","SOL","ADA","AVAX","MATIC","DOGE"]:["BTC/USDT","ETH/USDT","SOL/USDT","ADA/USDT","DOT/USDT","LINK/USDT","MATIC/USDT","AVAX/USDT","XRP/USDT","DOGE/USDT"]:de==="tick"?["BTC","ETH","LTC","XRP","BCH","SOL","ADA","AVAX"]:["BTC-USDT-SWAP","ETH-USDT-SWAP","SOL-USDT-SWAP","ADA-USDT-SWAP","DOT-USDT-SWAP","LINK-USDT-SWAP"],We=["1m","5m","15m","30m","1h","2h","4h","1d","1w"];y.useEffect(()=>{if(!t||!r){s("/login");return}if(r.membership_level!=="professional"){c("需要专业版权限才能访问数据管理中心"),l(!1);return}},[t,r,s]);const be=async()=>{try{const P=await fetch("/api/v1/data/storage/stats",{headers:{Authorization:`Bearer ${t}`}});if(!P.ok)throw new Error(`HTTP ${P.status}: ${P.statusText}`);const de=await P.json();if(de.success)n(de.data);else throw new Error(de.detail||"数据获取失败");l(!1)}catch(P){console.error("获取数据统计失败:",P),c(P instanceof Error?P.message:"数据获取失败"),l(!1)}},ce=async()=>{try{const de=await(await fetch("/api/v1/data/okx/statistics",{headers:{Authorization:`Bearer ${t}`}})).json();de.success&&ge(de.data)}catch(P){console.error("获取OKX统计失败:",P)}},Ae=async()=>{Z(!0);try{const de=await fetch("/api/v1/data/query?data_type=kline&exchange=okx&symbol=BTC-USDT-SWAP",{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!de.ok)throw new Error(`数据查询失败: ${de.status}`);const Ve=await de.json();if(Ve.success&&Ve.data.query_result){const it=Ve.data.query_result.map(Me=>({exchange:"OKX",symbol:Me.symbol,timeframe:Me.timeframe,record_count:Me.record_count,earliest_date:Me.start_date,latest_date:Me.end_date,timeframes_count:1}));te(it)}else te([])}catch(P){console.error("获取数据可用性失败:",P),te([])}finally{Z(!1)}},Ke=async()=>{try{const de=await(await fetch("/api/v1/data/okx/tasks",{headers:{Authorization:`Bearer ${t}`}})).json();de.success&&Array.isArray(de.data)?M(de.data):(console.warn("OKX tasks data is not an array:",de.data),M([]))}catch(P){console.error("获取OKX任务列表失败:",P)}},Ut=async()=>{if(!Array.isArray(v)||v.length===0){alert("请选择至少一个交易对");return}p(!0);try{const P=m==="tick"?"/api/v1/data/okx/tick/download":"/api/v1/data/okx/kline/download",de=Le=>{try{return typeof Le!="string"||!Le?new Date().toISOString().substring(0,10).replace(/-/g,""):Le.replace(/-/g,"")}catch(N){return console.error("Date formatting error:",N),"20250831"}},Ve=m==="tick"?{symbols:v.filter(Le=>typeof Le=="string"&&Le.length>0),start_date:de(S),end_date:de(U)}:{symbols:v.filter(Le=>typeof Le=="string"&&Le.length>0),timeframes:We,start_date:de(S),end_date:de(U)},Me=await(await fetch(P,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(Ve)})).json();if(Me.success)alert(`OKX ${m==="tick"?"Tick":"K线"}数据下载任务已启动！任务ID: ${Me.data.task_id}`),await Ke();else throw new Error(Me.detail||"下载启动失败")}catch(P){alert(P instanceof Error?P.message:"OKX下载启动失败")}finally{p(!1)}},kt=async()=>{nt(!0);try{const P=["BTC/USDT","ETH/USDT","SOL/USDT"],de=["1h","1d"],it=[];let Me=[];for(const h of P)for(const A of de)it.push(fetch(`/api/v1/data/quality/check/okx/${h}/${A}?check_days=7`,{headers:{Authorization:`Bearer ${t}`}}).then(D=>D.json()).then(D=>D.success&&D.data?(D.data.missing_periods&&D.data.missing_periods.length>0&&D.data.missing_periods.forEach($=>{Me.push({symbol:h,data_type:"K线",timeframe:A,missing_period:$.period||$,missing_count:$.count||0,severity:$.count>100?"critical":"warning"})}),D.data):null).catch(()=>null));const N=(await Promise.all(it)).filter(h=>h!==null);if(N.length>0){const h=N.length,A=N.filter($=>$.completeness_percent>=95).length,D=h>0?A/h*100:0;z({completeness:{kline_completeness:D,tick_completeness:0,missing_dates:[]},accuracy:{price_anomalies:N.reduce(($,O)=>{var V;return $+(((V=O.anomalies)==null?void 0:V.price_anomalies)||0)},0),volume_anomalies:N.reduce(($,O)=>{var V;return $+(((V=O.anomalies)==null?void 0:V.volume_anomalies)||0)},0)}})}else z({completeness:{kline_completeness:0,tick_completeness:0,missing_dates:[]},accuracy:{price_anomalies:0,volume_anomalies:0}});me(Me)}catch(P){console.error("质量检查失败:",P),alert("质量检查失败: "+(P instanceof Error?P.message:"未知错误"))}finally{nt(!1)}};return y.useEffect(()=>{d==="overview"&&t&&(ce(),Ae())},[d,t]),y.useEffect(()=>{t&&r&&(be(),Ke())},[t,r]),y.useEffect(()=>{if(d==="okx-download"){const P=setInterval(Ke,3e3);return()=>clearInterval(P)}},[d,t]),i?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Rt,{size:"lg"})}):o?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-red-600 text-lg mb-4",children:["⚠️ ",o]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"重新加载"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-r from-blue-600 to-blue-700 flex items-center justify-center shadow-lg",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"数据管理中心"}),e.jsx("p",{className:"text-sm text-gray-600",children:"完全集成后端API的数据管理系统"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 px-4 py-2 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx("span",{className:"text-blue-700 text-sm font-semibold",children:(gt=r==null?void 0:r.username)==null?void 0:gt.charAt(0).toUpperCase()})}),e.jsxs("span",{className:"text-sm font-medium text-blue-700",children:["管理员: ",r==null?void 0:r.username]})]}),e.jsxs("button",{onClick:()=>s("/admin"),className:"px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-all duration-200 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),e.jsx("span",{children:"返回控制台"})]})]})]})})}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"px-6",children:e.jsx("nav",{className:"flex space-x-8",children:[{id:"overview",name:"数据概览",icon:"📊"},{id:"okx-download",name:"OKX数据下载",icon:"🚀"},{id:"quality",name:"质量监控",icon:"🔍"}].map(P=>e.jsxs("button",{onClick:()=>u(P.id),className:`py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200 ${d===P.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[e.jsx("span",{className:"mr-2",children:P.icon}),P.name]},P.id))})})}),e.jsxs("div",{className:"p-6",children:[d==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"真实API数据统计概览"}),e.jsxs("button",{onClick:()=>{be(),ce(),Ae()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),e.jsx("span",{children:"刷新数据"})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"数据库真实数据概览"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"显示我们后台现有的所有数据，按交易所、数据类型、市场类型分组"}),T?e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"ml-2 text-gray-600",children:"加载数据中..."})]}):e.jsxs("div",{className:"space-y-6",children:[Y&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-blue-600 font-bold text-sm",children:"OKX"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:"OKX 交易所数据统计"})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4",children:[e.jsx("h5",{className:"font-semibold text-gray-800 mb-3",children:"📊 下载统计"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Y.download_statistics.total_downloads}),e.jsx("div",{className:"text-sm text-gray-600",children:"总下载次数"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Y.download_statistics.successful_downloads}),e.jsx("div",{className:"text-sm text-gray-600",children:"成功下载"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:Y.download_statistics.failed_downloads}),e.jsx("div",{className:"text-sm text-gray-600",children:"失败次数"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:Y.download_statistics.total_files_processed}),e.jsx("div",{className:"text-sm text-gray-600",children:"处理文件数"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[(Y.download_statistics.total_records_downloaded/1e6).toFixed(1),"M"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"下载记录数"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-blue-800 mb-2",children:"📈 K线数据支持的交易对"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"mb-1",children:["总计: ",e.jsxs("span",{className:"font-medium text-blue-700",children:[Y.supported_symbols.kline_data.length,"个"]})]}),e.jsxs("div",{className:"text-gray-600 max-h-20 overflow-y-auto",children:[Y.supported_symbols.kline_data.slice(0,10).join(", "),Y.supported_symbols.kline_data.length>10&&"..."]})]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-green-800 mb-2",children:"⚡ Tick数据支持的交易对"}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"mb-1",children:["总计: ",e.jsxs("span",{className:"font-medium text-green-700",children:[Y.supported_symbols.tick_data.length,"个"]})]}),e.jsxs("div",{className:"text-gray-600 max-h-20 overflow-y-auto",children:[Y.supported_symbols.tick_data.slice(0,10).join(", "),Y.supported_symbols.tick_data.length>10&&"..."]})]})]})]}),e.jsxs("div",{className:"mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h5",{className:"font-semibold text-yellow-800 mb-2",children:"⏰ 支持的时间框架"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Y.supported_timeframes.map(P=>e.jsx("span",{className:"px-2 py-1 bg-yellow-200 text-yellow-800 rounded text-sm font-medium",children:P},P))})]})]}),!Y&&!T&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"📊"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"数据统计信息"}),e.jsx("p",{className:"text-gray-600 mb-4",children:'请点击上方"刷新数据"按钮加载最新数据'})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"🔍 数据查询工具"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"查询数据库中的真实数据情况，了解具体的数据日期范围"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"数据类型"}),e.jsxs("select",{value:m,onChange:P=>k(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"kline",children:"K线数据"}),e.jsx("option",{value:"tick",children:"Tick数据"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"市场类型"}),e.jsxs("select",{value:x,onChange:P=>b(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"spot",children:"现货市场"}),e.jsx("option",{value:"futures",children:"合约市场"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"交易对"}),e.jsxs("select",{value:v[0]||"",onChange:P=>L(P.target.value?[P.target.value]:[]),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"全部"}),pe(x,m).map(P=>e.jsx("option",{value:P,children:P},P))]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsxs("button",{onClick:async()=>{Z(!0);try{const P=v[0]||null,de=P?`/api/v1/data/query?data_type=${m}&exchange=okx&symbol=${encodeURIComponent(P)}`:`/api/v1/data/query?data_type=${m}&exchange=okx`,Ve=localStorage.getItem("auth-storage"),it=Ve?JSON.parse(Ve).state.token:null;if(!it)throw new Error("未找到认证令牌，请重新登录");const Me=await fetch(de,{headers:{Authorization:`Bearer ${it}`,"Content-Type":"application/json"}});if(!Me.ok)throw new Error(`HTTP错误: ${Me.status}`);const Le=await Me.json();Le.success?(te(Le.data.query_result||[]),ie(Le.data.summary||null)):console.error("查询失败:",Le)}catch(P){console.error("查询数据失败:",P)}finally{Z(!1)}},disabled:T,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 transition-colors duration-200 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("span",{children:"查询数据"})]}),e.jsx("button",{onClick:()=>{te([])},className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors duration-200",children:"清除结果"})]}),T&&e.jsxs("div",{className:"flex justify-center items-center py-8",children:[e.jsxs("svg",{className:"animate-spin h-8 w-8 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{className:"ml-2 text-gray-600",children:"查询中..."})]}),X.length>0&&!T&&e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"📊 查询结果"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:X.map((P,de)=>e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-800",children:P.symbol}),P.timeframe&&e.jsx("span",{className:"text-sm text-blue-600 bg-blue-100 px-2 py-1 rounded",children:P.timeframe})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[P.start_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"开始日期:"}),e.jsx("span",{className:"font-medium",children:new Date(P.start_date).toLocaleDateString()})]}),P.end_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"结束日期:"}),e.jsx("span",{className:"font-medium",children:new Date(P.end_date).toLocaleDateString()})]}),P.record_count&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"记录数:"}),e.jsx("span",{className:"font-medium text-blue-600",children:P.record_count.toLocaleString()})]}),P.total_records&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"总记录:"}),e.jsx("span",{className:"font-medium text-green-600",children:P.total_records.toLocaleString()})]}),P.timeframes_count&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"时间框架数:"}),e.jsx("span",{className:"font-medium text-purple-600",children:P.timeframes_count})]}),P.earliest_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"最早数据:"}),e.jsx("span",{className:"font-medium",children:new Date(P.earliest_date).toLocaleDateString()})]}),P.latest_date&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"最新数据:"}),e.jsx("span",{className:"font-medium",children:new Date(P.latest_date).toLocaleDateString()})]})]})]},de))})]}),R&&!T&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-lg p-6 mt-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-4",children:"📈 数据统计摘要"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4",children:[R.total_records&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:R.total_records.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"总记录数"})]}),R.data_completeness_percent!==void 0&&e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-2xl font-bold ${R.data_completeness_percent>=95?"text-green-600":"text-yellow-600"}`,children:[R.data_completeness_percent,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"数据完整度"})]}),R.timeframes_available&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:R.timeframes_available}),e.jsx("div",{className:"text-sm text-gray-600",children:"时间框架"})]}),R.days_span&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:R.days_span}),e.jsx("div",{className:"text-sm text-gray-600",children:"天数跨度"})]}),R.earliest_date&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:new Date(R.earliest_date).toLocaleDateString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"最早日期"})]}),R.latest_date&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-800",children:new Date(R.latest_date).toLocaleDateString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"最新日期"})]})]})]}),!T&&X.length===0&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"📊"}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:"暂无查询结果"}),e.jsx("p",{className:"text-gray-600",children:'请点击"查询数据"按钮来查看数据库中的真实数据情况'})]})]})]}),d==="okx-download"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"OKX 数据下载中心"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"数据类型"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>k("kline"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-200 ${m==="kline"?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"📈 K线数据"}),e.jsx("button",{onClick:()=>k("tick"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-200 ${m==="tick"?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"⚡ Tick数据"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"市场类型"}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:()=>b("spot"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-200 ${x==="spot"?"bg-green-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"💰 现货市场"}),e.jsx("button",{onClick:()=>b("futures"),className:`px-6 py-3 rounded-lg font-medium transition-all duration-200 ${x==="futures"?"bg-orange-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:"📈 合约市场 (永续)"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"交易对选择"}),e.jsx("button",{onClick:()=>{try{const P=pe(x,m);Array.isArray(P)&&L(P)}catch(P){console.error("Error selecting all symbols:",P),L([])}},className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"全选所有"})]}),e.jsx("div",{className:"grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2 mb-4",children:pe(x,m).map(P=>e.jsxs("label",{className:"flex items-center space-x-2 p-2 border rounded cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(v)&&v.includes(P),onChange:de=>{if(!Array.isArray(v)){L([]);return}de.target.checked?L([...v,P]):L(v.filter(Ve=>Ve!==P))},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:P})]},P))}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"text",value:g,onChange:P=>w(P.target.value),placeholder:x==="spot"?m==="tick"?"输入现货Tick交易对 (如: DOGE)":"输入现货K线交易对 (如: DOGE/USDT)":m==="tick"?"输入合约Tick交易对 (如: DOGE)":"输入合约K线交易对 (如: DOGE-USDT-SWAP)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx("button",{onClick:()=>{g&&g.trim()&&Array.isArray(v)&&!v.includes(g.trim())&&(L([...v,g.trim()]),w(""))},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:"添加"})]}),e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:["已选择 ",Array.isArray(v)?v.length:0," 个交易对："]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.isArray(v)&&v.map(P=>e.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm flex items-center space-x-1",children:[e.jsx("span",{children:P}),e.jsx("button",{onClick:()=>{Array.isArray(v)&&L(v.filter(de=>de!==P))},className:"text-blue-600 hover:text-blue-800",children:"×"})]},P))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"时间范围选择"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"开始日期"}),e.jsx("input",{type:"date",value:S,onChange:P=>_(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"结束日期"}),e.jsx("input",{type:"date",value:U,onChange:P=>re(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["选择的时间范围: ",S," 到 ",U]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{const P=new Date(Date.now()-6048e5).toISOString().substring(0,10),de=new Date().toISOString().substring(0,10);_(P),re(de)},className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 transition-colors",children:"最近7天"}),e.jsx("button",{onClick:()=>{const P=new Date(Date.now()-2592e6).toISOString().substring(0,10),de=new Date().toISOString().substring(0,10);_(P),re(de)},className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 transition-colors",children:"最近30天"}),e.jsx("button",{onClick:()=>{const P=new Date(Date.now()-7776e6).toISOString().substring(0,10),de=new Date().toISOString().substring(0,10);_(P),re(de)},className:"px-3 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200 transition-colors",children:"最近3个月"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold mb-2 text-gray-900",children:"时间框架 (自动全选)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:We.map(P=>e.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:["✓ ",P]},P))}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"所有时间框架将自动下载，无需手动选择"})]}),e.jsx("div",{className:"flex justify-center pt-4",children:e.jsx("button",{onClick:Ut,disabled:j||!Array.isArray(v)||v.length===0,className:`px-8 py-3 rounded-lg font-semibold transition-all duration-200 ${j||!Array.isArray(v)||v.length===0?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-blue-600 to-blue-700 text-white hover:from-blue-700 hover:to-blue-800 shadow-lg hover:shadow-xl"}`,children:j?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"正在启动下载..."]}):e.jsxs(e.Fragment,{children:["🚀 开始下载 ",m==="tick"?"Tick":"K线","数据 (",Array.isArray(v)?v.length:0," 个交易对)"]})})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold",children:"下载任务列表"})}),e.jsx("div",{className:"p-6",children:!Array.isArray(C)||C.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"暂无下载任务"}):e.jsx("div",{className:"space-y-4",children:Array.isArray(C)&&C.slice(0,5).map(P=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${P.status==="completed"?"bg-green-500":P.status==="running"?"bg-blue-500":P.status==="failed"?"bg-red-500":"bg-gray-400"}`}),e.jsxs("span",{className:"font-medium",children:[P.data_type.toUpperCase()," - ",P.symbols.join(", ")]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${P.status==="completed"?"bg-green-100 text-green-800":P.status==="running"?"bg-blue-100 text-blue-800":P.status==="failed"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:P.status})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${P.progress}%`}})}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[P.progress,"% - ",P.processed_files,"/",P.total_files," 文件"]})]},P.task_id))})})]})]}),d==="quality"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"数据完整性检测 (真实API)"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:kt,disabled:Se,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400",children:"🔍 开始检测"}),e.jsx("button",{className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200",children:"📊 生成报告"})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:"使用真实API检测数据完整性，精确定位每个缺失时段"})]}),oe&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"K线数据完整性"}),e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-100 flex items-center justify-center",children:e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[oe.completeness.kline_completeness.toFixed(1),"%"]})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"检查结果:"}),e.jsx("span",{className:"font-medium",children:"真实API数据"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"完整性:"}),e.jsxs("span",{className:"font-medium",children:[oe.completeness.kline_completeness.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600",children:"异常数据:"}),e.jsxs("span",{className:"font-medium text-red-600",children:[oe.accuracy.price_anomalies," 处"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Tick数据完整性"}),e.jsx("div",{className:"w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[oe.completeness.tick_completeness.toFixed(1),"%"]})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"检查结果:"}),e.jsx("span",{className:"font-medium",children:"待实现"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"完整性:"}),e.jsxs("span",{className:"font-medium",children:[oe.completeness.tick_completeness.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-600",children:"成交量异常:"}),e.jsxs("span",{className:"font-medium text-red-600",children:[oe.accuracy.volume_anomalies," 处"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"数据异常检测"}),e.jsx("div",{className:"w-16 h-16 rounded-full bg-yellow-100 flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"⚠️"})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"价格异常:"}),e.jsxs("span",{className:"font-medium text-yellow-600",children:[oe.accuracy.price_anomalies," 处"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"成交量异常:"}),e.jsxs("span",{className:"font-medium text-yellow-600",children:[oe.accuracy.volume_anomalies," 处"]})]})]})]})]}),F.length>0&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"详细缺失分析 (真实API数据)"}),e.jsx("p",{className:"text-sm text-gray-600",children:"基于真实API检测结果，精确定位每个缺失时段"})]}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"交易对"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"数据类型"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"时间框架"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"缺失时段"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"缺失数量"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"严重程度"}),e.jsx("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"操作"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:F.map((P,de)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:P.symbol}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P.data_type}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P.timeframe}),e.jsx("td",{className:"px-4 py-3 text-sm",children:P.missing_period}),e.jsx("td",{className:"px-4 py-3 text-sm text-red-600",children:P.missing_count===0?"全时段":`${P.missing_count}条`}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded ${P.severity==="critical"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:P.severity==="critical"?"Critical":"Warning"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{className:"text-blue-600 hover:text-blue-800 text-sm",children:"补全下载"})})]},de))})]})})})]}),!oe&&!Se&&e.jsxs("div",{className:"bg-white rounded-xl p-12 shadow-sm border text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🔍"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"数据质量检测 (真实API)"}),e.jsx("p",{className:"text-gray-600 mb-4",children:'点击"开始检测"按钮运行真实API数据完整性分析'}),e.jsx("button",{onClick:kt,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"🚀 开始质量检测"})]}),Se&&e.jsxs("div",{className:"bg-white rounded-xl p-12 shadow-sm border text-center",children:[e.jsx("div",{className:"flex justify-center items-center mb-4",children:e.jsxs("svg",{className:"animate-spin h-12 w-12 text-blue-600",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"正在执行质量检测..."}),e.jsx("p",{className:"text-gray-600",children:"调用真实API检测数据完整性，请稍候"})]})]})]})]})},cm=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"w-24 h-24 mx-auto bg-gray-200 rounded-full flex items-center justify-center mb-4",children:e.jsx("span",{className:"text-4xl",children:"🔍"})}),e.jsx("h1",{className:"text-6xl font-bold text-gray-900 mb-4",children:"404"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-2",children:"页面未找到"}),e.jsx("p",{className:"text-gray-500 mb-8",children:"抱歉，您访问的页面不存在或已被移动"})]}),e.jsxs("div",{className:"space-x-4",children:[e.jsx(Ge,{to:"/",children:e.jsx(ht,{children:"返回首页"})}),e.jsx(Ge,{to:"/overview",children:e.jsx(ht,{variant:"outline",children:"前往概览页"})})]})]})}),dm=({isOpen:s,onClose:t})=>{const[r,a]=y.useState(!1),[n,i]=y.useState(!1),[l,o]=y.useState([]),[c,d]=y.useState(""),u=y.useRef(null),m=y.useRef(null),{token:k}=Je(),x=y.useCallback(j=>{j.preventDefault(),j.stopPropagation(),j.type==="dragenter"||j.type==="dragover"?a(!0):j.type==="dragleave"&&a(!1)},[]),b=y.useCallback(j=>{j.preventDefault(),j.stopPropagation(),a(!1),j.dataTransfer.files&&j.dataTransfer.files[0]&&v(Array.from(j.dataTransfer.files))},[]),g=y.useCallback(async j=>{var _;const p=(_=j.clipboardData)==null?void 0:_.items;if(!p)return;const S=[];for(let U=0;U<p.length;U++){const re=p[U];if(re.type.indexOf("image")!==-1){const X=re.getAsFile();X&&S.push(X)}}S.length>0&&(j.preventDefault(),v(S))},[]),w=j=>{j.target.files&&v(Array.from(j.target.files))},v=async j=>{const p=j.filter(S=>S.type.startsWith("image/"));if(p.length===0){E.error("请选择图片文件");return}for(const S of p)await L(S)},L=async j=>{if(!k){E.error("请先登录");return}i(!0);try{const p=new FormData;p.append("image",j),p.append("purpose","debug_discussion");const S=await fetch("/api/v1/debug/upload-image",{method:"POST",headers:{Authorization:`Bearer ${k}`},body:p});if(!S.ok)throw new Error("上传失败");const _=await S.json(),U={id:_.id,filename:_.filename,url:_.url,uploadTime:new Date().toLocaleString(),size:j.size};o(X=>[U,...X]),E.success(`图片上传成功: ${_.filename}`);const re=`/root/trademe/uploads/debug/${_.filename}`;await navigator.clipboard.writeText(re),E.success("文件路径已复制到剪贴板")}catch(p){console.error("上传图片失败:",p),E.error("上传图片失败，请重试")}finally{i(!1)}},C=j=>j<1024?j+" B":j<1024*1024?(j/1024).toFixed(1)+" KB":(j/(1024*1024)).toFixed(1)+" MB",M=async j=>{const p=`/root/trademe/uploads/debug/${j}`;try{await navigator.clipboard.writeText(p),E.success("路径已复制")}catch{E.error("复制失败")}};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ma,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"图片粘贴助手"})]}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600",children:e.jsx(zu,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-1",children:"使用方法："}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{children:["• 直接在下方区域 ",e.jsx("kbd",{className:"px-1 py-0.5 bg-blue-100 rounded",children:"Ctrl+V"})," 粘贴截图"]}),e.jsx("li",{children:"• 拖拽图片文件到虚线区域"}),e.jsx("li",{children:"• 点击选择文件按钮上传"}),e.jsx("li",{children:"• 上传后自动复制文件路径，方便Claude查看"})]})]}),e.jsxs("div",{ref:m,className:`
              border-2 border-dashed rounded-lg p-8 text-center transition-colors
              ${r?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}
              ${n?"opacity-50 pointer-events-none":""}
            `,onDragEnter:x,onDragLeave:x,onDragOver:x,onDrop:b,onPaste:g,tabIndex:0,children:[e.jsx(Ma,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),e.jsx("div",{className:"text-gray-600",children:n?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{children:"上传中..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-lg font-medium",children:"点击此区域并粘贴图片 (Ctrl+V)"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"或拖拽图片文件到这里"})]})}),e.jsx("input",{ref:u,type:"file",multiple:!0,accept:"image/*",onChange:w,className:"hidden"}),!n&&e.jsx("button",{onClick:()=>{var j;return(j=u.current)==null?void 0:j.click()},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"选择文件"})]}),l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"已上传图片:"}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:l.map(j=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("img",{src:j.url,alt:j.filename,className:"w-10 h-10 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:j.filename}),e.jsxs("div",{className:"text-xs text-gray-500",children:[C(j.size)," • ",j.uploadTime]})]})]}),e.jsxs("button",{onClick:()=>M(j.filename),className:"flex items-center space-x-1 px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors",children:[e.jsx(Du,{className:"w-3 h-3"}),e.jsx("span",{children:"复制路径"})]})]},j.id))})]})]}),e.jsx("div",{className:"border-t p-4 bg-gray-50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["💡 上传的图片会保存到 ",e.jsx("code",{className:"bg-gray-200 px-1 rounded",children:"/root/trademe/uploads/debug/"})]}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:"关闭"})]})})]})}):null},um=({className:s=""})=>{const[t,r]=y.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>r(!0),className:`
          fixed bottom-6 right-6 z-40
          bg-blue-600 hover:bg-blue-700
          text-white rounded-full
          w-14 h-14
          flex items-center justify-center
          shadow-lg hover:shadow-xl
          transition-all duration-200
          group
          ${s}
        `,title:"粘贴图片讨论",children:[e.jsx(Ma,{className:"w-6 h-6 group-hover:scale-110 transition-transform"}),e.jsx("div",{className:`
          absolute right-16 bottom-2
          bg-gray-800 text-white text-xs
          px-2 py-1 rounded
          opacity-0 group-hover:opacity-100
          transition-opacity duration-200
          whitespace-nowrap
          pointer-events-none
        `,children:"截图讨论前端问题"})]}),e.jsx(dm,{isOpen:t,onClose:()=>r(!1)})]})},Bt=({children:s})=>{var b;const t=zr(),{user:r,logout:a}=Je(),{theme:n,toggleTheme:i}=ea(),{language:l,setLanguage:o,t:c}=ns(),d=[{path:"/ai-chat",label:"AI助手",key:"ai-chat"},{path:"/strategies",label:c("liveTrading"),key:"strategies"},{path:"/backtest",label:c("backtest"),key:"backtest"},{path:"/profile",label:c("accountCenter"),key:"profile"}],u=g=>g==="/ai-chat"?t.pathname==="/ai-chat":g==="/trading"?t.pathname==="/trading":t.pathname.startsWith(g),m=()=>{a(),window.location.href="/login"},k=g=>{o(g)},x=()=>{i()};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors",children:e.jsxs("div",{className:"max-w-[1440px] mx-auto bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden relative transition-colors",children:[e.jsxs("header",{className:"py-4 px-8 flex justify-between border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-brand-500 flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"T"})}),e.jsx("h1",{className:"text-xl font-bold text-brand-500 dark:text-brand-400",children:"Trademe"})]}),e.jsx("nav",{className:"flex gap-2",children:d.map(g=>e.jsx(Ge,{to:g.path,className:`nav-item ${u(g.path)?"active":""}`,children:g.label},g.key))}),e.jsxs("div",{className:"flex items-center relative group",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-gray-200 overflow-hidden cursor-pointer",children:r!=null&&r.avatar_url?e.jsx("img",{src:r.avatar_url,alt:"User avatar",className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-brand-100 text-brand-600 font-medium",children:((b=r==null?void 0:r.username)==null?void 0:b.charAt(0).toUpperCase())||"U"})}),e.jsxs("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r==null?void 0:r.username}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r==null?void 0:r.email}),e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-200 mt-1",children:[(r==null?void 0:r.membership_level)==="basic"&&"基础版",(r==null?void 0:r.membership_level)==="premium"&&"高级版",(r==null?void 0:r.membership_level)==="professional"&&"专业版"]})]}),e.jsx(Ge,{to:"/profile",className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:c("settings")}),e.jsx(Ge,{to:"/profile/membership",className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700",children:c("membershipManagement")}),e.jsx("button",{onClick:m,className:"block w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",children:c("logout")})]})]})]}),e.jsxs("div",{className:"absolute top-4 right-8 flex items-center space-x-4 z-40",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>k("zh"),className:`px-2 py-1 text-sm rounded-md transition-colors ${l==="zh"?"bg-blue-100 text-blue-700 dark:bg-blue-800 dark:text-blue-200":"bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300"}`,children:"中"}),e.jsx("button",{onClick:()=>k("en"),className:`px-2 py-1 text-sm rounded-md transition-colors ${l==="en"?"bg-blue-100 text-blue-700 dark:bg-blue-800 dark:text-blue-200":"bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300"}`,children:"EN"})]}),e.jsx("div",{className:"border-l border-gray-300 dark:border-gray-600 h-6"}),e.jsx("button",{onClick:x,className:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",title:c(n==="light"?"darkMode":"lightMode"),children:n==="light"?e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("circle",{cx:"12",cy:"12",r:"5"}),e.jsx("path",{d:"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"})]}):e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"})})})]}),e.jsx("main",{className:"p-8",children:s}),e.jsx(um,{})]})})},mm=({children:s})=>e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[e.jsx("header",{className:"py-6 px-8 flex justify-center border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-brand-500 flex items-center justify-center mr-3",children:e.jsx("span",{className:"text-white font-bold",children:"T"})}),e.jsx("h1",{className:"text-2xl font-bold text-brand-500",children:"Trademe"})]})}),e.jsxs("div",{className:"absolute top-4 right-4 flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{className:"lang-toggle px-2 py-1 text-sm rounded-md bg-gray-100 hover:bg-gray-200","data-lang":"zh",children:"中"}),e.jsx("button",{className:"lang-toggle px-2 py-1 text-sm rounded-md hover:bg-gray-200","data-lang":"en",children:"EN"})]}),e.jsx("div",{className:"border-l border-gray-300 h-6"}),e.jsx("button",{id:"theme-toggle",className:"p-2 rounded-full hover:bg-gray-200",title:"切换主题",children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"})})})]}),e.jsx("main",{className:"p-8",children:s}),e.jsx("footer",{className:"px-8 pb-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"© 2024 Trademe. 专业的数字货币策略交易平台"})})]})});function hm(){const{isLoading:s,checkAuth:t,token:r,isAuthenticated:a}=Je(),{theme:n}=ea();return y.useEffect(()=>{r&&!a&&t()},[t,r,a]),y.useEffect(()=>{n==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[n]),s?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 transition-colors",children:e.jsx(Rt,{size:"lg"})}):e.jsx(l0,{clientId:"832153922895-6hc3h1qsb72td6gd8lq9vcajq3rborpj.apps.googleusercontent.com",children:e.jsxs(Cl,{children:[e.jsx(Oe,{path:"/login",element:e.jsx(fu,{})}),e.jsx(Oe,{path:"/verification",element:e.jsx(mm,{children:e.jsx(pu,{})})}),e.jsx(Oe,{path:"/",element:e.jsx(g0,{})}),e.jsx(Oe,{path:"/overview",element:e.jsx(et,{children:e.jsx(Bt,{children:e.jsx(_u,{})})})}),e.jsx(Oe,{path:"/strategies",element:e.jsx(et,{children:e.jsx(Bt,{children:e.jsx(Cu,{})})})}),e.jsx(Oe,{path:"/strategy/:strategyId/live",element:e.jsx(et,{children:e.jsx(Bt,{children:e.jsx(Au,{})})})}),e.jsx(Oe,{path:"/live-strategies",element:e.jsx(et,{children:e.jsx(Lu,{})})}),e.jsx(Oe,{path:"/backtest",element:e.jsx(et,{children:e.jsx(Bt,{children:e.jsx(Eu,{})})})}),e.jsx(Oe,{path:"/backtest/:id/details",element:e.jsx(et,{children:e.jsx(Bt,{children:e.jsx(Mu,{})})})}),e.jsx(Oe,{path:"/ai-chat",element:e.jsx(et,{children:e.jsx(Bt,{children:e.jsx(tm,{})})})}),e.jsx(Oe,{path:"/api-keys",element:e.jsx(et,{children:e.jsx(Bt,{children:e.jsx(ti,{})})})}),e.jsx(Oe,{path:"/api-management",element:e.jsx(et,{children:e.jsx(Bt,{children:e.jsx(ti,{})})})}),e.jsx(Oe,{path:"/profile",element:e.jsx(et,{children:e.jsx(Bt,{children:e.jsx(rm,{})})})}),e.jsx(Oe,{path:"/admin",element:e.jsx(et,{children:e.jsx(am,{})})}),e.jsx(Oe,{path:"/admin/users",element:e.jsx(et,{children:e.jsx(nm,{})})}),e.jsx(Oe,{path:"/admin/claude",element:e.jsx(et,{children:e.jsx(im,{})})}),e.jsx(Oe,{path:"/admin/wallets",element:e.jsx(et,{children:e.jsx(lm,{})})}),e.jsx(Oe,{path:"/admin/data",element:e.jsx(et,{children:e.jsx(om,{})})}),e.jsx(Oe,{path:"*",element:e.jsx(cm,{})})]})})}const xm=new ao({defaultOptions:{queries:{staleTime:5*60*1e3,retry:(s,t)=>{var r,a;return((r=t==null?void 0:t.response)==null?void 0:r.status)>=400&&((a=t==null?void 0:t.response)==null?void 0:a.status)<500?!1:s<3}},mutations:{retry:1}}});ma.createRoot(document.getElementById("root")).render(e.jsx(ze.StrictMode,{children:e.jsxs(io,{client:xm,children:[e.jsxs(Al,{children:[e.jsx(hm,{}),e.jsx(Go,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{iconTheme:{primary:"#22c55e",secondary:"#fff"}},error:{iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]}),!1]})}));
//# sourceMappingURL=index-BV6Pjgu2.js.map
