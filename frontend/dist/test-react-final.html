<!DOCTYPE html>
<html>
<head>
    <title>ReactåŠ è½½éªŒè¯æµ‹è¯•</title>
    <style>
        body { font-family: Arial; margin: 20px; line-height: 1.6; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .loading { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; font-size: 12px; overflow-x: auto; }
        .test-result { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .progress { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Reactåº”ç”¨åŠ è½½éªŒè¯</h1>
    
    <div class="status loading" id="status">
        â³ æ­£åœ¨éªŒè¯Reactä¿®å¤æ•ˆæœ...
    </div>
    
    <div class="progress">
        <h3>æµ‹è¯•è¿›åº¦:</h3>
        <div id="progress-log"></div>
    </div>
    
    <div class="test-result">
        <h3>è¯¦ç»†æµ‹è¯•ç»“æœ:</h3>
        <pre id="test-details"></pre>
    </div>
    
    <!-- Reactåº”ç”¨æ ¹èŠ‚ç‚¹ - ç”¨äºæ£€æµ‹æ¸²æŸ“ -->
    <div id="test-root" style="display: none;"></div>
    
    <script type="module">
        let progressLog = [];
        let testDetails = [];
        const progressElement = document.getElementById('progress-log');
        const statusElement = document.getElementById('status');
        const detailsElement = document.getElementById('test-details');
        
        function addProgress(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            progressLog.push(logMessage);
            progressElement.innerHTML = progressLog.join('<br>');
            console.log(logMessage);
        }
        
        function addDetail(message) {
            testDetails.push(message);
            detailsElement.textContent = testDetails.join('\n');
        }
        
        function setStatus(message, className) {
            statusElement.textContent = message;
            statusElement.className = `status ${className}`;
        }
        
        // é”™è¯¯æ•è·
        window.addEventListener('error', (e) => {
            addProgress(`âŒ å…¨å±€é”™è¯¯: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
            addDetail(`Error: ${e.message}\nFile: ${e.filename}:${e.lineno}:${e.colno}\nStack: ${e.error?.stack || 'N/A'}`);
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            addProgress(`âŒ Promiseé”™è¯¯: ${e.reason}`, 'error');
            addDetail(`Promise Rejection: ${e.reason}`);
        });
        
        async function runTests() {
            try {
                addProgress('ğŸš€ å¼€å§‹ReactåŠ è½½éªŒè¯æµ‹è¯•');
                
                // æµ‹è¯•1: æ£€æŸ¥åŸºæœ¬çš„æµè§ˆå™¨ç¯å¢ƒ
                addProgress('1ï¸âƒ£ æ£€æŸ¥æµè§ˆå™¨ç¯å¢ƒ...');
                const envTest = {
                    importMeta: typeof import.meta !== 'undefined',
                    viteModeExists: typeof import.meta.env !== 'undefined',
                    viteMode: import.meta.env?.MODE,
                    vitePublicTest: import.meta.env?.VITE_PUBLIC_TEST
                };
                addDetail(`Browser Environment:\n${JSON.stringify(envTest, null, 2)}`);
                addProgress('âœ… æµè§ˆå™¨ç¯å¢ƒæ£€æŸ¥å®Œæˆ');
                
                // æµ‹è¯•2: å°è¯•åˆ›å»ºåŸºæœ¬Reactå…ƒç´ 
                addProgress('2ï¸âƒ£ æµ‹è¯•Reactå¯¼å…¥...');
                
                let reactModule, reactDomModule;
                
                try {
                    reactModule = await import('/node_modules/.vite/deps/react.js?v=0ef459ff');
                    addProgress('âœ… Reactæ¨¡å—å¯¼å…¥æˆåŠŸ');
                    addDetail(`React version: ${reactModule.version || 'unknown'}`);
                } catch (error) {
                    addProgress(`âŒ Reactæ¨¡å—å¯¼å…¥å¤±è´¥: ${error.message}`);
                    addDetail(`React import error: ${error.stack}`);
                }
                
                try {
                    reactDomModule = await import('/node_modules/.vite/deps/react-dom_client.js?v=0ef459ff');
                    addProgress('âœ… ReactDOMæ¨¡å—å¯¼å…¥æˆåŠŸ');
                } catch (error) {
                    addProgress(`âŒ ReactDOMæ¨¡å—å¯¼å…¥å¤±è´¥: ${error.message}`);
                    addDetail(`ReactDOM import error: ${error.stack}`);
                }
                
                // æµ‹è¯•3: æµ‹è¯•websocketManager
                addProgress('3ï¸âƒ£ æµ‹è¯•WebSocketManager...');
                try {
                    const wsManager = await import('/src/utils/websocketManager.ts');
                    addProgress('âœ… WebSocketManagerå¯¼å…¥æˆåŠŸï¼Œprocessé”™è¯¯å·²ä¿®å¤');
                    addDetail(`WebSocketManager config: baseUrl=${wsManager.wsManager?.config?.baseUrl || 'N/A'}`);
                } catch (error) {
                    addProgress(`âŒ WebSocketManagerå¯¼å…¥å¤±è´¥: ${error.message}`);
                    addDetail(`WebSocketManager error: ${error.stack}`);
                }
                
                // æµ‹è¯•4: æ£€æŸ¥ä¸»åº”ç”¨
                addProgress('4ï¸âƒ£ å°è¯•å¯¼å…¥ä¸»åº”ç”¨...');
                try {
                    const mainApp = await import('/src/main.tsx');
                    addProgress('âœ… ä¸»åº”ç”¨å¯¼å…¥æˆåŠŸï¼');
                    addDetail(`Main app exported: ${Object.keys(mainApp).join(', ')}`);
                    
                    // æµ‹è¯•æ¸²æŸ“
                    addProgress('5ï¸âƒ£ æ£€æŸ¥é¡µé¢æ ¹å…ƒç´ ...');
                    const rootElement = document.getElementById('root');
                    if (rootElement) {
                        addProgress('âœ… æ‰¾åˆ°#rootå…ƒç´ ');
                        const rootContent = rootElement.innerHTML;
                        if (rootContent.trim() && !rootContent.includes('Reactåº”ç”¨å°†åœ¨è¿™é‡Œæ¸²æŸ“')) {
                            addProgress('âœ… Reactåº”ç”¨å·²æˆåŠŸæ¸²æŸ“åˆ°é¡µé¢ï¼');
                            addDetail(`Root element content length: ${rootContent.length} characters`);
                            setStatus('âœ… Reactåº”ç”¨åŠ è½½æˆåŠŸï¼Œæ‰€æœ‰é—®é¢˜å·²ä¿®å¤ï¼', 'success');
                        } else {
                            addProgress('âš ï¸ #rootå…ƒç´ å­˜åœ¨ä½†å†…å®¹ä¸ºç©ºæˆ–æ˜¾ç¤ºå ä½æ–‡æœ¬');
                            addDetail(`Root element content: ${rootContent.substring(0, 500)}...`);
                        }
                    } else {
                        addProgress('âŒ æœªæ‰¾åˆ°#rootå…ƒç´ ');
                    }
                    
                } catch (error) {
                    addProgress(`âŒ ä¸»åº”ç”¨å¯¼å…¥å¤±è´¥: ${error.message}`);
                    addDetail(`Main app error: ${error.stack}`);
                    setStatus('âŒ Reactåº”ç”¨ä»å­˜åœ¨åŠ è½½é—®é¢˜', 'error');
                }
                
                addProgress('ğŸ¯ æµ‹è¯•å®Œæˆï¼');
                
            } catch (error) {
                addProgress(`âŒ æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}`);
                addDetail(`Test execution error: ${error.stack}`);
                setStatus('âŒ éªŒè¯æµ‹è¯•å¤±è´¥', 'error');
            }
        }
        
        // ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åå¼€å§‹æµ‹è¯•
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTests);
        } else {
            setTimeout(runTests, 1000);
        }
    </script>
</body>
</html>