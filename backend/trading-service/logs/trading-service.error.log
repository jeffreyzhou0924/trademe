{"text": "2025-08-21 13:34:39.908 | ERROR    | app.middleware.structured_logging:log_request_end:153 | bb4e5b05-ce11-4582-9bf9-49cafc95d724 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:34.267957", "seconds": 94.267957}, "exception": null, "extra": {"request_id": "bb4e5b05-ce11-4582-9bf9-49cafc95d724", "extra": {"structured_data": {"request_id": "bb4e5b05-ce11-4582-9bf9-49cafc95d724", "method": "GET", "url": "http://localhost:8001/api/v1/strategies/", "path": "/api/v1/strategies/", "query_params": {}, "headers": {"host": "localhost:8001", "authorization": "[FILTERED]", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "client_ip": "127.0.0.1", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-08-21T05:34:39.908139+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "315", "content-type": "application/json"}, "duration_ms": 16.73}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 752794, "name": "SpawnProcess-2"}, "thread": {"id": 128082262339712, "name": "MainThread"}, "time": {"repr": "2025-08-21 13:34:39.908174+08:00", "timestamp": 1755754479.908174}}}
{"text": "2025-08-21 15:43:43.650 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 32dd4a1f-e5a9-480d-812d-156d4ed04d5b | Server error: 500\n", "record": {"elapsed": {"repr": "2:10:38.010615", "seconds": 7838.010615}, "exception": null, "extra": {"request_id": "32dd4a1f-e5a9-480d-812d-156d4ed04d5b", "extra": {"structured_data": {"request_id": "32dd4a1f-e5a9-480d-812d-156d4ed04d5b", "method": "GET", "url": "http://43.167.252.120/api/v1/strategies/", "path": "/api/v1/strategies/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.57", "x-forwarded-for": "208.87.243.57", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/test.html"}, "client_ip": "208.87.243.57", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36", "timestamp": "2025-08-21T07:43:43.650802+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "557", "content-type": "application/json"}, "duration_ms": 34.84}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 752794, "name": "SpawnProcess-2"}, "thread": {"id": 128082262339712, "name": "MainThread"}, "time": {"repr": "2025-08-21 15:43:43.650832+08:00", "timestamp": 1755762223.650832}}}
{"text": "2025-08-21 19:36:03.709 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 5d08761a-b9d5-426e-8dcf-ed1a804ef87c | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:26.801757", "seconds": 86.801757}, "exception": null, "extra": {"request_id": "5d08761a-b9d5-426e-8dcf-ed1a804ef87c", "extra": {"structured_data": {"request_id": "5d08761a-b9d5-426e-8dcf-ed1a804ef87c", "method": "GET", "url": "http://43.167.252.120/api/v1/strategies/", "path": "/api/v1/strategies/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "43.167.252.120", "x-forwarded-for": "43.167.252.120", "x-forwarded-proto": "http", "connection": "close", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-21T11:36:03.709304+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "557", "content-type": "application/json"}, "duration_ms": 27.87}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 880746, "name": "SpawnProcess-2"}, "thread": {"id": 132338034368640, "name": "MainThread"}, "time": {"repr": "2025-08-21 19:36:03.709342+08:00", "timestamp": 1755776163.709342}}}
{"text": "2025-08-21 23:38:11.738 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 2c896f50-e450-49e9-995e-fcafc2dad2bb | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:25.124498", "seconds": 85.124498}, "exception": null, "extra": {"request_id": "2c896f50-e450-49e9-995e-fcafc2dad2bb", "extra": {"structured_data": {"request_id": "2c896f50-e450-49e9-995e-fcafc2dad2bb", "method": "GET", "url": "http://localhost:8001/api/v1/market/klines/BTCUSDT?exchange=okx&timeframe=1h&limit=5", "path": "/api/v1/market/klines/BTCUSDT", "query_params": {"exchange": "okx", "timeframe": "1h", "limit": "5"}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-21T15:38:11.738473+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "76", "content-type": "application/json"}, "duration_ms": 897.12}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 967099, "name": "SpawnProcess-1"}, "thread": {"id": 129687266164864, "name": "MainThread"}, "time": {"repr": "2025-08-21 23:38:11.738497+08:00", "timestamp": 1755790691.738497}}}
{"text": "2025-08-22 12:19:30.738 | ERROR    | app.middleware.structured_logging:log_request_end:153 | ef9dbc3e-ff1a-4b83-a573-8fe3acbfcb82 | Server error: 500\n", "record": {"elapsed": {"repr": "0:20:35.449477", "seconds": 1235.449477}, "exception": null, "extra": {"request_id": "ef9dbc3e-ff1a-4b83-a573-8fe3acbfcb82", "extra": {"structured_data": {"request_id": "ef9dbc3e-ff1a-4b83-a573-8fe3acbfcb82", "method": "GET", "url": "http://localhost:8001/api/v1/api-keys/", "path": "/api/v1/api-keys/", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-22T04:19:30.738459+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "40", "content-type": "application/json"}, "duration_ms": 12.7}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1207438, "name": "SpawnProcess-1"}, "thread": {"id": 137348030345344, "name": "MainThread"}, "time": {"repr": "2025-08-22 12:19:30.738496+08:00", "timestamp": 1755836370.738496}}}
{"text": "2025-08-22 12:20:52.268 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 21903d93-5f2a-4da3-abd7-5f5676cde6ce | Server error: 500\n", "record": {"elapsed": {"repr": "0:21:56.979580", "seconds": 1316.97958}, "exception": null, "extra": {"request_id": "21903d93-5f2a-4da3-abd7-5f5676cde6ce", "extra": {"structured_data": {"request_id": "21903d93-5f2a-4da3-abd7-5f5676cde6ce", "method": "POST", "url": "http://localhost:8001/api/v1/api-keys/", "path": "/api/v1/api-keys/", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "190"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-22T04:20:52.266523+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "34", "content-type": "application/json"}, "duration_ms": 64.68}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1207438, "name": "SpawnProcess-1"}, "thread": {"id": 137348030345344, "name": "MainThread"}, "time": {"repr": "2025-08-22 12:20:52.268599+08:00", "timestamp": 1755836452.268599}}}
{"text": "2025-08-22 13:46:03.652 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 825be8b1-e8dc-43de-849d-21cdf2417e3b | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:56.676494", "seconds": 236.676494}, "exception": null, "extra": {"request_id": "825be8b1-e8dc-43de-849d-21cdf2417e3b", "extra": {"structured_data": {"request_id": "825be8b1-e8dc-43de-849d-21cdf2417e3b", "method": "GET", "url": "http://localhost:8001/api/v1/membership/usage-stats", "path": "/api/v1/membership/usage-stats", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-22T05:46:03.652103+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "85", "content-type": "application/json"}, "duration_ms": 3.84}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1243685, "name": "SpawnProcess-10"}, "thread": {"id": 126496160792704, "name": "MainThread"}, "time": {"repr": "2025-08-22 13:46:03.652136+08:00", "timestamp": 1755841563.652136}}}
{"text": "2025-08-22 19:58:33.462 | ERROR    | app.middleware.structured_logging:log_request_end:153 | dfc258a3-1a23-4f99-9620-6faffd5515fa | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:05.806052", "seconds": 125.806052}, "exception": null, "extra": {"request_id": "dfc258a3-1a23-4f99-9620-6faffd5515fa", "extra": {"structured_data": {"request_id": "dfc258a3-1a23-4f99-9620-6faffd5515fa", "method": "POST", "url": "http://localhost:8001/api/v1/trading-notes/ai-analysis", "path": "/api/v1/trading-notes/ai-analysis", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-22T11:58:33.462473+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "27", "content-type": "application/json"}, "duration_ms": 4.26}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1374632, "name": "SpawnProcess-46"}, "thread": {"id": 133968729960576, "name": "MainThread"}, "time": {"repr": "2025-08-22 19:58:33.462494+08:00", "timestamp": 1755863913.462494}}}
{"text": "2025-08-23 09:56:20.132 | ERROR    | app.middleware.structured_logging:log_request_end:153 | bad0f3cf-fc93-4f13-ad0c-b0a9d21f3dd1 | Server error: 500\n", "record": {"elapsed": {"repr": "13:56:47.758576", "seconds": 50207.758576}, "exception": null, "extra": {"request_id": "bad0f3cf-fc93-4f13-ad0c-b0a9d21f3dd1", "extra": {"structured_data": {"request_id": "bad0f3cf-fc93-4f13-ad0c-b0a9d21f3dd1", "method": "POST", "url": "http://43.167.252.120/api/v1/backtests/", "path": "/api/v1/backtests/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "62.197.154.30", "x-forwarded-for": "62.197.154.30", "x-forwarded-proto": "http", "connection": "close", "content-length": "175", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/backtest"}, "client_ip": "62.197.154.30", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-23T01:56:20.132111+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "97", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 6.43}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1375679, "name": "SpawnProcess-48"}, "thread": {"id": 140495922839680, "name": "MainThread"}, "time": {"repr": "2025-08-23 09:56:20.132137+08:00", "timestamp": 1755914180.132137}}}
{"text": "2025-08-23 09:56:33.552 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 5af75f93-1adb-423d-a68b-566bf084ab80 | Server error: 500\n", "record": {"elapsed": {"repr": "13:57:01.178736", "seconds": 50221.178736}, "exception": null, "extra": {"request_id": "5af75f93-1adb-423d-a68b-566bf084ab80", "extra": {"structured_data": {"request_id": "5af75f93-1adb-423d-a68b-566bf084ab80", "method": "POST", "url": "http://43.167.252.120/api/v1/backtests/", "path": "/api/v1/backtests/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "62.197.154.30", "x-forwarded-for": "62.197.154.30", "x-forwarded-proto": "http", "connection": "close", "content-length": "171", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/backtest"}, "client_ip": "62.197.154.30", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-23T01:56:33.552271+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "97", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 3.6}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1375679, "name": "SpawnProcess-48"}, "thread": {"id": 140495922839680, "name": "MainThread"}, "time": {"repr": "2025-08-23 09:56:33.552297+08:00", "timestamp": 1755914193.552297}}}
{"text": "2025-08-23 09:57:59.310 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 09fe5944-ad40-4460-95d5-dbf940cc307c | Server error: 500\n", "record": {"elapsed": {"repr": "13:58:26.937141", "seconds": 50306.937141}, "exception": null, "extra": {"request_id": "09fe5944-ad40-4460-95d5-dbf940cc307c", "extra": {"structured_data": {"request_id": "09fe5944-ad40-4460-95d5-dbf940cc307c", "method": "POST", "url": "http://43.167.252.120/api/v1/backtests/", "path": "/api/v1/backtests/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "43.167.252.120", "x-forwarded-for": "43.167.252.120", "x-forwarded-proto": "http", "connection": "close", "content-length": "222", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-23T01:57:59.310671+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "97", "content-type": "application/json"}, "duration_ms": 4.31}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1375679, "name": "SpawnProcess-48"}, "thread": {"id": 140495922839680, "name": "MainThread"}, "time": {"repr": "2025-08-23 09:57:59.310702+08:00", "timestamp": 1755914279.310702}}}
{"text": "2025-08-23 15:37:20.759 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 75e3a39b-6461-4466-ae36-e9414a6658a0 | Server error: 500\n", "record": {"elapsed": {"repr": "4:19:42.602589", "seconds": 15582.602589}, "exception": null, "extra": {"request_id": "75e3a39b-6461-4466-ae36-e9414a6658a0", "extra": {"structured_data": {"request_id": "75e3a39b-6461-4466-ae36-e9414a6658a0", "method": "POST", "url": "http://43.167.252.120/api/v1/trading-notes/ai-analysis", "path": "/api/v1/trading-notes/ai-analysis", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.183", "x-forwarded-for": "208.87.243.183", "x-forwarded-proto": "http", "connection": "close", "content-length": "0", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/trading-notes"}, "client_ip": "208.87.243.183", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-23T07:37:20.759135+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "27", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 5.46}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1668338, "name": "SpawnProcess-1"}, "thread": {"id": 124615261634688, "name": "MainThread"}, "time": {"repr": "2025-08-23 15:37:20.759160+08:00", "timestamp": 1755934640.75916}}}
{"text": "2025-08-23 18:54:27.597 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 97121d54-8d0f-467c-b62e-e0949dc3c15b | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:32.938146", "seconds": 32.938146}, "exception": null, "extra": {"request_id": "97121d54-8d0f-467c-b62e-e0949dc3c15b", "extra": {"structured_data": {"request_id": "97121d54-8d0f-467c-b62e-e0949dc3c15b", "method": "GET", "url": "http://localhost:8001/api/v1/membership/usage-stats", "path": "/api/v1/membership/usage-stats", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-23T10:54:27.597704+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "650", "content-type": "application/json"}, "duration_ms": 67.78}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1819287, "name": "SpawnProcess-31"}, "thread": {"id": 130959724249216, "name": "MainThread"}, "time": {"repr": "2025-08-23 18:54:27.597747+08:00", "timestamp": 1755946467.597747}}}
{"text": "2025-08-24 13:27:25.610 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6af13a99-1574-4c4c-92c9-cac0b7294a35 | Server error: 500\n", "record": {"elapsed": {"repr": "0:31:38.207481", "seconds": 1898.207481}, "exception": null, "extra": {"request_id": "6af13a99-1574-4c4c-92c9-cac0b7294a35", "extra": {"structured_data": {"request_id": "6af13a99-1574-4c4c-92c9-cac0b7294a35", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/sessions", "path": "/api/v1/ai/sessions", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.183", "x-forwarded-for": "208.87.243.183", "x-forwarded-proto": "http", "connection": "close", "content-length": "161", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "208.87.243.183", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-24T05:27:25.610124+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 5.4}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2163461, "name": "SpawnProcess-46"}, "thread": {"id": 124716442124416, "name": "MainThread"}, "time": {"repr": "2025-08-24 13:27:25.610148+08:00", "timestamp": 1756013245.610148}}}
{"text": "2025-08-24 13:43:16.862 | ERROR    | app.middleware.structured_logging:log_request_end:153 | efc129cd-7efd-4b01-bee2-a54692591c7e | Server error: 500\n", "record": {"elapsed": {"repr": "0:47:29.459503", "seconds": 2849.459503}, "exception": null, "extra": {"request_id": "efc129cd-7efd-4b01-bee2-a54692591c7e", "extra": {"structured_data": {"request_id": "efc129cd-7efd-4b01-bee2-a54692591c7e", "method": "POST", "url": "http://localhost:8001/api/v1/ai/sessions", "path": "/api/v1/ai/sessions", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "python-requests/2.31.0", "accept-encoding": "gzip, deflate", "accept": "*/*", "connection": "keep-alive", "authorization": "[FILTERED]", "content-length": "87", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "python-requests/2.31.0", "timestamp": "2025-08-24T05:43:16.862151+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json"}, "duration_ms": 3.14}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2163461, "name": "SpawnProcess-46"}, "thread": {"id": 124716442124416, "name": "MainThread"}, "time": {"repr": "2025-08-24 13:43:16.862170+08:00", "timestamp": 1756014196.86217}}}
{"text": "2025-08-24 13:47:00.742 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a7d9340f-9dfe-410e-93fb-77798d5e91ae | Server error: 500\n", "record": {"elapsed": {"repr": "0:51:13.340332", "seconds": 3073.340332}, "exception": null, "extra": {"request_id": "a7d9340f-9dfe-410e-93fb-77798d5e91ae", "extra": {"structured_data": {"request_id": "a7d9340f-9dfe-410e-93fb-77798d5e91ae", "method": "POST", "url": "http://localhost:8001/api/v1/ai/sessions", "path": "/api/v1/ai/sessions", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "python-requests/2.31.0", "accept-encoding": "gzip, deflate", "accept": "*/*", "connection": "keep-alive", "authorization": "[FILTERED]", "content-length": "87", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "python-requests/2.31.0", "timestamp": "2025-08-24T05:47:00.742962+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json"}, "duration_ms": 9.94}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2163461, "name": "SpawnProcess-46"}, "thread": {"id": 124716442124416, "name": "MainThread"}, "time": {"repr": "2025-08-24 13:47:00.742999+08:00", "timestamp": 1756014420.742999}}}
{"text": "2025-08-24 13:51:55.248 | ERROR    | app.middleware.structured_logging:log_request_end:153 | eb331378-f89e-43d8-9854-63451a9ffbc9 | Server error: 500\n", "record": {"elapsed": {"repr": "0:56:07.846105", "seconds": 3367.846105}, "exception": null, "extra": {"request_id": "eb331378-f89e-43d8-9854-63451a9ffbc9", "extra": {"structured_data": {"request_id": "eb331378-f89e-43d8-9854-63451a9ffbc9", "method": "POST", "url": "http://localhost:8001/api/v1/ai/sessions", "path": "/api/v1/ai/sessions", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "python-requests/2.31.0", "accept-encoding": "gzip, deflate", "accept": "*/*", "connection": "keep-alive", "authorization": "[FILTERED]", "content-length": "87", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "python-requests/2.31.0", "timestamp": "2025-08-24T05:51:55.248737+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json"}, "duration_ms": 8.59}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2163461, "name": "SpawnProcess-46"}, "thread": {"id": 124716442124416, "name": "MainThread"}, "time": {"repr": "2025-08-24 13:51:55.248772+08:00", "timestamp": 1756014715.248772}}}
{"text": "2025-08-24 13:57:19.401 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 51721040-f829-4663-9f7f-090ef6715d3f | Server error: 500\n", "record": {"elapsed": {"repr": "1:01:31.999059", "seconds": 3691.999059}, "exception": null, "extra": {"request_id": "51721040-f829-4663-9f7f-090ef6715d3f", "extra": {"structured_data": {"request_id": "51721040-f829-4663-9f7f-090ef6715d3f", "method": "POST", "url": "http://localhost:8001/api/v1/ai/sessions", "path": "/api/v1/ai/sessions", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "python-requests/2.31.0", "accept-encoding": "gzip, deflate", "accept": "*/*", "connection": "keep-alive", "authorization": "[FILTERED]", "content-length": "174", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "python-requests/2.31.0", "timestamp": "2025-08-24T05:57:19.401694+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json"}, "duration_ms": 7.97}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2163461, "name": "SpawnProcess-46"}, "thread": {"id": 124716442124416, "name": "MainThread"}, "time": {"repr": "2025-08-24 13:57:19.401726+08:00", "timestamp": 1756015039.401726}}}
{"text": "2025-08-24 22:07:12.871 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 44c68d03-1f2b-4402-8c77-9b9edd370702 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:32.288549", "seconds": 32.288549}, "exception": null, "extra": {"request_id": "44c68d03-1f2b-4402-8c77-9b9edd370702", "extra": {"structured_data": {"request_id": "44c68d03-1f2b-4402-8c77-9b9edd370702", "method": "GET", "url": "http://localhost:8001/api/v1/trading/live-strategies", "path": "/api/v1/trading/live-strategies", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-24T14:07:12.871323+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "80", "content-type": "application/json"}, "duration_ms": 13.67}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2343786, "name": "SpawnProcess-2"}, "thread": {"id": 130376797696128, "name": "MainThread"}, "time": {"repr": "2025-08-24 22:07:12.871365+08:00", "timestamp": 1756044432.871365}}}
{"text": "2025-08-25 11:20:08.853 | ERROR    | app.middleware.structured_logging:log_error:184 | 3ca461f6-4453-4496-a77e-ba4d63aef882 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:01:22.052923", "seconds": 82.052923}, "exception": null, "extra": {"request_id": "3ca461f6-4453-4496-a77e-ba4d63aef882", "extra": {"structured_data": {"request_id": "3ca461f6-4453-4496-a77e-ba4d63aef882", "method": "GET", "url": "http://localhost:8001/api/v1/admin/stats/system", "path": "/api/v1/admin/stats/system", "client_ip": "127.0.0.1", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 11.62, "timestamp": "2025-08-25T03:20:08.853495+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2611392, "name": "SpawnProcess-17"}, "thread": {"id": 128122299719808, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:20:08.853576+08:00", "timestamp": 1756092008.853576}}}
{"text": "2025-08-25 11:21:56.100 | ERROR    | app.middleware.structured_logging:log_request_end:153 | bcd88083-dc17-4961-82db-26ae78798bdf | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:04.901102", "seconds": 64.901102}, "exception": null, "extra": {"request_id": "bcd88083-dc17-4961-82db-26ae78798bdf", "extra": {"structured_data": {"request_id": "bcd88083-dc17-4961-82db-26ae78798bdf", "method": "GET", "url": "http://localhost:8001/api/v1/admin/users?limit=5", "path": "/api/v1/admin/users", "query_params": {"limit": "5"}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T03:21:56.100809+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 13.35}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2612132, "name": "SpawnProcess-19"}, "thread": {"id": 130622170689664, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:21:56.100844+08:00", "timestamp": 1756092116.100844}}}
{"text": "2025-08-25 11:22:17.827 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 65bdb1da-a904-4601-8876-f76952a7a1c9 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:08.567656", "seconds": 8.567656}, "exception": null, "extra": {"request_id": "65bdb1da-a904-4601-8876-f76952a7a1c9", "extra": {"structured_data": {"request_id": "65bdb1da-a904-4601-8876-f76952a7a1c9", "method": "GET", "url": "http://localhost:8001/api/v1/admin/users?limit=3", "path": "/api/v1/admin/users", "query_params": {"limit": "3"}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T03:22:17.827562+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 53.1}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2612631, "name": "SpawnProcess-20"}, "thread": {"id": 126073837400192, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:22:17.827604+08:00", "timestamp": 1756092137.827604}}}
{"text": "2025-08-25 11:22:41.714 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 4d36c624-1f70-479e-9af7-24cde1c8208f | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:09.293095", "seconds": 9.293095}, "exception": null, "extra": {"request_id": "4d36c624-1f70-479e-9af7-24cde1c8208f", "extra": {"structured_data": {"request_id": "4d36c624-1f70-479e-9af7-24cde1c8208f", "method": "GET", "url": "http://localhost:8001/api/v1/admin/users?limit=2", "path": "/api/v1/admin/users", "query_params": {"limit": "2"}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T03:22:41.714173+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 32.87}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2612781, "name": "SpawnProcess-21"}, "thread": {"id": 130772882010240, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:22:41.714204+08:00", "timestamp": 1756092161.714204}}}
{"text": "2025-08-25 11:23:50.065 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b1c486b5-1160-44ff-b1fe-627e32f487f5 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:42.784144", "seconds": 42.784144}, "exception": null, "extra": {"request_id": "b1c486b5-1160-44ff-b1fe-627e32f487f5", "extra": {"structured_data": {"request_id": "b1c486b5-1160-44ff-b1fe-627e32f487f5", "method": "GET", "url": "http://localhost:8001/api/v1/admin/users?limit=2", "path": "/api/v1/admin/users", "query_params": {"limit": "2"}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T03:23:50.065151+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 77.62}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2613010, "name": "SpawnProcess-22"}, "thread": {"id": 138592896540800, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:23:50.065191+08:00", "timestamp": 1756092230.065191}}}
{"text": "2025-08-25 11:37:37.600 | ERROR    | app.middleware.structured_logging:log_request_end:153 | df7783be-d731-4989-a02d-766e23c015f4 | Server error: 500\n", "record": {"elapsed": {"repr": "0:14:30.319874", "seconds": 870.319874}, "exception": null, "extra": {"request_id": "df7783be-d731-4989-a02d-766e23c015f4", "extra": {"structured_data": {"request_id": "df7783be-d731-4989-a02d-766e23c015f4", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users?limit=5", "path": "/api/v1/admin/users", "query_params": {"limit": "5"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "authorization": "[FILTERED]", "accept": "*/*", "referer": "http://43.167.252.120/admin", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "if-none-match": "W/\"506-2/4g2YWLBTVoBB4yXaX8NAc5A8Q\""}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T03:37:37.600894+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 7.45}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2613010, "name": "SpawnProcess-22"}, "thread": {"id": 138592896540800, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:37:37.600921+08:00", "timestamp": 1756093057.600921}}}
{"text": "2025-08-25 11:37:37.682 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f1076f6c-ae49-4f1d-9690-700dd87c9292 | Server error: 500\n", "record": {"elapsed": {"repr": "0:14:30.401417", "seconds": 870.401417}, "exception": null, "extra": {"request_id": "f1076f6c-ae49-4f1d-9690-700dd87c9292", "extra": {"structured_data": {"request_id": "f1076f6c-ae49-4f1d-9690-700dd87c9292", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users?limit=5", "path": "/api/v1/admin/users", "query_params": {"limit": "5"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "authorization": "[FILTERED]", "accept": "*/*", "referer": "http://43.167.252.120/admin", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T03:37:37.682442+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 3.38}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2613010, "name": "SpawnProcess-22"}, "thread": {"id": 138592896540800, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:37:37.682464+08:00", "timestamp": 1756093057.682464}}}
{"text": "2025-08-25 11:37:41.223 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 265b3a39-7410-487f-8342-44fc38223c77 | Server error: 500\n", "record": {"elapsed": {"repr": "0:14:33.942919", "seconds": 873.942919}, "exception": null, "extra": {"request_id": "265b3a39-7410-487f-8342-44fc38223c77", "extra": {"structured_data": {"request_id": "265b3a39-7410-487f-8342-44fc38223c77", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users?limit=5", "path": "/api/v1/admin/users", "query_params": {"limit": "5"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "authorization": "[FILTERED]", "accept": "*/*", "referer": "http://43.167.252.120/admin", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T03:37:41.223933+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 14.17}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2613010, "name": "SpawnProcess-22"}, "thread": {"id": 138592896540800, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:37:41.223966+08:00", "timestamp": 1756093061.223966}}}
{"text": "2025-08-25 11:37:41.956 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8ed4c06c-5d68-4c5e-b650-849290fdf901 | Server error: 500\n", "record": {"elapsed": {"repr": "0:14:34.675909", "seconds": 874.675909}, "exception": null, "extra": {"request_id": "8ed4c06c-5d68-4c5e-b650-849290fdf901", "extra": {"structured_data": {"request_id": "8ed4c06c-5d68-4c5e-b650-849290fdf901", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users?limit=5", "path": "/api/v1/admin/users", "query_params": {"limit": "5"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "authorization": "[FILTERED]", "accept": "*/*", "referer": "http://43.167.252.120/admin", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T03:37:41.956932+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 3.28}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2613010, "name": "SpawnProcess-22"}, "thread": {"id": 138592896540800, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:37:41.956956+08:00", "timestamp": 1756093061.956956}}}
{"text": "2025-08-25 11:43:02.482 | ERROR    | app.middleware.structured_logging:log_request_end:153 | be40d079-bc67-47ea-a5f4-d79df3dd18e9 | Server error: 500\n", "record": {"elapsed": {"repr": "0:19:55.201062", "seconds": 1195.201062}, "exception": null, "extra": {"request_id": "be40d079-bc67-47ea-a5f4-d79df3dd18e9", "extra": {"structured_data": {"request_id": "be40d079-bc67-47ea-a5f4-d79df3dd18e9", "method": "GET", "url": "http://localhost/api/v1/admin/users?limit=5", "path": "/api/v1/admin/users", "query_params": {"limit": "5"}, "headers": {"host": "localhost", "x-real-ip": "127.0.0.1", "x-forwarded-for": "127.0.0.1", "x-forwarded-proto": "http", "connection": "close", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T03:43:02.482075+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 9.71}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2613010, "name": "SpawnProcess-22"}, "thread": {"id": 138592896540800, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:43:02.482109+08:00", "timestamp": 1756093382.482109}}}
{"text": "2025-08-25 11:43:32.502 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 2cc30ecb-6b61-4046-a322-4a04aae82c0b | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:11.417072", "seconds": 11.417072}, "exception": null, "extra": {"request_id": "2cc30ecb-6b61-4046-a322-4a04aae82c0b", "extra": {"structured_data": {"request_id": "2cc30ecb-6b61-4046-a322-4a04aae82c0b", "method": "GET", "url": "http://localhost/api/v1/admin/users?limit=5", "path": "/api/v1/admin/users", "query_params": {"limit": "5"}, "headers": {"host": "localhost", "x-real-ip": "127.0.0.1", "x-forwarded-for": "127.0.0.1", "x-forwarded-proto": "http", "connection": "close", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T03:43:32.502207+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 86.28}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2620326, "name": "SpawnProcess-23"}, "thread": {"id": 125708779122816, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:43:32.502248+08:00", "timestamp": 1756093412.502248}}}
{"text": "2025-08-25 11:45:50.087 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 017650f5-c8b0-4296-9a6d-c1a60f99a29b | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:34.569776", "seconds": 94.569776}, "exception": null, "extra": {"request_id": "017650f5-c8b0-4296-9a6d-c1a60f99a29b", "extra": {"structured_data": {"request_id": "017650f5-c8b0-4296-9a6d-c1a60f99a29b", "method": "GET", "url": "http://localhost/api/v1/admin/users?limit=3", "path": "/api/v1/admin/users", "query_params": {"limit": "3"}, "headers": {"host": "localhost", "x-real-ip": "127.0.0.1", "x-forwarded-for": "127.0.0.1", "x-forwarded-proto": "http", "connection": "close", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T03:45:50.087305+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 11.19}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2620669, "name": "SpawnProcess-24"}, "thread": {"id": 136730510835840, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:45:50.087341+08:00", "timestamp": 1756093550.087341}}}
{"text": "2025-08-25 11:46:50.657 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3bc55bd9-3e9c-47d9-8cbb-7792790ed8c6 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:20.548275", "seconds": 20.548275}, "exception": null, "extra": {"request_id": "3bc55bd9-3e9c-47d9-8cbb-7792790ed8c6", "extra": {"structured_data": {"request_id": "3bc55bd9-3e9c-47d9-8cbb-7792790ed8c6", "method": "GET", "url": "http://localhost/api/v1/admin/users?limit=3", "path": "/api/v1/admin/users", "query_params": {"limit": "3"}, "headers": {"host": "localhost", "x-real-ip": "127.0.0.1", "x-forwarded-for": "127.0.0.1", "x-forwarded-proto": "http", "connection": "close", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T03:46:50.657116+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 52.98}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2621569, "name": "SpawnProcess-25"}, "thread": {"id": 131722704609408, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:46:50.657161+08:00", "timestamp": 1756093610.657161}}}
{"text": "2025-08-25 11:47:49.681 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d5ea03c2-d5ef-4efe-929b-81a85d0a9797 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:23.061445", "seconds": 23.061445}, "exception": null, "extra": {"request_id": "d5ea03c2-d5ef-4efe-929b-81a85d0a9797", "extra": {"structured_data": {"request_id": "d5ea03c2-d5ef-4efe-929b-81a85d0a9797", "method": "GET", "url": "http://localhost/api/v1/admin/users?limit=3", "path": "/api/v1/admin/users", "query_params": {"limit": "3"}, "headers": {"host": "localhost", "x-real-ip": "127.0.0.1", "x-forwarded-for": "127.0.0.1", "x-forwarded-proto": "http", "connection": "close", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T03:47:49.681923+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 75.55}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2621921, "name": "SpawnProcess-26"}, "thread": {"id": 126037646844032, "name": "MainThread"}, "time": {"repr": "2025-08-25 11:47:49.681964+08:00", "timestamp": 1756093669.681964}}}
{"text": "2025-08-25 16:57:54.612 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d90236ab-d47a-4353-b6c2-4f6c0ae1a421 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:23.919394", "seconds": 23.919394}, "exception": null, "extra": {"request_id": "d90236ab-d47a-4353-b6c2-4f6c0ae1a421", "extra": {"structured_data": {"request_id": "d90236ab-d47a-4353-b6c2-4f6c0ae1a421", "method": "GET", "url": "http://localhost:8001/api/v1/admin/users/?page=1&page_size=3", "path": "/api/v1/admin/users/", "query_params": {"page": "1", "page_size": "3"}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T08:57:54.612780+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "82", "content-type": "application/json"}, "duration_ms": 565.38}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2731950, "name": "SpawnProcess-14"}, "thread": {"id": 140700351500416, "name": "MainThread"}, "time": {"repr": "2025-08-25 16:57:54.612821+08:00", "timestamp": 1756112274.612821}}}
{"text": "2025-08-25 16:57:54.709 | ERROR    | app.middleware.structured_logging:log_request_end:153 | ae394419-a88d-4429-82b0-2e9ba7f9292d | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:24.016384", "seconds": 24.016384}, "exception": null, "extra": {"request_id": "ae394419-a88d-4429-82b0-2e9ba7f9292d", "extra": {"structured_data": {"request_id": "ae394419-a88d-4429-82b0-2e9ba7f9292d", "method": "GET", "url": "http://localhost:8001/api/v1/admin/users/9", "path": "/api/v1/admin/users/9", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-25T08:57:54.709771+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "100", "content-type": "application/json"}, "duration_ms": 40.48}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2731950, "name": "SpawnProcess-14"}, "thread": {"id": 140700351500416, "name": "MainThread"}, "time": {"repr": "2025-08-25 16:57:54.709811+08:00", "timestamp": 1756112274.709811}}}
{"text": "2025-08-25 17:18:49.785 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 5ebe6ec3-feaf-47d4-91dd-39c8c6ad7f64 | Server error: 500\n", "record": {"elapsed": {"repr": "0:12:37.612618", "seconds": 757.612618}, "exception": null, "extra": {"request_id": "5ebe6ec3-feaf-47d4-91dd-39c8c6ad7f64", "extra": {"structured_data": {"request_id": "5ebe6ec3-feaf-47d4-91dd-39c8c6ad7f64", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T09:18:49.785706+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 19.09}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2735724, "name": "SpawnProcess-20"}, "thread": {"id": 135752286216320, "name": "MainThread"}, "time": {"repr": "2025-08-25 17:18:49.785744+08:00", "timestamp": 1756113529.785744}}}
{"text": "2025-08-25 17:18:49.827 | ERROR    | app.middleware.structured_logging:log_error:184 | b1f8ffcb-7b30-44f8-b264-62b47bd60657 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:12:37.654191", "seconds": 757.654191}, "exception": null, "extra": {"request_id": "b1f8ffcb-7b30-44f8-b264-62b47bd60657", "extra": {"structured_data": {"request_id": "b1f8ffcb-7b30-44f8-b264-62b47bd60657", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 16.67, "timestamp": "2025-08-25T09:18:49.827254+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2735724, "name": "SpawnProcess-20"}, "thread": {"id": 135752286216320, "name": "MainThread"}, "time": {"repr": "2025-08-25 17:18:49.827317+08:00", "timestamp": 1756113529.827317}}}
{"text": "2025-08-25 17:18:50.133 | ERROR    | app.middleware.structured_logging:log_error:184 | f0877485-f974-4cd4-a1ac-e6b7165e73e6 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:12:37.959899", "seconds": 757.959899}, "exception": null, "extra": {"request_id": "f0877485-f974-4cd4-a1ac-e6b7165e73e6", "extra": {"structured_data": {"request_id": "f0877485-f974-4cd4-a1ac-e6b7165e73e6", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 14.88, "timestamp": "2025-08-25T09:18:50.132965+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2735724, "name": "SpawnProcess-20"}, "thread": {"id": 135752286216320, "name": "MainThread"}, "time": {"repr": "2025-08-25 17:18:50.133025+08:00", "timestamp": 1756113530.133025}}}
{"text": "2025-08-25 17:18:50.264 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6010beae-59d7-4ae0-93bb-31ddda31a065 | Server error: 500\n", "record": {"elapsed": {"repr": "0:12:38.091175", "seconds": 758.091175}, "exception": null, "extra": {"request_id": "6010beae-59d7-4ae0-93bb-31ddda31a065", "extra": {"structured_data": {"request_id": "6010beae-59d7-4ae0-93bb-31ddda31a065", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T09:18:50.264270+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 8.41}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2735724, "name": "SpawnProcess-20"}, "thread": {"id": 135752286216320, "name": "MainThread"}, "time": {"repr": "2025-08-25 17:18:50.264301+08:00", "timestamp": 1756113530.264301}}}
{"text": "2025-08-25 17:27:03.946 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e4706eee-78bd-4a69-bd76-e6adad73a216 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:46.282539", "seconds": 106.282539}, "exception": null, "extra": {"request_id": "e4706eee-78bd-4a69-bd76-e6adad73a216", "extra": {"structured_data": {"request_id": "e4706eee-78bd-4a69-bd76-e6adad73a216", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T09:27:03.946184+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 6.47}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2742656, "name": "SpawnProcess-24"}, "thread": {"id": 138425319559296, "name": "MainThread"}, "time": {"repr": "2025-08-25 17:27:03.946220+08:00", "timestamp": 1756114023.94622}}}
{"text": "2025-08-25 17:27:04.010 | ERROR    | app.middleware.structured_logging:log_error:184 | 368b95ad-b6f9-4573-9e49-74f92a1b6d6d | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:01:46.346803", "seconds": 106.346803}, "exception": null, "extra": {"request_id": "368b95ad-b6f9-4573-9e49-74f92a1b6d6d", "extra": {"structured_data": {"request_id": "368b95ad-b6f9-4573-9e49-74f92a1b6d6d", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 15.44, "timestamp": "2025-08-25T09:27:04.010253+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2742656, "name": "SpawnProcess-24"}, "thread": {"id": 138425319559296, "name": "MainThread"}, "time": {"repr": "2025-08-25 17:27:04.010484+08:00", "timestamp": 1756114024.010484}}}
{"text": "2025-08-25 17:27:04.324 | ERROR    | app.middleware.structured_logging:log_error:184 | b455e7c3-bf43-4b69-9c9d-07be40bf5c23 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:01:46.660948", "seconds": 106.660948}, "exception": null, "extra": {"request_id": "b455e7c3-bf43-4b69-9c9d-07be40bf5c23", "extra": {"structured_data": {"request_id": "b455e7c3-bf43-4b69-9c9d-07be40bf5c23", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 9.29, "timestamp": "2025-08-25T09:27:04.324576+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2742656, "name": "SpawnProcess-24"}, "thread": {"id": 138425319559296, "name": "MainThread"}, "time": {"repr": "2025-08-25 17:27:04.324629+08:00", "timestamp": 1756114024.324629}}}
{"text": "2025-08-25 17:27:04.360 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 93a4ff1d-529e-454f-a3c6-5210f77dcb99 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:46.696477", "seconds": 106.696477}, "exception": null, "extra": {"request_id": "93a4ff1d-529e-454f-a3c6-5210f77dcb99", "extra": {"structured_data": {"request_id": "93a4ff1d-529e-454f-a3c6-5210f77dcb99", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T09:27:04.360129+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 6.3}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2742656, "name": "SpawnProcess-24"}, "thread": {"id": 138425319559296, "name": "MainThread"}, "time": {"repr": "2025-08-25 17:27:04.360158+08:00", "timestamp": 1756114024.360158}}}
{"text": "2025-08-25 18:16:56.942 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b96562a9-1b40-479f-b046-bcc429239ca8 | Server error: 500\n", "record": {"elapsed": {"repr": "0:27:12.644511", "seconds": 1632.644511}, "exception": null, "extra": {"request_id": "b96562a9-1b40-479f-b046-bcc429239ca8", "extra": {"structured_data": {"request_id": "b96562a9-1b40-479f-b046-bcc429239ca8", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T10:16:56.942581+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 8.38}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2752049, "name": "SpawnProcess-2"}, "thread": {"id": 125768433377408, "name": "MainThread"}, "time": {"repr": "2025-08-25 18:16:56.942622+08:00", "timestamp": 1756117016.942622}}}
{"text": "2025-08-25 18:16:56.987 | ERROR    | app.middleware.structured_logging:log_error:184 | 9d807e9f-9e40-4814-806f-41d47f3c8b21 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:27:12.688904", "seconds": 1632.688904}, "exception": null, "extra": {"request_id": "9d807e9f-9e40-4814-806f-41d47f3c8b21", "extra": {"structured_data": {"request_id": "9d807e9f-9e40-4814-806f-41d47f3c8b21", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 20.75, "timestamp": "2025-08-25T10:16:56.986963+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2752049, "name": "SpawnProcess-2"}, "thread": {"id": 125768433377408, "name": "MainThread"}, "time": {"repr": "2025-08-25 18:16:56.987015+08:00", "timestamp": 1756117016.987015}}}
{"text": "2025-08-25 18:16:57.219 | ERROR    | app.middleware.structured_logging:log_request_end:153 | be93bd0c-9b92-40ea-8011-0cfbff41ad58 | Server error: 500\n", "record": {"elapsed": {"repr": "0:27:12.921834", "seconds": 1632.921834}, "exception": null, "extra": {"request_id": "be93bd0c-9b92-40ea-8011-0cfbff41ad58", "extra": {"structured_data": {"request_id": "be93bd0c-9b92-40ea-8011-0cfbff41ad58", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T10:16:57.219916+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 9.23}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2752049, "name": "SpawnProcess-2"}, "thread": {"id": 125768433377408, "name": "MainThread"}, "time": {"repr": "2025-08-25 18:16:57.219945+08:00", "timestamp": 1756117017.219945}}}
{"text": "2025-08-25 18:16:57.281 | ERROR    | app.middleware.structured_logging:log_error:184 | 5ccfb2f3-fca8-4be5-9757-cc65ff2e6505 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:27:12.983850", "seconds": 1632.98385}, "exception": null, "extra": {"request_id": "5ccfb2f3-fca8-4be5-9757-cc65ff2e6505", "extra": {"structured_data": {"request_id": "5ccfb2f3-fca8-4be5-9757-cc65ff2e6505", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 18.35, "timestamp": "2025-08-25T10:16:57.281908+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2752049, "name": "SpawnProcess-2"}, "thread": {"id": 125768433377408, "name": "MainThread"}, "time": {"repr": "2025-08-25 18:16:57.281961+08:00", "timestamp": 1756117017.281961}}}
{"text": "2025-08-25 18:43:19.403 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 68a1044d-e8b8-4cd4-9b25-66b5e784901e | Server error: 500\n", "record": {"elapsed": {"repr": "0:05:01.513609", "seconds": 301.513609}, "exception": null, "extra": {"request_id": "68a1044d-e8b8-4cd4-9b25-66b5e784901e", "extra": {"structured_data": {"request_id": "68a1044d-e8b8-4cd4-9b25-66b5e784901e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T10:43:19.403774+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 4.72}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2768908, "name": "SpawnProcess-8"}, "thread": {"id": 130067292700800, "name": "MainThread"}, "time": {"repr": "2025-08-25 18:43:19.403803+08:00", "timestamp": 1756118599.403803}}}
{"text": "2025-08-25 18:43:19.425 | ERROR    | app.middleware.structured_logging:log_error:184 | 5c80726b-d2de-4329-a379-1094ac03f090 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:05:01.535146", "seconds": 301.535146}, "exception": null, "extra": {"request_id": "5c80726b-d2de-4329-a379-1094ac03f090", "extra": {"structured_data": {"request_id": "5c80726b-d2de-4329-a379-1094ac03f090", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.41, "timestamp": "2025-08-25T10:43:19.425301+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2768908, "name": "SpawnProcess-8"}, "thread": {"id": 130067292700800, "name": "MainThread"}, "time": {"repr": "2025-08-25 18:43:19.425340+08:00", "timestamp": 1756118599.42534}}}
{"text": "2025-08-25 18:43:19.679 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 56de7137-f281-42fc-a774-282e28243384 | Server error: 500\n", "record": {"elapsed": {"repr": "0:05:01.788965", "seconds": 301.788965}, "exception": null, "extra": {"request_id": "56de7137-f281-42fc-a774-282e28243384", "extra": {"structured_data": {"request_id": "56de7137-f281-42fc-a774-282e28243384", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T10:43:19.679134+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.83}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2768908, "name": "SpawnProcess-8"}, "thread": {"id": 130067292700800, "name": "MainThread"}, "time": {"repr": "2025-08-25 18:43:19.679159+08:00", "timestamp": 1756118599.679159}}}
{"text": "2025-08-25 18:43:19.690 | ERROR    | app.middleware.structured_logging:log_error:184 | f69014ad-4032-48a3-8a4b-29e527a3ec62 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:05:01.800276", "seconds": 301.800276}, "exception": null, "extra": {"request_id": "f69014ad-4032-48a3-8a4b-29e527a3ec62", "extra": {"structured_data": {"request_id": "f69014ad-4032-48a3-8a4b-29e527a3ec62", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.6, "timestamp": "2025-08-25T10:43:19.690443+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2768908, "name": "SpawnProcess-8"}, "thread": {"id": 130067292700800, "name": "MainThread"}, "time": {"repr": "2025-08-25 18:43:19.690470+08:00", "timestamp": 1756118599.69047}}}
{"text": "2025-08-25 22:24:36.372 | ERROR    | app.middleware.structured_logging:log_error:184 | 18b8629f-893a-457c-90ac-e72f592631eb | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "3:31:21.992590", "seconds": 12681.99259}, "exception": null, "extra": {"request_id": "18b8629f-893a-457c-90ac-e72f592631eb", "extra": {"structured_data": {"request_id": "18b8629f-893a-457c-90ac-e72f592631eb", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 5.83, "timestamp": "2025-08-25T14:24:36.372683+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 22:24:36.372730+08:00", "timestamp": 1756131876.37273}}}
{"text": "2025-08-25 22:24:36.449 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 5370156e-cb96-405b-8ff6-acd4f6537347 | Server error: 500\n", "record": {"elapsed": {"repr": "3:31:22.069128", "seconds": 12682.069128}, "exception": null, "extra": {"request_id": "5370156e-cb96-405b-8ff6-acd4f6537347", "extra": {"structured_data": {"request_id": "5370156e-cb96-405b-8ff6-acd4f6537347", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T14:24:36.449244+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 5.11}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 22:24:36.449268+08:00", "timestamp": 1756131876.449268}}}
{"text": "2025-08-25 22:24:36.856 | ERROR    | app.middleware.structured_logging:log_error:184 | 5c005f39-2493-49c5-9651-4177013ca9a5 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "3:31:22.476696", "seconds": 12682.476696}, "exception": null, "extra": {"request_id": "5c005f39-2493-49c5-9651-4177013ca9a5", "extra": {"structured_data": {"request_id": "5c005f39-2493-49c5-9651-4177013ca9a5", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.34, "timestamp": "2025-08-25T14:24:36.856791+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 22:24:36.856836+08:00", "timestamp": 1756131876.856836}}}
{"text": "2025-08-25 22:24:36.899 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6139215e-ef09-42d6-97d9-8f1b5977e902 | Server error: 500\n", "record": {"elapsed": {"repr": "3:31:22.519718", "seconds": 12682.519718}, "exception": null, "extra": {"request_id": "6139215e-ef09-42d6-97d9-8f1b5977e902", "extra": {"structured_data": {"request_id": "6139215e-ef09-42d6-97d9-8f1b5977e902", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T14:24:36.899833+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.61}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 22:24:36.899858+08:00", "timestamp": 1756131876.899858}}}
{"text": "2025-08-25 23:03:31.415 | ERROR    | app.middleware.structured_logging:log_error:184 | 63adfa1a-3730-4b06-83d9-65e9430d426f | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "4:10:17.035472", "seconds": 15017.035472}, "exception": null, "extra": {"request_id": "63adfa1a-3730-4b06-83d9-65e9430d426f", "extra": {"structured_data": {"request_id": "63adfa1a-3730-4b06-83d9-65e9430d426f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.56, "timestamp": "2025-08-25T15:03:31.415584+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:03:31.415612+08:00", "timestamp": 1756134211.415612}}}
{"text": "2025-08-25 23:03:31.513 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 68a8a1cc-3a1f-47ad-abbb-812bd5278c8e | Server error: 500\n", "record": {"elapsed": {"repr": "4:10:17.133099", "seconds": 15017.133099}, "exception": null, "extra": {"request_id": "68a8a1cc-3a1f-47ad-abbb-812bd5278c8e", "extra": {"structured_data": {"request_id": "68a8a1cc-3a1f-47ad-abbb-812bd5278c8e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:03:31.513215+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.93}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:03:31.513239+08:00", "timestamp": 1756134211.513239}}}
{"text": "2025-08-25 23:03:31.785 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3f7e567a-a7cd-4867-8863-57c8a437eeac | Server error: 500\n", "record": {"elapsed": {"repr": "4:10:17.404918", "seconds": 15017.404918}, "exception": null, "extra": {"request_id": "3f7e567a-a7cd-4867-8863-57c8a437eeac", "extra": {"structured_data": {"request_id": "3f7e567a-a7cd-4867-8863-57c8a437eeac", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:03:31.785028+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.95}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:03:31.785058+08:00", "timestamp": 1756134211.785058}}}
{"text": "2025-08-25 23:03:32.056 | ERROR    | app.middleware.structured_logging:log_error:184 | e6814cda-47a2-4088-a408-15cfd1b13973 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "4:10:17.676640", "seconds": 15017.67664}, "exception": null, "extra": {"request_id": "e6814cda-47a2-4088-a408-15cfd1b13973", "extra": {"structured_data": {"request_id": "e6814cda-47a2-4088-a408-15cfd1b13973", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.06, "timestamp": "2025-08-25T15:03:32.056741+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:03:32.056780+08:00", "timestamp": 1756134212.05678}}}
{"text": "2025-08-25 23:06:57.488 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 4eb24986-dca6-4add-8b06-de0e1305797a | Server error: 500\n", "record": {"elapsed": {"repr": "4:13:43.108658", "seconds": 15223.108658}, "exception": null, "extra": {"request_id": "4eb24986-dca6-4add-8b06-de0e1305797a", "extra": {"structured_data": {"request_id": "4eb24986-dca6-4add-8b06-de0e1305797a", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:06:57.488771+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 5.83}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:06:57.488798+08:00", "timestamp": 1756134417.488798}}}
{"text": "2025-08-25 23:06:57.491 | ERROR    | app.middleware.structured_logging:log_error:184 | 256cada8-b1a9-4ab5-a86c-036d1214bdba | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "4:13:43.111624", "seconds": 15223.111624}, "exception": null, "extra": {"request_id": "256cada8-b1a9-4ab5-a86c-036d1214bdba", "extra": {"structured_data": {"request_id": "256cada8-b1a9-4ab5-a86c-036d1214bdba", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 5.0, "timestamp": "2025-08-25T15:06:57.491734+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:06:57.491764+08:00", "timestamp": 1756134417.491764}}}
{"text": "2025-08-25 23:06:57.568 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 1a5679c2-ad57-47d3-aba4-f6683e3585c3 | Server error: 500\n", "record": {"elapsed": {"repr": "4:13:43.188625", "seconds": 15223.188625}, "exception": null, "extra": {"request_id": "1a5679c2-ad57-47d3-aba4-f6683e3585c3", "extra": {"structured_data": {"request_id": "1a5679c2-ad57-47d3-aba4-f6683e3585c3", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:06:57.568746+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.76}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:06:57.568765+08:00", "timestamp": 1756134417.568765}}}
{"text": "2025-08-25 23:06:57.672 | ERROR    | app.middleware.structured_logging:log_error:184 | ce17c8be-d950-4d2f-829f-f0c3abb02f8f | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "4:13:43.292388", "seconds": 15223.292388}, "exception": null, "extra": {"request_id": "ce17c8be-d950-4d2f-829f-f0c3abb02f8f", "extra": {"structured_data": {"request_id": "ce17c8be-d950-4d2f-829f-f0c3abb02f8f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.83, "timestamp": "2025-08-25T15:06:57.672499+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2774394, "name": "SpawnProcess-1"}, "thread": {"id": 128290397372544, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:06:57.672528+08:00", "timestamp": 1756134417.672528}}}
{"text": "2025-08-25 23:51:29.973 | ERROR    | app.middleware.structured_logging:log_error:184 | 32a1413d-e76c-4496-b5e3-33506ff52dd1 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:00:02.157268", "seconds": 2.157268}, "exception": null, "extra": {"request_id": "32a1413d-e76c-4496-b5e3-33506ff52dd1", "extra": {"structured_data": {"request_id": "32a1413d-e76c-4496-b5e3-33506ff52dd1", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 20.68, "timestamp": "2025-08-25T15:51:29.973713+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:29.973761+08:00", "timestamp": 1756137089.973761}}}
{"text": "2025-08-25 23:51:29.974 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 80bdb47a-782c-4795-af52-bf47fbc4a7a4 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:02.157877", "seconds": 2.157877}, "exception": null, "extra": {"request_id": "80bdb47a-782c-4795-af52-bf47fbc4a7a4", "extra": {"structured_data": {"request_id": "80bdb47a-782c-4795-af52-bf47fbc4a7a4", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:51:29.974345+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 17.91}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:29.974370+08:00", "timestamp": 1756137089.97437}}}
{"text": "2025-08-25 23:51:29.982 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 28ace2a5-e72f-42ee-a0f2-ed7db8623393 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:02.165657", "seconds": 2.165657}, "exception": null, "extra": {"request_id": "28ace2a5-e72f-42ee-a0f2-ed7db8623393", "extra": {"structured_data": {"request_id": "28ace2a5-e72f-42ee-a0f2-ed7db8623393", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:51:29.982122+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 20.51}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:29.982150+08:00", "timestamp": 1756137089.98215}}}
{"text": "2025-08-25 23:51:30.045 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c0621fc5-dcb9-44c9-a74d-08f2025d91fc | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:02.228579", "seconds": 2.228579}, "exception": null, "extra": {"request_id": "c0621fc5-dcb9-44c9-a74d-08f2025d91fc", "extra": {"structured_data": {"request_id": "c0621fc5-dcb9-44c9-a74d-08f2025d91fc", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:51:30.045041+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 79.02}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:30.045072+08:00", "timestamp": 1756137090.045072}}}
{"text": "2025-08-25 23:51:30.059 | ERROR    | app.middleware.structured_logging:log_error:184 | a31e2726-f085-4cc8-a67d-7a4dcd8c6d04 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:00:02.242622", "seconds": 2.242622}, "exception": null, "extra": {"request_id": "a31e2726-f085-4cc8-a67d-7a4dcd8c6d04", "extra": {"structured_data": {"request_id": "a31e2726-f085-4cc8-a67d-7a4dcd8c6d04", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 93.88, "timestamp": "2025-08-25T15:51:30.059070+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:30.059115+08:00", "timestamp": 1756137090.059115}}}
{"text": "2025-08-25 23:51:30.059 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 71ef74c3-1b43-43a5-8b33-57fda4ecc00e | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:02.243210", "seconds": 2.24321}, "exception": null, "extra": {"request_id": "71ef74c3-1b43-43a5-8b33-57fda4ecc00e", "extra": {"structured_data": {"request_id": "71ef74c3-1b43-43a5-8b33-57fda4ecc00e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:51:30.059680+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 90.93}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:30.059703+08:00", "timestamp": 1756137090.059703}}}
{"text": "2025-08-25 23:51:30.077 | ERROR    | app.middleware.structured_logging:log_error:184 | 188acc4f-fc64-4e45-bbff-9fbec240023a | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:00:02.260882", "seconds": 2.260882}, "exception": null, "extra": {"request_id": "188acc4f-fc64-4e45-bbff-9fbec240023a", "extra": {"structured_data": {"request_id": "188acc4f-fc64-4e45-bbff-9fbec240023a", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 98.06, "timestamp": "2025-08-25T15:51:30.077340+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:30.077375+08:00", "timestamp": 1756137090.077375}}}
{"text": "2025-08-25 23:51:30.097 | ERROR    | app.middleware.structured_logging:log_error:184 | 729bf55e-daf3-4fb5-a5ce-f9e59fcada33 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:00:02.280634", "seconds": 2.280634}, "exception": null, "extra": {"request_id": "729bf55e-daf3-4fb5-a5ce-f9e59fcada33", "extra": {"structured_data": {"request_id": "729bf55e-daf3-4fb5-a5ce-f9e59fcada33", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 52.45, "timestamp": "2025-08-25T15:51:30.097100+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:30.097127+08:00", "timestamp": 1756137090.097127}}}
{"text": "2025-08-25 23:51:30.101 | ERROR    | app.middleware.structured_logging:log_error:184 | f1446162-708e-454f-9e68-8f18189c836f | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:00:02.285221", "seconds": 2.285221}, "exception": null, "extra": {"request_id": "f1446162-708e-454f-9e68-8f18189c836f", "extra": {"structured_data": {"request_id": "f1446162-708e-454f-9e68-8f18189c836f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 51.26, "timestamp": "2025-08-25T15:51:30.101690+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:30.101714+08:00", "timestamp": 1756137090.101714}}}
{"text": "2025-08-25 23:51:30.102 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 74391848-b15a-4184-9ec1-317cee8417dc | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:02.285673", "seconds": 2.285673}, "exception": null, "extra": {"request_id": "74391848-b15a-4184-9ec1-317cee8417dc", "extra": {"structured_data": {"request_id": "74391848-b15a-4184-9ec1-317cee8417dc", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:51:30.102150+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 30.82}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:30.102166+08:00", "timestamp": 1756137090.102166}}}
{"text": "2025-08-25 23:51:30.127 | ERROR    | app.middleware.structured_logging:log_error:184 | ad99b5d5-46e7-4cfa-a78e-745e06714dd9 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:00:02.310956", "seconds": 2.310956}, "exception": null, "extra": {"request_id": "ad99b5d5-46e7-4cfa-a78e-745e06714dd9", "extra": {"structured_data": {"request_id": "ad99b5d5-46e7-4cfa-a78e-745e06714dd9", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 40.62, "timestamp": "2025-08-25T15:51:30.127420+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:30.127449+08:00", "timestamp": 1756137090.127449}}}
{"text": "2025-08-25 23:51:30.130 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 24ed49f1-3824-4baf-8705-e6cc4085413e | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:02.313909", "seconds": 2.313909}, "exception": null, "extra": {"request_id": "24ed49f1-3824-4baf-8705-e6cc4085413e", "extra": {"structured_data": {"request_id": "24ed49f1-3824-4baf-8705-e6cc4085413e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:51:30.130381+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 17.34}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869747, "name": "SpawnProcess-16"}, "thread": {"id": 123885902348416, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:51:30.130402+08:00", "timestamp": 1756137090.130402}}}
{"text": "2025-08-25 23:54:26.655 | ERROR    | app.middleware.structured_logging:log_error:184 | df6ffd7d-226b-40c9-961a-9954e5e49f27 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:02:47.013098", "seconds": 167.013098}, "exception": null, "extra": {"request_id": "df6ffd7d-226b-40c9-961a-9954e5e49f27", "extra": {"structured_data": {"request_id": "df6ffd7d-226b-40c9-961a-9954e5e49f27", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.45, "timestamp": "2025-08-25T15:54:26.655614+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:54:26.655663+08:00", "timestamp": 1756137266.655663}}}
{"text": "2025-08-25 23:54:26.750 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f1fc6c6d-c761-43f1-b431-2e0c496a25f5 | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:47.108178", "seconds": 167.108178}, "exception": null, "extra": {"request_id": "f1fc6c6d-c761-43f1-b431-2e0c496a25f5", "extra": {"structured_data": {"request_id": "f1fc6c6d-c761-43f1-b431-2e0c496a25f5", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:54:26.750718+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.8}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:54:26.750743+08:00", "timestamp": 1756137266.750743}}}
{"text": "2025-08-25 23:54:27.027 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0b501366-ab17-4682-bb04-dd188366dfab | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:47.384478", "seconds": 167.384478}, "exception": null, "extra": {"request_id": "0b501366-ab17-4682-bb04-dd188366dfab", "extra": {"structured_data": {"request_id": "0b501366-ab17-4682-bb04-dd188366dfab", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T15:54:27.027011+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 3.91}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:54:27.027043+08:00", "timestamp": 1756137267.027043}}}
{"text": "2025-08-25 23:54:27.034 | ERROR    | app.middleware.structured_logging:log_error:184 | 43d23393-ad72-4bef-9b40-3500e280e33e | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:02:47.391526", "seconds": 167.391526}, "exception": null, "extra": {"request_id": "43d23393-ad72-4bef-9b40-3500e280e33e", "extra": {"structured_data": {"request_id": "43d23393-ad72-4bef-9b40-3500e280e33e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.53, "timestamp": "2025-08-25T15:54:27.034048+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-25 23:54:27.034091+08:00", "timestamp": 1756137267.034091}}}
{"text": "2025-08-26 00:00:11.673 | ERROR    | app.middleware.structured_logging:log_error:184 | aa3c3060-5206-4af2-819a-8be10484822e | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:08:32.031321", "seconds": 512.031321}, "exception": null, "extra": {"request_id": "aa3c3060-5206-4af2-819a-8be10484822e", "extra": {"structured_data": {"request_id": "aa3c3060-5206-4af2-819a-8be10484822e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 7.55, "timestamp": "2025-08-25T16:00:11.673845+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:00:11.673886+08:00", "timestamp": 1756137611.673886}}}
{"text": "2025-08-26 00:00:11.793 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 9e980f02-c493-4a31-b26c-85eb42ec3a5d | Server error: 500\n", "record": {"elapsed": {"repr": "0:08:32.151126", "seconds": 512.151126}, "exception": null, "extra": {"request_id": "9e980f02-c493-4a31-b26c-85eb42ec3a5d", "extra": {"structured_data": {"request_id": "9e980f02-c493-4a31-b26c-85eb42ec3a5d", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:00:11.793666+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.5}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:00:11.793691+08:00", "timestamp": 1756137611.793691}}}
{"text": "2025-08-26 00:00:11.954 | ERROR    | app.middleware.structured_logging:log_error:184 | e88fcc6e-0c3e-4093-a367-c9cb47dadd56 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:08:32.311755", "seconds": 512.311755}, "exception": null, "extra": {"request_id": "e88fcc6e-0c3e-4093-a367-c9cb47dadd56", "extra": {"structured_data": {"request_id": "e88fcc6e-0c3e-4093-a367-c9cb47dadd56", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.03, "timestamp": "2025-08-25T16:00:11.954290+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:00:11.954320+08:00", "timestamp": 1756137611.95432}}}
{"text": "2025-08-26 00:00:12.071 | ERROR    | app.middleware.structured_logging:log_request_end:153 | dcb5ed37-1d97-4761-a5fe-b26e12893572 | Server error: 500\n", "record": {"elapsed": {"repr": "0:08:32.428559", "seconds": 512.428559}, "exception": null, "extra": {"request_id": "dcb5ed37-1d97-4761-a5fe-b26e12893572", "extra": {"structured_data": {"request_id": "dcb5ed37-1d97-4761-a5fe-b26e12893572", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:00:12.071103+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.78}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:00:12.071124+08:00", "timestamp": 1756137612.071124}}}
{"text": "2025-08-26 00:05:56.504 | ERROR    | app.middleware.structured_logging:log_error:184 | 8b76f6ec-526a-4d05-929c-12a46dcb2b99 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:14:16.862138", "seconds": 856.862138}, "exception": null, "extra": {"request_id": "8b76f6ec-526a-4d05-929c-12a46dcb2b99", "extra": {"structured_data": {"request_id": "8b76f6ec-526a-4d05-929c-12a46dcb2b99", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.09, "timestamp": "2025-08-25T16:05:56.504672+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:05:56.504703+08:00", "timestamp": 1756137956.504703}}}
{"text": "2025-08-26 00:05:56.598 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 4207c1d5-2cea-4624-8509-9bf5e0a8016b | Server error: 500\n", "record": {"elapsed": {"repr": "0:14:16.956346", "seconds": 856.956346}, "exception": null, "extra": {"request_id": "4207c1d5-2cea-4624-8509-9bf5e0a8016b", "extra": {"structured_data": {"request_id": "4207c1d5-2cea-4624-8509-9bf5e0a8016b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:05:56.598882+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 3.42}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:05:56.598911+08:00", "timestamp": 1756137956.598911}}}
{"text": "2025-08-26 00:05:56.799 | ERROR    | app.middleware.structured_logging:log_error:184 | 1cac3ef5-96db-403c-b032-1824c4b40f2a | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:14:17.157239", "seconds": 857.157239}, "exception": null, "extra": {"request_id": "1cac3ef5-96db-403c-b032-1824c4b40f2a", "extra": {"structured_data": {"request_id": "1cac3ef5-96db-403c-b032-1824c4b40f2a", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 13.15, "timestamp": "2025-08-25T16:05:56.799761+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:05:56.799804+08:00", "timestamp": 1756137956.799804}}}
{"text": "2025-08-26 00:05:56.982 | ERROR    | app.middleware.structured_logging:log_request_end:153 | ba05eaf8-678d-4097-907c-2f96f619d6aa | Server error: 500\n", "record": {"elapsed": {"repr": "0:14:17.340296", "seconds": 857.340296}, "exception": null, "extra": {"request_id": "ba05eaf8-678d-4097-907c-2f96f619d6aa", "extra": {"structured_data": {"request_id": "ba05eaf8-678d-4097-907c-2f96f619d6aa", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:05:56.982839+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.83}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2869821, "name": "SpawnProcess-17"}, "thread": {"id": 134204433481856, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:05:56.982861+08:00", "timestamp": 1756137956.982861}}}
{"text": "2025-08-26 00:11:40.753 | ERROR    | app.middleware.structured_logging:log_error:184 | 63bd9936-4a71-42d9-a3ef-7886a8b20e63 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:04:44.860014", "seconds": 284.860014}, "exception": null, "extra": {"request_id": "63bd9936-4a71-42d9-a3ef-7886a8b20e63", "extra": {"structured_data": {"request_id": "63bd9936-4a71-42d9-a3ef-7886a8b20e63", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 5.03, "timestamp": "2025-08-25T16:11:40.753849+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:11:40.753900+08:00", "timestamp": 1756138300.7539}}}
{"text": "2025-08-26 00:11:40.851 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 366054a1-5b17-46c8-bf73-e6017e06cb54 | Server error: 500\n", "record": {"elapsed": {"repr": "0:04:44.957894", "seconds": 284.957894}, "exception": null, "extra": {"request_id": "366054a1-5b17-46c8-bf73-e6017e06cb54", "extra": {"structured_data": {"request_id": "366054a1-5b17-46c8-bf73-e6017e06cb54", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:11:40.851747+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 3.07}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:11:40.851780+08:00", "timestamp": 1756138300.85178}}}
{"text": "2025-08-26 00:11:41.017 | ERROR    | app.middleware.structured_logging:log_error:184 | f1a11927-1933-4d41-80c7-0d126f2fc13b | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:04:45.123436", "seconds": 285.123436}, "exception": null, "extra": {"request_id": "f1a11927-1933-4d41-80c7-0d126f2fc13b", "extra": {"structured_data": {"request_id": "f1a11927-1933-4d41-80c7-0d126f2fc13b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.23, "timestamp": "2025-08-25T16:11:41.017277+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:11:41.017322+08:00", "timestamp": 1756138301.017322}}}
{"text": "2025-08-26 00:11:41.111 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 4b8c1ce9-6e99-4057-b0a9-4af317dcde0b | Server error: 500\n", "record": {"elapsed": {"repr": "0:04:45.218059", "seconds": 285.218059}, "exception": null, "extra": {"request_id": "4b8c1ce9-6e99-4057-b0a9-4af317dcde0b", "extra": {"structured_data": {"request_id": "4b8c1ce9-6e99-4057-b0a9-4af317dcde0b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:11:41.111922+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.87}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:11:41.111945+08:00", "timestamp": 1756138301.111945}}}
{"text": "2025-08-26 00:44:12.399 | ERROR    | app.middleware.structured_logging:log_error:184 | 3e76ad79-98ec-4a66-9034-5ff71d1d219d | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:37:16.505882", "seconds": 2236.505882}, "exception": null, "extra": {"request_id": "3e76ad79-98ec-4a66-9034-5ff71d1d219d", "extra": {"structured_data": {"request_id": "3e76ad79-98ec-4a66-9034-5ff71d1d219d", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.87, "timestamp": "2025-08-25T16:44:12.399739+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:44:12.399768+08:00", "timestamp": 1756140252.399768}}}
{"text": "2025-08-26 00:44:12.507 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 94810597-6b5b-4e36-b7d4-f51253fd0a28 | Server error: 500\n", "record": {"elapsed": {"repr": "0:37:16.613946", "seconds": 2236.613946}, "exception": null, "extra": {"request_id": "94810597-6b5b-4e36-b7d4-f51253fd0a28", "extra": {"structured_data": {"request_id": "94810597-6b5b-4e36-b7d4-f51253fd0a28", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:44:12.507809+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.86}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:44:12.507832+08:00", "timestamp": 1756140252.507832}}}
{"text": "2025-08-26 00:44:12.696 | ERROR    | app.middleware.structured_logging:log_error:184 | 6d3f4596-cd40-4dcd-ac7b-080d36a35fe5 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:37:16.802927", "seconds": 2236.802927}, "exception": null, "extra": {"request_id": "6d3f4596-cd40-4dcd-ac7b-080d36a35fe5", "extra": {"structured_data": {"request_id": "6d3f4596-cd40-4dcd-ac7b-080d36a35fe5", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 5.92, "timestamp": "2025-08-25T16:44:12.696771+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:44:12.696813+08:00", "timestamp": 1756140252.696813}}}
{"text": "2025-08-26 00:44:12.807 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 59c945e6-5853-433c-a64c-2f21384edb84 | Server error: 500\n", "record": {"elapsed": {"repr": "0:37:16.913444", "seconds": 2236.913444}, "exception": null, "extra": {"request_id": "59c945e6-5853-433c-a64c-2f21384edb84", "extra": {"structured_data": {"request_id": "59c945e6-5853-433c-a64c-2f21384edb84", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:44:12.807307+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.01}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:44:12.807330+08:00", "timestamp": 1756140252.80733}}}
{"text": "2025-08-26 00:49:56.944 | ERROR    | app.middleware.structured_logging:log_error:184 | 58e887de-1fc7-4250-aba0-ff29ecbe011b | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:43:01.050913", "seconds": 2581.050913}, "exception": null, "extra": {"request_id": "58e887de-1fc7-4250-aba0-ff29ecbe011b", "extra": {"structured_data": {"request_id": "58e887de-1fc7-4250-aba0-ff29ecbe011b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.19, "timestamp": "2025-08-25T16:49:56.944759+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:49:56.944799+08:00", "timestamp": 1756140596.944799}}}
{"text": "2025-08-26 00:49:57.033 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c3d712ec-6e18-4611-be8a-2a2ec6048bbf | Server error: 500\n", "record": {"elapsed": {"repr": "0:43:01.140071", "seconds": 2581.140071}, "exception": null, "extra": {"request_id": "c3d712ec-6e18-4611-be8a-2a2ec6048bbf", "extra": {"structured_data": {"request_id": "c3d712ec-6e18-4611-be8a-2a2ec6048bbf", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:49:57.033918+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.79}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:49:57.033957+08:00", "timestamp": 1756140597.033957}}}
{"text": "2025-08-26 00:49:57.319 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 655e2416-5f71-4441-84cb-ce4c806f29a7 | Server error: 500\n", "record": {"elapsed": {"repr": "0:43:01.425489", "seconds": 2581.425489}, "exception": null, "extra": {"request_id": "655e2416-5f71-4441-84cb-ce4c806f29a7", "extra": {"structured_data": {"request_id": "655e2416-5f71-4441-84cb-ce4c806f29a7", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T16:49:57.319350+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.16}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:49:57.319375+08:00", "timestamp": 1756140597.319375}}}
{"text": "2025-08-26 00:49:57.355 | ERROR    | app.middleware.structured_logging:log_error:184 | 370a5379-0f62-4538-9468-b1697d7e7c21 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:43:01.461372", "seconds": 2581.461372}, "exception": null, "extra": {"request_id": "370a5379-0f62-4538-9468-b1697d7e7c21", "extra": {"structured_data": {"request_id": "370a5379-0f62-4538-9468-b1697d7e7c21", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.73, "timestamp": "2025-08-25T16:49:57.355210+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 00:49:57.355258+08:00", "timestamp": 1756140597.355258}}}
{"text": "2025-08-26 01:06:14.742 | ERROR    | app.middleware.structured_logging:log_error:184 | 0fd89c98-8088-4603-a459-542037d42a6f | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:59:18.849020", "seconds": 3558.84902}, "exception": null, "extra": {"request_id": "0fd89c98-8088-4603-a459-542037d42a6f", "extra": {"structured_data": {"request_id": "0fd89c98-8088-4603-a459-542037d42a6f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.64, "timestamp": "2025-08-25T17:06:14.742879+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:06:14.742906+08:00", "timestamp": 1756141574.742906}}}
{"text": "2025-08-26 01:06:14.833 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d59f67ee-51c2-47bf-9d35-46b9a4c1e98b | Server error: 500\n", "record": {"elapsed": {"repr": "0:59:18.939614", "seconds": 3558.939614}, "exception": null, "extra": {"request_id": "d59f67ee-51c2-47bf-9d35-46b9a4c1e98b", "extra": {"structured_data": {"request_id": "d59f67ee-51c2-47bf-9d35-46b9a4c1e98b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T17:06:14.833481+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.8}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:06:14.833500+08:00", "timestamp": 1756141574.8335}}}
{"text": "2025-08-26 01:06:15.015 | ERROR    | app.middleware.structured_logging:log_error:184 | 578ed17d-2fff-49d7-8fc4-6e46b1b5c714 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:59:19.121290", "seconds": 3559.12129}, "exception": null, "extra": {"request_id": "578ed17d-2fff-49d7-8fc4-6e46b1b5c714", "extra": {"structured_data": {"request_id": "578ed17d-2fff-49d7-8fc4-6e46b1b5c714", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.48, "timestamp": "2025-08-25T17:06:15.015138+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:06:15.015176+08:00", "timestamp": 1756141575.015176}}}
{"text": "2025-08-26 01:06:15.100 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 17271755-3db5-47da-a27b-748303c95db1 | Server error: 500\n", "record": {"elapsed": {"repr": "0:59:19.206219", "seconds": 3559.206219}, "exception": null, "extra": {"request_id": "17271755-3db5-47da-a27b-748303c95db1", "extra": {"structured_data": {"request_id": "17271755-3db5-47da-a27b-748303c95db1", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T17:06:15.100078+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.16}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:06:15.100105+08:00", "timestamp": 1756141575.100105}}}
{"text": "2025-08-26 01:22:31.863 | ERROR    | app.middleware.structured_logging:log_error:184 | 482273a9-7d36-44fa-adfa-2fcba0f10fac | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:15:35.969817", "seconds": 4535.969817}, "exception": null, "extra": {"request_id": "482273a9-7d36-44fa-adfa-2fcba0f10fac", "extra": {"structured_data": {"request_id": "482273a9-7d36-44fa-adfa-2fcba0f10fac", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.54, "timestamp": "2025-08-25T17:22:31.863676+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:22:31.863703+08:00", "timestamp": 1756142551.863703}}}
{"text": "2025-08-26 01:22:31.980 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 7796f4a4-ebcf-4de2-8742-b67df26f5a43 | Server error: 500\n", "record": {"elapsed": {"repr": "1:15:36.086117", "seconds": 4536.086117}, "exception": null, "extra": {"request_id": "7796f4a4-ebcf-4de2-8742-b67df26f5a43", "extra": {"structured_data": {"request_id": "7796f4a4-ebcf-4de2-8742-b67df26f5a43", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T17:22:31.979983+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.72}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:22:31.980003+08:00", "timestamp": 1756142551.980003}}}
{"text": "2025-08-26 01:22:32.132 | ERROR    | app.middleware.structured_logging:log_error:184 | 314a6e95-18c9-450e-9c65-0a02aac9d6c6 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:15:36.239041", "seconds": 4536.239041}, "exception": null, "extra": {"request_id": "314a6e95-18c9-450e-9c65-0a02aac9d6c6", "extra": {"structured_data": {"request_id": "314a6e95-18c9-450e-9c65-0a02aac9d6c6", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.0, "timestamp": "2025-08-25T17:22:32.132887+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:22:32.132927+08:00", "timestamp": 1756142552.132927}}}
{"text": "2025-08-26 01:22:32.247 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 85984bbc-9653-4da1-a791-b2e07ff040d4 | Server error: 500\n", "record": {"elapsed": {"repr": "1:15:36.353953", "seconds": 4536.353953}, "exception": null, "extra": {"request_id": "85984bbc-9653-4da1-a791-b2e07ff040d4", "extra": {"structured_data": {"request_id": "85984bbc-9653-4da1-a791-b2e07ff040d4", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T17:22:32.247812+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.75}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:22:32.247839+08:00", "timestamp": 1756142552.247839}}}
{"text": "2025-08-26 01:53:00.203 | ERROR    | app.middleware.structured_logging:log_error:184 | 7d54a3e1-e26d-475e-923c-ef6a74c7907a | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:46:04.310077", "seconds": 6364.310077}, "exception": null, "extra": {"request_id": "7d54a3e1-e26d-475e-923c-ef6a74c7907a", "extra": {"structured_data": {"request_id": "7d54a3e1-e26d-475e-923c-ef6a74c7907a", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.63, "timestamp": "2025-08-25T17:53:00.203926+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:53:00.203963+08:00", "timestamp": 1756144380.203963}}}
{"text": "2025-08-26 01:53:00.300 | ERROR    | app.middleware.structured_logging:log_request_end:153 | aaaff850-b26b-486a-9da5-4cbddfdfbcb6 | Server error: 500\n", "record": {"elapsed": {"repr": "1:46:04.406438", "seconds": 6364.406438}, "exception": null, "extra": {"request_id": "aaaff850-b26b-486a-9da5-4cbddfdfbcb6", "extra": {"structured_data": {"request_id": "aaaff850-b26b-486a-9da5-4cbddfdfbcb6", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T17:53:00.300299+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.4}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:53:00.300324+08:00", "timestamp": 1756144380.300324}}}
{"text": "2025-08-26 01:53:00.470 | ERROR    | app.middleware.structured_logging:log_error:184 | 0a62cb65-2e9a-4b5f-a948-d3fc3bbcd1cd | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:46:04.576309", "seconds": 6364.576309}, "exception": null, "extra": {"request_id": "0a62cb65-2e9a-4b5f-a948-d3fc3bbcd1cd", "extra": {"structured_data": {"request_id": "0a62cb65-2e9a-4b5f-a948-d3fc3bbcd1cd", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.3, "timestamp": "2025-08-25T17:53:00.470164+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:53:00.470195+08:00", "timestamp": 1756144380.470195}}}
{"text": "2025-08-26 01:53:00.574 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8448b307-8385-4b5e-ab16-3450ef2089fa | Server error: 500\n", "record": {"elapsed": {"repr": "1:46:04.680444", "seconds": 6364.680444}, "exception": null, "extra": {"request_id": "8448b307-8385-4b5e-ab16-3450ef2089fa", "extra": {"structured_data": {"request_id": "8448b307-8385-4b5e-ab16-3450ef2089fa", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T17:53:00.574311+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.7}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 01:53:00.574330+08:00", "timestamp": 1756144380.57433}}}
{"text": "2025-08-26 02:09:38.499 | ERROR    | app.middleware.structured_logging:log_error:184 | aa889e42-cbe5-461a-a683-e974dd68dfca | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:02:42.605330", "seconds": 7362.60533}, "exception": null, "extra": {"request_id": "aa889e42-cbe5-461a-a683-e974dd68dfca", "extra": {"structured_data": {"request_id": "aa889e42-cbe5-461a-a683-e974dd68dfca", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 8.02, "timestamp": "2025-08-25T18:09:38.499180+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:09:38.499216+08:00", "timestamp": 1756145378.499216}}}
{"text": "2025-08-26 02:09:38.585 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8611ed22-3f35-4bfb-bcae-1dbe8b03d635 | Server error: 500\n", "record": {"elapsed": {"repr": "2:02:42.692102", "seconds": 7362.692102}, "exception": null, "extra": {"request_id": "8611ed22-3f35-4bfb-bcae-1dbe8b03d635", "extra": {"structured_data": {"request_id": "8611ed22-3f35-4bfb-bcae-1dbe8b03d635", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T18:09:38.585968+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.78}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:09:38.585988+08:00", "timestamp": 1756145378.585988}}}
{"text": "2025-08-26 02:09:38.759 | ERROR    | app.middleware.structured_logging:log_error:184 | 28bd8e91-321b-426c-8523-e54c1b5e7a52 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:02:42.865768", "seconds": 7362.865768}, "exception": null, "extra": {"request_id": "28bd8e91-321b-426c-8523-e54c1b5e7a52", "extra": {"structured_data": {"request_id": "28bd8e91-321b-426c-8523-e54c1b5e7a52", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.46, "timestamp": "2025-08-25T18:09:38.759622+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:09:38.759654+08:00", "timestamp": 1756145378.759654}}}
{"text": "2025-08-26 02:09:38.847 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 5b6e6d2c-648c-488e-8408-1e9521da752d | Server error: 500\n", "record": {"elapsed": {"repr": "2:02:42.953137", "seconds": 7362.953137}, "exception": null, "extra": {"request_id": "5b6e6d2c-648c-488e-8408-1e9521da752d", "extra": {"structured_data": {"request_id": "5b6e6d2c-648c-488e-8408-1e9521da752d", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T18:09:38.846996+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.19}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:09:38.847023+08:00", "timestamp": 1756145378.847023}}}
{"text": "2025-08-26 02:25:53.065 | ERROR    | app.middleware.structured_logging:log_error:184 | be978d00-008b-4f96-bf78-f144e645bdcd | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:18:57.171769", "seconds": 8337.171769}, "exception": null, "extra": {"request_id": "be978d00-008b-4f96-bf78-f144e645bdcd", "extra": {"structured_data": {"request_id": "be978d00-008b-4f96-bf78-f144e645bdcd", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.89, "timestamp": "2025-08-25T18:25:53.065615+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:25:53.065655+08:00", "timestamp": 1756146353.065655}}}
{"text": "2025-08-26 02:25:53.169 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 67586455-16b6-41c0-85e0-f27375464175 | Server error: 500\n", "record": {"elapsed": {"repr": "2:18:57.275372", "seconds": 8337.275372}, "exception": null, "extra": {"request_id": "67586455-16b6-41c0-85e0-f27375464175", "extra": {"structured_data": {"request_id": "67586455-16b6-41c0-85e0-f27375464175", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T18:25:53.169232+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.41}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:25:53.169258+08:00", "timestamp": 1756146353.169258}}}
{"text": "2025-08-26 02:25:53.333 | ERROR    | app.middleware.structured_logging:log_error:184 | dfe26535-67c7-44f1-a5a1-06ed0cdcb5d2 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:18:57.439983", "seconds": 8337.439983}, "exception": null, "extra": {"request_id": "dfe26535-67c7-44f1-a5a1-06ed0cdcb5d2", "extra": {"structured_data": {"request_id": "dfe26535-67c7-44f1-a5a1-06ed0cdcb5d2", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.74, "timestamp": "2025-08-25T18:25:53.333840+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:25:53.333869+08:00", "timestamp": 1756146353.333869}}}
{"text": "2025-08-26 02:25:53.433 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 5533bde1-c7da-44c9-bebf-dc015e7ffcf2 | Server error: 500\n", "record": {"elapsed": {"repr": "2:18:57.539552", "seconds": 8337.539552}, "exception": null, "extra": {"request_id": "5533bde1-c7da-44c9-bebf-dc015e7ffcf2", "extra": {"structured_data": {"request_id": "5533bde1-c7da-44c9-bebf-dc015e7ffcf2", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T18:25:53.433419+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.71}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:25:53.433438+08:00", "timestamp": 1756146353.433438}}}
{"text": "2025-08-26 02:42:27.384 | ERROR    | app.middleware.structured_logging:log_error:184 | d8d396ea-e77c-4524-a5d6-e4385a9068ac | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:35:31.490712", "seconds": 9331.490712}, "exception": null, "extra": {"request_id": "d8d396ea-e77c-4524-a5d6-e4385a9068ac", "extra": {"structured_data": {"request_id": "d8d396ea-e77c-4524-a5d6-e4385a9068ac", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.09, "timestamp": "2025-08-25T18:42:27.384567+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:42:27.384598+08:00", "timestamp": 1756147347.384598}}}
{"text": "2025-08-26 02:42:27.501 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 85a8fc54-699a-4dd8-a02f-a3a75fab3ebd | Server error: 500\n", "record": {"elapsed": {"repr": "2:35:31.607466", "seconds": 9331.607466}, "exception": null, "extra": {"request_id": "85a8fc54-699a-4dd8-a02f-a3a75fab3ebd", "extra": {"structured_data": {"request_id": "85a8fc54-699a-4dd8-a02f-a3a75fab3ebd", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T18:42:27.501328+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.52}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:42:27.501352+08:00", "timestamp": 1756147347.501352}}}
{"text": "2025-08-26 02:42:27.756 | ERROR    | app.middleware.structured_logging:log_error:184 | bc73d5a5-a950-4ef8-9df6-b88de15c4b86 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:35:31.862618", "seconds": 9331.862618}, "exception": null, "extra": {"request_id": "bc73d5a5-a950-4ef8-9df6-b88de15c4b86", "extra": {"structured_data": {"request_id": "bc73d5a5-a950-4ef8-9df6-b88de15c4b86", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.83, "timestamp": "2025-08-25T18:42:27.756474+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:42:27.756504+08:00", "timestamp": 1756147347.756504}}}
{"text": "2025-08-26 02:42:27.780 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c894024c-6cb8-4f60-88c6-3b4068f6159d | Server error: 500\n", "record": {"elapsed": {"repr": "2:35:31.887056", "seconds": 9331.887056}, "exception": null, "extra": {"request_id": "c894024c-6cb8-4f60-88c6-3b4068f6159d", "extra": {"structured_data": {"request_id": "c894024c-6cb8-4f60-88c6-3b4068f6159d", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T18:42:27.780922+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.68}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:42:27.780942+08:00", "timestamp": 1756147347.780942}}}
{"text": "2025-08-26 02:58:35.725 | ERROR    | app.middleware.structured_logging:log_error:184 | 0edf612d-0244-4ed6-b490-76f676ffa66f | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:51:39.831267", "seconds": 10299.831267}, "exception": null, "extra": {"request_id": "0edf612d-0244-4ed6-b490-76f676ffa66f", "extra": {"structured_data": {"request_id": "0edf612d-0244-4ed6-b490-76f676ffa66f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 7.13, "timestamp": "2025-08-25T18:58:35.725108+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:58:35.725153+08:00", "timestamp": 1756148315.725153}}}
{"text": "2025-08-26 02:58:35.831 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8588baae-5495-4f0a-9933-53fb5fc2ab4b | Server error: 500\n", "record": {"elapsed": {"repr": "2:51:39.937408", "seconds": 10299.937408}, "exception": null, "extra": {"request_id": "8588baae-5495-4f0a-9933-53fb5fc2ab4b", "extra": {"structured_data": {"request_id": "8588baae-5495-4f0a-9933-53fb5fc2ab4b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T18:58:35.831267+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.62}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:58:35.831294+08:00", "timestamp": 1756148315.831294}}}
{"text": "2025-08-26 02:58:35.996 | ERROR    | app.middleware.structured_logging:log_error:184 | d5e6f8f3-68a8-4561-8a18-35bb0126ac42 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:51:40.102757", "seconds": 10300.102757}, "exception": null, "extra": {"request_id": "d5e6f8f3-68a8-4561-8a18-35bb0126ac42", "extra": {"structured_data": {"request_id": "d5e6f8f3-68a8-4561-8a18-35bb0126ac42", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.72, "timestamp": "2025-08-25T18:58:35.996608+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:58:35.996643+08:00", "timestamp": 1756148315.996643}}}
{"text": "2025-08-26 02:58:36.106 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 15b153d7-e81e-43e9-8a6e-9a476ca4742e | Server error: 500\n", "record": {"elapsed": {"repr": "2:51:40.212162", "seconds": 10300.212162}, "exception": null, "extra": {"request_id": "15b153d7-e81e-43e9-8a6e-9a476ca4742e", "extra": {"structured_data": {"request_id": "15b153d7-e81e-43e9-8a6e-9a476ca4742e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T18:58:36.106030+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.74}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 02:58:36.106048+08:00", "timestamp": 1756148316.106048}}}
{"text": "2025-08-26 03:15:03.246 | ERROR    | app.middleware.structured_logging:log_error:184 | b6137151-a118-4af2-a372-64c79ebecdfa | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "3:08:07.352924", "seconds": 11287.352924}, "exception": null, "extra": {"request_id": "b6137151-a118-4af2-a372-64c79ebecdfa", "extra": {"structured_data": {"request_id": "b6137151-a118-4af2-a372-64c79ebecdfa", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.57, "timestamp": "2025-08-25T19:15:03.246776+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 03:15:03.246810+08:00", "timestamp": 1756149303.24681}}}
{"text": "2025-08-26 03:15:03.356 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8b35a924-01e2-439f-9a91-f856a9c8be93 | Server error: 500\n", "record": {"elapsed": {"repr": "3:08:07.463041", "seconds": 11287.463041}, "exception": null, "extra": {"request_id": "8b35a924-01e2-439f-9a91-f856a9c8be93", "extra": {"structured_data": {"request_id": "8b35a924-01e2-439f-9a91-f856a9c8be93", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T19:15:03.356903+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.1}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 03:15:03.356927+08:00", "timestamp": 1756149303.356927}}}
{"text": "2025-08-26 03:15:03.504 | ERROR    | app.middleware.structured_logging:log_error:184 | ec56a94b-814f-4457-a1e3-405159f4fc89 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "3:08:07.610243", "seconds": 11287.610243}, "exception": null, "extra": {"request_id": "ec56a94b-814f-4457-a1e3-405159f4fc89", "extra": {"structured_data": {"request_id": "ec56a94b-814f-4457-a1e3-405159f4fc89", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "64.181.232.23", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.6, "timestamp": "2025-08-25T19:15:03.504094+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 03:15:03.504129+08:00", "timestamp": 1756149303.504129}}}
{"text": "2025-08-26 03:15:03.731 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a2ac488e-5440-47a7-a2ce-43682552345b | Server error: 500\n", "record": {"elapsed": {"repr": "3:08:07.837580", "seconds": 11287.83758}, "exception": null, "extra": {"request_id": "a2ac488e-5440-47a7-a2ce-43682552345b", "extra": {"structured_data": {"request_id": "a2ac488e-5440-47a7-a2ce-43682552345b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "64.181.232.23", "x-forwarded-for": "64.181.232.23", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "64.181.232.23", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-25T19:15:03.731447+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.7}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2875107, "name": "SpawnProcess-20"}, "thread": {"id": 124899749163136, "name": "MainThread"}, "time": {"repr": "2025-08-26 03:15:03.731466+08:00", "timestamp": 1756149303.731466}}}
{"text": "2025-08-26 11:51:05.014 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c0f1f32c-76cb-4d6b-8832-adda7d383414 | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:13.443616", "seconds": 433.443616}, "exception": null, "extra": {"request_id": "c0f1f32c-76cb-4d6b-8832-adda7d383414", "extra": {"structured_data": {"request_id": "c0f1f32c-76cb-4d6b-8832-adda7d383414", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T03:51:05.014779+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 6.29}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3097043, "name": "SpawnProcess-1"}, "thread": {"id": 132277755965568, "name": "MainThread"}, "time": {"repr": "2025-08-26 11:51:05.014813+08:00", "timestamp": 1756180265.014813}}}
{"text": "2025-08-26 11:51:05.020 | ERROR    | app.middleware.structured_logging:log_error:184 | e9d30ba5-30a5-4494-a4e2-d31fb3d7e39b | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:07:13.449227", "seconds": 433.449227}, "exception": null, "extra": {"request_id": "e9d30ba5-30a5-4494-a4e2-d31fb3d7e39b", "extra": {"structured_data": {"request_id": "e9d30ba5-30a5-4494-a4e2-d31fb3d7e39b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 7.18, "timestamp": "2025-08-26T03:51:05.020383+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3097043, "name": "SpawnProcess-1"}, "thread": {"id": 132277755965568, "name": "MainThread"}, "time": {"repr": "2025-08-26 11:51:05.020424+08:00", "timestamp": 1756180265.020424}}}
{"text": "2025-08-26 11:51:05.098 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 12376678-ef1c-40a4-bd18-8e240aab7432 | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:13.527174", "seconds": 433.527174}, "exception": null, "extra": {"request_id": "12376678-ef1c-40a4-bd18-8e240aab7432", "extra": {"structured_data": {"request_id": "12376678-ef1c-40a4-bd18-8e240aab7432", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T03:51:05.098343+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.41}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3097043, "name": "SpawnProcess-1"}, "thread": {"id": 132277755965568, "name": "MainThread"}, "time": {"repr": "2025-08-26 11:51:05.098371+08:00", "timestamp": 1756180265.098371}}}
{"text": "2025-08-26 11:51:05.107 | ERROR    | app.middleware.structured_logging:log_error:184 | 36dd59b1-ddf0-488e-b4b0-189705fb38fc | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:07:13.535874", "seconds": 433.535874}, "exception": null, "extra": {"request_id": "36dd59b1-ddf0-488e-b4b0-189705fb38fc", "extra": {"structured_data": {"request_id": "36dd59b1-ddf0-488e-b4b0-189705fb38fc", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.21, "timestamp": "2025-08-26T03:51:05.107030+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3097043, "name": "SpawnProcess-1"}, "thread": {"id": 132277755965568, "name": "MainThread"}, "time": {"repr": "2025-08-26 11:51:05.107071+08:00", "timestamp": 1756180265.107071}}}
{"text": "2025-08-26 13:33:46.441 | ERROR    | app.middleware.structured_logging:log_error:184 | aefe0834-d133-4f41-b18b-acb778a5c12e | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:37:01.116515", "seconds": 2221.116515}, "exception": null, "extra": {"request_id": "aefe0834-d133-4f41-b18b-acb778a5c12e", "extra": {"structured_data": {"request_id": "aefe0834-d133-4f41-b18b-acb778a5c12e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.56, "timestamp": "2025-08-26T05:33:46.441909+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3124660, "name": "SpawnProcess-15"}, "thread": {"id": 131579789123712, "name": "MainThread"}, "time": {"repr": "2025-08-26 13:33:46.441958+08:00", "timestamp": 1756186426.441958}}}
{"text": "2025-08-26 13:33:46.484 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 13f33a80-d458-40f4-8b37-ef3fb712d89a | Server error: 500\n", "record": {"elapsed": {"repr": "0:37:01.159018", "seconds": 2221.159018}, "exception": null, "extra": {"request_id": "13f33a80-d458-40f4-8b37-ef3fb712d89a", "extra": {"structured_data": {"request_id": "13f33a80-d458-40f4-8b37-ef3fb712d89a", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T05:33:46.484436+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.94}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3124660, "name": "SpawnProcess-15"}, "thread": {"id": 131579789123712, "name": "MainThread"}, "time": {"repr": "2025-08-26 13:33:46.484461+08:00", "timestamp": 1756186426.484461}}}
{"text": "2025-08-26 13:33:46.521 | ERROR    | app.middleware.structured_logging:log_error:184 | c225aa50-b63d-412d-8324-05d9e8bdf933 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:37:01.196237", "seconds": 2221.196237}, "exception": null, "extra": {"request_id": "c225aa50-b63d-412d-8324-05d9e8bdf933", "extra": {"structured_data": {"request_id": "c225aa50-b63d-412d-8324-05d9e8bdf933", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 5.14, "timestamp": "2025-08-26T05:33:46.521627+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3124660, "name": "SpawnProcess-15"}, "thread": {"id": 131579789123712, "name": "MainThread"}, "time": {"repr": "2025-08-26 13:33:46.521680+08:00", "timestamp": 1756186426.52168}}}
{"text": "2025-08-26 13:33:46.597 | ERROR    | app.middleware.structured_logging:log_request_end:153 | bff62ef0-e342-4e63-a55d-e76042e332a6 | Server error: 500\n", "record": {"elapsed": {"repr": "0:37:01.271811", "seconds": 2221.271811}, "exception": null, "extra": {"request_id": "bff62ef0-e342-4e63-a55d-e76042e332a6", "extra": {"structured_data": {"request_id": "bff62ef0-e342-4e63-a55d-e76042e332a6", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T05:33:46.597228+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.26}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3124660, "name": "SpawnProcess-15"}, "thread": {"id": 131579789123712, "name": "MainThread"}, "time": {"repr": "2025-08-26 13:33:46.597254+08:00", "timestamp": 1756186426.597254}}}
{"text": "2025-08-26 14:27:18.929 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 01a1de5d-cfd3-453a-b0ee-cf2b80d84f55 | Server error: 500\n", "record": {"elapsed": {"repr": "0:08:22.002635", "seconds": 502.002635}, "exception": null, "extra": {"request_id": "01a1de5d-cfd3-453a-b0ee-cf2b80d84f55", "extra": {"structured_data": {"request_id": "01a1de5d-cfd3-453a-b0ee-cf2b80d84f55", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T06:27:18.928972+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 7.38}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 14:27:18.929007+08:00", "timestamp": 1756189638.929007}}}
{"text": "2025-08-26 14:27:18.942 | ERROR    | app.middleware.structured_logging:log_error:184 | c41456d5-43c5-40ee-ac4a-499ebb9ae43b | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:08:22.015764", "seconds": 502.015764}, "exception": null, "extra": {"request_id": "c41456d5-43c5-40ee-ac4a-499ebb9ae43b", "extra": {"structured_data": {"request_id": "c41456d5-43c5-40ee-ac4a-499ebb9ae43b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 7.49, "timestamp": "2025-08-26T06:27:18.942085+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 14:27:18.942136+08:00", "timestamp": 1756189638.942136}}}
{"text": "2025-08-26 14:27:19.127 | ERROR    | app.middleware.structured_logging:log_request_end:153 | eded44a8-d526-4b61-955f-19cad785d5ba | Server error: 500\n", "record": {"elapsed": {"repr": "0:08:22.201446", "seconds": 502.201446}, "exception": null, "extra": {"request_id": "eded44a8-d526-4b61-955f-19cad785d5ba", "extra": {"structured_data": {"request_id": "eded44a8-d526-4b61-955f-19cad785d5ba", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T06:27:19.127793+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.56}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 14:27:19.127818+08:00", "timestamp": 1756189639.127818}}}
{"text": "2025-08-26 14:27:19.136 | ERROR    | app.middleware.structured_logging:log_error:184 | a7e6348c-ad8f-415a-8a5b-f3085cb65c45 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:08:22.210117", "seconds": 502.210117}, "exception": null, "extra": {"request_id": "a7e6348c-ad8f-415a-8a5b-f3085cb65c45", "extra": {"structured_data": {"request_id": "a7e6348c-ad8f-415a-8a5b-f3085cb65c45", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.16, "timestamp": "2025-08-26T06:27:19.136416+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 14:27:19.136489+08:00", "timestamp": 1756189639.136489}}}
{"text": "2025-08-26 15:15:02.657 | ERROR    | app.middleware.structured_logging:log_error:184 | 9cb96536-d90d-4273-b452-1560a44eeb11 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:56:05.730729", "seconds": 3365.730729}, "exception": null, "extra": {"request_id": "9cb96536-d90d-4273-b452-1560a44eeb11", "extra": {"structured_data": {"request_id": "9cb96536-d90d-4273-b452-1560a44eeb11", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "13.231.104.197", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.82, "timestamp": "2025-08-26T07:15:02.657078+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:15:02.657101+08:00", "timestamp": 1756192502.657101}}}
{"text": "2025-08-26 15:15:02.662 | ERROR    | app.middleware.structured_logging:log_request_end:153 | bdd136a7-e4d9-4c1e-b40a-c7143ddd4fee | Server error: 500\n", "record": {"elapsed": {"repr": "0:56:05.735870", "seconds": 3365.73587}, "exception": null, "extra": {"request_id": "bdd136a7-e4d9-4c1e-b40a-c7143ddd4fee", "extra": {"structured_data": {"request_id": "bdd136a7-e4d9-4c1e-b40a-c7143ddd4fee", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "13.231.104.197", "x-forwarded-for": "13.231.104.197", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "13.231.104.197", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T07:15:02.662218+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 6.63}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:15:02.662242+08:00", "timestamp": 1756192502.662242}}}
{"text": "2025-08-26 15:15:02.722 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a7f2e5f6-8a35-4921-9825-1f9813bd7d0f | Server error: 500\n", "record": {"elapsed": {"repr": "0:56:05.796257", "seconds": 3365.796257}, "exception": null, "extra": {"request_id": "a7f2e5f6-8a35-4921-9825-1f9813bd7d0f", "extra": {"structured_data": {"request_id": "a7f2e5f6-8a35-4921-9825-1f9813bd7d0f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "13.231.104.197", "x-forwarded-for": "13.231.104.197", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "13.231.104.197", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T07:15:02.722609+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.76}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:15:02.722629+08:00", "timestamp": 1756192502.722629}}}
{"text": "2025-08-26 15:15:03.020 | ERROR    | app.middleware.structured_logging:log_error:184 | ebbf5f7f-8624-40ee-b22b-4e901a58dc2f | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:56:06.094498", "seconds": 3366.094498}, "exception": null, "extra": {"request_id": "ebbf5f7f-8624-40ee-b22b-4e901a58dc2f", "extra": {"structured_data": {"request_id": "ebbf5f7f-8624-40ee-b22b-4e901a58dc2f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "13.231.104.197", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.65, "timestamp": "2025-08-26T07:15:03.020832+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:15:03.020870+08:00", "timestamp": 1756192503.02087}}}
{"text": "2025-08-26 15:18:23.290 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 789fff0a-67d2-4c56-b0dc-eb3eba7b6427 | Server error: 500\n", "record": {"elapsed": {"repr": "0:59:26.364002", "seconds": 3566.364002}, "exception": null, "extra": {"request_id": "789fff0a-67d2-4c56-b0dc-eb3eba7b6427", "extra": {"structured_data": {"request_id": "789fff0a-67d2-4c56-b0dc-eb3eba7b6427", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T07:18:23.290352+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.83}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:18:23.290374+08:00", "timestamp": 1756192703.290374}}}
{"text": "2025-08-26 15:18:23.301 | ERROR    | app.middleware.structured_logging:log_error:184 | f9ca923d-e3d3-4eb8-bff8-0206f6c61c06 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:59:26.374857", "seconds": 3566.374857}, "exception": null, "extra": {"request_id": "f9ca923d-e3d3-4eb8-bff8-0206f6c61c06", "extra": {"structured_data": {"request_id": "f9ca923d-e3d3-4eb8-bff8-0206f6c61c06", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.97, "timestamp": "2025-08-26T07:18:23.301203+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:18:23.301229+08:00", "timestamp": 1756192703.301229}}}
{"text": "2025-08-26 15:18:23.569 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a53b830a-95d9-4b1b-9fa9-e559c2596711 | Server error: 500\n", "record": {"elapsed": {"repr": "0:59:26.643492", "seconds": 3566.643492}, "exception": null, "extra": {"request_id": "a53b830a-95d9-4b1b-9fa9-e559c2596711", "extra": {"structured_data": {"request_id": "a53b830a-95d9-4b1b-9fa9-e559c2596711", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T07:18:23.569797+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.57}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:18:23.569864+08:00", "timestamp": 1756192703.569864}}}
{"text": "2025-08-26 15:18:23.578 | ERROR    | app.middleware.structured_logging:log_error:184 | 09547d7b-6650-423b-bd2b-8038d3ece3dc | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:59:26.651998", "seconds": 3566.651998}, "exception": null, "extra": {"request_id": "09547d7b-6650-423b-bd2b-8038d3ece3dc", "extra": {"structured_data": {"request_id": "09547d7b-6650-423b-bd2b-8038d3ece3dc", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.85, "timestamp": "2025-08-26T07:18:23.578336+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:18:23.578370+08:00", "timestamp": 1756192703.57837}}}
{"text": "2025-08-26 15:43:00.425 | ERROR    | app.middleware.structured_logging:log_error:184 | e6f5b18e-67dc-4ef5-9529-6f10efbf1f0f | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:24:03.499127", "seconds": 5043.499127}, "exception": null, "extra": {"request_id": "e6f5b18e-67dc-4ef5-9529-6f10efbf1f0f", "extra": {"structured_data": {"request_id": "e6f5b18e-67dc-4ef5-9529-6f10efbf1f0f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.69, "timestamp": "2025-08-26T07:43:00.425469+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:43:00.425499+08:00", "timestamp": 1756194180.425499}}}
{"text": "2025-08-26 15:43:00.435 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 26b0ade4-4400-4a2e-9ca6-c9c2d0ec258e | Server error: 500\n", "record": {"elapsed": {"repr": "1:24:03.509312", "seconds": 5043.509312}, "exception": null, "extra": {"request_id": "26b0ade4-4400-4a2e-9ca6-c9c2d0ec258e", "extra": {"structured_data": {"request_id": "26b0ade4-4400-4a2e-9ca6-c9c2d0ec258e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T07:43:00.435661+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.94}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:43:00.435684+08:00", "timestamp": 1756194180.435684}}}
{"text": "2025-08-26 15:43:00.705 | ERROR    | app.middleware.structured_logging:log_error:184 | 1d49f0c4-588a-4b2c-a376-973522e7ff46 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:24:03.779589", "seconds": 5043.779589}, "exception": null, "extra": {"request_id": "1d49f0c4-588a-4b2c-a376-973522e7ff46", "extra": {"structured_data": {"request_id": "1d49f0c4-588a-4b2c-a376-973522e7ff46", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.55, "timestamp": "2025-08-26T07:43:00.705920+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:43:00.705961+08:00", "timestamp": 1756194180.705961}}}
{"text": "2025-08-26 15:43:00.721 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 57c6cdbb-a07b-406f-ae26-c7c893567048 | Server error: 500\n", "record": {"elapsed": {"repr": "1:24:03.795479", "seconds": 5043.795479}, "exception": null, "extra": {"request_id": "57c6cdbb-a07b-406f-ae26-c7c893567048", "extra": {"structured_data": {"request_id": "57c6cdbb-a07b-406f-ae26-c7c893567048", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T07:43:00.721821+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 3.16}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:43:00.721851+08:00", "timestamp": 1756194180.721851}}}
{"text": "2025-08-26 15:44:11.771 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e29df4ac-3b18-4da0-92f9-439fc50bda29 | Server error: 500\n", "record": {"elapsed": {"repr": "1:25:14.845345", "seconds": 5114.845345}, "exception": null, "extra": {"request_id": "e29df4ac-3b18-4da0-92f9-439fc50bda29", "extra": {"structured_data": {"request_id": "e29df4ac-3b18-4da0-92f9-439fc50bda29", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T07:44:11.771689+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 3.55}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:44:11.771717+08:00", "timestamp": 1756194251.771717}}}
{"text": "2025-08-26 15:44:11.777 | ERROR    | app.middleware.structured_logging:log_error:184 | cc27f247-ba67-484c-aa87-501d098c844e | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:25:14.851402", "seconds": 5114.851402}, "exception": null, "extra": {"request_id": "cc27f247-ba67-484c-aa87-501d098c844e", "extra": {"structured_data": {"request_id": "cc27f247-ba67-484c-aa87-501d098c844e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.51, "timestamp": "2025-08-26T07:44:11.777741+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:44:11.777774+08:00", "timestamp": 1756194251.777774}}}
{"text": "2025-08-26 15:44:12.072 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 537cc1a5-9bfa-42cf-98f2-a310cff6bc9e | Server error: 500\n", "record": {"elapsed": {"repr": "1:25:15.146255", "seconds": 5115.146255}, "exception": null, "extra": {"request_id": "537cc1a5-9bfa-42cf-98f2-a310cff6bc9e", "extra": {"structured_data": {"request_id": "537cc1a5-9bfa-42cf-98f2-a310cff6bc9e", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T07:44:12.072598+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 6.46}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:44:12.072627+08:00", "timestamp": 1756194252.072627}}}
{"text": "2025-08-26 15:44:12.075 | ERROR    | app.middleware.structured_logging:log_error:184 | 480c4be4-26ea-4ce1-b9e5-80306510f00b | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:25:15.148739", "seconds": 5115.148739}, "exception": null, "extra": {"request_id": "480c4be4-26ea-4ce1-b9e5-80306510f00b", "extra": {"structured_data": {"request_id": "480c4be4-26ea-4ce1-b9e5-80306510f00b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 10.02, "timestamp": "2025-08-26T07:44:12.075080+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 15:44:12.075111+08:00", "timestamp": 1756194252.075111}}}
{"text": "2025-08-26 16:05:57.758 | ERROR    | app.middleware.structured_logging:log_error:184 | fdcc073a-5afa-4394-bb64-32f2db54ebb2 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:47:00.832105", "seconds": 6420.832105}, "exception": null, "extra": {"request_id": "fdcc073a-5afa-4394-bb64-32f2db54ebb2", "extra": {"structured_data": {"request_id": "fdcc073a-5afa-4394-bb64-32f2db54ebb2", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 7.8, "timestamp": "2025-08-26T08:05:57.758444+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:05:57.758477+08:00", "timestamp": 1756195557.758477}}}
{"text": "2025-08-26 16:05:57.759 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 24a1a2c4-bdf9-459a-833b-d528a5a02b42 | Server error: 500\n", "record": {"elapsed": {"repr": "1:47:00.833228", "seconds": 6420.833228}, "exception": null, "extra": {"request_id": "24a1a2c4-bdf9-459a-833b-d528a5a02b42", "extra": {"structured_data": {"request_id": "24a1a2c4-bdf9-459a-833b-d528a5a02b42", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T08:05:57.759577+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 4.72}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:05:57.759600+08:00", "timestamp": 1756195557.7596}}}
{"text": "2025-08-26 16:05:58.038 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a1cd2470-f3a3-436b-86c9-a2d1c92f8969 | Server error: 500\n", "record": {"elapsed": {"repr": "1:47:01.112478", "seconds": 6421.112478}, "exception": null, "extra": {"request_id": "a1cd2470-f3a3-436b-86c9-a2d1c92f8969", "extra": {"structured_data": {"request_id": "a1cd2470-f3a3-436b-86c9-a2d1c92f8969", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T08:05:58.038830+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.75}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:05:58.038850+08:00", "timestamp": 1756195558.03885}}}
{"text": "2025-08-26 16:05:58.148 | ERROR    | app.middleware.structured_logging:log_error:184 | c5ace2e9-330b-4a1f-af56-e5e58eeb4fa9 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:47:01.222040", "seconds": 6421.22204}, "exception": null, "extra": {"request_id": "c5ace2e9-330b-4a1f-af56-e5e58eeb4fa9", "extra": {"structured_data": {"request_id": "c5ace2e9-330b-4a1f-af56-e5e58eeb4fa9", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.85, "timestamp": "2025-08-26T08:05:58.148374+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:05:58.148412+08:00", "timestamp": 1756195558.148412}}}
{"text": "2025-08-26 16:10:01.762 | ERROR    | app.middleware.structured_logging:log_request_end:153 | caad0aea-5cac-4e3c-ad26-4fc8e3a50fdf | Server error: 500\n", "record": {"elapsed": {"repr": "1:51:04.836283", "seconds": 6664.836283}, "exception": null, "extra": {"request_id": "caad0aea-5cac-4e3c-ad26-4fc8e3a50fdf", "extra": {"structured_data": {"request_id": "caad0aea-5cac-4e3c-ad26-4fc8e3a50fdf", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T08:10:01.762615+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 4.24}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:10:01.762655+08:00", "timestamp": 1756195801.762655}}}
{"text": "2025-08-26 16:10:01.780 | ERROR    | app.middleware.structured_logging:log_error:184 | e5287683-4ff2-4861-8fe2-306e2f7d4f27 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:51:04.853770", "seconds": 6664.85377}, "exception": null, "extra": {"request_id": "e5287683-4ff2-4861-8fe2-306e2f7d4f27", "extra": {"structured_data": {"request_id": "e5287683-4ff2-4861-8fe2-306e2f7d4f27", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 11.32, "timestamp": "2025-08-26T08:10:01.780093+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:10:01.780142+08:00", "timestamp": 1756195801.780142}}}
{"text": "2025-08-26 16:10:02.035 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f5c4d19b-9084-4dd0-aec8-ab15fa0dd2e3 | Server error: 500\n", "record": {"elapsed": {"repr": "1:51:05.108769", "seconds": 6665.108769}, "exception": null, "extra": {"request_id": "f5c4d19b-9084-4dd0-aec8-ab15fa0dd2e3", "extra": {"structured_data": {"request_id": "f5c4d19b-9084-4dd0-aec8-ab15fa0dd2e3", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T08:10:02.035121+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.84}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:10:02.035141+08:00", "timestamp": 1756195802.035141}}}
{"text": "2025-08-26 16:10:02.060 | ERROR    | app.middleware.structured_logging:log_error:184 | acddbd24-7729-4a0a-89ae-03595990392f | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:51:05.134049", "seconds": 6665.134049}, "exception": null, "extra": {"request_id": "acddbd24-7729-4a0a-89ae-03595990392f", "extra": {"structured_data": {"request_id": "acddbd24-7729-4a0a-89ae-03595990392f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.97, "timestamp": "2025-08-26T08:10:02.060392+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:10:02.060421+08:00", "timestamp": 1756195802.060421}}}
{"text": "2025-08-26 16:23:59.212 | ERROR    | app.middleware.structured_logging:log_error:184 | d01b746f-7d2b-4253-91fc-6b55af9d1e33 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:05:02.286087", "seconds": 7502.286087}, "exception": null, "extra": {"request_id": "d01b746f-7d2b-4253-91fc-6b55af9d1e33", "extra": {"structured_data": {"request_id": "d01b746f-7d2b-4253-91fc-6b55af9d1e33", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.9, "timestamp": "2025-08-26T08:23:59.212421+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:23:59.212459+08:00", "timestamp": 1756196639.212459}}}
{"text": "2025-08-26 16:23:59.234 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e48f59b1-86ce-449e-b4b4-4f55173260f3 | Server error: 500\n", "record": {"elapsed": {"repr": "2:05:02.307807", "seconds": 7502.307807}, "exception": null, "extra": {"request_id": "e48f59b1-86ce-449e-b4b4-4f55173260f3", "extra": {"structured_data": {"request_id": "e48f59b1-86ce-449e-b4b4-4f55173260f3", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T08:23:59.234154+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.94}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:23:59.234179+08:00", "timestamp": 1756196639.234179}}}
{"text": "2025-08-26 16:23:59.501 | ERROR    | app.middleware.structured_logging:log_error:184 | fe1a04a9-fa43-4158-9148-1599480b888b | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "2:05:02.575123", "seconds": 7502.575123}, "exception": null, "extra": {"request_id": "fe1a04a9-fa43-4158-9148-1599480b888b", "extra": {"structured_data": {"request_id": "fe1a04a9-fa43-4158-9148-1599480b888b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.43, "timestamp": "2025-08-26T08:23:59.501468+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:23:59.501495+08:00", "timestamp": 1756196639.501495}}}
{"text": "2025-08-26 16:23:59.525 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 568fe6eb-3447-4465-9385-c6c0cd538550 | Server error: 500\n", "record": {"elapsed": {"repr": "2:05:02.599583", "seconds": 7502.599583}, "exception": null, "extra": {"request_id": "568fe6eb-3447-4465-9385-c6c0cd538550", "extra": {"structured_data": {"request_id": "568fe6eb-3447-4465-9385-c6c0cd538550", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T08:23:59.525934+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.92}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3152844, "name": "SpawnProcess-1"}, "thread": {"id": 123772734341248, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:23:59.525955+08:00", "timestamp": 1756196639.525955}}}
{"text": "2025-08-26 16:36:25.511 | ERROR    | app.middleware.structured_logging:log_error:184 | c6addc12-c177-48e6-a0c2-ebd63447484d | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:01:09.167945", "seconds": 69.167945}, "exception": null, "extra": {"request_id": "c6addc12-c177-48e6-a0c2-ebd63447484d", "extra": {"structured_data": {"request_id": "c6addc12-c177-48e6-a0c2-ebd63447484d", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "client_ip": "208.87.243.139", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/claude.py\", line 257, in get_claude_accounts\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 17.2, "timestamp": "2025-08-26T08:36:25.511202+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3198659, "name": "SpawnProcess-2"}, "thread": {"id": 138894493433984, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:36:25.511234+08:00", "timestamp": 1756197385.511234}}}
{"text": "2025-08-26 16:36:25.795 | ERROR    | app.middleware.structured_logging:log_error:184 | 833c8ba8-6ac1-421c-ad2b-ec31a96d9297 | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:01:09.452385", "seconds": 69.452385}, "exception": null, "extra": {"request_id": "833c8ba8-6ac1-421c-ad2b-ec31a96d9297", "extra": {"structured_data": {"request_id": "833c8ba8-6ac1-421c-ad2b-ec31a96d9297", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "client_ip": "208.87.243.139", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/claude.py\", line 257, in get_claude_accounts\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 6.1, "timestamp": "2025-08-26T08:36:25.795640+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3198659, "name": "SpawnProcess-2"}, "thread": {"id": 138894493433984, "name": "MainThread"}, "time": {"repr": "2025-08-26 16:36:25.795674+08:00", "timestamp": 1756197385.795674}}}
{"text": "2025-08-26 17:18:53.968 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 7f5221ed-39f3-4dbb-a4df-690f691de96a | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:01.937583", "seconds": 61.937583}, "exception": null, "extra": {"request_id": "7f5221ed-39f3-4dbb-a4df-690f691de96a", "extra": {"structured_data": {"request_id": "7f5221ed-39f3-4dbb-a4df-690f691de96a", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T09:18:53.968729+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 5.41}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3213330, "name": "SpawnProcess-1"}, "thread": {"id": 132770854879360, "name": "MainThread"}, "time": {"repr": "2025-08-26 17:18:53.968759+08:00", "timestamp": 1756199933.968759}}}
{"text": "2025-08-26 17:18:53.993 | ERROR    | app.middleware.structured_logging:log_error:184 | 641d5030-3626-475d-a356-5352f3b028f1 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:01:01.962822", "seconds": 61.962822}, "exception": null, "extra": {"request_id": "641d5030-3626-475d-a356-5352f3b028f1", "extra": {"structured_data": {"request_id": "641d5030-3626-475d-a356-5352f3b028f1", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 9.44, "timestamp": "2025-08-26T09:18:53.993943+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3213330, "name": "SpawnProcess-1"}, "thread": {"id": 132770854879360, "name": "MainThread"}, "time": {"repr": "2025-08-26 17:18:53.993998+08:00", "timestamp": 1756199933.993998}}}
{"text": "2025-08-26 17:18:54.241 | ERROR    | app.middleware.structured_logging:log_request_end:153 | cf9e40df-4614-46d4-adcc-f7acb1a9c8b6 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:02.210451", "seconds": 62.210451}, "exception": null, "extra": {"request_id": "cf9e40df-4614-46d4-adcc-f7acb1a9c8b6", "extra": {"structured_data": {"request_id": "cf9e40df-4614-46d4-adcc-f7acb1a9c8b6", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.139", "x-forwarded-for": "208.87.243.139", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users"}, "client_ip": "208.87.243.139", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T09:18:54.241607+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.97}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3213330, "name": "SpawnProcess-1"}, "thread": {"id": 132770854879360, "name": "MainThread"}, "time": {"repr": "2025-08-26 17:18:54.241627+08:00", "timestamp": 1756199934.241627}}}
{"text": "2025-08-26 17:18:54.313 | ERROR    | app.middleware.structured_logging:log_error:184 | 0d8a9397-817c-48a3-8576-a5faf6622b02 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:01:02.281900", "seconds": 62.2819}, "exception": null, "extra": {"request_id": "0d8a9397-817c-48a3-8576-a5faf6622b02", "extra": {"structured_data": {"request_id": "0d8a9397-817c-48a3-8576-a5faf6622b02", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "208.87.243.139", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.09, "timestamp": "2025-08-26T09:18:54.313046+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3213330, "name": "SpawnProcess-1"}, "thread": {"id": 132770854879360, "name": "MainThread"}, "time": {"repr": "2025-08-26 17:18:54.313076+08:00", "timestamp": 1756199934.313076}}}
{"text": "2025-08-26 17:18:58.518 | ERROR    | app.middleware.structured_logging:log_error:184 | 3a110bd9-a1d5-4ce7-86bc-5299f7b5c774 | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:01:06.487619", "seconds": 66.487619}, "exception": null, "extra": {"request_id": "3a110bd9-a1d5-4ce7-86bc-5299f7b5c774", "extra": {"structured_data": {"request_id": "3a110bd9-a1d5-4ce7-86bc-5299f7b5c774", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "client_ip": "208.87.243.139", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/claude.py\", line 258, in get_claude_accounts\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 30.89, "timestamp": "2025-08-26T09:18:58.518761+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3213330, "name": "SpawnProcess-1"}, "thread": {"id": 132770854879360, "name": "MainThread"}, "time": {"repr": "2025-08-26 17:18:58.518795+08:00", "timestamp": 1756199938.518795}}}
{"text": "2025-08-26 17:18:59.044 | ERROR    | app.middleware.structured_logging:log_error:184 | 5cbb1f77-c49a-4673-b0f2-0cd248b3fb00 | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:01:07.013191", "seconds": 67.013191}, "exception": null, "extra": {"request_id": "5cbb1f77-c49a-4673-b0f2-0cd248b3fb00", "extra": {"structured_data": {"request_id": "5cbb1f77-c49a-4673-b0f2-0cd248b3fb00", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "client_ip": "208.87.243.139", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/claude.py\", line 258, in get_claude_accounts\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 4.45, "timestamp": "2025-08-26T09:18:59.044333+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3213330, "name": "SpawnProcess-1"}, "thread": {"id": 132770854879360, "name": "MainThread"}, "time": {"repr": "2025-08-26 17:18:59.044367+08:00", "timestamp": 1756199939.044367}}}
{"text": "2025-08-26 17:21:25.492 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 7fe89aa9-8356-4428-bdba-7d076e7d314c | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:18.895044", "seconds": 18.895044}, "exception": null, "extra": {"request_id": "7fe89aa9-8356-4428-bdba-7d076e7d314c", "extra": {"structured_data": {"request_id": "7fe89aa9-8356-4428-bdba-7d076e7d314c", "method": "GET", "url": "http://localhost:8001/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-26T09:21:25.492453+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1181", "content-type": "application/json"}, "duration_ms": 51.12}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3214684, "name": "SpawnProcess-5"}, "thread": {"id": 136932397084800, "name": "MainThread"}, "time": {"repr": "2025-08-26 17:21:25.492488+08:00", "timestamp": 1756200085.492488}}}
{"text": "2025-08-26 20:05:09.873 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 542304da-a696-4fec-84bf-a775233b2ad6 | Server error: 500\n", "record": {"elapsed": {"repr": "2:37:32.162343", "seconds": 9452.162343}, "exception": null, "extra": {"request_id": "542304da-a696-4fec-84bf-a775233b2ad6", "extra": {"structured_data": {"request_id": "542304da-a696-4fec-84bf-a775233b2ad6", "method": "POST", "url": "http://43.167.252.120/api/v1/admin/claude/accounts/oauth/initiate", "path": "/api/v1/admin/claude/accounts/oauth/initiate", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "107.167.23.66", "x-forwarded-for": "107.167.23.66", "x-forwarded-proto": "http", "connection": "close", "content-length": "60", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "107.167.23.66", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T12:05:09.873739+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "144", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 15.23}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3217035, "name": "SpawnProcess-6"}, "thread": {"id": 130346207535232, "name": "MainThread"}, "time": {"repr": "2025-08-26 20:05:09.873781+08:00", "timestamp": 1756209909.873781}}}
{"text": "2025-08-26 20:08:19.161 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 7f56d686-905e-4208-83b0-9ac0a81f3a4f | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:17.813172", "seconds": 77.813172}, "exception": null, "extra": {"request_id": "7f56d686-905e-4208-83b0-9ac0a81f3a4f", "extra": {"structured_data": {"request_id": "7f56d686-905e-4208-83b0-9ac0a81f3a4f", "method": "POST", "url": "http://localhost:8001/api/v1/admin/claude/accounts/oauth/initiate", "path": "/api/v1/admin/claude/accounts/oauth/initiate", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "57"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-26T12:08:19.161920+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "144", "content-type": "application/json"}, "duration_ms": 7.83}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3267424, "name": "SpawnProcess-7"}, "thread": {"id": 133041062883456, "name": "MainThread"}, "time": {"repr": "2025-08-26 20:08:19.161958+08:00", "timestamp": 1756210099.161958}}}
{"text": "2025-08-26 22:08:39.506 | ERROR    | app.middleware.structured_logging:log_error:184 | a7b3ec4f-76e5-47a1-b751-cbe4f5828b0b | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:32:57.352913", "seconds": 5577.352913}, "exception": null, "extra": {"request_id": "a7b3ec4f-76e5-47a1-b751-cbe4f5828b0b", "extra": {"structured_data": {"request_id": "a7b3ec4f-76e5-47a1-b751-cbe4f5828b0b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 11.66, "timestamp": "2025-08-26T14:08:39.506728+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3277554, "name": "SpawnProcess-17"}, "thread": {"id": 128701251035264, "name": "MainThread"}, "time": {"repr": "2025-08-26 22:08:39.506785+08:00", "timestamp": 1756217319.506785}}}
{"text": "2025-08-26 22:08:39.510 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e2394563-cfde-4f7e-a6bc-4a0d20b99eb1 | Server error: 500\n", "record": {"elapsed": {"repr": "1:32:57.356526", "seconds": 5577.356526}, "exception": null, "extra": {"request_id": "e2394563-cfde-4f7e-a6bc-4a0d20b99eb1", "extra": {"structured_data": {"request_id": "e2394563-cfde-4f7e-a6bc-4a0d20b99eb1", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T14:08:39.510372+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 20.68}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3277554, "name": "SpawnProcess-17"}, "thread": {"id": 128701251035264, "name": "MainThread"}, "time": {"repr": "2025-08-26 22:08:39.510398+08:00", "timestamp": 1756217319.510398}}}
{"text": "2025-08-26 22:08:39.590 | ERROR    | app.middleware.structured_logging:log_error:184 | 4e8e2995-8088-43b7-b11a-adb6ce94629d | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "1:32:57.436378", "seconds": 5577.436378}, "exception": null, "extra": {"request_id": "4e8e2995-8088-43b7-b11a-adb6ce94629d", "extra": {"structured_data": {"request_id": "4e8e2995-8088-43b7-b11a-adb6ce94629d", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.37, "timestamp": "2025-08-26T14:08:39.590217+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3277554, "name": "SpawnProcess-17"}, "thread": {"id": 128701251035264, "name": "MainThread"}, "time": {"repr": "2025-08-26 22:08:39.590250+08:00", "timestamp": 1756217319.59025}}}
{"text": "2025-08-26 22:08:39.603 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e040e5b3-e5d0-4621-8edf-feab437f98d3 | Server error: 500\n", "record": {"elapsed": {"repr": "1:32:57.450124", "seconds": 5577.450124}, "exception": null, "extra": {"request_id": "e040e5b3-e5d0-4621-8edf-feab437f98d3", "extra": {"structured_data": {"request_id": "e040e5b3-e5d0-4621-8edf-feab437f98d3", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T14:08:39.603978+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.51}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3277554, "name": "SpawnProcess-17"}, "thread": {"id": 128701251035264, "name": "MainThread"}, "time": {"repr": "2025-08-26 22:08:39.603996+08:00", "timestamp": 1756217319.603996}}}
{"text": "2025-08-26 23:25:52.703 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0095c95d-0945-4331-971c-7da6774b7cd8 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:18.746550", "seconds": 18.74655}, "exception": null, "extra": {"request_id": "0095c95d-0945-4331-971c-7da6774b7cd8", "extra": {"structured_data": {"request_id": "0095c95d-0945-4331-971c-7da6774b7cd8", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:25:52.703149+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 4.91}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:25:52.703172+08:00", "timestamp": 1756221952.703172}}}
{"text": "2025-08-26 23:25:52.707 | ERROR    | app.middleware.structured_logging:log_error:184 | f0713528-6de8-4c60-9f9b-7193100baab9 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:00:18.750891", "seconds": 18.750891}, "exception": null, "extra": {"request_id": "f0713528-6de8-4c60-9f9b-7193100baab9", "extra": {"structured_data": {"request_id": "f0713528-6de8-4c60-9f9b-7193100baab9", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 4.01, "timestamp": "2025-08-26T15:25:52.707483+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:25:52.707513+08:00", "timestamp": 1756221952.707513}}}
{"text": "2025-08-26 23:25:52.874 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0eed4aca-0e02-4511-a483-6ab4a5efe544 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:18.917450", "seconds": 18.91745}, "exception": null, "extra": {"request_id": "0eed4aca-0e02-4511-a483-6ab4a5efe544", "extra": {"structured_data": {"request_id": "0eed4aca-0e02-4511-a483-6ab4a5efe544", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:25:52.874048+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.9}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:25:52.874072+08:00", "timestamp": 1756221952.874072}}}
{"text": "2025-08-26 23:25:52.890 | ERROR    | app.middleware.structured_logging:log_error:184 | c9aedf40-afb2-4d9d-b0c4-3da3bd246a8b | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:00:18.934012", "seconds": 18.934012}, "exception": null, "extra": {"request_id": "c9aedf40-afb2-4d9d-b0c4-3da3bd246a8b", "extra": {"structured_data": {"request_id": "c9aedf40-afb2-4d9d-b0c4-3da3bd246a8b", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.72", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 2.82, "timestamp": "2025-08-26T15:25:52.890601+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:25:52.890634+08:00", "timestamp": 1756221952.890634}}}
{"text": "2025-08-26 23:32:55.929 | ERROR    | app.middleware.structured_logging:log_request_end:153 | cf442355-af18-452e-9389-2f64d13b7b22 | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:21.973278", "seconds": 441.973278}, "exception": null, "extra": {"request_id": "cf442355-af18-452e-9389-2f64d13b7b22", "extra": {"structured_data": {"request_id": "cf442355-af18-452e-9389-2f64d13b7b22", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:32:55.929874+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.19}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:32:55.929900+08:00", "timestamp": 1756222375.9299}}}
{"text": "2025-08-26 23:32:56.110 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c61779f1-ee46-4945-a3a0-54be6d9b16a9 | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:22.153686", "seconds": 442.153686}, "exception": null, "extra": {"request_id": "c61779f1-ee46-4945-a3a0-54be6d9b16a9", "extra": {"structured_data": {"request_id": "c61779f1-ee46-4945-a3a0-54be6d9b16a9", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:32:56.110277+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.97}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:32:56.110308+08:00", "timestamp": 1756222376.110308}}}
{"text": "2025-08-26 23:33:12.914 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6ccb7333-d772-488a-88b0-b6fc59c7548a | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:38.957692", "seconds": 458.957692}, "exception": null, "extra": {"request_id": "6ccb7333-d772-488a-88b0-b6fc59c7548a", "extra": {"structured_data": {"request_id": "6ccb7333-d772-488a-88b0-b6fc59c7548a", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:33:12.914280+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.85}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:33:12.914314+08:00", "timestamp": 1756222392.914314}}}
{"text": "2025-08-26 23:33:13.098 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 64d780ba-82c1-4bf1-9069-fd4b339df75d | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:39.141512", "seconds": 459.141512}, "exception": null, "extra": {"request_id": "64d780ba-82c1-4bf1-9069-fd4b339df75d", "extra": {"structured_data": {"request_id": "64d780ba-82c1-4bf1-9069-fd4b339df75d", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:33:13.098092+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 11.94}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:33:13.098134+08:00", "timestamp": 1756222393.098134}}}
{"text": "2025-08-26 23:34:29.919 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 11e7494b-991c-4e3a-9d2e-adafd9b58b6f | Server error: 500\n", "record": {"elapsed": {"repr": "0:08:55.962815", "seconds": 535.962815}, "exception": null, "extra": {"request_id": "11e7494b-991c-4e3a-9d2e-adafd9b58b6f", "extra": {"structured_data": {"request_id": "11e7494b-991c-4e3a-9d2e-adafd9b58b6f", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:34:29.919406+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.18}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:34:29.919437+08:00", "timestamp": 1756222469.919437}}}
{"text": "2025-08-26 23:34:30.095 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f4b70fb5-b073-438a-8877-db918559e76c | Server error: 500\n", "record": {"elapsed": {"repr": "0:08:56.138638", "seconds": 536.138638}, "exception": null, "extra": {"request_id": "f4b70fb5-b073-438a-8877-db918559e76c", "extra": {"structured_data": {"request_id": "f4b70fb5-b073-438a-8877-db918559e76c", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:34:30.095230+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.89}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:34:30.095260+08:00", "timestamp": 1756222470.09526}}}
{"text": "2025-08-26 23:34:49.430 | ERROR    | app.middleware.structured_logging:log_request_end:153 | cc0854a6-91c0-46ba-9a2f-068e7beb4a2f | Server error: 500\n", "record": {"elapsed": {"repr": "0:09:15.474163", "seconds": 555.474163}, "exception": null, "extra": {"request_id": "cc0854a6-91c0-46ba-9a2f-068e7beb4a2f", "extra": {"structured_data": {"request_id": "cc0854a6-91c0-46ba-9a2f-068e7beb4a2f", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:34:49.430754+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 8.47}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:34:49.430785+08:00", "timestamp": 1756222489.430785}}}
{"text": "2025-08-26 23:34:49.610 | ERROR    | app.middleware.structured_logging:log_request_end:153 | dc309ba1-2c7a-4bf0-b73f-6d101cf9b171 | Server error: 500\n", "record": {"elapsed": {"repr": "0:09:15.653972", "seconds": 555.653972}, "exception": null, "extra": {"request_id": "dc309ba1-2c7a-4bf0-b73f-6d101cf9b171", "extra": {"structured_data": {"request_id": "dc309ba1-2c7a-4bf0-b73f-6d101cf9b171", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:34:49.610563+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 10.79}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:34:49.610594+08:00", "timestamp": 1756222489.610594}}}
{"text": "2025-08-26 23:34:57.724 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3ec25808-5d3a-40b8-90f7-a0a31dfdf7f8 | Server error: 500\n", "record": {"elapsed": {"repr": "0:09:23.767752", "seconds": 563.767752}, "exception": null, "extra": {"request_id": "3ec25808-5d3a-40b8-90f7-a0a31dfdf7f8", "extra": {"structured_data": {"request_id": "3ec25808-5d3a-40b8-90f7-a0a31dfdf7f8", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:34:57.724340+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 12.69}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:34:57.724374+08:00", "timestamp": 1756222497.724374}}}
{"text": "2025-08-26 23:34:57.896 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3ef45447-0ecd-45b5-aea3-1d29d2ac75d5 | Server error: 500\n", "record": {"elapsed": {"repr": "0:09:23.940085", "seconds": 563.940085}, "exception": null, "extra": {"request_id": "3ef45447-0ecd-45b5-aea3-1d29d2ac75d5", "extra": {"structured_data": {"request_id": "3ef45447-0ecd-45b5-aea3-1d29d2ac75d5", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:34:57.896683+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.18}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:34:57.896707+08:00", "timestamp": 1756222497.896707}}}
{"text": "2025-08-26 23:35:09.964 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 050ecdac-fc19-4a86-bf73-399481320bc1 | Server error: 500\n", "record": {"elapsed": {"repr": "0:09:36.007424", "seconds": 576.007424}, "exception": null, "extra": {"request_id": "050ecdac-fc19-4a86-bf73-399481320bc1", "extra": {"structured_data": {"request_id": "050ecdac-fc19-4a86-bf73-399481320bc1", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:35:09.964020+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 8.6}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:35:09.964046+08:00", "timestamp": 1756222509.964046}}}
{"text": "2025-08-26 23:35:10.148 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6ad836a7-313a-4f60-bc63-add245dcb437 | Server error: 500\n", "record": {"elapsed": {"repr": "0:09:36.192194", "seconds": 576.192194}, "exception": null, "extra": {"request_id": "6ad836a7-313a-4f60-bc63-add245dcb437", "extra": {"structured_data": {"request_id": "6ad836a7-313a-4f60-bc63-add245dcb437", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:35:10.148783+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 8.48}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:35:10.148816+08:00", "timestamp": 1756222510.148816}}}
{"text": "2025-08-26 23:35:21.172 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b4aece74-1326-4be8-8dbb-bede9cdefb1b | Server error: 500\n", "record": {"elapsed": {"repr": "0:09:47.215585", "seconds": 587.215585}, "exception": null, "extra": {"request_id": "b4aece74-1326-4be8-8dbb-bede9cdefb1b", "extra": {"structured_data": {"request_id": "b4aece74-1326-4be8-8dbb-bede9cdefb1b", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:35:21.172184+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 6.08}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:35:21.172207+08:00", "timestamp": 1756222521.172207}}}
{"text": "2025-08-26 23:35:21.251 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8d845754-0b46-4209-ae81-ca7f443f6b73 | Server error: 500\n", "record": {"elapsed": {"repr": "0:09:47.294508", "seconds": 587.294508}, "exception": null, "extra": {"request_id": "8d845754-0b46-4209-ae81-ca7f443f6b73", "extra": {"structured_data": {"request_id": "8d845754-0b46-4209-ae81-ca7f443f6b73", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:35:21.251100+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.17}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:35:21.251130+08:00", "timestamp": 1756222521.25113}}}
{"text": "2025-08-26 23:36:03.870 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f2cd5915-3110-43b1-b690-991fbb5a3499 | Server error: 500\n", "record": {"elapsed": {"repr": "0:10:29.913876", "seconds": 629.913876}, "exception": null, "extra": {"request_id": "f2cd5915-3110-43b1-b690-991fbb5a3499", "extra": {"structured_data": {"request_id": "f2cd5915-3110-43b1-b690-991fbb5a3499", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:36:03.870464+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 9.97}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:36:03.870498+08:00", "timestamp": 1756222563.870498}}}
{"text": "2025-08-26 23:36:03.950 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3dcdda13-16ef-4f8f-aad5-d0a7a1c07fb3 | Server error: 500\n", "record": {"elapsed": {"repr": "0:10:29.994209", "seconds": 629.994209}, "exception": null, "extra": {"request_id": "3dcdda13-16ef-4f8f-aad5-d0a7a1c07fb3", "extra": {"structured_data": {"request_id": "3dcdda13-16ef-4f8f-aad5-d0a7a1c07fb3", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:36:03.950798+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.26}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:36:03.950831+08:00", "timestamp": 1756222563.950831}}}
{"text": "2025-08-26 23:37:45.200 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3df60c12-542e-478e-99e3-306a7330020e | Server error: 500\n", "record": {"elapsed": {"repr": "0:12:11.243908", "seconds": 731.243908}, "exception": null, "extra": {"request_id": "3df60c12-542e-478e-99e3-306a7330020e", "extra": {"structured_data": {"request_id": "3df60c12-542e-478e-99e3-306a7330020e", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:37:45.200502+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 7.3}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:37:45.200530+08:00", "timestamp": 1756222665.20053}}}
{"text": "2025-08-26 23:37:45.370 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 190ae4de-d05d-49bd-a803-eb209570f022 | Server error: 500\n", "record": {"elapsed": {"repr": "0:12:11.414019", "seconds": 731.414019}, "exception": null, "extra": {"request_id": "190ae4de-d05d-49bd-a803-eb209570f022", "extra": {"structured_data": {"request_id": "190ae4de-d05d-49bd-a803-eb209570f022", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:37:45.370612+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 6.49}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:37:45.370641+08:00", "timestamp": 1756222665.370641}}}
{"text": "2025-08-26 23:41:44.115 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a5e96793-1658-4e43-a100-4a32064a5ea6 | Server error: 500\n", "record": {"elapsed": {"repr": "0:16:10.158975", "seconds": 970.158975}, "exception": null, "extra": {"request_id": "a5e96793-1658-4e43-a100-4a32064a5ea6", "extra": {"structured_data": {"request_id": "a5e96793-1658-4e43-a100-4a32064a5ea6", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:41:44.115574+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 6.02}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:41:44.115597+08:00", "timestamp": 1756222904.115597}}}
{"text": "2025-08-26 23:41:44.539 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 14488995-ef69-4933-94d6-bda0084adaaf | Server error: 500\n", "record": {"elapsed": {"repr": "0:16:10.582392", "seconds": 970.582392}, "exception": null, "extra": {"request_id": "14488995-ef69-4933-94d6-bda0084adaaf", "extra": {"structured_data": {"request_id": "14488995-ef69-4933-94d6-bda0084adaaf", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:41:44.538991+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.1}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:41:44.539014+08:00", "timestamp": 1756222904.539014}}}
{"text": "2025-08-26 23:44:00.918 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 9dbdc1b4-0884-4f38-80bd-097af0ccdf34 | Server error: 500\n", "record": {"elapsed": {"repr": "0:18:26.961574", "seconds": 1106.961574}, "exception": null, "extra": {"request_id": "9dbdc1b4-0884-4f38-80bd-097af0ccdf34", "extra": {"structured_data": {"request_id": "9dbdc1b4-0884-4f38-80bd-097af0ccdf34", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:44:00.918164+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.4}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:44:00.918196+08:00", "timestamp": 1756223040.918196}}}
{"text": "2025-08-26 23:44:01.001 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e05d7975-b936-4464-8ce3-5922d7ae6b56 | Server error: 500\n", "record": {"elapsed": {"repr": "0:18:27.044434", "seconds": 1107.044434}, "exception": null, "extra": {"request_id": "e05d7975-b936-4464-8ce3-5922d7ae6b56", "extra": {"structured_data": {"request_id": "e05d7975-b936-4464-8ce3-5922d7ae6b56", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:44:01.001027+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.18}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:44:01.001056+08:00", "timestamp": 1756223041.001056}}}
{"text": "2025-08-26 23:44:28.627 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b9e09e13-7597-4477-881d-75511ccfd6e4 | Server error: 500\n", "record": {"elapsed": {"repr": "0:18:54.670938", "seconds": 1134.670938}, "exception": null, "extra": {"request_id": "b9e09e13-7597-4477-881d-75511ccfd6e4", "extra": {"structured_data": {"request_id": "b9e09e13-7597-4477-881d-75511ccfd6e4", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:44:28.627522+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.53}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:44:28.627560+08:00", "timestamp": 1756223068.62756}}}
{"text": "2025-08-26 23:44:28.708 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 4699ca52-5e20-4b8a-99a4-8275756a00ee | Server error: 500\n", "record": {"elapsed": {"repr": "0:18:54.751801", "seconds": 1134.751801}, "exception": null, "extra": {"request_id": "4699ca52-5e20-4b8a-99a4-8275756a00ee", "extra": {"structured_data": {"request_id": "4699ca52-5e20-4b8a-99a4-8275756a00ee", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:44:28.708403+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.79}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:44:28.708423+08:00", "timestamp": 1756223068.708423}}}
{"text": "2025-08-26 23:45:03.782 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 23c12c73-ea28-4d40-b95b-a91a10fa9569 | Server error: 500\n", "record": {"elapsed": {"repr": "0:19:29.826035", "seconds": 1169.826035}, "exception": null, "extra": {"request_id": "23c12c73-ea28-4d40-b95b-a91a10fa9569", "extra": {"structured_data": {"request_id": "23c12c73-ea28-4d40-b95b-a91a10fa9569", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:45:03.782620+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 17.65}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:45:03.782657+08:00", "timestamp": 1756223103.782657}}}
{"text": "2025-08-26 23:45:03.859 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c595a1e8-6935-48f9-b395-3929a8d1649b | Server error: 500\n", "record": {"elapsed": {"repr": "0:19:29.902737", "seconds": 1169.902737}, "exception": null, "extra": {"request_id": "c595a1e8-6935-48f9-b395-3929a8d1649b", "extra": {"structured_data": {"request_id": "c595a1e8-6935-48f9-b395-3929a8d1649b", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:45:03.859328+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.87}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:45:03.859359+08:00", "timestamp": 1756223103.859359}}}
{"text": "2025-08-26 23:45:07.551 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3e6b018a-0cba-4c0c-8ddf-1672f2b0f8c8 | Server error: 500\n", "record": {"elapsed": {"repr": "0:19:33.595326", "seconds": 1173.595326}, "exception": null, "extra": {"request_id": "3e6b018a-0cba-4c0c-8ddf-1672f2b0f8c8", "extra": {"structured_data": {"request_id": "3e6b018a-0cba-4c0c-8ddf-1672f2b0f8c8", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:45:07.551921+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 6.39}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:45:07.551948+08:00", "timestamp": 1756223107.551948}}}
{"text": "2025-08-26 23:45:07.631 | ERROR    | app.middleware.structured_logging:log_request_end:153 | bfef2f24-d7fc-4cef-9d70-2fc6487419f5 | Server error: 500\n", "record": {"elapsed": {"repr": "0:19:33.674473", "seconds": 1173.674473}, "exception": null, "extra": {"request_id": "bfef2f24-d7fc-4cef-9d70-2fc6487419f5", "extra": {"structured_data": {"request_id": "bfef2f24-d7fc-4cef-9d70-2fc6487419f5", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:45:07.631072+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.1}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:45:07.631095+08:00", "timestamp": 1756223107.631095}}}
{"text": "2025-08-26 23:45:17.351 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e2f4773f-289f-4bb5-affc-cc78f249ed0c | Server error: 500\n", "record": {"elapsed": {"repr": "0:19:43.395141", "seconds": 1183.395141}, "exception": null, "extra": {"request_id": "e2f4773f-289f-4bb5-affc-cc78f249ed0c", "extra": {"structured_data": {"request_id": "e2f4773f-289f-4bb5-affc-cc78f249ed0c", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:45:17.351728+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 8.79}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:45:17.351763+08:00", "timestamp": 1756223117.351763}}}
{"text": "2025-08-26 23:45:17.431 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 99dc8537-f4a2-4ba2-8510-75b72ce28e52 | Server error: 500\n", "record": {"elapsed": {"repr": "0:19:43.475053", "seconds": 1183.475053}, "exception": null, "extra": {"request_id": "99dc8537-f4a2-4ba2-8510-75b72ce28e52", "extra": {"structured_data": {"request_id": "99dc8537-f4a2-4ba2-8510-75b72ce28e52", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:45:17.431646+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.63}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:45:17.431675+08:00", "timestamp": 1756223117.431675}}}
{"text": "2025-08-26 23:46:07.945 | ERROR    | app.middleware.structured_logging:log_request_end:153 | be0f737d-51c7-4a4b-ba43-666f2ee37f25 | Server error: 500\n", "record": {"elapsed": {"repr": "0:20:33.988840", "seconds": 1233.98884}, "exception": null, "extra": {"request_id": "be0f737d-51c7-4a4b-ba43-666f2ee37f25", "extra": {"structured_data": {"request_id": "be0f737d-51c7-4a4b-ba43-666f2ee37f25", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:46:07.945428+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 12.35}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:46:07.945462+08:00", "timestamp": 1756223167.945462}}}
{"text": "2025-08-26 23:46:08.025 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 57ebb20d-8fd0-4f8a-95c8-76c1383f2319 | Server error: 500\n", "record": {"elapsed": {"repr": "0:20:34.069024", "seconds": 1234.069024}, "exception": null, "extra": {"request_id": "57ebb20d-8fd0-4f8a-95c8-76c1383f2319", "extra": {"structured_data": {"request_id": "57ebb20d-8fd0-4f8a-95c8-76c1383f2319", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:46:08.025615+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.2}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:46:08.025646+08:00", "timestamp": 1756223168.025646}}}
{"text": "2025-08-26 23:46:58.135 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a177b93e-ca2c-4875-a62b-e4cfb855be75 | Server error: 500\n", "record": {"elapsed": {"repr": "0:21:24.179026", "seconds": 1284.179026}, "exception": null, "extra": {"request_id": "a177b93e-ca2c-4875-a62b-e4cfb855be75", "extra": {"structured_data": {"request_id": "a177b93e-ca2c-4875-a62b-e4cfb855be75", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:46:58.135625+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 2.8}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:46:58.135648+08:00", "timestamp": 1756223218.135648}}}
{"text": "2025-08-26 23:46:58.315 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6360fd5b-6d4f-4191-aa4c-391a00c99538 | Server error: 500\n", "record": {"elapsed": {"repr": "0:21:24.359063", "seconds": 1284.359063}, "exception": null, "extra": {"request_id": "6360fd5b-6d4f-4191-aa4c-391a00c99538", "extra": {"structured_data": {"request_id": "6360fd5b-6d4f-4191-aa4c-391a00c99538", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:46:58.315661+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.32}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:46:58.315685+08:00", "timestamp": 1756223218.315685}}}
{"text": "2025-08-26 23:59:48.959 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6a8d2296-4e86-40be-9060-ecc439f66b08 | Server error: 500\n", "record": {"elapsed": {"repr": "0:34:15.002640", "seconds": 2055.00264}, "exception": null, "extra": {"request_id": "6a8d2296-4e86-40be-9060-ecc439f66b08", "extra": {"structured_data": {"request_id": "6a8d2296-4e86-40be-9060-ecc439f66b08", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:59:48.959221+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 16.33}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:59:48.959262+08:00", "timestamp": 1756223988.959262}}}
{"text": "2025-08-26 23:59:49.920 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e97d5708-4ca2-48f1-a576-5026c3c5bdf3 | Server error: 500\n", "record": {"elapsed": {"repr": "0:34:15.964050", "seconds": 2055.96405}, "exception": null, "extra": {"request_id": "e97d5708-4ca2-48f1-a576-5026c3c5bdf3", "extra": {"structured_data": {"request_id": "e97d5708-4ca2-48f1-a576-5026c3c5bdf3", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T15:59:49.920639+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 9.17}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-26 23:59:49.920672+08:00", "timestamp": 1756223989.920672}}}
{"text": "2025-08-27 00:00:52.351 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c94dd3bf-ef21-49bc-a480-1e138c87ab76 | Server error: 500\n", "record": {"elapsed": {"repr": "0:35:18.394595", "seconds": 2118.394595}, "exception": null, "extra": {"request_id": "c94dd3bf-ef21-49bc-a480-1e138c87ab76", "extra": {"structured_data": {"request_id": "c94dd3bf-ef21-49bc-a480-1e138c87ab76", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:00:52.351182+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 10.37}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:00:52.351217+08:00", "timestamp": 1756224052.351217}}}
{"text": "2025-08-27 00:00:52.538 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 61d9c099-6868-40d6-9c78-90d26a2aec4b | Server error: 500\n", "record": {"elapsed": {"repr": "0:35:18.582329", "seconds": 2118.582329}, "exception": null, "extra": {"request_id": "61d9c099-6868-40d6-9c78-90d26a2aec4b", "extra": {"structured_data": {"request_id": "61d9c099-6868-40d6-9c78-90d26a2aec4b", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:00:52.538912+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 8.93}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:00:52.538951+08:00", "timestamp": 1756224052.538951}}}
{"text": "2025-08-27 00:02:56.934 | ERROR    | app.middleware.structured_logging:log_request_end:153 | eaf094a1-2109-4338-9bb9-df616186aa43 | Server error: 500\n", "record": {"elapsed": {"repr": "0:37:22.978012", "seconds": 2242.978012}, "exception": null, "extra": {"request_id": "eaf094a1-2109-4338-9bb9-df616186aa43", "extra": {"structured_data": {"request_id": "eaf094a1-2109-4338-9bb9-df616186aa43", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:02:56.934613+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 7.6}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:02:56.934634+08:00", "timestamp": 1756224176.934634}}}
{"text": "2025-08-27 00:02:57.242 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 35731773-7c30-49fe-9892-fbba8679965e | Server error: 500\n", "record": {"elapsed": {"repr": "0:37:23.285907", "seconds": 2243.285907}, "exception": null, "extra": {"request_id": "35731773-7c30-49fe-9892-fbba8679965e", "extra": {"structured_data": {"request_id": "35731773-7c30-49fe-9892-fbba8679965e", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:02:57.242501+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.06}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:02:57.242529+08:00", "timestamp": 1756224177.242529}}}
{"text": "2025-08-27 00:05:35.916 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3d4b991c-9247-42d5-962f-e925d30a57ba | Server error: 500\n", "record": {"elapsed": {"repr": "0:40:01.960173", "seconds": 2401.960173}, "exception": null, "extra": {"request_id": "3d4b991c-9247-42d5-962f-e925d30a57ba", "extra": {"structured_data": {"request_id": "3d4b991c-9247-42d5-962f-e925d30a57ba", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:05:35.916773+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 2.97}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:05:35.916795+08:00", "timestamp": 1756224335.916795}}}
{"text": "2025-08-27 00:05:36.092 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 47e8e9bc-2a15-4f2c-9aa7-3383ffddc49b | Server error: 500\n", "record": {"elapsed": {"repr": "0:40:02.136237", "seconds": 2402.136237}, "exception": null, "extra": {"request_id": "47e8e9bc-2a15-4f2c-9aa7-3383ffddc49b", "extra": {"structured_data": {"request_id": "47e8e9bc-2a15-4f2c-9aa7-3383ffddc49b", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:05:36.092831+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.7}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:05:36.092859+08:00", "timestamp": 1756224336.092859}}}
{"text": "2025-08-27 00:07:32.951 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 7fa4b6a4-5dbf-4353-ad52-f934bf539085 | Server error: 500\n", "record": {"elapsed": {"repr": "0:41:58.994385", "seconds": 2518.994385}, "exception": null, "extra": {"request_id": "7fa4b6a4-5dbf-4353-ad52-f934bf539085", "extra": {"structured_data": {"request_id": "7fa4b6a4-5dbf-4353-ad52-f934bf539085", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:07:32.950975+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.75}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:07:32.951007+08:00", "timestamp": 1756224452.951007}}}
{"text": "2025-08-27 00:07:33.031 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 20a9eb10-79af-4d20-8ee6-dba3219a04e1 | Server error: 500\n", "record": {"elapsed": {"repr": "0:41:59.074728", "seconds": 2519.074728}, "exception": null, "extra": {"request_id": "20a9eb10-79af-4d20-8ee6-dba3219a04e1", "extra": {"structured_data": {"request_id": "20a9eb10-79af-4d20-8ee6-dba3219a04e1", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:07:33.031324+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.6}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:07:33.031350+08:00", "timestamp": 1756224453.03135}}}
{"text": "2025-08-27 00:09:32.919 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e0b7118d-bda4-40fa-b7e8-1afc60975ae5 | Server error: 500\n", "record": {"elapsed": {"repr": "0:43:58.962477", "seconds": 2638.962477}, "exception": null, "extra": {"request_id": "e0b7118d-bda4-40fa-b7e8-1afc60975ae5", "extra": {"structured_data": {"request_id": "e0b7118d-bda4-40fa-b7e8-1afc60975ae5", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:09:32.919068+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.52}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:09:32.919099+08:00", "timestamp": 1756224572.919099}}}
{"text": "2025-08-27 00:09:33.091 | ERROR    | app.middleware.structured_logging:log_request_end:153 | baf9b4ba-5e15-46e3-b87b-8b4158628bb8 | Server error: 500\n", "record": {"elapsed": {"repr": "0:43:59.135219", "seconds": 2639.135219}, "exception": null, "extra": {"request_id": "baf9b4ba-5e15-46e3-b87b-8b4158628bb8", "extra": {"structured_data": {"request_id": "baf9b4ba-5e15-46e3-b87b-8b4158628bb8", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:09:33.091804+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.49}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:09:33.091841+08:00", "timestamp": 1756224573.091841}}}
{"text": "2025-08-27 00:09:41.911 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b914efb2-eb2a-467e-b1e8-0e60f115dd48 | Server error: 500\n", "record": {"elapsed": {"repr": "0:44:07.955373", "seconds": 2647.955373}, "exception": null, "extra": {"request_id": "b914efb2-eb2a-467e-b1e8-0e60f115dd48", "extra": {"structured_data": {"request_id": "b914efb2-eb2a-467e-b1e8-0e60f115dd48", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:09:41.911972+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.11}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:09:41.911995+08:00", "timestamp": 1756224581.911995}}}
{"text": "2025-08-27 00:09:42.087 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6e136a00-6672-4a0b-bbd9-fe9f9f479c63 | Server error: 500\n", "record": {"elapsed": {"repr": "0:44:08.130896", "seconds": 2648.130896}, "exception": null, "extra": {"request_id": "6e136a00-6672-4a0b-bbd9-fe9f9f479c63", "extra": {"structured_data": {"request_id": "6e136a00-6672-4a0b-bbd9-fe9f9f479c63", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:09:42.087480+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 7.33}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:09:42.087518+08:00", "timestamp": 1756224582.087518}}}
{"text": "2025-08-27 00:10:06.909 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0629dfec-2201-4996-94db-070641a36ea9 | Server error: 500\n", "record": {"elapsed": {"repr": "0:44:32.952444", "seconds": 2672.952444}, "exception": null, "extra": {"request_id": "0629dfec-2201-4996-94db-070641a36ea9", "extra": {"structured_data": {"request_id": "0629dfec-2201-4996-94db-070641a36ea9", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:10:06.909035+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.12}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:10:06.909066+08:00", "timestamp": 1756224606.909066}}}
{"text": "2025-08-27 00:10:07.083 | ERROR    | app.middleware.structured_logging:log_request_end:153 | dc1ea092-2839-43e7-a2e7-8f0d124cfe37 | Server error: 500\n", "record": {"elapsed": {"repr": "0:44:33.127338", "seconds": 2673.127338}, "exception": null, "extra": {"request_id": "dc1ea092-2839-43e7-a2e7-8f0d124cfe37", "extra": {"structured_data": {"request_id": "dc1ea092-2839-43e7-a2e7-8f0d124cfe37", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:10:07.083927+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 6.09}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:10:07.083960+08:00", "timestamp": 1756224607.08396}}}
{"text": "2025-08-27 00:10:30.915 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 03dae0c1-5c99-4ab0-a22d-4442d0b6a7be | Server error: 500\n", "record": {"elapsed": {"repr": "0:44:56.959294", "seconds": 2696.959294}, "exception": null, "extra": {"request_id": "03dae0c1-5c99-4ab0-a22d-4442d0b6a7be", "extra": {"structured_data": {"request_id": "03dae0c1-5c99-4ab0-a22d-4442d0b6a7be", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:10:30.915891+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.08}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:10:30.915916+08:00", "timestamp": 1756224630.915916}}}
{"text": "2025-08-27 00:10:31.086 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 17b92342-84cf-4f8c-ab3e-e8616fb0780b | Server error: 500\n", "record": {"elapsed": {"repr": "0:44:57.129715", "seconds": 2697.129715}, "exception": null, "extra": {"request_id": "17b92342-84cf-4f8c-ab3e-e8616fb0780b", "extra": {"structured_data": {"request_id": "17b92342-84cf-4f8c-ab3e-e8616fb0780b", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:10:31.086311+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.54}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:10:31.086337+08:00", "timestamp": 1756224631.086337}}}
{"text": "2025-08-27 00:10:50.908 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6e5bc652-7e67-4f8f-aef9-8b83e38301ce | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:16.951466", "seconds": 2716.951466}, "exception": null, "extra": {"request_id": "6e5bc652-7e67-4f8f-aef9-8b83e38301ce", "extra": {"structured_data": {"request_id": "6e5bc652-7e67-4f8f-aef9-8b83e38301ce", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:10:50.908058+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.06}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:10:50.908088+08:00", "timestamp": 1756224650.908088}}}
{"text": "2025-08-27 00:10:51.167 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e83711d2-b6a9-4aba-8ec8-d1a58217f329 | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:17.211236", "seconds": 2717.211236}, "exception": null, "extra": {"request_id": "e83711d2-b6a9-4aba-8ec8-d1a58217f329", "extra": {"structured_data": {"request_id": "e83711d2-b6a9-4aba-8ec8-d1a58217f329", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:10:51.167832+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.47}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:10:51.167858+08:00", "timestamp": 1756224651.167858}}}
{"text": "2025-08-27 00:10:51.884 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c18c24e0-7678-4bae-a82d-79dee5c8956e | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:17.927428", "seconds": 2717.927428}, "exception": null, "extra": {"request_id": "c18c24e0-7678-4bae-a82d-79dee5c8956e", "extra": {"structured_data": {"request_id": "c18c24e0-7678-4bae-a82d-79dee5c8956e", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:10:51.884020+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.73}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:10:51.884050+08:00", "timestamp": 1756224651.88405}}}
{"text": "2025-08-27 00:10:52.133 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a0599289-49cc-4c2e-8ad2-0fd76def315c | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:18.176440", "seconds": 2718.17644}, "exception": null, "extra": {"request_id": "a0599289-49cc-4c2e-8ad2-0fd76def315c", "extra": {"structured_data": {"request_id": "a0599289-49cc-4c2e-8ad2-0fd76def315c", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:10:52.133024+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.61}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:10:52.133062+08:00", "timestamp": 1756224652.133062}}}
{"text": "2025-08-27 00:11:03.924 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 835d69f9-f2a0-43d8-bc0e-31eced155811 | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:29.968102", "seconds": 2729.968102}, "exception": null, "extra": {"request_id": "835d69f9-f2a0-43d8-bc0e-31eced155811", "extra": {"structured_data": {"request_id": "835d69f9-f2a0-43d8-bc0e-31eced155811", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:03.924689+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 7.47}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:03.924724+08:00", "timestamp": 1756224663.924724}}}
{"text": "2025-08-27 00:11:04.092 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c8bbc985-f04b-479f-9b53-28ecb0e48e97 | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:30.136121", "seconds": 2730.136121}, "exception": null, "extra": {"request_id": "c8bbc985-f04b-479f-9b53-28ecb0e48e97", "extra": {"structured_data": {"request_id": "c8bbc985-f04b-479f-9b53-28ecb0e48e97", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:04.092711+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.08}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:04.092743+08:00", "timestamp": 1756224664.092743}}}
{"text": "2025-08-27 00:11:12.908 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e41d08f7-caf0-4684-8799-9f224f81086d | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:38.951867", "seconds": 2738.951867}, "exception": null, "extra": {"request_id": "e41d08f7-caf0-4684-8799-9f224f81086d", "extra": {"structured_data": {"request_id": "e41d08f7-caf0-4684-8799-9f224f81086d", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:12.908467+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.12}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:12.908489+08:00", "timestamp": 1756224672.908489}}}
{"text": "2025-08-27 00:11:13.083 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 48b1c445-e1da-4524-9edb-26473c6ef906 | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:39.126715", "seconds": 2739.126715}, "exception": null, "extra": {"request_id": "48b1c445-e1da-4524-9edb-26473c6ef906", "extra": {"structured_data": {"request_id": "48b1c445-e1da-4524-9edb-26473c6ef906", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:13.083306+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.42}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:13.083337+08:00", "timestamp": 1756224673.083337}}}
{"text": "2025-08-27 00:11:21.923 | ERROR    | app.middleware.structured_logging:log_request_end:153 | aa39166e-6c82-4b53-98a9-bc4a3b3ba6ee | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:47.967269", "seconds": 2747.967269}, "exception": null, "extra": {"request_id": "aa39166e-6c82-4b53-98a9-bc4a3b3ba6ee", "extra": {"structured_data": {"request_id": "aa39166e-6c82-4b53-98a9-bc4a3b3ba6ee", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:21.923866+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.49}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:21.923891+08:00", "timestamp": 1756224681.923891}}}
{"text": "2025-08-27 00:11:22.005 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6ba3e227-117c-4933-a0b9-c391a8b5149d | Server error: 500\n", "record": {"elapsed": {"repr": "0:45:48.048519", "seconds": 2748.048519}, "exception": null, "extra": {"request_id": "6ba3e227-117c-4933-a0b9-c391a8b5149d", "extra": {"structured_data": {"request_id": "6ba3e227-117c-4933-a0b9-c391a8b5149d", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:22.005110+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.8}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:22.005141+08:00", "timestamp": 1756224682.005141}}}
{"text": "2025-08-27 00:11:44.931 | ERROR    | app.middleware.structured_logging:log_request_end:153 | aef06aca-9da4-4ed8-a1cc-dd6a0885d559 | Server error: 500\n", "record": {"elapsed": {"repr": "0:46:10.974803", "seconds": 2770.974803}, "exception": null, "extra": {"request_id": "aef06aca-9da4-4ed8-a1cc-dd6a0885d559", "extra": {"structured_data": {"request_id": "aef06aca-9da4-4ed8-a1cc-dd6a0885d559", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:44.931394+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 6.88}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:44.931425+08:00", "timestamp": 1756224704.931425}}}
{"text": "2025-08-27 00:11:45.019 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 603e11d6-f803-4eab-a40e-edd934605ec5 | Server error: 500\n", "record": {"elapsed": {"repr": "0:46:11.063279", "seconds": 2771.063279}, "exception": null, "extra": {"request_id": "603e11d6-f803-4eab-a40e-edd934605ec5", "extra": {"structured_data": {"request_id": "603e11d6-f803-4eab-a40e-edd934605ec5", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:45.019862+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 10.6}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:45.019901+08:00", "timestamp": 1756224705.019901}}}
{"text": "2025-08-27 00:11:57.921 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 1b5eb318-4c74-4376-b36d-62345a284635 | Server error: 500\n", "record": {"elapsed": {"repr": "0:46:23.964914", "seconds": 2783.964914}, "exception": null, "extra": {"request_id": "1b5eb318-4c74-4376-b36d-62345a284635", "extra": {"structured_data": {"request_id": "1b5eb318-4c74-4376-b36d-62345a284635", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:57.921504+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.28}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:57.921536+08:00", "timestamp": 1756224717.921536}}}
{"text": "2025-08-27 00:11:58.001 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f24cbbda-7a99-4f5e-baac-087dc99ea5bb | Server error: 500\n", "record": {"elapsed": {"repr": "0:46:24.045306", "seconds": 2784.045306}, "exception": null, "extra": {"request_id": "f24cbbda-7a99-4f5e-baac-087dc99ea5bb", "extra": {"structured_data": {"request_id": "f24cbbda-7a99-4f5e-baac-087dc99ea5bb", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:11:58.001903+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.48}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:11:58.001928+08:00", "timestamp": 1756224718.001928}}}
{"text": "2025-08-27 00:12:10.922 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f0dd5602-2c9c-438e-ac54-857ce795fffc | Server error: 500\n", "record": {"elapsed": {"repr": "0:46:36.965661", "seconds": 2796.965661}, "exception": null, "extra": {"request_id": "f0dd5602-2c9c-438e-ac54-857ce795fffc", "extra": {"structured_data": {"request_id": "f0dd5602-2c9c-438e-ac54-857ce795fffc", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:12:10.922252+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.07}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:12:10.922283+08:00", "timestamp": 1756224730.922283}}}
{"text": "2025-08-27 00:12:11.002 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 2a6ee60c-1dd0-4608-9126-7a0787dfdb95 | Server error: 500\n", "record": {"elapsed": {"repr": "0:46:37.046263", "seconds": 2797.046263}, "exception": null, "extra": {"request_id": "2a6ee60c-1dd0-4608-9126-7a0787dfdb95", "extra": {"structured_data": {"request_id": "2a6ee60c-1dd0-4608-9126-7a0787dfdb95", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:12:11.002852+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.05}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:12:11.002885+08:00", "timestamp": 1756224731.002885}}}
{"text": "2025-08-27 00:13:56.929 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3a2dcffd-6fb3-4aed-a422-810eba6abb57 | Server error: 500\n", "record": {"elapsed": {"repr": "0:48:22.972816", "seconds": 2902.972816}, "exception": null, "extra": {"request_id": "3a2dcffd-6fb3-4aed-a422-810eba6abb57", "extra": {"structured_data": {"request_id": "3a2dcffd-6fb3-4aed-a422-810eba6abb57", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:13:56.929406+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 8.69}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:13:56.929438+08:00", "timestamp": 1756224836.929438}}}
{"text": "2025-08-27 00:13:57.012 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 9de7587b-c6be-4719-b6c8-75319da358cd | Server error: 500\n", "record": {"elapsed": {"repr": "0:48:23.056027", "seconds": 2903.056027}, "exception": null, "extra": {"request_id": "9de7587b-c6be-4719-b6c8-75319da358cd", "extra": {"structured_data": {"request_id": "9de7587b-c6be-4719-b6c8-75319da358cd", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:13:57.012619+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.47}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:13:57.012649+08:00", "timestamp": 1756224837.012649}}}
{"text": "2025-08-27 00:14:23.916 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d72987e5-3d0a-482e-9ad6-5de1332e2fb3 | Server error: 500\n", "record": {"elapsed": {"repr": "0:48:49.960133", "seconds": 2929.960133}, "exception": null, "extra": {"request_id": "d72987e5-3d0a-482e-9ad6-5de1332e2fb3", "extra": {"structured_data": {"request_id": "d72987e5-3d0a-482e-9ad6-5de1332e2fb3", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:14:23.916724+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 7.75}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:14:23.916755+08:00", "timestamp": 1756224863.916755}}}
{"text": "2025-08-27 00:14:24.089 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6316a769-bfaa-47d8-8ae0-2fe3ba4257de | Server error: 500\n", "record": {"elapsed": {"repr": "0:48:50.133228", "seconds": 2930.133228}, "exception": null, "extra": {"request_id": "6316a769-bfaa-47d8-8ae0-2fe3ba4257de", "extra": {"structured_data": {"request_id": "6316a769-bfaa-47d8-8ae0-2fe3ba4257de", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:14:24.089819+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 10.35}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:14:24.089850+08:00", "timestamp": 1756224864.08985}}}
{"text": "2025-08-27 00:14:40.077 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6001e8fc-c942-47fc-9487-6d8b1c0b7a7a | Server error: 500\n", "record": {"elapsed": {"repr": "0:49:06.120432", "seconds": 2946.120432}, "exception": null, "extra": {"request_id": "6001e8fc-c942-47fc-9487-6d8b1c0b7a7a", "extra": {"structured_data": {"request_id": "6001e8fc-c942-47fc-9487-6d8b1c0b7a7a", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:14:40.077024+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 7.78}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:14:40.077054+08:00", "timestamp": 1756224880.077054}}}
{"text": "2025-08-27 00:14:40.265 | ERROR    | app.middleware.structured_logging:log_request_end:153 | ab94622b-5949-4d71-8406-adb493ac07bf | Server error: 500\n", "record": {"elapsed": {"repr": "0:49:06.309033", "seconds": 2946.309033}, "exception": null, "extra": {"request_id": "ab94622b-5949-4d71-8406-adb493ac07bf", "extra": {"structured_data": {"request_id": "ab94622b-5949-4d71-8406-adb493ac07bf", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:14:40.265621+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 16.21}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:14:40.265655+08:00", "timestamp": 1756224880.265655}}}
{"text": "2025-08-27 00:14:50.936 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 68bccaae-08fc-4d37-848b-70e082eca6a0 | Server error: 500\n", "record": {"elapsed": {"repr": "0:49:16.979794", "seconds": 2956.979794}, "exception": null, "extra": {"request_id": "68bccaae-08fc-4d37-848b-70e082eca6a0", "extra": {"structured_data": {"request_id": "68bccaae-08fc-4d37-848b-70e082eca6a0", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:14:50.936392+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.93}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:14:50.936416+08:00", "timestamp": 1756224890.936416}}}
{"text": "2025-08-27 00:14:51.614 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b4def66a-e2a2-4daa-a916-ec4d9225ad8a | Server error: 500\n", "record": {"elapsed": {"repr": "0:49:17.658048", "seconds": 2957.658048}, "exception": null, "extra": {"request_id": "b4def66a-e2a2-4daa-a916-ec4d9225ad8a", "extra": {"structured_data": {"request_id": "b4def66a-e2a2-4daa-a916-ec4d9225ad8a", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:14:51.614636+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 9.84}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:14:51.614670+08:00", "timestamp": 1756224891.61467}}}
{"text": "2025-08-27 00:15:22.911 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c5c6f2ef-8264-4376-b448-243741149476 | Server error: 500\n", "record": {"elapsed": {"repr": "0:49:48.955323", "seconds": 2988.955323}, "exception": null, "extra": {"request_id": "c5c6f2ef-8264-4376-b448-243741149476", "extra": {"structured_data": {"request_id": "c5c6f2ef-8264-4376-b448-243741149476", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:15:22.911919+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 9.08}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:15:22.911945+08:00", "timestamp": 1756224922.911945}}}
{"text": "2025-08-27 00:15:23.079 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0697c00e-9546-45ea-80e7-c18473849a65 | Server error: 500\n", "record": {"elapsed": {"repr": "0:49:49.122802", "seconds": 2989.122802}, "exception": null, "extra": {"request_id": "0697c00e-9546-45ea-80e7-c18473849a65", "extra": {"structured_data": {"request_id": "0697c00e-9546-45ea-80e7-c18473849a65", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:15:23.079398+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.19}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:15:23.079424+08:00", "timestamp": 1756224923.079424}}}
{"text": "2025-08-27 00:15:36.934 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b2f1f5f7-0717-4abf-94c1-25f3b68535b7 | Server error: 500\n", "record": {"elapsed": {"repr": "0:50:02.978244", "seconds": 3002.978244}, "exception": null, "extra": {"request_id": "b2f1f5f7-0717-4abf-94c1-25f3b68535b7", "extra": {"structured_data": {"request_id": "b2f1f5f7-0717-4abf-94c1-25f3b68535b7", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:15:36.934841+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 6.54}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:15:36.934866+08:00", "timestamp": 1756224936.934866}}}
{"text": "2025-08-27 00:15:37.104 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8dfedd04-2f22-4fa5-8166-5c354d9ea183 | Server error: 500\n", "record": {"elapsed": {"repr": "0:50:03.147910", "seconds": 3003.14791}, "exception": null, "extra": {"request_id": "8dfedd04-2f22-4fa5-8166-5c354d9ea183", "extra": {"structured_data": {"request_id": "8dfedd04-2f22-4fa5-8166-5c354d9ea183", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:15:37.104500+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.24}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:15:37.104532+08:00", "timestamp": 1756224937.104532}}}
{"text": "2025-08-27 00:16:24.928 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 11a193b7-0ab4-4434-9ba8-fa70384205e2 | Server error: 500\n", "record": {"elapsed": {"repr": "0:50:50.972360", "seconds": 3050.97236}, "exception": null, "extra": {"request_id": "11a193b7-0ab4-4434-9ba8-fa70384205e2", "extra": {"structured_data": {"request_id": "11a193b7-0ab4-4434-9ba8-fa70384205e2", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:16:24.928947+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 18.1}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:16:24.928982+08:00", "timestamp": 1756224984.928982}}}
{"text": "2025-08-27 00:16:25.126 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 67ba0f51-1337-492d-9b75-41302be5e976 | Server error: 500\n", "record": {"elapsed": {"repr": "0:50:51.169718", "seconds": 3051.169718}, "exception": null, "extra": {"request_id": "67ba0f51-1337-492d-9b75-41302be5e976", "extra": {"structured_data": {"request_id": "67ba0f51-1337-492d-9b75-41302be5e976", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:16:25.126300+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 17.25}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:16:25.126340+08:00", "timestamp": 1756224985.12634}}}
{"text": "2025-08-27 00:17:59.902 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8b933d35-6998-4ee9-8039-3a6b601d3179 | Server error: 500\n", "record": {"elapsed": {"repr": "0:52:25.946259", "seconds": 3145.946259}, "exception": null, "extra": {"request_id": "8b933d35-6998-4ee9-8039-3a6b601d3179", "extra": {"structured_data": {"request_id": "8b933d35-6998-4ee9-8039-3a6b601d3179", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:17:59.902851+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.1}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:17:59.902881+08:00", "timestamp": 1756225079.902881}}}
{"text": "2025-08-27 00:18:00.082 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 25e8a97a-575b-4462-892f-931a8eebddf7 | Server error: 500\n", "record": {"elapsed": {"repr": "0:52:26.126067", "seconds": 3146.126067}, "exception": null, "extra": {"request_id": "25e8a97a-575b-4462-892f-931a8eebddf7", "extra": {"structured_data": {"request_id": "25e8a97a-575b-4462-892f-931a8eebddf7", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:18:00.082665+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.41}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:18:00.082689+08:00", "timestamp": 1756225080.082689}}}
{"text": "2025-08-27 00:18:23.911 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 30b44748-01bb-4c14-a7d7-85c88458caf7 | Server error: 500\n", "record": {"elapsed": {"repr": "0:52:49.955192", "seconds": 3169.955192}, "exception": null, "extra": {"request_id": "30b44748-01bb-4c14-a7d7-85c88458caf7", "extra": {"structured_data": {"request_id": "30b44748-01bb-4c14-a7d7-85c88458caf7", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:18:23.911789+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 3.38}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:18:23.911814+08:00", "timestamp": 1756225103.911814}}}
{"text": "2025-08-27 00:18:23.996 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 589c4d23-1de6-498e-8a7e-7e60394ff28a | Server error: 500\n", "record": {"elapsed": {"repr": "0:52:50.040286", "seconds": 3170.040286}, "exception": null, "extra": {"request_id": "589c4d23-1de6-498e-8a7e-7e60394ff28a", "extra": {"structured_data": {"request_id": "589c4d23-1de6-498e-8a7e-7e60394ff28a", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:18:23.996879+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 4.63}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:18:23.996908+08:00", "timestamp": 1756225103.996908}}}
{"text": "2025-08-27 00:18:35.906 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 4cd44f67-2bc4-4b94-b02f-561f65f1869d | Server error: 500\n", "record": {"elapsed": {"repr": "0:53:01.950228", "seconds": 3181.950228}, "exception": null, "extra": {"request_id": "4cd44f67-2bc4-4b94-b02f-561f65f1869d", "extra": {"structured_data": {"request_id": "4cd44f67-2bc4-4b94-b02f-561f65f1869d", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:18:35.906817+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 8.57}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:18:35.906850+08:00", "timestamp": 1756225115.90685}}}
{"text": "2025-08-27 00:18:35.998 | ERROR    | app.middleware.structured_logging:log_request_end:153 | ca1bb1d5-a59a-4512-9a41-0e5b053e2b7f | Server error: 500\n", "record": {"elapsed": {"repr": "0:53:02.041464", "seconds": 3182.041464}, "exception": null, "extra": {"request_id": "ca1bb1d5-a59a-4512-9a41-0e5b053e2b7f", "extra": {"structured_data": {"request_id": "ca1bb1d5-a59a-4512-9a41-0e5b053e2b7f", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:18:35.998052+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 9.77}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:18:35.998086+08:00", "timestamp": 1756225115.998086}}}
{"text": "2025-08-27 00:18:54.679 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6475c439-92e0-469a-9a76-8ff10a0926a1 | Server error: 500\n", "record": {"elapsed": {"repr": "0:53:20.722549", "seconds": 3200.722549}, "exception": null, "extra": {"request_id": "6475c439-92e0-469a-9a76-8ff10a0926a1", "extra": {"structured_data": {"request_id": "6475c439-92e0-469a-9a76-8ff10a0926a1", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:18:54.679151+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.26}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:18:54.679171+08:00", "timestamp": 1756225134.679171}}}
{"text": "2025-08-27 00:18:54.762 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b35c48b5-b428-41f8-bf1e-7c3bfc1f344e | Server error: 500\n", "record": {"elapsed": {"repr": "0:53:20.805658", "seconds": 3200.805658}, "exception": null, "extra": {"request_id": "b35c48b5-b428-41f8-bf1e-7c3bfc1f344e", "extra": {"structured_data": {"request_id": "b35c48b5-b428-41f8-bf1e-7c3bfc1f344e", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.72", "x-forwarded-for": "114.105.192.72", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.72", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-26T16:18:54.762254+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 5.89}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3333799, "name": "SpawnProcess-1"}, "thread": {"id": 131470029934720, "name": "MainThread"}, "time": {"repr": "2025-08-27 00:18:54.762280+08:00", "timestamp": 1756225134.76228}}}
{"text": "2025-08-27 12:49:44.554 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 5c4c1928-b384-48b7-837d-a381cb22eb27 | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:06.449012", "seconds": 186.449012}, "exception": null, "extra": {"request_id": "5c4c1928-b384-48b7-837d-a381cb22eb27", "extra": {"structured_data": {"request_id": "5c4c1928-b384-48b7-837d-a381cb22eb27", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T04:49:44.554058+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 8.18}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3591395, "name": "SpawnProcess-1"}, "thread": {"id": 137779268788352, "name": "MainThread"}, "time": {"repr": "2025-08-27 12:49:44.554082+08:00", "timestamp": 1756270184.554082}}}
{"text": "2025-08-27 12:49:44.829 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e8b3c16b-e9db-4e75-ab5d-9a3e959e76ae | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:06.724198", "seconds": 186.724198}, "exception": null, "extra": {"request_id": "e8b3c16b-e9db-4e75-ab5d-9a3e959e76ae", "extra": {"structured_data": {"request_id": "e8b3c16b-e9db-4e75-ab5d-9a3e959e76ae", "method": "GET", "url": "http://43.167.252.120/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "query_params": {"days": "1"}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T04:49:44.829241+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1070", "content-type": "application/json"}, "duration_ms": 8.08}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3591395, "name": "SpawnProcess-1"}, "thread": {"id": 137779268788352, "name": "MainThread"}, "time": {"repr": "2025-08-27 12:49:44.829268+08:00", "timestamp": 1756270184.829268}}}
{"text": "2025-08-27 12:54:27.408 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 327e9ca0-a9c0-47c9-964f-5ac6560f1170 | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:49.303048", "seconds": 469.303048}, "exception": null, "extra": {"request_id": "327e9ca0-a9c0-47c9-964f-5ac6560f1170", "extra": {"structured_data": {"request_id": "327e9ca0-a9c0-47c9-964f-5ac6560f1170", "method": "GET", "url": "http://localhost:8001/api/v1/ai/usage/stats", "path": "/api/v1/ai/usage/stats", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T04:54:27.408080+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "260", "content-type": "application/json"}, "duration_ms": 23.16}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3591395, "name": "SpawnProcess-1"}, "thread": {"id": 137779268788352, "name": "MainThread"}, "time": {"repr": "2025-08-27 12:54:27.408118+08:00", "timestamp": 1756270467.408118}}}
{"text": "2025-08-27 17:56:36.197 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 97a43bfd-a545-469b-af46-bcf6049f85e2 | Server error: 500\n", "record": {"elapsed": {"repr": "0:08:54.202675", "seconds": 534.202675}, "exception": null, "extra": {"request_id": "97a43bfd-a545-469b-af46-bcf6049f85e2", "extra": {"structured_data": {"request_id": "97a43bfd-a545-469b-af46-bcf6049f85e2", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "114"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T09:56:36.197277+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 62.39}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3692882, "name": "SpawnProcess-7"}, "thread": {"id": 128975507271808, "name": "MainThread"}, "time": {"repr": "2025-08-27 17:56:36.197315+08:00", "timestamp": 1756288596.197315}}}
{"text": "2025-08-27 17:59:19.519 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8d61b45d-5fd0-4472-b1bb-f545691b85de | Server error: 500\n", "record": {"elapsed": {"repr": "0:11:37.525108", "seconds": 697.525108}, "exception": null, "extra": {"request_id": "8d61b45d-5fd0-4472-b1bb-f545691b85de", "extra": {"structured_data": {"request_id": "8d61b45d-5fd0-4472-b1bb-f545691b85de", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "90"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T09:59:19.519724+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 7.88}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3692882, "name": "SpawnProcess-7"}, "thread": {"id": 128975507271808, "name": "MainThread"}, "time": {"repr": "2025-08-27 17:59:19.519748+08:00", "timestamp": 1756288759.519748}}}
{"text": "2025-08-27 18:00:48.091 | ERROR    | app.middleware.structured_logging:log_request_end:153 | bb7a079c-e2b1-4cbe-a8fa-d85f68c45d52 | Server error: 500\n", "record": {"elapsed": {"repr": "0:13:06.096735", "seconds": 786.096735}, "exception": null, "extra": {"request_id": "bb7a079c-e2b1-4cbe-a8fa-d85f68c45d52", "extra": {"structured_data": {"request_id": "bb7a079c-e2b1-4cbe-a8fa-d85f68c45d52", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "90"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:00:48.091339+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 11.94}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3692882, "name": "SpawnProcess-7"}, "thread": {"id": 128975507271808, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:00:48.091375+08:00", "timestamp": 1756288848.091375}}}
{"text": "2025-08-27 18:02:34.895 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8fed7acc-de3f-46cd-aa2d-192844cd1678 | Server error: 500\n", "record": {"elapsed": {"repr": "0:14:52.901200", "seconds": 892.9012}, "exception": null, "extra": {"request_id": "8fed7acc-de3f-46cd-aa2d-192844cd1678", "extra": {"structured_data": {"request_id": "8fed7acc-de3f-46cd-aa2d-192844cd1678", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "90"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:02:34.895805+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "91", "content-type": "application/json"}, "duration_ms": 18.4}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3692882, "name": "SpawnProcess-7"}, "thread": {"id": 128975507271808, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:02:34.895840+08:00", "timestamp": 1756288954.89584}}}
{"text": "2025-08-27 18:03:35.938 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 16a52d78-05de-486e-8d6a-670e33ca72db | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:16.774330", "seconds": 16.77433}, "exception": null, "extra": {"request_id": "16a52d78-05de-486e-8d6a-670e33ca72db", "extra": {"structured_data": {"request_id": "16a52d78-05de-486e-8d6a-670e33ca72db", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "90"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:03:35.938049+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "91", "content-type": "application/json"}, "duration_ms": 79.39}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3698910, "name": "SpawnProcess-9"}, "thread": {"id": 123156978217088, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:03:35.938091+08:00", "timestamp": 1756289015.938091}}}
{"text": "2025-08-27 18:04:28.944 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 16696977-09a0-452d-8ea0-90ea99b4022c | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:17.747026", "seconds": 17.747026}, "exception": null, "extra": {"request_id": "16696977-09a0-452d-8ea0-90ea99b4022c", "extra": {"structured_data": {"request_id": "16696977-09a0-452d-8ea0-90ea99b4022c", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "90"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:04:28.944878+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "91", "content-type": "application/json"}, "duration_ms": 99.06}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3699237, "name": "SpawnProcess-11"}, "thread": {"id": 126275971616896, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:04:28.944915+08:00", "timestamp": 1756289068.944915}}}
{"text": "2025-08-27 18:05:40.628 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3c780d51-396a-4aeb-8002-f8e6871228b0 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:18.017389", "seconds": 18.017389}, "exception": null, "extra": {"request_id": "3c780d51-396a-4aeb-8002-f8e6871228b0", "extra": {"structured_data": {"request_id": "3c780d51-396a-4aeb-8002-f8e6871228b0", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "90"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:05:40.628067+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "91", "content-type": "application/json"}, "duration_ms": 123.05}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3699728, "name": "SpawnProcess-15"}, "thread": {"id": 131673496031360, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:05:40.628105+08:00", "timestamp": 1756289140.628105}}}
{"text": "2025-08-27 18:07:31.254 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 1b9f2c1e-51f0-445f-b922-204aa43f67bd | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:15.822622", "seconds": 15.822622}, "exception": null, "extra": {"request_id": "1b9f2c1e-51f0-445f-b922-204aa43f67bd", "extra": {"structured_data": {"request_id": "1b9f2c1e-51f0-445f-b922-204aa43f67bd", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "90"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:07:31.254658+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "495", "content-type": "application/json"}, "duration_ms": 101.7}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3700507, "name": "SpawnProcess-19"}, "thread": {"id": 132808967192704, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:07:31.254695+08:00", "timestamp": 1756289251.254695}}}
{"text": "2025-08-27 18:08:46.901 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3f0104db-db7f-400e-a23d-e2ea71bdda1f | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:31.469845", "seconds": 91.469845}, "exception": null, "extra": {"request_id": "3f0104db-db7f-400e-a23d-e2ea71bdda1f", "extra": {"structured_data": {"request_id": "3f0104db-db7f-400e-a23d-e2ea71bdda1f", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "171", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:08:46.901893+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 9.18}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3700507, "name": "SpawnProcess-19"}, "thread": {"id": 132808967192704, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:08:46.901918+08:00", "timestamp": 1756289326.901918}}}
{"text": "2025-08-27 18:08:48.824 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 95230532-e4ed-4f47-ad16-5f272e6f7968 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:33.391943", "seconds": 93.391943}, "exception": null, "extra": {"request_id": "95230532-e4ed-4f47-ad16-5f272e6f7968", "extra": {"structured_data": {"request_id": "95230532-e4ed-4f47-ad16-5f272e6f7968", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "171", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:08:48.823980+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 275.84}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3700507, "name": "SpawnProcess-19"}, "thread": {"id": 132808967192704, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:08:48.824016+08:00", "timestamp": 1756289328.824016}}}
{"text": "2025-08-27 18:09:58.457 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e1c2096b-f3d3-49f6-aab0-48a692e77083 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:55.238877", "seconds": 55.238877}, "exception": null, "extra": {"request_id": "e1c2096b-f3d3-49f6-aab0-48a692e77083", "extra": {"structured_data": {"request_id": "e1c2096b-f3d3-49f6-aab0-48a692e77083", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "315", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/trading"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:09:58.457590+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 27.82}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3701124, "name": "SpawnProcess-20"}, "thread": {"id": 128138143731840, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:09:58.457621+08:00", "timestamp": 1756289398.457621}}}
{"text": "2025-08-27 18:10:01.929 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d1679f57-ce0f-408c-a17c-5b9f30086849 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:58.711184", "seconds": 58.711184}, "exception": null, "extra": {"request_id": "d1679f57-ce0f-408c-a17c-5b9f30086849", "extra": {"structured_data": {"request_id": "d1679f57-ce0f-408c-a17c-5b9f30086849", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "315", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/trading"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:10:01.929892+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 201.31}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3701124, "name": "SpawnProcess-20"}, "thread": {"id": 128138143731840, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:10:01.929928+08:00", "timestamp": 1756289401.929928}}}
{"text": "2025-08-27 18:12:15.576 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8921d4cf-44d5-4309-828b-4edec8c8bd4d | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:12.358079", "seconds": 192.358079}, "exception": null, "extra": {"request_id": "8921d4cf-44d5-4309-828b-4edec8c8bd4d", "extra": {"structured_data": {"request_id": "8921d4cf-44d5-4309-828b-4edec8c8bd4d", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "513", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:12:15.576791+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 9.26}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3701124, "name": "SpawnProcess-20"}, "thread": {"id": 128138143731840, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:12:15.576823+08:00", "timestamp": 1756289535.576823}}}
{"text": "2025-08-27 18:12:17.239 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 4d8fa30f-2bb6-493e-bc93-c52123355a69 | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:14.020976", "seconds": 194.020976}, "exception": null, "extra": {"request_id": "4d8fa30f-2bb6-493e-bc93-c52123355a69", "extra": {"structured_data": {"request_id": "4d8fa30f-2bb6-493e-bc93-c52123355a69", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "513", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:12:17.239683+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 17.1}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3701124, "name": "SpawnProcess-20"}, "thread": {"id": 128138143731840, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:12:17.239720+08:00", "timestamp": 1756289537.23972}}}
{"text": "2025-08-27 18:16:47.060 | ERROR    | app.middleware.structured_logging:log_request_end:153 | ba726c1a-3389-43ac-bd83-8aae1aa43e55 | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:19.372114", "seconds": 139.372114}, "exception": null, "extra": {"request_id": "ba726c1a-3389-43ac-bd83-8aae1aa43e55", "extra": {"structured_data": {"request_id": "ba726c1a-3389-43ac-bd83-8aae1aa43e55", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "129", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:16:47.060476+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 20.48}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3703791, "name": "SpawnProcess-3"}, "thread": {"id": 137303695634560, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:16:47.060524+08:00", "timestamp": 1756289807.060524}}}
{"text": "2025-08-27 18:16:48.711 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3ea12f43-69b9-4315-850e-ec53267a67a7 | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:21.023484", "seconds": 141.023484}, "exception": null, "extra": {"request_id": "3ea12f43-69b9-4315-850e-ec53267a67a7", "extra": {"structured_data": {"request_id": "3ea12f43-69b9-4315-850e-ec53267a67a7", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "129", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:16:48.711864+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 13.11}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3703791, "name": "SpawnProcess-3"}, "thread": {"id": 137303695634560, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:16:48.711894+08:00", "timestamp": 1756289808.711894}}}
{"text": "2025-08-27 18:17:02.205 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 86f4655a-728b-4d4f-8f43-d906f3d6e019 | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:34.517385", "seconds": 154.517385}, "exception": null, "extra": {"request_id": "86f4655a-728b-4d4f-8f43-d906f3d6e019", "extra": {"structured_data": {"request_id": "86f4655a-728b-4d4f-8f43-d906f3d6e019", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "88"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:17:02.205760+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 10.96}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3703791, "name": "SpawnProcess-3"}, "thread": {"id": 137303695634560, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:17:02.205795+08:00", "timestamp": 1756289822.205795}}}
{"text": "2025-08-27 18:17:38.021 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 25676e40-cfe1-4546-b8db-399d3a700ce2 | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:10.332672", "seconds": 190.332672}, "exception": null, "extra": {"request_id": "25676e40-cfe1-4546-b8db-399d3a700ce2", "extra": {"structured_data": {"request_id": "25676e40-cfe1-4546-b8db-399d3a700ce2", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "45"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:17:38.021042+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 362.32}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3703791, "name": "SpawnProcess-3"}, "thread": {"id": 137303695634560, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:17:38.021082+08:00", "timestamp": 1756289858.021082}}}
{"text": "2025-08-27 18:17:45.315 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d8345f89-2597-414c-a41d-950a95527792 | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:17.627031", "seconds": 197.627031}, "exception": null, "extra": {"request_id": "d8345f89-2597-414c-a41d-950a95527792", "extra": {"structured_data": {"request_id": "d8345f89-2597-414c-a41d-950a95527792", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "45"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:17:45.315412+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 8.11}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3703791, "name": "SpawnProcess-3"}, "thread": {"id": 137303695634560, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:17:45.315441+08:00", "timestamp": 1756289865.315441}}}
{"text": "2025-08-27 18:19:53.509 | ERROR    | app.middleware.structured_logging:log_request_end:153 | eebc8703-871b-422e-93ef-5e2b4cca301f | Server error: 500\n", "record": {"elapsed": {"repr": "0:05:25.820991", "seconds": 325.820991}, "exception": null, "extra": {"request_id": "eebc8703-871b-422e-93ef-5e2b4cca301f", "extra": {"structured_data": {"request_id": "eebc8703-871b-422e-93ef-5e2b4cca301f", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "164", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:19:53.509376+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 7.45}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3703791, "name": "SpawnProcess-3"}, "thread": {"id": 137303695634560, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:19:53.509401+08:00", "timestamp": 1756289993.509401}}}
{"text": "2025-08-27 18:19:55.166 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d0a02028-078c-4245-8edc-aa27683c32a5 | Server error: 500\n", "record": {"elapsed": {"repr": "0:05:27.477784", "seconds": 327.477784}, "exception": null, "extra": {"request_id": "d0a02028-078c-4245-8edc-aa27683c32a5", "extra": {"structured_data": {"request_id": "d0a02028-078c-4245-8edc-aa27683c32a5", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "164", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:19:55.166161+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 11.89}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3703791, "name": "SpawnProcess-3"}, "thread": {"id": 137303695634560, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:19:55.166194+08:00", "timestamp": 1756289995.166194}}}
{"text": "2025-08-27 18:27:03.870 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c53c1086-9fc1-4118-9183-02e46e807b72 | Server error: 500\n", "record": {"elapsed": {"repr": "0:12:36.182080", "seconds": 756.18208}, "exception": null, "extra": {"request_id": "c53c1086-9fc1-4118-9183-02e46e807b72", "extra": {"structured_data": {"request_id": "c53c1086-9fc1-4118-9183-02e46e807b72", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "78"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:27:03.870461+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 9.07}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3703791, "name": "SpawnProcess-3"}, "thread": {"id": 137303695634560, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:27:03.870490+08:00", "timestamp": 1756290423.87049}}}
{"text": "2025-08-27 18:30:11.136 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 83baf168-750e-4b4d-b70d-7f3efc6bef1d | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:02.320168", "seconds": 2.320168}, "exception": null, "extra": {"request_id": "83baf168-750e-4b4d-b70d-7f3efc6bef1d", "extra": {"structured_data": {"request_id": "83baf168-750e-4b4d-b70d-7f3efc6bef1d", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "513", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:30:11.136620+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 75.67}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709489, "name": "SpawnProcess-5"}, "thread": {"id": 124232193110144, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:30:11.136653+08:00", "timestamp": 1756290611.136653}}}
{"text": "2025-08-27 18:30:12.754 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0e401e6b-f8cf-4b38-8be4-af1d4b1b71ca | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:03.938218", "seconds": 3.938218}, "exception": null, "extra": {"request_id": "0e401e6b-f8cf-4b38-8be4-af1d4b1b71ca", "extra": {"structured_data": {"request_id": "0e401e6b-f8cf-4b38-8be4-af1d4b1b71ca", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "513", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:30:12.754664+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 10.69}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709489, "name": "SpawnProcess-5"}, "thread": {"id": 124232193110144, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:30:12.754703+08:00", "timestamp": 1756290612.754703}}}
{"text": "2025-08-27 18:31:02.736 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 66389194-232e-467d-bf6f-fab144a40b80 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:45.244677", "seconds": 45.244677}, "exception": null, "extra": {"request_id": "66389194-232e-467d-bf6f-fab144a40b80", "extra": {"structured_data": {"request_id": "66389194-232e-467d-bf6f-fab144a40b80", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "138", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:31:02.736234+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 18.82}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709554, "name": "SpawnProcess-6"}, "thread": {"id": 133186693357696, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:31:02.736268+08:00", "timestamp": 1756290662.736268}}}
{"text": "2025-08-27 18:31:04.326 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 2d88c903-a128-467d-92bf-ddd2cab467cb | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:46.834886", "seconds": 46.834886}, "exception": null, "extra": {"request_id": "2d88c903-a128-467d-92bf-ddd2cab467cb", "extra": {"structured_data": {"request_id": "2d88c903-a128-467d-92bf-ddd2cab467cb", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "138", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:31:04.326443+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 9.57}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709554, "name": "SpawnProcess-6"}, "thread": {"id": 133186693357696, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:31:04.326477+08:00", "timestamp": 1756290664.326477}}}
{"text": "2025-08-27 18:32:40.162 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 95d2e3d9-4073-42d1-8dab-33a0670a6c2b | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:22.670786", "seconds": 142.670786}, "exception": null, "extra": {"request_id": "95d2e3d9-4073-42d1-8dab-33a0670a6c2b", "extra": {"structured_data": {"request_id": "95d2e3d9-4073-42d1-8dab-33a0670a6c2b", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "315", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/trading"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:32:40.162346+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 8.83}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709554, "name": "SpawnProcess-6"}, "thread": {"id": 133186693357696, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:32:40.162377+08:00", "timestamp": 1756290760.162377}}}
{"text": "2025-08-27 18:33:01.809 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d803d26a-4b82-429f-9eee-1bc27b133743 | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:44.317763", "seconds": 164.317763}, "exception": null, "extra": {"request_id": "d803d26a-4b82-429f-9eee-1bc27b133743", "extra": {"structured_data": {"request_id": "d803d26a-4b82-429f-9eee-1bc27b133743", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "321", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/trading"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:33:01.809324+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 9.4}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709554, "name": "SpawnProcess-6"}, "thread": {"id": 133186693357696, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:33:01.809354+08:00", "timestamp": 1756290781.809354}}}
{"text": "2025-08-27 18:33:47.098 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a430770d-84cc-41a1-8ed7-255059dd6b1a | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:29.606972", "seconds": 209.606972}, "exception": null, "extra": {"request_id": "a430770d-84cc-41a1-8ed7-255059dd6b1a", "extra": {"structured_data": {"request_id": "a430770d-84cc-41a1-8ed7-255059dd6b1a", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "315", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/trading"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:33:47.098516+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 9.21}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709554, "name": "SpawnProcess-6"}, "thread": {"id": 133186693357696, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:33:47.098563+08:00", "timestamp": 1756290827.098563}}}
{"text": "2025-08-27 18:33:55.246 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 49501c0c-f643-4d99-a7e3-c6e6fa8bb6b1 | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:37.754488", "seconds": 217.754488}, "exception": null, "extra": {"request_id": "49501c0c-f643-4d99-a7e3-c6e6fa8bb6b1", "extra": {"structured_data": {"request_id": "49501c0c-f643-4d99-a7e3-c6e6fa8bb6b1", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "314", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/trading"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:33:55.246044+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 13.99}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709554, "name": "SpawnProcess-6"}, "thread": {"id": 133186693357696, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:33:55.246079+08:00", "timestamp": 1756290835.246079}}}
{"text": "2025-08-27 18:34:17.316 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e2f8fc72-7827-4cf5-b8da-808978437fad | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:59.824413", "seconds": 239.824413}, "exception": null, "extra": {"request_id": "e2f8fc72-7827-4cf5-b8da-808978437fad", "extra": {"structured_data": {"request_id": "e2f8fc72-7827-4cf5-b8da-808978437fad", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "78"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:34:17.315969+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 17.09}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709554, "name": "SpawnProcess-6"}, "thread": {"id": 133186693357696, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:34:17.316004+08:00", "timestamp": 1756290857.316004}}}
{"text": "2025-08-27 18:34:47.643 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 9b0a30cc-7e1e-4295-89a3-67544aa0b5fb | Server error: 500\n", "record": {"elapsed": {"repr": "0:04:30.151728", "seconds": 270.151728}, "exception": null, "extra": {"request_id": "9b0a30cc-7e1e-4295-89a3-67544aa0b5fb", "extra": {"structured_data": {"request_id": "9b0a30cc-7e1e-4295-89a3-67544aa0b5fb", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "138", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:34:47.643283+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 11.18}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709554, "name": "SpawnProcess-6"}, "thread": {"id": 133186693357696, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:34:47.643319+08:00", "timestamp": 1756290887.643319}}}
{"text": "2025-08-27 18:34:49.239 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 11730955-3ceb-456b-8abb-6e9d6b6855f7 | Server error: 500\n", "record": {"elapsed": {"repr": "0:04:31.748383", "seconds": 271.748383}, "exception": null, "extra": {"request_id": "11730955-3ceb-456b-8abb-6e9d6b6855f7", "extra": {"structured_data": {"request_id": "11730955-3ceb-456b-8abb-6e9d6b6855f7", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "138", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:34:49.239940+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 14.12}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3709554, "name": "SpawnProcess-6"}, "thread": {"id": 133186693357696, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:34:49.239974+08:00", "timestamp": 1756290889.239974}}}
{"text": "2025-08-27 18:35:29.884 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0228526c-12bc-4dfb-b99f-1e7fa7bb6d9b | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:15.944698", "seconds": 15.944698}, "exception": null, "extra": {"request_id": "0228526c-12bc-4dfb-b99f-1e7fa7bb6d9b", "extra": {"structured_data": {"request_id": "0228526c-12bc-4dfb-b99f-1e7fa7bb6d9b", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "54"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:35:29.884031+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 35.22}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3711632, "name": "SpawnProcess-9"}, "thread": {"id": 129859319177344, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:35:29.884072+08:00", "timestamp": 1756290929.884072}}}
{"text": "2025-08-27 18:38:53.749 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 25516c9a-7c77-4999-89a5-df6b97b2d406 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:23.465003", "seconds": 83.465003}, "exception": null, "extra": {"request_id": "25516c9a-7c77-4999-89a5-df6b97b2d406", "extra": {"structured_data": {"request_id": "25516c9a-7c77-4999-89a5-df6b97b2d406", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "102"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:38:53.749425+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 99.67}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3717596, "name": "SpawnProcess-10"}, "thread": {"id": 129558309986432, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:38:53.749464+08:00", "timestamp": 1756291133.749464}}}
{"text": "2025-08-27 18:40:09.519 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 85b6b804-02db-4e15-b3a9-a5552e55f5d9 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:24.334683", "seconds": 24.334683}, "exception": null, "extra": {"request_id": "85b6b804-02db-4e15-b3a9-a5552e55f5d9", "extra": {"structured_data": {"request_id": "85b6b804-02db-4e15-b3a9-a5552e55f5d9", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "102"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:40:09.519901+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 23.55}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3718623, "name": "SpawnProcess-13"}, "thread": {"id": 136467448770688, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:40:09.519937+08:00", "timestamp": 1756291209.519937}}}
{"text": "2025-08-27 18:40:16.896 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d888b849-2f2e-45a5-93bd-96c2ace6d71e | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:31.711714", "seconds": 31.711714}, "exception": null, "extra": {"request_id": "d888b849-2f2e-45a5-93bd-96c2ace6d71e", "extra": {"structured_data": {"request_id": "d888b849-2f2e-45a5-93bd-96c2ace6d71e", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "129", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:40:16.896929+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 12.53}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3718623, "name": "SpawnProcess-13"}, "thread": {"id": 136467448770688, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:40:16.896968+08:00", "timestamp": 1756291216.896968}}}
{"text": "2025-08-27 18:40:18.556 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 7760e2e6-1ade-4853-a346-b5413ac2f713 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:33.370900", "seconds": 33.3709}, "exception": null, "extra": {"request_id": "7760e2e6-1ade-4853-a346-b5413ac2f713", "extra": {"structured_data": {"request_id": "7760e2e6-1ade-4853-a346-b5413ac2f713", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "116.30.198.150", "x-forwarded-for": "116.30.198.150", "x-forwarded-proto": "http", "connection": "close", "content-length": "129", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "116.30.198.150", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T10:40:18.556124+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 7.6}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3718623, "name": "SpawnProcess-13"}, "thread": {"id": 136467448770688, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:40:18.556154+08:00", "timestamp": 1756291218.556154}}}
{"text": "2025-08-27 18:40:50.983 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 19858d64-049d-4e2b-901d-fda8037b9e2e | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:05.797811", "seconds": 65.797811}, "exception": null, "extra": {"request_id": "19858d64-049d-4e2b-901d-fda8037b9e2e", "extra": {"structured_data": {"request_id": "19858d64-049d-4e2b-901d-fda8037b9e2e", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "28"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:40:50.983030+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 376.07}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3718623, "name": "SpawnProcess-13"}, "thread": {"id": 136467448770688, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:40:50.983065+08:00", "timestamp": 1756291250.983065}}}
{"text": "2025-08-27 18:42:01.292 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 410cf043-8f23-40e3-91b9-c3c14aefa32e | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:22.314298", "seconds": 22.314298}, "exception": null, "extra": {"request_id": "410cf043-8f23-40e3-91b9-c3c14aefa32e", "extra": {"structured_data": {"request_id": "410cf043-8f23-40e3-91b9-c3c14aefa32e", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "28"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:42:01.292490+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 60.42}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3719564, "name": "SpawnProcess-14"}, "thread": {"id": 135018461921408, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:42:01.292520+08:00", "timestamp": 1756291321.29252}}}
{"text": "2025-08-27 18:44:42.975 | ERROR    | app.middleware.structured_logging:log_request_end:153 | bcbbc0e8-e8e3-48c4-9afa-d3d71d297009 | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:03.997758", "seconds": 183.997758}, "exception": null, "extra": {"request_id": "bcbbc0e8-e8e3-48c4-9afa-d3d71d297009", "extra": {"structured_data": {"request_id": "bcbbc0e8-e8e3-48c4-9afa-d3d71d297009", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "104"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:44:42.975946+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json"}, "duration_ms": 29.64}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3719564, "name": "SpawnProcess-14"}, "thread": {"id": 135018461921408, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:44:42.975980+08:00", "timestamp": 1756291482.97598}}}
{"text": "2025-08-27 18:51:37.418 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f7875a88-1b9d-4de2-910a-553258d52514 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:22.435961", "seconds": 82.435961}, "exception": null, "extra": {"request_id": "f7875a88-1b9d-4de2-910a-553258d52514", "extra": {"structured_data": {"request_id": "f7875a88-1b9d-4de2-910a-553258d52514", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "107"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:51:37.418645+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json"}, "duration_ms": 109.44}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3722921, "name": "SpawnProcess-18"}, "thread": {"id": 130943140073600, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:51:37.418682+08:00", "timestamp": 1756291897.418682}}}
{"text": "2025-08-27 18:52:51.993 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f2e098e0-ad36-4447-92e0-e63c2d9145b4 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:24.901613", "seconds": 24.901613}, "exception": null, "extra": {"request_id": "f2e098e0-ad36-4447-92e0-e63c2d9145b4", "extra": {"structured_data": {"request_id": "f2e098e0-ad36-4447-92e0-e63c2d9145b4", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "140"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:52:51.993617+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json"}, "duration_ms": 122.7}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3723802, "name": "SpawnProcess-19"}, "thread": {"id": 136368410448000, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:52:51.993656+08:00", "timestamp": 1756291971.993656}}}
{"text": "2025-08-27 18:54:02.463 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 9a91d91f-d087-48d0-88a0-7ef68c141ea4 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:25.672096", "seconds": 25.672096}, "exception": null, "extra": {"request_id": "9a91d91f-d087-48d0-88a0-7ef68c141ea4", "extra": {"structured_data": {"request_id": "9a91d91f-d087-48d0-88a0-7ef68c141ea4", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "68"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:54:02.463010+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json"}, "duration_ms": 211.71}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3724236, "name": "SpawnProcess-20"}, "thread": {"id": 132249209663616, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:54:02.463048+08:00", "timestamp": 1756292042.463048}}}
{"text": "2025-08-27 18:54:51.358 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 565ddd40-feb6-41be-86c7-1f32049ac9cc | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:23.326627", "seconds": 23.326627}, "exception": null, "extra": {"request_id": "565ddd40-feb6-41be-86c7-1f32049ac9cc", "extra": {"structured_data": {"request_id": "565ddd40-feb6-41be-86c7-1f32049ac9cc", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "127"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:54:51.358186+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "88", "content-type": "application/json"}, "duration_ms": 304.13}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3724583, "name": "SpawnProcess-21"}, "thread": {"id": 134213007569024, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:54:51.358226+08:00", "timestamp": 1756292091.358226}}}
{"text": "2025-08-27 18:58:23.606 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a26db97c-8dba-4efa-b04f-0e1754d8948b | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:09.403173", "seconds": 189.403173}, "exception": null, "extra": {"request_id": "a26db97c-8dba-4efa-b04f-0e1754d8948b", "extra": {"structured_data": {"request_id": "a26db97c-8dba-4efa-b04f-0e1754d8948b", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "104"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T10:58:23.606073+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "110", "content-type": "application/json"}, "duration_ms": 239.36}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3724883, "name": "SpawnProcess-22"}, "thread": {"id": 139223504887936, "name": "MainThread"}, "time": {"repr": "2025-08-27 18:58:23.606115+08:00", "timestamp": 1756292303.606115}}}
{"text": "2025-08-27 19:00:00.093 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6a74fe30-a78d-4a61-9bda-a2fe4358fad4 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:30.024412", "seconds": 30.024412}, "exception": null, "extra": {"request_id": "6a74fe30-a78d-4a61-9bda-a2fe4358fad4", "extra": {"structured_data": {"request_id": "6a74fe30-a78d-4a61-9bda-a2fe4358fad4", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "104"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T11:00:00.093424+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "101", "content-type": "application/json"}, "duration_ms": 357.24}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3726595, "name": "SpawnProcess-23"}, "thread": {"id": 128846601277568, "name": "MainThread"}, "time": {"repr": "2025-08-27 19:00:00.093465+08:00", "timestamp": 1756292400.093465}}}
{"text": "2025-08-27 19:01:39.574 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 87dd19d5-a0fe-43fd-bce0-7c3fa3d20418 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:31.495516", "seconds": 31.495516}, "exception": null, "extra": {"request_id": "87dd19d5-a0fe-43fd-bce0-7c3fa3d20418", "extra": {"structured_data": {"request_id": "87dd19d5-a0fe-43fd-bce0-7c3fa3d20418", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "104"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T11:01:39.574220+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "101", "content-type": "application/json"}, "duration_ms": 422.52}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3727340, "name": "SpawnProcess-1"}, "thread": {"id": 134090697724032, "name": "MainThread"}, "time": {"repr": "2025-08-27 19:01:39.574262+08:00", "timestamp": 1756292499.574262}}}
{"text": "2025-08-27 19:03:28.849 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3531986e-6d4c-4d9e-acec-4ae7bc2694c3 | Server error: 502\n", "record": {"elapsed": {"repr": "0:00:36.119140", "seconds": 36.11914}, "exception": null, "extra": {"request_id": "3531986e-6d4c-4d9e-acec-4ae7bc2694c3", "extra": {"structured_data": {"request_id": "3531986e-6d4c-4d9e-acec-4ae7bc2694c3", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "104"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T11:03:28.849228+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 543.11}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3728015, "name": "SpawnProcess-3"}, "thread": {"id": 134771576008832, "name": "MainThread"}, "time": {"repr": "2025-08-27 19:03:28.849268+08:00", "timestamp": 1756292608.849268}}}
{"text": "2025-08-27 20:14:19.003 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e89cdfdd-f201-4e81-aef1-638120b2431d | Server error: 502\n", "record": {"elapsed": {"repr": "1:11:26.273758", "seconds": 4286.273758}, "exception": null, "extra": {"request_id": "e89cdfdd-f201-4e81-aef1-638120b2431d", "extra": {"structured_data": {"request_id": "e89cdfdd-f201-4e81-aef1-638120b2431d", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "123"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T12:14:19.003845+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 332.99}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3728015, "name": "SpawnProcess-3"}, "thread": {"id": 134771576008832, "name": "MainThread"}, "time": {"repr": "2025-08-27 20:14:19.003886+08:00", "timestamp": 1756296859.003886}}}
{"text": "2025-08-27 20:35:06.501 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 958aea8c-7630-48d6-a8b4-eaa7883d09dd | Server error: 500\n", "record": {"elapsed": {"repr": "0:04:04.338606", "seconds": 244.338606}, "exception": null, "extra": {"request_id": "958aea8c-7630-48d6-a8b4-eaa7883d09dd", "extra": {"structured_data": {"request_id": "958aea8c-7630-48d6-a8b4-eaa7883d09dd", "method": "POST", "url": "http://localhost:8001/api/v1/admin/claude/accounts/1/test", "path": "/api/v1/admin/claude/accounts/1/test", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T12:35:06.501180+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "73", "content-type": "application/json"}, "duration_ms": 293.87}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3758124, "name": "SpawnProcess-8"}, "thread": {"id": 138999397154944, "name": "MainThread"}, "time": {"repr": "2025-08-27 20:35:06.501219+08:00", "timestamp": 1756298106.501219}}}
{"text": "2025-08-27 20:48:12.492 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c0b8bd3f-c9c0-4e31-8926-1d9b8cbadad1 | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:29.982621", "seconds": 149.982621}, "exception": null, "extra": {"request_id": "c0b8bd3f-c9c0-4e31-8926-1d9b8cbadad1", "extra": {"structured_data": {"request_id": "c0b8bd3f-c9c0-4e31-8926-1d9b8cbadad1", "method": "POST", "url": "http://localhost:8001/api/v1/admin/claude/accounts/1/test", "path": "/api/v1/admin/claude/accounts/1/test", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T12:48:12.492423+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "73", "content-type": "application/json"}, "duration_ms": 197.55}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3763154, "name": "SpawnProcess-9"}, "thread": {"id": 129336239521920, "name": "MainThread"}, "time": {"repr": "2025-08-27 20:48:12.492464+08:00", "timestamp": 1756298892.492464}}}
{"text": "2025-08-27 20:59:04.120 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c93e2c80-2127-4a51-90cb-849c1bcbe9a3 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:22.029520", "seconds": 82.02952}, "exception": null, "extra": {"request_id": "c93e2c80-2127-4a51-90cb-849c1bcbe9a3", "extra": {"structured_data": {"request_id": "c93e2c80-2127-4a51-90cb-849c1bcbe9a3", "method": "POST", "url": "http://localhost:8001/api/v1/admin/claude/accounts/1/test", "path": "/api/v1/admin/claude/accounts/1/test", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T12:59:04.120393+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 102.72}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3767635, "name": "SpawnProcess-15"}, "thread": {"id": 124667309043840, "name": "MainThread"}, "time": {"repr": "2025-08-27 20:59:04.120434+08:00", "timestamp": 1756299544.120434}}}
{"text": "2025-08-27 21:03:12.271 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0bfe1f6d-ffcf-40fb-81c5-85383141c33e | Server error: 502\n", "record": {"elapsed": {"repr": "0:03:39.412788", "seconds": 219.412788}, "exception": null, "extra": {"request_id": "0bfe1f6d-ffcf-40fb-81c5-85383141c33e", "extra": {"structured_data": {"request_id": "0bfe1f6d-ffcf-40fb-81c5-85383141c33e", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "130"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T13:03:12.271426+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 600.99}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3768427, "name": "SpawnProcess-17"}, "thread": {"id": 130212466954368, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:03:12.271465+08:00", "timestamp": 1756299792.271465}}}
{"text": "2025-08-27 21:06:09.187 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 42c46c25-c16d-449d-bac3-046773066616 | Server error: 502\n", "record": {"elapsed": {"repr": "0:06:36.328655", "seconds": 396.328655}, "exception": null, "extra": {"request_id": "42c46c25-c16d-449d-bac3-046773066616", "extra": {"structured_data": {"request_id": "42c46c25-c16d-449d-bac3-046773066616", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "127"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T13:06:09.187294+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 268.5}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3768427, "name": "SpawnProcess-17"}, "thread": {"id": 130212466954368, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:06:09.187332+08:00", "timestamp": 1756299969.187332}}}
{"text": "2025-08-27 21:19:20.169 | ERROR    | app.middleware.structured_logging:log_error:184 | cefb3b29-e07e-4dc6-bdcf-d3f7797885ee | Request failed: AttributeError: type object 'UserClaudeKeyService' has no attribute 'get_by_virtual_key'\n", "record": {"elapsed": {"repr": "0:00:20.238899", "seconds": 20.238899}, "exception": null, "extra": {"request_id": "cefb3b29-e07e-4dc6-bdcf-d3f7797885ee", "extra": {"structured_data": {"request_id": "cefb3b29-e07e-4dc6-bdcf-d3f7797885ee", "method": "POST", "url": "http://localhost:8001/api/v1/ai/proxy/chat", "path": "/api/v1/ai/proxy/chat", "client_ip": "127.0.0.1", "error_type": "AttributeError", "error_message": "type object 'UserClaudeKeyService' has no attribute 'get_by_virtual_key'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 292, in app\n    solved_result = await solve_dependencies(\n                    ^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/dependencies/utils.py\", line 638, in solve_dependencies\n    solved = await call(**solved_result.values)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/ai.py\", line 557, in authenticate_virtual_key\n    user_key = await UserClaudeKeyService.get_by_virtual_key(db, x_api_key)\n                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: type object 'UserClaudeKeyService' has no attribute 'get_by_virtual_key'. Did you mean: 'generate_virtual_key'?\n", "duration_ms": 4.18, "timestamp": "2025-08-27T13:19:20.169689+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: type object 'UserClaudeKeyService' has no attribute 'get_by_virtual_key'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3775191, "name": "SpawnProcess-19"}, "thread": {"id": 123939665772672, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:19:20.169740+08:00", "timestamp": 1756300760.16974}}}
{"text": "2025-08-27 21:25:15.829 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f07bd0c9-f318-4d9a-b04f-da570115aef2 | Server error: 502\n", "record": {"elapsed": {"repr": "0:03:39.187385", "seconds": 219.187385}, "exception": null, "extra": {"request_id": "f07bd0c9-f318-4d9a-b04f-da570115aef2", "extra": {"structured_data": {"request_id": "f07bd0c9-f318-4d9a-b04f-da570115aef2", "method": "POST", "url": "http://localhost:8001/api/v1/ai/v1/messages", "path": "/api/v1/ai/v1/messages", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "x-api-key": "[FILTERED]", "content-length": "150"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T13:25:15.829938+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 513.63}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3776103, "name": "SpawnProcess-20"}, "thread": {"id": 137502283264128, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:25:15.829980+08:00", "timestamp": 1756301115.82998}}}
{"text": "2025-08-27 21:38:11.308 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 7a4119dc-8661-4aa0-b252-94475e295b5d | Server error: 500\n", "record": {"elapsed": {"repr": "0:16:34.665559", "seconds": 994.665559}, "exception": null, "extra": {"request_id": "7a4119dc-8661-4aa0-b252-94475e295b5d", "extra": {"structured_data": {"request_id": "7a4119dc-8661-4aa0-b252-94475e295b5d", "method": "POST", "url": "http://localhost:8001/api/v1/ai/v1/messages", "path": "/api/v1/ai/v1/messages", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "x-api-key": "[FILTERED]", "content-length": "169"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T13:38:11.308114+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "104", "content-type": "application/json"}, "duration_ms": 40.55}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3776103, "name": "SpawnProcess-20"}, "thread": {"id": 137502283264128, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:38:11.308154+08:00", "timestamp": 1756301891.308154}}}
{"text": "2025-08-27 21:38:49.972 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 73d67766-c387-4b3b-817d-cc28d6efa527 | Server error: 502\n", "record": {"elapsed": {"repr": "0:00:20.500500", "seconds": 20.5005}, "exception": null, "extra": {"request_id": "73d67766-c387-4b3b-817d-cc28d6efa527", "extra": {"structured_data": {"request_id": "73d67766-c387-4b3b-817d-cc28d6efa527", "method": "POST", "url": "http://localhost:8001/api/v1/ai/v1/messages", "path": "/api/v1/ai/v1/messages", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "x-api-key": "[FILTERED]", "content-length": "169"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T13:38:49.972339+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "232", "content-type": "application/json"}, "duration_ms": 475.9}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3781768, "name": "SpawnProcess-21"}, "thread": {"id": 128423869599872, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:38:49.972382+08:00", "timestamp": 1756301929.972382}}}
{"text": "2025-08-27 21:40:00.211 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 1437a432-44d5-4353-99e0-6e0e03ec4c50 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:30.739242", "seconds": 90.739242}, "exception": null, "extra": {"request_id": "1437a432-44d5-4353-99e0-6e0e03ec4c50", "extra": {"structured_data": {"request_id": "1437a432-44d5-4353-99e0-6e0e03ec4c50", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "en-US,en;q=0.9", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "timestamp": "2025-08-27T13:40:00.211097+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "105", "content-type": "application/json"}, "duration_ms": 7.81}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3781768, "name": "SpawnProcess-21"}, "thread": {"id": 128423869599872, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:40:00.211124+08:00", "timestamp": 1756302000.211124}}}
{"text": "2025-08-27 21:40:00.213 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0a73d281-24de-4910-bcdd-8d853f259572 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:30.741319", "seconds": 90.741319}, "exception": null, "extra": {"request_id": "0a73d281-24de-4910-bcdd-8d853f259572", "extra": {"structured_data": {"request_id": "0a73d281-24de-4910-bcdd-8d853f259572", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "en-US,en;q=0.9", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "timestamp": "2025-08-27T13:40:00.213176+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "105", "content-type": "application/json"}, "duration_ms": 8.14}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3781768, "name": "SpawnProcess-21"}, "thread": {"id": 128423869599872, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:40:00.213201+08:00", "timestamp": 1756302000.213201}}}
{"text": "2025-08-27 21:40:23.356 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 1280b649-6ba6-4300-819d-bf8208a8acfe | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:53.884319", "seconds": 113.884319}, "exception": null, "extra": {"request_id": "1280b649-6ba6-4300-819d-bf8208a8acfe", "extra": {"structured_data": {"request_id": "1280b649-6ba6-4300-819d-bf8208a8acfe", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "en-US,en;q=0.9", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "timestamp": "2025-08-27T13:40:23.356175+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "105", "content-type": "application/json"}, "duration_ms": 4.13}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3781768, "name": "SpawnProcess-21"}, "thread": {"id": 128423869599872, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:40:23.356201+08:00", "timestamp": 1756302023.356201}}}
{"text": "2025-08-27 21:40:27.816 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 72fbe1b1-4de0-47e0-abeb-ea090eee8e68 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:58.344340", "seconds": 118.34434}, "exception": null, "extra": {"request_id": "72fbe1b1-4de0-47e0-abeb-ea090eee8e68", "extra": {"structured_data": {"request_id": "72fbe1b1-4de0-47e0-abeb-ea090eee8e68", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "en-US,en;q=0.9", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "timestamp": "2025-08-27T13:40:27.816198+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "105", "content-type": "application/json"}, "duration_ms": 6.87}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3781768, "name": "SpawnProcess-21"}, "thread": {"id": 128423869599872, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:40:27.816222+08:00", "timestamp": 1756302027.816222}}}
{"text": "2025-08-27 21:40:27.819 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 2db90630-9185-402a-aaf1-2d6a7cea54ac | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:58.347861", "seconds": 118.347861}, "exception": null, "extra": {"request_id": "2db90630-9185-402a-aaf1-2d6a7cea54ac", "extra": {"structured_data": {"request_id": "2db90630-9185-402a-aaf1-2d6a7cea54ac", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "en-US,en;q=0.9", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "timestamp": "2025-08-27T13:40:27.819717+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "105", "content-type": "application/json"}, "duration_ms": 5.78}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3781768, "name": "SpawnProcess-21"}, "thread": {"id": 128423869599872, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:40:27.819743+08:00", "timestamp": 1756302027.819743}}}
{"text": "2025-08-27 21:40:47.141 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e1d23716-ab9f-4bca-a82b-bca3e963c654 | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:17.670006", "seconds": 137.670006}, "exception": null, "extra": {"request_id": "e1d23716-ab9f-4bca-a82b-bca3e963c654", "extra": {"structured_data": {"request_id": "e1d23716-ab9f-4bca-a82b-bca3e963c654", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "en-US,en;q=0.9", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.4 Safari/605.1.15", "timestamp": "2025-08-27T13:40:47.141862+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "105", "content-type": "application/json"}, "duration_ms": 3.92}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3781768, "name": "SpawnProcess-21"}, "thread": {"id": 128423869599872, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:40:47.141888+08:00", "timestamp": 1756302047.141888}}}
{"text": "2025-08-27 21:49:08.029 | ERROR    | app.middleware.structured_logging:log_request_end:153 | dfb583c3-648b-4652-9907-c80d9a17261d | Server error: 502\n", "record": {"elapsed": {"repr": "0:03:07.449576", "seconds": 187.449576}, "exception": null, "extra": {"request_id": "dfb583c3-648b-4652-9907-c80d9a17261d", "extra": {"structured_data": {"request_id": "dfb583c3-648b-4652-9907-c80d9a17261d", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "content-length": "131", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T13:49:08.029725+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 503.72}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3784300, "name": "SpawnProcess-22"}, "thread": {"id": 140199658037376, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:49:08.029756+08:00", "timestamp": 1756302548.029756}}}
{"text": "2025-08-27 21:49:10.073 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a7064ff9-1abc-4a97-acce-2c85b310d5aa | Server error: 502\n", "record": {"elapsed": {"repr": "0:03:09.493534", "seconds": 189.493534}, "exception": null, "extra": {"request_id": "a7064ff9-1abc-4a97-acce-2c85b310d5aa", "extra": {"structured_data": {"request_id": "a7064ff9-1abc-4a97-acce-2c85b310d5aa", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "content-length": "131", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T13:49:10.073675+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 245.79}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3784300, "name": "SpawnProcess-22"}, "thread": {"id": 140199658037376, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:49:10.073714+08:00", "timestamp": 1756302550.073714}}}
{"text": "2025-08-27 21:49:33.942 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 0750e6af-e0ad-4c75-80b1-3eba683c215f | Server error: 502\n", "record": {"elapsed": {"repr": "0:03:33.362019", "seconds": 213.362019}, "exception": null, "extra": {"request_id": "0750e6af-e0ad-4c75-80b1-3eba683c215f", "extra": {"structured_data": {"request_id": "0750e6af-e0ad-4c75-80b1-3eba683c215f", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "content-length": "131", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T13:49:33.942162+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 242.29}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3784300, "name": "SpawnProcess-22"}, "thread": {"id": 140199658037376, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:49:33.942199+08:00", "timestamp": 1756302573.942199}}}
{"text": "2025-08-27 21:49:36.151 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d2fee844-285b-4a7c-88ec-34a1d83fac39 | Server error: 502\n", "record": {"elapsed": {"repr": "0:03:35.571613", "seconds": 215.571613}, "exception": null, "extra": {"request_id": "d2fee844-285b-4a7c-88ec-34a1d83fac39", "extra": {"structured_data": {"request_id": "d2fee844-285b-4a7c-88ec-34a1d83fac39", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "content-length": "131", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T13:49:36.151759+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 226.43}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3784300, "name": "SpawnProcess-22"}, "thread": {"id": 140199658037376, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:49:36.151793+08:00", "timestamp": 1756302576.151793}}}
{"text": "2025-08-27 21:51:40.129 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 5c7f71ac-6120-4d7b-95e7-4a7f26ea0c97 | Server error: 502\n", "record": {"elapsed": {"repr": "0:05:39.549111", "seconds": 339.549111}, "exception": null, "extra": {"request_id": "5c7f71ac-6120-4d7b-95e7-4a7f26ea0c97", "extra": {"structured_data": {"request_id": "5c7f71ac-6120-4d7b-95e7-4a7f26ea0c97", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "content-length": "131", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T13:51:40.129262+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 227.32}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3784300, "name": "SpawnProcess-22"}, "thread": {"id": 140199658037376, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:51:40.129291+08:00", "timestamp": 1756302700.129291}}}
{"text": "2025-08-27 21:51:42.163 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 499875b7-7762-4261-9f37-727211e4ceaa | Server error: 502\n", "record": {"elapsed": {"repr": "0:05:41.583413", "seconds": 341.583413}, "exception": null, "extra": {"request_id": "499875b7-7762-4261-9f37-727211e4ceaa", "extra": {"structured_data": {"request_id": "499875b7-7762-4261-9f37-727211e4ceaa", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "152.67.235.98", "x-forwarded-for": "152.67.235.98", "x-forwarded-proto": "http", "connection": "close", "content-length": "131", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/ai-chat"}, "client_ip": "152.67.235.98", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-27T13:51:42.163563+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 245.72}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3784300, "name": "SpawnProcess-22"}, "thread": {"id": 140199658037376, "name": "MainThread"}, "time": {"repr": "2025-08-27 21:51:42.163593+08:00", "timestamp": 1756302702.163593}}}
{"text": "2025-08-27 22:25:44.437 | ERROR    | app.middleware.structured_logging:log_error:184 | 34522285-d86a-4677-8957-323493c1a145 | Request failed: AttributeError: type object 'UserClaudeKeyService' has no attribute 'get_user_usage_statistics'\n", "record": {"elapsed": {"repr": "0:02:17.871829", "seconds": 137.871829}, "exception": null, "extra": {"request_id": "34522285-d86a-4677-8957-323493c1a145", "extra": {"structured_data": {"request_id": "34522285-d86a-4677-8957-323493c1a145", "method": "GET", "url": "http://localhost:8001/v1/usage", "path": "/v1/usage", "client_ip": "127.0.0.1", "error_type": "AttributeError", "error_message": "type object 'UserClaudeKeyService' has no attribute 'get_user_usage_statistics'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/claude_compatible.py\", line 314, in get_usage_stats\n    usage_stats = await UserClaudeKeyService.get_user_usage_statistics(db, user.id)\n                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: type object 'UserClaudeKeyService' has no attribute 'get_user_usage_statistics'. Did you mean: 'get_usage_statistics'?\n", "duration_ms": 3.96, "timestamp": "2025-08-27T14:25:44.437845+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: type object 'UserClaudeKeyService' has no attribute 'get_user_usage_statistics'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3797465, "name": "SpawnProcess-1"}, "thread": {"id": 139110681788544, "name": "MainThread"}, "time": {"repr": "2025-08-27 22:25:44.437874+08:00", "timestamp": 1756304744.437874}}}
{"text": "2025-08-27 22:34:09.127 | ERROR    | app.middleware.structured_logging:log_request_end:153 | f0b2cc31-c234-49c2-ba23-691056a07ce6 | Server error: 502\n", "record": {"elapsed": {"repr": "0:07:41.178098", "seconds": 461.178098}, "exception": null, "extra": {"request_id": "f0b2cc31-c234-49c2-ba23-691056a07ce6", "extra": {"structured_data": {"request_id": "f0b2cc31-c234-49c2-ba23-691056a07ce6", "method": "POST", "url": "http://localhost:8001/v1/messages", "path": "/v1/messages", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "280"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T14:34:09.127725+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 703.33}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3798548, "name": "SpawnProcess-3"}, "thread": {"id": 135431557742720, "name": "MainThread"}, "time": {"repr": "2025-08-27 22:34:09.127753+08:00", "timestamp": 1756305249.127753}}}
{"text": "2025-08-27 22:37:18.863 | ERROR    | app.middleware.structured_logging:log_request_end:153 | e0aacd42-b07c-432f-af7b-a212e02cb27a | Server error: 502\n", "record": {"elapsed": {"repr": "0:10:50.913668", "seconds": 650.913668}, "exception": null, "extra": {"request_id": "e0aacd42-b07c-432f-af7b-a212e02cb27a", "extra": {"structured_data": {"request_id": "e0aacd42-b07c-432f-af7b-a212e02cb27a", "method": "POST", "url": "http://localhost:8001/v1/messages", "path": "/v1/messages", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "217"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T14:37:18.863287+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 316.26}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3798548, "name": "SpawnProcess-3"}, "thread": {"id": 135431557742720, "name": "MainThread"}, "time": {"repr": "2025-08-27 22:37:18.863323+08:00", "timestamp": 1756305438.863323}}}
{"text": "2025-08-27 22:45:42.197 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6a8c2a71-b407-4cb7-b1c4-a6045f6cd8a8 | Server error: 502\n", "record": {"elapsed": {"repr": "0:05:11.952642", "seconds": 311.952642}, "exception": null, "extra": {"request_id": "6a8c2a71-b407-4cb7-b1c4-a6045f6cd8a8", "extra": {"structured_data": {"request_id": "6a8c2a71-b407-4cb7-b1c4-a6045f6cd8a8", "method": "POST", "url": "http://localhost:8001/v1/messages", "path": "/v1/messages", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "214"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T14:45:42.197326+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 617.22}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3803172, "name": "SpawnProcess-4"}, "thread": {"id": 127650409017472, "name": "MainThread"}, "time": {"repr": "2025-08-27 22:45:42.197365+08:00", "timestamp": 1756305942.197365}}}
{"text": "2025-08-27 22:58:32.689 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 361dc794-9f6a-41ae-aaa3-1ede9d62829b | Server error: 500\n", "record": {"elapsed": {"repr": "0:04:29.302372", "seconds": 269.302372}, "exception": null, "extra": {"request_id": "361dc794-9f6a-41ae-aaa3-1ede9d62829b", "extra": {"structured_data": {"request_id": "361dc794-9f6a-41ae-aaa3-1ede9d62829b", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "128"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T14:58:32.689519+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "61", "content-type": "application/json"}, "duration_ms": 1479.01}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3807660, "name": "SpawnProcess-9"}, "thread": {"id": 133956438737024, "name": "MainThread"}, "time": {"repr": "2025-08-27 22:58:32.689810+08:00", "timestamp": 1756306712.68981}}}
{"text": "2025-08-27 22:59:34.311 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 15f11628-2f03-43a1-8a9a-9d41e5a9fe62 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:33.069502", "seconds": 33.069502}, "exception": null, "extra": {"request_id": "15f11628-2f03-43a1-8a9a-9d41e5a9fe62", "extra": {"structured_data": {"request_id": "15f11628-2f03-43a1-8a9a-9d41e5a9fe62", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "128"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T14:59:34.311255+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "54", "content-type": "application/json"}, "duration_ms": 1201.38}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3809496, "name": "SpawnProcess-11"}, "thread": {"id": 127401995055232, "name": "MainThread"}, "time": {"repr": "2025-08-27 22:59:34.311286+08:00", "timestamp": 1756306774.311286}}}
{"text": "2025-08-27 23:00:54.989 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c9b4e1b7-d901-4e1f-9bcd-dc7e605e2b07 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:37.467911", "seconds": 37.467911}, "exception": null, "extra": {"request_id": "c9b4e1b7-d901-4e1f-9bcd-dc7e605e2b07", "extra": {"structured_data": {"request_id": "c9b4e1b7-d901-4e1f-9bcd-dc7e605e2b07", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "119"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T15:00:54.989777+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "61", "content-type": "application/json"}, "duration_ms": 546.92}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3809989, "name": "SpawnProcess-13"}, "thread": {"id": 128597501939840, "name": "MainThread"}, "time": {"repr": "2025-08-27 23:00:54.989817+08:00", "timestamp": 1756306854.989817}}}
{"text": "2025-08-27 23:09:26.279 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 609201c5-1c51-4445-9b58-ec1f2039c249 | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:03.452589", "seconds": 423.452589}, "exception": null, "extra": {"request_id": "609201c5-1c51-4445-9b58-ec1f2039c249", "extra": {"structured_data": {"request_id": "609201c5-1c51-4445-9b58-ec1f2039c249", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "120"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T15:09:26.279632+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "33", "content-type": "application/json"}, "duration_ms": 129170.17}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3810770, "name": "SpawnProcess-17"}, "thread": {"id": 136704609333376, "name": "MainThread"}, "time": {"repr": "2025-08-27 23:09:26.279674+08:00", "timestamp": 1756307366.279674}}}
{"text": "2025-08-27 23:43:47.142 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 1f7afa70-1a4e-4ec9-953a-1b95ef2a48c9 | Server error: 500\n", "record": {"elapsed": {"repr": "0:08:05.956147", "seconds": 485.956147}, "exception": null, "extra": {"request_id": "1f7afa70-1a4e-4ec9-953a-1b95ef2a48c9", "extra": {"structured_data": {"request_id": "1f7afa70-1a4e-4ec9-953a-1b95ef2a48c9", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "132"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T15:43:47.142517+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "41", "content-type": "application/json"}, "duration_ms": 210.63}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3822173, "name": "SpawnProcess-24"}, "thread": {"id": 137158659641472, "name": "MainThread"}, "time": {"repr": "2025-08-27 23:43:47.142577+08:00", "timestamp": 1756309427.142577}}}
{"text": "2025-08-27 23:44:35.073 | ERROR    | app.middleware.structured_logging:log_request_end:153 | bfeb4e15-d5b0-4acb-805c-dc62e27f5238 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:17.166999", "seconds": 17.166999}, "exception": null, "extra": {"request_id": "bfeb4e15-d5b0-4acb-805c-dc62e27f5238", "extra": {"structured_data": {"request_id": "bfeb4e15-d5b0-4acb-805c-dc62e27f5238", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "97"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T15:44:35.073662+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "41", "content-type": "application/json"}, "duration_ms": 1307.01}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3825258, "name": "SpawnProcess-25"}, "thread": {"id": 133454841933952, "name": "MainThread"}, "time": {"repr": "2025-08-27 23:44:35.073693+08:00", "timestamp": 1756309475.073693}}}
{"text": "2025-08-27 23:46:01.538 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 7272dd90-4173-43f3-8e58-d569b387a9c6 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:18.774324", "seconds": 18.774324}, "exception": null, "extra": {"request_id": "7272dd90-4173-43f3-8e58-d569b387a9c6", "extra": {"structured_data": {"request_id": "7272dd90-4173-43f3-8e58-d569b387a9c6", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "103"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T15:46:01.538388+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "41", "content-type": "application/json"}, "duration_ms": 474.75}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3825855, "name": "SpawnProcess-26"}, "thread": {"id": 124606897733760, "name": "MainThread"}, "time": {"repr": "2025-08-27 23:46:01.538434+08:00", "timestamp": 1756309561.538434}}}
{"text": "2025-08-28 00:02:24.497 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 1ea33894-e6fd-4695-b711-fce59a5af5b7 | Server error: 500\n", "record": {"elapsed": {"repr": "0:06:29.182352", "seconds": 389.182352}, "exception": null, "extra": {"request_id": "1ea33894-e6fd-4695-b711-fce59a5af5b7", "extra": {"structured_data": {"request_id": "1ea33894-e6fd-4695-b711-fce59a5af5b7", "method": "POST", "url": "http://43.167.252.120:8001/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "194"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T16:02:24.497255+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "1237", "content-type": "application/json"}, "duration_ms": 16.29}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3829272, "name": "SpawnProcess-35"}, "thread": {"id": 128103253340288, "name": "MainThread"}, "time": {"repr": "2025-08-28 00:02:24.497297+08:00", "timestamp": 1756310544.497297}}}
{"text": "2025-08-28 00:05:46.505 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6b3677e9-52d8-4e08-8e29-5fbb2a9b1213 | Server error: 500\n", "record": {"elapsed": {"repr": "0:09:51.190856", "seconds": 591.190856}, "exception": null, "extra": {"request_id": "6b3677e9-52d8-4e08-8e29-5fbb2a9b1213", "extra": {"structured_data": {"request_id": "6b3677e9-52d8-4e08-8e29-5fbb2a9b1213", "method": "POST", "url": "http://43.167.252.120:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]", "content-type": "application/json", "content-length": "142"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T16:05:46.505770+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "41", "content-type": "application/json"}, "duration_ms": 1248.41}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 3829272, "name": "SpawnProcess-35"}, "thread": {"id": 128103253340288, "name": "MainThread"}, "time": {"repr": "2025-08-28 00:05:46.505801+08:00", "timestamp": 1756310746.505801}}}
{"text": "2025-08-28 01:56:00.079 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 75069653-6c94-404e-94c2-9d08a141c43e | Server error: 502\n", "record": {"elapsed": {"repr": "0:00:41.180115", "seconds": 41.180115}, "exception": null, "extra": {"request_id": "75069653-6c94-404e-94c2-9d08a141c43e", "extra": {"structured_data": {"request_id": "75069653-6c94-404e-94c2-9d08a141c43e", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "156"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T17:56:00.079247+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 734.88}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 36685, "name": "SpawnProcess-1"}, "thread": {"id": 128460152369280, "name": "MainThread"}, "time": {"repr": "2025-08-28 01:56:00.079279+08:00", "timestamp": 1756317360.079279}}}
{"text": "2025-08-28 02:32:38.627 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 2d189089-518b-4bf0-8e1a-9f0afd0a6ec7 | Server error: 502\n", "record": {"elapsed": {"repr": "0:29:26.694235", "seconds": 1766.694235}, "exception": null, "extra": {"request_id": "2d189089-518b-4bf0-8e1a-9f0afd0a6ec7", "extra": {"structured_data": {"request_id": "2d189089-518b-4bf0-8e1a-9f0afd0a6ec7", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "79"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-27T18:32:38.627730+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "122", "content-type": "application/json"}, "duration_ms": 626.12}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 39295, "name": "SpawnProcess-4"}, "thread": {"id": 135963205734528, "name": "MainThread"}, "time": {"repr": "2025-08-28 02:32:38.627767+08:00", "timestamp": 1756319558.627767}}}
{"text": "2025-08-28 10:50:40.005 | ERROR    | app.middleware.structured_logging:log_error:184 | 31c605cf-7289-462a-aed8-a2f10a83fcae | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "8:02:55.544488", "seconds": 28975.544488}, "exception": null, "extra": {"request_id": "31c605cf-7289-462a-aed8-a2f10a83fcae", "extra": {"structured_data": {"request_id": "31c605cf-7289-462a-aed8-a2f10a83fcae", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.135", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 10.49, "timestamp": "2025-08-28T02:50:40.005151+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 65086, "name": "SpawnProcess-19"}, "thread": {"id": 123608452661376, "name": "MainThread"}, "time": {"repr": "2025-08-28 10:50:40.005203+08:00", "timestamp": 1756349440.005203}}}
{"text": "2025-08-28 10:50:40.008 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d95296fc-d23b-4a54-8a34-133d2fecc127 | Server error: 500\n", "record": {"elapsed": {"repr": "8:02:55.547352", "seconds": 28975.547352}, "exception": null, "extra": {"request_id": "d95296fc-d23b-4a54-8a34-133d2fecc127", "extra": {"structured_data": {"request_id": "d95296fc-d23b-4a54-8a34-133d2fecc127", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.135", "x-forwarded-for": "114.105.192.135", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.135", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-28T02:50:40.008038+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 22.42}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 65086, "name": "SpawnProcess-19"}, "thread": {"id": 123608452661376, "name": "MainThread"}, "time": {"repr": "2025-08-28 10:50:40.008067+08:00", "timestamp": 1756349440.008067}}}
{"text": "2025-08-28 10:50:40.109 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 5d486100-5b69-4451-8346-e8c5f6023207 | Server error: 500\n", "record": {"elapsed": {"repr": "8:02:55.648662", "seconds": 28975.648662}, "exception": null, "extra": {"request_id": "5d486100-5b69-4451-8346-e8c5f6023207", "extra": {"structured_data": {"request_id": "5d486100-5b69-4451-8346-e8c5f6023207", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.135", "x-forwarded-for": "114.105.192.135", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.135", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-28T02:50:40.109347+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 2.29}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 65086, "name": "SpawnProcess-19"}, "thread": {"id": 123608452661376, "name": "MainThread"}, "time": {"repr": "2025-08-28 10:50:40.109377+08:00", "timestamp": 1756349440.109377}}}
{"text": "2025-08-28 10:50:40.180 | ERROR    | app.middleware.structured_logging:log_error:184 | 4c1ac9f6-52df-4d5d-99d1-2b6422199025 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "8:02:55.719825", "seconds": 28975.719825}, "exception": null, "extra": {"request_id": "4c1ac9f6-52df-4d5d-99d1-2b6422199025", "extra": {"structured_data": {"request_id": "4c1ac9f6-52df-4d5d-99d1-2b6422199025", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.135", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.17, "timestamp": "2025-08-28T02:50:40.180508+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 65086, "name": "SpawnProcess-19"}, "thread": {"id": 123608452661376, "name": "MainThread"}, "time": {"repr": "2025-08-28 10:50:40.180540+08:00", "timestamp": 1756349440.18054}}}
{"text": "2025-08-28 11:10:44.002 | ERROR    | app.middleware.structured_logging:log_request_end:153 | de4af73e-ff7f-4aba-af24-9c1343f23394 | Server error: 500\n", "record": {"elapsed": {"repr": "8:22:59.541487", "seconds": 30179.541487}, "exception": null, "extra": {"request_id": "de4af73e-ff7f-4aba-af24-9c1343f23394", "extra": {"structured_data": {"request_id": "de4af73e-ff7f-4aba-af24-9c1343f23394", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "85"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-28T03:10:44.002174+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "67", "content-type": "application/json"}, "duration_ms": 11.74}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 65086, "name": "SpawnProcess-19"}, "thread": {"id": 123608452661376, "name": "MainThread"}, "time": {"repr": "2025-08-28 11:10:44.002202+08:00", "timestamp": 1756350644.002202}}}
{"text": "2025-08-28 12:10:50.769 | ERROR    | app.middleware.structured_logging:log_request_end:153 | c34900bb-2674-469f-b2c7-c6cd11dd882a | Server error: 503\n", "record": {"elapsed": {"repr": "0:01:58.093975", "seconds": 118.093975}, "exception": null, "extra": {"request_id": "c34900bb-2674-469f-b2c7-c6cd11dd882a", "extra": {"structured_data": {"request_id": "c34900bb-2674-469f-b2c7-c6cd11dd882a", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "266"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-28T04:10:50.769260+00:00", "event_type": "request_end", "status_code": 503, "response_headers": {"content-length": "64", "content-type": "application/json"}, "duration_ms": 2127.55}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 503", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 246217, "name": "SpawnProcess-31"}, "thread": {"id": 123293195919488, "name": "MainThread"}, "time": {"repr": "2025-08-28 12:10:50.769303+08:00", "timestamp": 1756354250.769303}}}
{"text": "2025-08-28 12:15:35.904 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a0031394-6916-459a-9f74-31c869589c87 | Server error: 502\n", "record": {"elapsed": {"repr": "0:00:48.213323", "seconds": 48.213323}, "exception": null, "extra": {"request_id": "a0031394-6916-459a-9f74-31c869589c87", "extra": {"structured_data": {"request_id": "a0031394-6916-459a-9f74-31c869589c87", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "159"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-28T04:15:35.904392+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "333", "content-type": "application/json"}, "duration_ms": 7356.15}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 248318, "name": "SpawnProcess-33"}, "thread": {"id": 135279555571840, "name": "MainThread"}, "time": {"repr": "2025-08-28 12:15:35.904423+08:00", "timestamp": 1756354535.904423}}}
{"text": "2025-08-28 12:29:03.539 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b2707598-987b-40d8-b50c-d8e821e8fda5 | Server error: 502\n", "record": {"elapsed": {"repr": "0:10:32.339109", "seconds": 632.339109}, "exception": null, "extra": {"request_id": "b2707598-987b-40d8-b50c-d8e821e8fda5", "extra": {"structured_data": {"request_id": "b2707598-987b-40d8-b50c-d8e821e8fda5", "method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "181"}, "client_ip": "127.0.0.1", "user_agent": "curl/8.5.0", "timestamp": "2025-08-28T04:29:03.539599+00:00", "event_type": "request_end", "status_code": 502, "response_headers": {"content-length": "160", "content-type": "application/json"}, "duration_ms": 518185.59}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 502", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 249615, "name": "SpawnProcess-36"}, "thread": {"id": 140422909243520, "name": "MainThread"}, "time": {"repr": "2025-08-28 12:29:03.539642+08:00", "timestamp": 1756355343.539642}}}
{"text": "2025-08-28 13:57:01.241 | ERROR    | app.middleware.structured_logging:log_error:184 | 80cad6cf-7118-47e7-9a7f-149555898f5c | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:29:55.459347", "seconds": 1795.459347}, "exception": null, "extra": {"request_id": "80cad6cf-7118-47e7-9a7f-149555898f5c", "extra": {"structured_data": {"request_id": "80cad6cf-7118-47e7-9a7f-149555898f5c", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.135", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 6.32, "timestamp": "2025-08-28T05:57:01.241096+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 273805, "name": "SpawnProcess-52"}, "thread": {"id": 136034939605120, "name": "MainThread"}, "time": {"repr": "2025-08-28 13:57:01.241138+08:00", "timestamp": 1756360621.241138}}}
{"text": "2025-08-28 13:57:01.260 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 85fd88af-9c77-4579-aebf-84cab665c517 | Server error: 500\n", "record": {"elapsed": {"repr": "0:29:55.478367", "seconds": 1795.478367}, "exception": null, "extra": {"request_id": "85fd88af-9c77-4579-aebf-84cab665c517", "extra": {"structured_data": {"request_id": "85fd88af-9c77-4579-aebf-84cab665c517", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.135", "x-forwarded-for": "114.105.192.135", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.135", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-28T05:57:01.260126+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 34.81}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 273805, "name": "SpawnProcess-52"}, "thread": {"id": 136034939605120, "name": "MainThread"}, "time": {"repr": "2025-08-28 13:57:01.260158+08:00", "timestamp": 1756360621.260158}}}
{"text": "2025-08-28 13:57:01.347 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 530bf8fc-a5f5-4046-b5ed-3a6639b405ff | Server error: 500\n", "record": {"elapsed": {"repr": "0:29:55.565360", "seconds": 1795.56536}, "exception": null, "extra": {"request_id": "530bf8fc-a5f5-4046-b5ed-3a6639b405ff", "extra": {"structured_data": {"request_id": "530bf8fc-a5f5-4046-b5ed-3a6639b405ff", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/tags/?is_active=true", "path": "/api/v1/admin/users/tags/", "query_params": {"is_active": "true"}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.135", "x-forwarded-for": "114.105.192.135", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "application/json, text/plain, */*", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/users", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.135", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-28T05:57:01.347132+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json"}, "duration_ms": 1.78}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 273805, "name": "SpawnProcess-52"}, "thread": {"id": 136034939605120, "name": "MainThread"}, "time": {"repr": "2025-08-28 13:57:01.347151+08:00", "timestamp": 1756360621.347151}}}
{"text": "2025-08-28 13:57:01.466 | ERROR    | app.middleware.structured_logging:log_error:184 | ea995ecd-bca7-4fd7-ba0e-27758cee51a3 | Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "record": {"elapsed": {"repr": "0:29:55.684675", "seconds": 1795.684675}, "exception": null, "extra": {"request_id": "ea995ecd-bca7-4fd7-ba0e-27758cee51a3", "extra": {"structured_data": {"request_id": "ea995ecd-bca7-4fd7-ba0e-27758cee51a3", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/users/dashboard/stats", "path": "/api/v1/admin/users/dashboard/stats", "client_ip": "114.105.192.135", "error_type": "IllegalStateChangeError", "error_message": "Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 291, in app\n    async with AsyncExitStack() as async_exit_stack:\n  File \"/usr/lib/python3.12/contextlib.py\", line 754, in __aexit__\n    raise exc_details[1]\n  File \"/usr/lib/python3.12/contextlib.py\", line 737, in __aexit__\n    cb_suppress = await cb(*exc_details)\n                  ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/lib/python3.12/contextlib.py\", line 231, in __aexit__\n    await self.gen.athrow(value)\n  File \"/root/trademe/backend/trading-service/app/database.py\", line 50, in get_db\n    async with AsyncSessionLocal() as session:\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1085, in __aexit__\n    await asyncio.shield(task)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py\", line 1030, in close\n    await greenlet_spawn(self.sync_session.close)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py\", line 190, in greenlet_spawn\n    result = context.switch(*args, **kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2521, in close\n    self._close_impl(invalidate=False)\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py\", line 2590, in _close_impl\n    transaction.close(invalidate)\n  File \"<string>\", line 2, in close\n  File \"/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py\", line 119, in _go\n    raise sa_exc.IllegalStateChangeError(\nsqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)\n", "duration_ms": 3.75, "timestamp": "2025-08-28T05:57:01.466415+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 273805, "name": "SpawnProcess-52"}, "thread": {"id": 136034939605120, "name": "MainThread"}, "time": {"repr": "2025-08-28 13:57:01.466466+08:00", "timestamp": 1756360621.466466}}}
{"text": "2025-08-29 02:26:23.173 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 536d50d0-b717-4311-9d3e-722e48588212 | Server error: 500\n", "record": {"elapsed": {"repr": "0:42:48.286860", "seconds": 2568.28686}, "exception": null, "extra": {"request_id": "536d50d0-b717-4311-9d3e-722e48588212", "extra": {"structured_data": {"request_id": "536d50d0-b717-4311-9d3e-722e48588212", "method": "GET", "url": "http://43.167.252.120/api/v1/api-keys/", "path": "/api/v1/api-keys/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.135", "x-forwarded-for": "114.105.192.135", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "content-type": "application/json", "authorization": "[FILTERED]", "accept": "*/*", "referer": "http://43.167.252.120/profile", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.135", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-28T18:26:23.173682+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "40", "content-type": "application/json"}, "duration_ms": 36.88}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 511377, "name": "SpawnProcess-1"}, "thread": {"id": 128275616174208, "name": "MainThread"}, "time": {"repr": "2025-08-29 02:26:23.173717+08:00", "timestamp": 1756405583.173717}}}
{"text": "2025-08-29 18:10:22.938 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 333420c2-8eb0-47e1-9887-3da4a10f6d04 | Server error: 500\n", "record": {"elapsed": {"repr": "16:26:48.051491", "seconds": 59208.051491}, "exception": null, "extra": {"request_id": "333420c2-8eb0-47e1-9887-3da4a10f6d04", "extra": {"structured_data": {"request_id": "333420c2-8eb0-47e1-9887-3da4a10f6d04", "method": "GET", "url": "http://43.167.252.120/api/v1/api-keys/", "path": "/api/v1/api-keys/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.135", "x-forwarded-for": "114.105.192.135", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "content-type": "application/json", "authorization": "[FILTERED]", "accept": "*/*", "referer": "http://43.167.252.120/profile", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.135", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-29T10:10:22.938298+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "40", "content-type": "application/json"}, "duration_ms": 89.39}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 511377, "name": "SpawnProcess-1"}, "thread": {"id": 128275616174208, "name": "MainThread"}, "time": {"repr": "2025-08-29 18:10:22.938348+08:00", "timestamp": 1756462222.938348}}}
{"text": "2025-08-29 18:24:41.919 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 2d766756-030b-41f1-bb70-2ba211e65ba7 | Server error: 500\n", "record": {"elapsed": {"repr": "16:41:07.033105", "seconds": 60067.033105}, "exception": null, "extra": {"request_id": "2d766756-030b-41f1-bb70-2ba211e65ba7", "extra": {"structured_data": {"request_id": "2d766756-030b-41f1-bb70-2ba211e65ba7", "method": "GET", "url": "http://43.167.252.120/api/v1/api-keys/", "path": "/api/v1/api-keys/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "114.105.192.135", "x-forwarded-for": "114.105.192.135", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "content-type": "application/json", "authorization": "[FILTERED]", "accept": "*/*", "referer": "http://43.167.252.120/profile", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7"}, "client_ip": "114.105.192.135", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-29T10:24:41.919943+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "40", "content-type": "application/json"}, "duration_ms": 3.26}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 511377, "name": "SpawnProcess-1"}, "thread": {"id": 128275616174208, "name": "MainThread"}, "time": {"repr": "2025-08-29 18:24:41.919962+08:00", "timestamp": 1756463081.919962}}}
{"text": "2025-08-30 14:56:39.273 | ERROR    | app.middleware.structured_logging:log_request_end:153 | b1bb712c-1225-4839-b681-dda7d94fa80b | Server error: 500\n", "record": {"elapsed": {"repr": "1 day, 13:13:04.386277", "seconds": 133984.386277}, "exception": null, "extra": {"request_id": "b1bb712c-1225-4839-b681-dda7d94fa80b", "extra": {"structured_data": {"request_id": "b1bb712c-1225-4839-b681-dda7d94fa80b", "method": "GET", "url": "http://43.167.252.120/api/v1/api-keys/", "path": "/api/v1/api-keys/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.133", "x-forwarded-for": "208.87.243.133", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "referer": "http://43.167.252.120/profile"}, "client_ip": "208.87.243.133", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-30T06:56:39.273108+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "40", "content-type": "application/json"}, "duration_ms": 6.0}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 511377, "name": "SpawnProcess-1"}, "thread": {"id": 128275616174208, "name": "MainThread"}, "time": {"repr": "2025-08-30 14:56:39.273134+08:00", "timestamp": 1756536999.273134}}}
{"text": "2025-08-30 15:01:07.613 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 789dfae4-e04a-42cf-9be3-30c477b636b8 | Server error: 500\n", "record": {"elapsed": {"repr": "1 day, 13:17:32.726597", "seconds": 134252.726597}, "exception": null, "extra": {"request_id": "789dfae4-e04a-42cf-9be3-30c477b636b8", "extra": {"structured_data": {"request_id": "789dfae4-e04a-42cf-9be3-30c477b636b8", "method": "GET", "url": "http://43.167.252.120/api/v1/api-keys/", "path": "/api/v1/api-keys/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "208.87.243.133", "x-forwarded-for": "208.87.243.133", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "referer": "http://43.167.252.120/profile"}, "client_ip": "208.87.243.133", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-08-30T07:01:07.613433+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "40", "content-type": "application/json"}, "duration_ms": 6.69}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 511377, "name": "SpawnProcess-1"}, "thread": {"id": 128275616174208, "name": "MainThread"}, "time": {"repr": "2025-08-30 15:01:07.613454+08:00", "timestamp": 1756537267.613454}}}
{"text": "2025-08-30 17:46:02.561 | ERROR    | app.middleware.structured_logging:log_request_end:153 | cfac6641-f62c-465b-9413-d6c637401ee7 | Server error: 500\n", "record": {"elapsed": {"repr": "0:12:24.600038", "seconds": 744.600038}, "exception": null, "extra": {"request_id": "cfac6641-f62c-465b-9413-d6c637401ee7", "extra": {"structured_data": {"request_id": "cfac6641-f62c-465b-9413-d6c637401ee7", "method": "GET", "url": "http://43.167.252.120:8001/api/v1/data/storage/stats?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2IiwiZW1haWwiOiJhZG1pbkB0cmFkZW1lLmNvbSIsIm1lbWJlcnNoaXBMZXZlbCI6InByb2Zlc3Npb25hbCIsInR5cGUiOiJhY2Nlc3MiLCJpYXQiOjE3NTY1NDY5NTgsImV4cCI6MTc1NjYzMzM1OCwiYXVkIjoidHJhZGVtZS1hcHAiLCJpc3MiOiJ0cmFkZW1lLXVzZXItc2VydmljZSJ9.pkKyBvqypEE9VK8o0sykSRnIRq0qIPT4ZbCmvyWvOQo", "path": "/api/v1/data/storage/stats", "query_params": {"token": "[FILTERED]"}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T09:46:02.561604+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "144", "content-type": "application/json"}, "duration_ms": 2.48}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1287495, "name": "MainProcess"}, "thread": {"id": 131586550698112, "name": "MainThread"}, "time": {"repr": "2025-08-30 17:46:02.561627+08:00", "timestamp": 1756547162.561627}}}
{"text": "2025-08-30 21:02:35.565 | ERROR    | app.middleware.structured_logging:log_error:184 | 421f60f6-9b38-4008-8620-068876582bc2 | Request failed: NameError: name 'logger' is not defined\n", "record": {"elapsed": {"repr": "0:01:03.966641", "seconds": 63.966641}, "exception": null, "extra": {"request_id": "421f60f6-9b38-4008-8620-068876582bc2", "extra": {"structured_data": {"request_id": "421f60f6-9b38-4008-8620-068876582bc2", "method": "GET", "url": "http://43.167.252.120:8001/api/v1/admin/claude/users-detailed-stats", "path": "/api/v1/admin/claude/users-detailed-stats", "client_ip": "43.167.252.120", "error_type": "NameError", "error_message": "name 'logger' is not defined", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/claude.py\", line 1618, in get_users_detailed_stats\n    logger.error(f\"获取用户详细统计失败: {str(e)}\")\n    ^^^^^^\nNameError: name 'logger' is not defined\n", "duration_ms": 10.7, "timestamp": "2025-08-30T13:02:35.565420+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: NameError: name 'logger' is not defined", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1357611, "name": "MainProcess"}, "thread": {"id": 131444316291200, "name": "MainThread"}, "time": {"repr": "2025-08-30 21:02:35.565473+08:00", "timestamp": 1756558955.565473}}}
{"text": "2025-08-30 21:02:49.211 | ERROR    | app.middleware.structured_logging:log_error:184 | e7fedb65-892e-4685-8f68-343150bd18bd | Request failed: NameError: name 'logger' is not defined\n", "record": {"elapsed": {"repr": "0:01:17.612727", "seconds": 77.612727}, "exception": null, "extra": {"request_id": "e7fedb65-892e-4685-8f68-343150bd18bd", "extra": {"structured_data": {"request_id": "e7fedb65-892e-4685-8f68-343150bd18bd", "method": "GET", "url": "http://43.167.252.120:8001/api/v1/admin/claude/users-detailed-stats", "path": "/api/v1/admin/claude/users-detailed-stats", "client_ip": "43.167.252.120", "error_type": "NameError", "error_message": "name 'logger' is not defined", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/claude.py\", line 1618, in get_users_detailed_stats\n    logger.error(f\"获取用户详细统计失败: {str(e)}\")\n    ^^^^^^\nNameError: name 'logger' is not defined\n", "duration_ms": 3.5, "timestamp": "2025-08-30T13:02:49.211529+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: NameError: name 'logger' is not defined", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1357611, "name": "MainProcess"}, "thread": {"id": 131444316291200, "name": "MainThread"}, "time": {"repr": "2025-08-30 21:02:49.211559+08:00", "timestamp": 1756558969.211559}}}
{"text": "2025-08-30 21:58:12.457 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 8c688227-afec-4616-856b-1a10f0bb951b | Server error: 500\n", "record": {"elapsed": {"repr": "0:54:08.371671", "seconds": 3248.371671}, "exception": null, "extra": {"request_id": "8c688227-afec-4616-856b-1a10f0bb951b", "extra": {"structured_data": {"request_id": "8c688227-afec-4616-856b-1a10f0bb951b", "method": "POST", "url": "http://localhost:8001/api/v1/user-claude-keys/auto-allocate", "path": "/api/v1/user-claude-keys/auto-allocate", "query_params": {}, "headers": {"host": "localhost:8001", "connection": "keep-alive", "content-type": "application/json", "authorization": "[FILTERED]", "user-agent": "Trademe-UserService/1.0", "accept": "*/*", "accept-language": "*", "sec-fetch-mode": "cors", "accept-encoding": "gzip, deflate", "content-length": "14"}, "client_ip": "127.0.0.1", "user_agent": "Trademe-UserService/1.0", "timestamp": "2025-08-30T13:58:12.457636+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 24.0}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1358704, "name": "MainProcess"}, "thread": {"id": 128303100752000, "name": "MainThread"}, "time": {"repr": "2025-08-30 21:58:12.457672+08:00", "timestamp": 1756562292.457672}}}
{"text": "2025-08-30 22:01:15.515 | ERROR    | app.middleware.structured_logging:log_request_end:153 | ac9803c2-84ff-4757-9d0e-8f4f1580f9c4 | Server error: 500\n", "record": {"elapsed": {"repr": "0:57:11.429936", "seconds": 3431.429936}, "exception": null, "extra": {"request_id": "ac9803c2-84ff-4757-9d0e-8f4f1580f9c4", "extra": {"structured_data": {"request_id": "ac9803c2-84ff-4757-9d0e-8f4f1580f9c4", "method": "POST", "url": "http://localhost:8001/api/v1/user-claude-keys/auto-allocate", "path": "/api/v1/user-claude-keys/auto-allocate", "query_params": {}, "headers": {"host": "localhost:8001", "connection": "keep-alive", "content-type": "application/json", "authorization": "[FILTERED]", "user-agent": "Trademe-UserService/1.0", "accept": "*/*", "accept-language": "*", "sec-fetch-mode": "cors", "accept-encoding": "gzip, deflate", "content-length": "14"}, "client_ip": "127.0.0.1", "user_agent": "Trademe-UserService/1.0", "timestamp": "2025-08-30T14:01:15.515901+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "74", "content-type": "application/json"}, "duration_ms": 7.61}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1358704, "name": "MainProcess"}, "thread": {"id": 128303100752000, "name": "MainThread"}, "time": {"repr": "2025-08-30 22:01:15.515937+08:00", "timestamp": 1756562475.515937}}}
{"text": "2025-08-30 22:06:37.560 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 15aa2ef4-6055-40d6-88d6-75b9fb5fa2ff | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:52.542892", "seconds": 52.542892}, "exception": null, "extra": {"request_id": "15aa2ef4-6055-40d6-88d6-75b9fb5fa2ff", "extra": {"structured_data": {"request_id": "15aa2ef4-6055-40d6-88d6-75b9fb5fa2ff", "method": "POST", "url": "http://43.167.252.120:8001/api/v1/user-wallets/admin/user/16/allocate", "path": "/api/v1/user-wallets/admin/user/16/allocate", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "2"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T14:06:37.560743+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "73", "content-type": "application/json"}, "duration_ms": 1.92}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 22:06:37.560770+08:00", "timestamp": 1756562797.56077}}}
{"text": "2025-08-30 22:08:09.196 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 9dbc14ca-9434-4892-baf0-91fd8914da1c | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:24.179119", "seconds": 144.179119}, "exception": null, "extra": {"request_id": "9dbc14ca-9434-4892-baf0-91fd8914da1c", "extra": {"structured_data": {"request_id": "9dbc14ca-9434-4892-baf0-91fd8914da1c", "method": "POST", "url": "http://43.167.252.120:8001/api/v1/user-wallets/admin/user/16/allocate", "path": "/api/v1/user-wallets/admin/user/16/allocate", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "2"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T14:08:09.196966+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "73", "content-type": "application/json"}, "duration_ms": 1.83}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 22:08:09.196997+08:00", "timestamp": 1756562889.196997}}}
{"text": "2025-08-30 22:11:28.870 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6bbaeb22-148d-4d05-9a55-bbfbfc7ba516 | Server error: 500\n", "record": {"elapsed": {"repr": "0:05:43.852254", "seconds": 343.852254}, "exception": null, "extra": {"request_id": "6bbaeb22-148d-4d05-9a55-bbfbfc7ba516", "extra": {"structured_data": {"request_id": "6bbaeb22-148d-4d05-9a55-bbfbfc7ba516", "method": "POST", "url": "http://43.167.252.120:8001/api/v1/user-wallets/admin/user/16/allocate", "path": "/api/v1/user-wallets/admin/user/16/allocate", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "2"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T14:11:28.870103+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "73", "content-type": "application/json"}, "duration_ms": 1.88}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 22:11:28.870132+08:00", "timestamp": 1756563088.870132}}}
{"text": "2025-08-30 22:13:42.506 | ERROR    | app.middleware.structured_logging:log_request_end:153 | be6aadb2-5de4-4498-9548-89230d362ef0 | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:57.488719", "seconds": 477.488719}, "exception": null, "extra": {"request_id": "be6aadb2-5de4-4498-9548-89230d362ef0", "extra": {"structured_data": {"request_id": "be6aadb2-5de4-4498-9548-89230d362ef0", "method": "POST", "url": "http://43.167.252.120:8001/api/v1/user-wallets/admin/user/15/allocate", "path": "/api/v1/user-wallets/admin/user/15/allocate", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "2"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T14:13:42.506569+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "73", "content-type": "application/json"}, "duration_ms": 1.55}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 22:13:42.506597+08:00", "timestamp": 1756563222.506597}}}
{"text": "2025-08-30 22:18:17.125 | ERROR    | app.middleware.structured_logging:log_error:184 | b4fe5f63-9c6c-401f-b386-a7649901023d | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:12:32.107336", "seconds": 752.107336}, "exception": null, "extra": {"request_id": "b4fe5f63-9c6c-401f-b386-a7649901023d", "extra": {"structured_data": {"request_id": "b4fe5f63-9c6c-401f-b386-a7649901023d", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/usdt-wallets/?page=1&limit=20", "path": "/api/v1/admin/usdt-wallets/", "client_ip": "208.87.243.133", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/usdt_wallets.py\", line 200, in get_wallets\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 4.74, "timestamp": "2025-08-30T14:18:17.125181+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 22:18:17.125214+08:00", "timestamp": 1756563497.125214}}}
{"text": "2025-08-30 23:30:23.723 | ERROR    | app.middleware.structured_logging:log_error:184 | 7fcbf33c-7948-45bd-95f6-ba054de3e6e3 | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "1:24:38.705322", "seconds": 5078.705322}, "exception": null, "extra": {"request_id": "7fcbf33c-7948-45bd-95f6-ba054de3e6e3", "extra": {"structured_data": {"request_id": "7fcbf33c-7948-45bd-95f6-ba054de3e6e3", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/usdt-wallets/?page=1&limit=20", "path": "/api/v1/admin/usdt-wallets/", "client_ip": "114.105.192.135", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/usdt_wallets.py\", line 200, in get_wallets\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 4.92, "timestamp": "2025-08-30T15:30:23.723168+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 23:30:23.723200+08:00", "timestamp": 1756567823.7232}}}
{"text": "2025-08-30 23:39:30.099 | ERROR    | app.middleware.structured_logging:log_error:184 | 925fe22f-f5c7-4839-a18a-029c177f4cc1 | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "1:33:45.081469", "seconds": 5625.081469}, "exception": null, "extra": {"request_id": "925fe22f-f5c7-4839-a18a-029c177f4cc1", "extra": {"structured_data": {"request_id": "925fe22f-f5c7-4839-a18a-029c177f4cc1", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/usdt-wallets/?page=1&limit=20", "path": "/api/v1/admin/usdt-wallets/", "client_ip": "114.105.192.135", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/usdt_wallets.py\", line 200, in get_wallets\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 5.19, "timestamp": "2025-08-30T15:39:30.099305+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 23:39:30.099347+08:00", "timestamp": 1756568370.099347}}}
{"text": "2025-08-30 23:40:04.061 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 2401b466-8732-44a3-a581-cb127a85c4d9 | Server error: 500\n", "record": {"elapsed": {"repr": "1:34:19.043629", "seconds": 5659.043629}, "exception": null, "extra": {"request_id": "2401b466-8732-44a3-a581-cb127a85c4d9", "extra": {"structured_data": {"request_id": "2401b466-8732-44a3-a581-cb127a85c4d9", "method": "GET", "url": "http://43.167.252.120:8001/api/v1/user-wallets/admin/overview", "path": "/api/v1/user-wallets/admin/overview", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T15:40:04.061479+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "85", "content-type": "application/json"}, "duration_ms": 1.95}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 23:40:04.061507+08:00", "timestamp": 1756568404.061507}}}
{"text": "2025-08-30 23:41:30.601 | ERROR    | app.middleware.structured_logging:log_request_end:153 | a34054ae-911e-4baa-a450-08a8a023f5f6 | Server error: 500\n", "record": {"elapsed": {"repr": "1:35:45.584098", "seconds": 5745.584098}, "exception": null, "extra": {"request_id": "a34054ae-911e-4baa-a450-08a8a023f5f6", "extra": {"structured_data": {"request_id": "a34054ae-911e-4baa-a450-08a8a023f5f6", "method": "GET", "url": "http://43.167.252.120:8001/api/v1/user-wallets/admin/overview", "path": "/api/v1/user-wallets/admin/overview", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T15:41:30.601954+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "85", "content-type": "application/json"}, "duration_ms": 1.38}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 23:41:30.601976+08:00", "timestamp": 1756568490.601976}}}
{"text": "2025-08-30 23:42:56.019 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 003732d4-5419-4516-b493-e29ac7f51aee | Server error: 500\n", "record": {"elapsed": {"repr": "1:37:11.001743", "seconds": 5831.001743}, "exception": null, "extra": {"request_id": "003732d4-5419-4516-b493-e29ac7f51aee", "extra": {"structured_data": {"request_id": "003732d4-5419-4516-b493-e29ac7f51aee", "method": "GET", "url": "http://43.167.252.120:8001/api/v1/user-wallets/admin/overview", "path": "/api/v1/user-wallets/admin/overview", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T15:42:56.019590+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "85", "content-type": "application/json"}, "duration_ms": 1.86}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1380472, "name": "MainProcess"}, "thread": {"id": 124375261380736, "name": "MainThread"}, "time": {"repr": "2025-08-30 23:42:56.019621+08:00", "timestamp": 1756568576.019621}}}
{"text": "2025-08-31 00:16:09.404 | ERROR    | app.middleware.structured_logging:log_error:184 | dd87bb07-7a64-456d-b692-1c775273c8d9 | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:00:12.089918", "seconds": 12.089918}, "exception": null, "extra": {"request_id": "dd87bb07-7a64-456d-b692-1c775273c8d9", "extra": {"structured_data": {"request_id": "dd87bb07-7a64-456d-b692-1c775273c8d9", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/usdt-wallets/?page=1&limit=20", "path": "/api/v1/admin/usdt-wallets/", "client_ip": "114.105.192.135", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/usdt_wallets.py\", line 200, in get_wallets\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 7.62, "timestamp": "2025-08-30T16:16:09.404825+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1427629, "name": "SpawnProcess-1"}, "thread": {"id": 132429897339008, "name": "MainThread"}, "time": {"repr": "2025-08-31 00:16:09.404861+08:00", "timestamp": 1756570569.404861}}}
{"text": "2025-08-31 00:17:34.548 | ERROR    | app.middleware.structured_logging:log_error:184 | f1a08a20-501a-44e2-a7b9-454df6ce55b6 | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:00:44.511295", "seconds": 44.511295}, "exception": null, "extra": {"request_id": "f1a08a20-501a-44e2-a7b9-454df6ce55b6", "extra": {"structured_data": {"request_id": "f1a08a20-501a-44e2-a7b9-454df6ce55b6", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/usdt-wallets/?page=1&limit=20", "path": "/api/v1/admin/usdt-wallets/", "client_ip": "114.105.192.135", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/usdt_wallets.py\", line 200, in get_wallets\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 18.08, "timestamp": "2025-08-30T16:17:34.548021+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1428002, "name": "SpawnProcess-3"}, "thread": {"id": 124030815133824, "name": "MainThread"}, "time": {"repr": "2025-08-31 00:17:34.548059+08:00", "timestamp": 1756570654.548059}}}
{"text": "2025-08-31 00:18:15.268 | ERROR    | app.middleware.structured_logging:log_error:184 | ff92bd98-c154-40a3-a0ff-9dc3f46cff56 | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:01:25.231284", "seconds": 85.231284}, "exception": null, "extra": {"request_id": "ff92bd98-c154-40a3-a0ff-9dc3f46cff56", "extra": {"structured_data": {"request_id": "ff92bd98-c154-40a3-a0ff-9dc3f46cff56", "method": "GET", "url": "http://43.167.252.120:8001/api/v1/admin/usdt-wallets/?page=1&limit=20", "path": "/api/v1/admin/usdt-wallets/", "client_ip": "43.167.252.120", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/usdt_wallets.py\", line 200, in get_wallets\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 7.72, "timestamp": "2025-08-30T16:18:15.268008+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1428002, "name": "SpawnProcess-3"}, "thread": {"id": 124030815133824, "name": "MainThread"}, "time": {"repr": "2025-08-31 00:18:15.268048+08:00", "timestamp": 1756570695.268048}}}
{"text": "2025-08-31 00:18:18.215 | ERROR    | app.middleware.structured_logging:log_error:184 | 1720e8a9-2ef3-4170-ad8b-8266c70ac8ab | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:01:28.179169", "seconds": 88.179169}, "exception": null, "extra": {"request_id": "1720e8a9-2ef3-4170-ad8b-8266c70ac8ab", "extra": {"structured_data": {"request_id": "1720e8a9-2ef3-4170-ad8b-8266c70ac8ab", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/usdt-wallets/?page=1&limit=20", "path": "/api/v1/admin/usdt-wallets/", "client_ip": "114.105.192.135", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/usdt_wallets.py\", line 200, in get_wallets\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 4.71, "timestamp": "2025-08-30T16:18:18.215904+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1428002, "name": "SpawnProcess-3"}, "thread": {"id": 124030815133824, "name": "MainThread"}, "time": {"repr": "2025-08-31 00:18:18.215933+08:00", "timestamp": 1756570698.215933}}}
{"text": "2025-08-31 00:25:07.961 | ERROR    | app.middleware.structured_logging:log_error:184 | 838be2d4-4c9f-460b-9b6d-16a5771b243f | Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "record": {"elapsed": {"repr": "0:08:17.924836", "seconds": 497.924836}, "exception": null, "extra": {"request_id": "838be2d4-4c9f-460b-9b6d-16a5771b243f", "extra": {"structured_data": {"request_id": "838be2d4-4c9f-460b-9b6d-16a5771b243f", "method": "GET", "url": "http://43.167.252.120/api/v1/admin/usdt-wallets/?page=1&limit=20", "path": "/api/v1/admin/usdt-wallets/", "client_ip": "43.167.252.120", "error_type": "AttributeError", "error_message": "'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "traceback": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 151, in call_next\n    message = await recv_stream.receive()\n              ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/anyio/streams/memory.py\", line 126, in receive\n    raise EndOfStream from None\nanyio.EndOfStream\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/root/trademe/backend/trading-service/app/middleware/structured_logging.py\", line 259, in structured_logging_middleware\n    response = await call_next(request)\n               ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 159, in call_next\n    raise app_exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py\", line 144, in coro\n    await self.app(scope, receive_or_disconnect, send_no_error)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/cors.py\", line 85, in __call__\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/middleware/exceptions.py\", line 63, in __call__\n    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 716, in __call__\n    await self.middleware_stack(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 736, in app\n    await route.handle(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 290, in handle\n    await self.app(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 78, in app\n    await wrap_app_handling_exceptions(app, request)(scope, receive, send)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 53, in wrapped_app\n    raise exc\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/_exception_handler.py\", line 42, in wrapped_app\n    await app(scope, receive, sender)\n  File \"/usr/local/lib/python3.12/dist-packages/starlette/routing.py\", line 75, in app\n    response = await f(request)\n               ^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 302, in app\n    raw_response = await run_endpoint_function(\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/dist-packages/fastapi/routing.py\", line 213, in run_endpoint_function\n    return await dependant.call(**values)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/root/trademe/backend/trading-service/app/api/v1/admin/usdt_wallets.py\", line 200, in get_wallets\n    status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nAttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n", "duration_ms": 49.73, "timestamp": "2025-08-30T16:25:07.961541+00:00", "event_type": "request_error"}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_error", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 184, "message": "Request failed: AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1428002, "name": "SpawnProcess-3"}, "thread": {"id": 124030815133824, "name": "MainThread"}, "time": {"repr": "2025-08-31 00:25:07.961600+08:00", "timestamp": 1756571107.9616}}}
{"text": "2025-08-31 00:29:57.285 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 2817f9db-f450-4ecd-aaa3-5b18c14ead55 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:07.171172", "seconds": 7.171172}, "exception": null, "extra": {"request_id": "2817f9db-f450-4ecd-aaa3-5b18c14ead55", "extra": {"structured_data": {"request_id": "2817f9db-f450-4ecd-aaa3-5b18c14ead55", "method": "GET", "url": "http://43.167.252.120/api/v1/data/storage/stats", "path": "/api/v1/data/storage/stats", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "43.167.252.120", "x-forwarded-for": "43.167.252.120", "x-forwarded-proto": "http", "connection": "close", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T16:29:57.285722+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "144", "content-type": "application/json"}, "duration_ms": 2.58}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1432756, "name": "SpawnProcess-5"}, "thread": {"id": 139809218670720, "name": "MainThread"}, "time": {"repr": "2025-08-31 00:29:57.285752+08:00", "timestamp": 1756571397.285752}}}
{"text": "2025-08-31 00:30:29.738 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 1b5b726f-f896-4d11-a869-8a3e956c628d | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:13.951340", "seconds": 13.95134}, "exception": null, "extra": {"request_id": "1b5b726f-f896-4d11-a869-8a3e956c628d", "extra": {"structured_data": {"request_id": "1b5b726f-f896-4d11-a869-8a3e956c628d", "method": "GET", "url": "http://43.167.252.120/api/v1/data/storage/stats", "path": "/api/v1/data/storage/stats", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "43.167.252.120", "x-forwarded-for": "43.167.252.120", "x-forwarded-proto": "http", "connection": "close", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-08-30T16:30:29.738422+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "389", "content-type": "application/json"}, "duration_ms": 7.37}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 1432958, "name": "SpawnProcess-7"}, "thread": {"id": 129408353284224, "name": "MainThread"}, "time": {"repr": "2025-08-31 00:30:29.738458+08:00", "timestamp": 1756571429.738458}}}
{"text": "2025-09-01 10:50:59.801 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 979dd6a8-6f36-4254-b000-4693d3b6eb2e | Server error: 500\n", "record": {"elapsed": {"repr": "10:09:04.833005", "seconds": 36544.833005}, "exception": null, "extra": {"request_id": "979dd6a8-6f36-4254-b000-4693d3b6eb2e", "extra": {"structured_data": {"request_id": "979dd6a8-6f36-4254-b000-4693d3b6eb2e", "method": "GET", "url": "http://43.167.252.120:8001/api/v1/data/data/timeframes?symbol=BTC-USDT-SWAP&exchange=okx", "path": "/api/v1/data/data/timeframes", "query_params": {"symbol": "BTC-USDT-SWAP", "exchange": "okx"}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-09-01T02:50:59.801482+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "54", "content-type": "application/json"}, "duration_ms": 5.68}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2022039, "name": "SpawnProcess-39"}, "thread": {"id": 124540187795584, "name": "MainThread"}, "time": {"repr": "2025-09-01 10:50:59.801509+08:00", "timestamp": 1756695059.801509}}}
{"text": "2025-09-01 11:25:34.535 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d8b1f9a8-f0f9-4b21-b44b-a5f005390549 | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:14.069661", "seconds": 134.069661}, "exception": null, "extra": {"request_id": "d8b1f9a8-f0f9-4b21-b44b-a5f005390549", "extra": {"structured_data": {"request_id": "d8b1f9a8-f0f9-4b21-b44b-a5f005390549", "method": "POST", "url": "http://43.167.252.120:8001/api/v1/data/okx/quality/check", "path": "/api/v1/data/okx/quality/check", "query_params": {}, "headers": {"host": "43.167.252.120:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]", "content-length": "107"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-09-01T03:25:34.535714+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "41", "content-type": "application/json"}, "duration_ms": 16.18}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2226225, "name": "SpawnProcess-1"}, "thread": {"id": 132363249299584, "name": "MainThread"}, "time": {"repr": "2025-09-01 11:25:34.535749+08:00", "timestamp": 1756697134.535749}}}
{"text": "2025-09-01 23:00:01.259 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 6b8ab7c3-1db5-4b40-a202-fae8e5369f04 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:51.991617", "seconds": 111.991617}, "exception": null, "extra": {"request_id": "6b8ab7c3-1db5-4b40-a202-fae8e5369f04", "extra": {"structured_data": {"request_id": "6b8ab7c3-1db5-4b40-a202-fae8e5369f04", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "43.167.252.120", "x-forwarded-for": "43.167.252.120", "x-forwarded-proto": "http", "connection": "close", "content-length": "99", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-09-01T15:00:01.259933+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "194", "content-type": "application/json"}, "duration_ms": 5.54}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2476532, "name": "MainProcess"}, "thread": {"id": 139313218990208, "name": "MainThread"}, "time": {"repr": "2025-09-01 23:00:01.259969+08:00", "timestamp": 1756738801.259969}}}
{"text": "2025-09-01 23:01:19.539 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 57fce01d-d532-47f1-8a24-963c8e9cf698 | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:10.271611", "seconds": 190.271611}, "exception": null, "extra": {"request_id": "57fce01d-d532-47f1-8a24-963c8e9cf698", "extra": {"structured_data": {"request_id": "57fce01d-d532-47f1-8a24-963c8e9cf698", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "43.167.252.120", "x-forwarded-for": "43.167.252.120", "x-forwarded-proto": "http", "connection": "close", "content-length": "99", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-09-01T15:01:19.539942+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "194", "content-type": "application/json"}, "duration_ms": 2.84}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2476532, "name": "MainProcess"}, "thread": {"id": 139313218990208, "name": "MainThread"}, "time": {"repr": "2025-09-01 23:01:19.539963+08:00", "timestamp": 1756738879.539963}}}
{"text": "2025-09-01 23:02:20.588 | ERROR    | app.middleware.structured_logging:log_request_end:153 | d7d3b642-c3eb-4974-b478-dffdb7face5d | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:37.509038", "seconds": 37.509038}, "exception": null, "extra": {"request_id": "d7d3b642-c3eb-4974-b478-dffdb7face5d", "extra": {"structured_data": {"request_id": "d7d3b642-c3eb-4974-b478-dffdb7face5d", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "43.167.252.120", "x-forwarded-for": "43.167.252.120", "x-forwarded-proto": "http", "connection": "close", "content-length": "99", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-09-01T15:02:20.588852+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "101", "content-type": "application/json"}, "duration_ms": 9.54}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2477879, "name": "MainProcess"}, "thread": {"id": 135465291509888, "name": "MainThread"}, "time": {"repr": "2025-09-01 23:02:20.588886+08:00", "timestamp": 1756738940.588886}}}
{"text": "2025-09-01 23:02:48.380 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 14bbe32c-bc80-4ea5-b780-7c81788b4aae | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:05.301011", "seconds": 65.301011}, "exception": null, "extra": {"request_id": "14bbe32c-bc80-4ea5-b780-7c81788b4aae", "extra": {"structured_data": {"request_id": "14bbe32c-bc80-4ea5-b780-7c81788b4aae", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "43.167.252.120", "x-forwarded-for": "43.167.252.120", "x-forwarded-proto": "http", "connection": "close", "content-length": "43", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-09-01T15:02:48.380838+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "101", "content-type": "application/json"}, "duration_ms": 2.04}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2477879, "name": "MainProcess"}, "thread": {"id": 135465291509888, "name": "MainThread"}, "time": {"repr": "2025-09-01 23:02:48.380859+08:00", "timestamp": 1756738968.380859}}}
{"text": "2025-09-01 23:04:13.991 | ERROR    | app.middleware.structured_logging:log_request_end:153 | 3c420af6-dfa0-4388-b9b4-decbae7aaaa1 | Server error: 500\n", "record": {"elapsed": {"repr": "0:02:30.912098", "seconds": 150.912098}, "exception": null, "extra": {"request_id": "3c420af6-dfa0-4388-b9b4-decbae7aaaa1", "extra": {"structured_data": {"request_id": "3c420af6-dfa0-4388-b9b4-decbae7aaaa1", "method": "POST", "url": "http://43.167.252.120/api/v1/ai/chat", "path": "/api/v1/ai/chat", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "43.167.252.120", "x-forwarded-for": "43.167.252.120", "x-forwarded-proto": "http", "connection": "close", "content-length": "43", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "[FILTERED]"}, "client_ip": "43.167.252.120", "user_agent": "curl/8.5.0", "timestamp": "2025-09-01T15:04:13.991919+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "101", "content-type": "application/json"}, "duration_ms": 2.03}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 153, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2477879, "name": "MainProcess"}, "thread": {"id": 135465291509888, "name": "MainThread"}, "time": {"repr": "2025-09-01 23:04:13.991946+08:00", "timestamp": 1756739053.991946}}}
{"text": "2025-09-01 23:57:23.588 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 15:57:23 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785f5d1f84a25e6</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:07:06.501515", "seconds": 426.501515}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 15:57:23 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785f5d1f84a25e6</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-01 23:57:23.588474+08:00", "timestamp": 1756742243.588474}}}
{"text": "2025-09-01 23:57:55.061 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 15:57:55 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785f6969d65d76c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:07:37.974833", "seconds": 457.974833}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 15:57:55 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785f6969d65d76c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-01 23:57:55.061792+08:00", "timestamp": 1756742275.061792}}}
{"text": "2025-09-01 23:58:58.932 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 15:58:58 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785f825e97ee365</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:08:41.845776", "seconds": 521.845776}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 15:58:58 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785f825e97ee365</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-01 23:58:58.932735+08:00", "timestamp": 1756742338.932735}}}
{"text": "2025-09-01 23:59:30.811 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 15:59:30 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785f8ed0af18d23</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:09:13.724047", "seconds": 553.724047}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 15:59:30 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785f8ed0af18d23</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-01 23:59:30.811006+08:00", "timestamp": 1756742370.811006}}}
{"text": "2025-09-02 00:00:34.257 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:00:34 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785fa792f46af2a</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:10:17.170290", "seconds": 617.17029}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:00:34 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785fa792f46af2a</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:00:34.257249+08:00", "timestamp": 1756742434.257249}}}
{"text": "2025-09-02 00:01:05.994 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:01:05 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785fb3fdacde07e</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:10:48.907385", "seconds": 648.907385}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:01:05 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785fb3fdacde07e</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:01:05.994344+08:00", "timestamp": 1756742465.994344}}}
{"text": "2025-09-02 00:02:09.581 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:02:09 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785fccd493b8385</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:11:52.494311", "seconds": 712.494311}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:02:09 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785fccd493b8385</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:02:09.581270+08:00", "timestamp": 1756742529.58127}}}
{"text": "2025-09-02 00:02:09.582 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "0:11:52.495101", "seconds": 712.495101}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:02:09.582060+08:00", "timestamp": 1756742529.58206}}}
{"text": "2025-09-02 00:02:41.480 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:02:41 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785fd94bbedded7</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:12:24.393519", "seconds": 744.393519}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:02:41 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9785fd94bbedded7</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:02:41.480478+08:00", "timestamp": 1756742561.480478}}}
{"text": "2025-09-02 00:02:41.481 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "0:12:24.394280", "seconds": 744.39428}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:02:41.481239+08:00", "timestamp": 1756742561.481239}}}
{"text": "2025-09-02 00:06:03.713 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:06:03 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">97860284bf24978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:15:46.626887", "seconds": 946.626887}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:06:03 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">97860284bf24978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:06:03.713846+08:00", "timestamp": 1756742763.713846}}}
{"text": "2025-09-02 00:06:36.151 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:06:36 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9786034f7c23262d</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:16:19.064753", "seconds": 979.064753}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:06:36 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9786034f7c23262d</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:06:36.151712+08:00", "timestamp": 1756742796.151712}}}
{"text": "2025-09-02 00:07:38.765 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:07:38 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978604d6c9a7978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:17:21.678701", "seconds": 1041.678701}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:07:38 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978604d6c9a7978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:07:38.765660+08:00", "timestamp": 1756742858.76566}}}
{"text": "2025-09-02 00:08:11.484 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:08:11 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978605a35b01262d</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:17:54.397561", "seconds": 1074.397561}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:08:11 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978605a35b01262d</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:08:11.484520+08:00", "timestamp": 1756742891.48452}}}
{"text": "2025-09-02 00:09:13.515 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:09:13 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978607270eed978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:18:56.428951", "seconds": 1136.428951}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:09:13 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978607270eed978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:09:13.515910+08:00", "timestamp": 1756742953.51591}}}
{"text": "2025-09-02 00:09:46.450 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:09:46 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978607f4d908262d</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:19:29.363168", "seconds": 1169.363168}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:09:46 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978607f4d908262d</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:09:46.450127+08:00", "timestamp": 1756742986.450127}}}
{"text": "2025-09-02 00:10:48.546 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:10:48 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">97860978e8de978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:20:31.459258", "seconds": 1231.459258}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:10:48 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">97860978e8de978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:10:48.546217+08:00", "timestamp": 1756743048.546217}}}
{"text": "2025-09-02 00:10:48.548 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "0:20:31.461804", "seconds": 1231.461804}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:10:48.548763+08:00", "timestamp": 1756743048.548763}}}
{"text": "2025-09-02 00:11:21.406 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:11:21 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">97860a4648ae978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:21:04.319828", "seconds": 1264.319828}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-01 16:11:21 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">97860a4648ae978f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:11:21.406787+08:00", "timestamp": 1756743081.406787}}}
{"text": "2025-09-02 00:11:21.407 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "0:21:04.320782", "seconds": 1264.320782}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 00:11:21.407741+08:00", "timestamp": 1756743081.407741}}}
{"text": "2025-09-02 11:24:20.903 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:24:20 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e41a2926d3fd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:34:03.816772", "seconds": 41643.816772}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:24:20 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e41a2926d3fd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:24:20.903731+08:00", "timestamp": 1756783460.903731}}}
{"text": "2025-09-02 11:24:51.450 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:24:51 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e4d91dddd3de</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:34:34.363160", "seconds": 41674.36316}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:24:51 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e4d91dddd3de</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:24:51.450119+08:00", "timestamp": 1756783491.450119}}}
{"text": "2025-09-02 11:25:56.102 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:25:56 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e66d2a8ed3fd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:35:39.015062", "seconds": 41739.015062}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:25:56 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e66d2a8ed3fd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:25:56.102021+08:00", "timestamp": 1756783556.102021}}}
{"text": "2025-09-02 11:26:26.753 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:26:26 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e72caa87d3de</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:36:09.666923", "seconds": 41769.666923}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:26:26 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e72caa87d3de</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:26:26.753882+08:00", "timestamp": 1756783586.753882}}}
{"text": "2025-09-02 11:27:31.317 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:27:31 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e8c02cded3fd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:37:14.230874", "seconds": 41834.230874}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:27:31 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e8c02cded3fd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:27:31.317833+08:00", "timestamp": 1756783651.317833}}}
{"text": "2025-09-02 11:28:01.788 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:28:01 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e97ebce2d3de</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:37:44.701383", "seconds": 41864.701383}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:28:01 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789e97ebce2d3de</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:28:01.788342+08:00", "timestamp": 1756783681.788342}}}
{"text": "2025-09-02 11:29:06.356 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:29:06 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789eb123ad1d3fd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:38:49.269727", "seconds": 41929.269727}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:29:06 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789eb123ad1d3fd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:29:06.356686+08:00", "timestamp": 1756783746.356686}}}
{"text": "2025-09-02 11:29:06.357 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "11:38:49.270778", "seconds": 41929.270778}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:29:06.357737+08:00", "timestamp": 1756783746.357737}}}
{"text": "2025-09-02 11:29:36.919 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:29:36 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789ebd11bded3de</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:39:19.832278", "seconds": 41959.832278}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:29:36 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789ebd11bded3de</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:29:36.919237+08:00", "timestamp": 1756783776.919237}}}
{"text": "2025-09-02 11:29:36.920 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "11:39:19.833261", "seconds": 41959.833261}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:29:36.920220+08:00", "timestamp": 1756783776.92022}}}
{"text": "2025-09-02 11:35:45.883 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:35:45 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789f4d2cbbde8bd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:45:28.796406", "seconds": 42328.796406}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:35:45 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789f4d2cbbde8bd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:35:45.883365+08:00", "timestamp": 1756784145.883365}}}
{"text": "2025-09-02 11:36:16.402 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:36:16 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789f59198f303df</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:45:59.315406", "seconds": 42359.315406}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:36:16 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789f59198f303df</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:36:16.402365+08:00", "timestamp": 1756784176.402365}}}
{"text": "2025-09-02 11:37:21.175 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:37:21 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789f7264861e8bd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:47:04.088742", "seconds": 42424.088742}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:37:21 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789f7264861e8bd</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:37:21.175701+08:00", "timestamp": 1756784241.175701}}}
{"text": "2025-09-02 11:38:56.880 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:38:56 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789f97c9ea403df</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:48:39.794018", "seconds": 42519.794018}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:38:56 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789f97c9ea403df</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:38:56.880977+08:00", "timestamp": 1756784336.880977}}}
{"text": "2025-09-02 11:40:32.119 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:40:32 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789fbcfbd1c03df</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:50:15.032863", "seconds": 42615.032863}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:40:32 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789fbcfbd1c03df</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:40:32.119822+08:00", "timestamp": 1756784432.119822}}}
{"text": "2025-09-02 11:40:32.120 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "11:50:15.033678", "seconds": 42615.033678}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:40:32.120637+08:00", "timestamp": 1756784432.120637}}}
{"text": "2025-09-02 11:42:00.560 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:42:00 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789fdf5bc2685af</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:51:43.473570", "seconds": 42703.47357}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:42:00 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789fdf5bc2685af</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:42:00.560529+08:00", "timestamp": 1756784520.560529}}}
{"text": "2025-09-02 11:42:48.913 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:42:48 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789ff222f680703</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:52:31.826454", "seconds": 42751.826454}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:42:48 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">9789ff222f680703</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:42:48.913413+08:00", "timestamp": 1756784568.913413}}}
{"text": "2025-09-02 11:43:36.663 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:43:36 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a00513b36da02</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:53:19.576975", "seconds": 42799.576975}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:43:36 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a00513b36da02</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:43:36.663934+08:00", "timestamp": 1756784616.663934}}}
{"text": "2025-09-02 11:44:14.542 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:44:14 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a013def7d0893</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:53:57.455727", "seconds": 42837.455727}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:44:14 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a013def7d0893</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:44:14.542686+08:00", "timestamp": 1756784654.542686}}}
{"text": "2025-09-02 11:44:24.953 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:44:24 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a017eee7b20e8</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:54:07.866165", "seconds": 42847.866165}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:44:24 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a017eee7b20e8</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:44:24.953124+08:00", "timestamp": 1756784664.953124}}}
{"text": "2025-09-02 11:45:12.482 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:45:12 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a02a7fb785158</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:54:55.396005", "seconds": 42895.396005}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:45:12 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a02a7fb785158</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:45:12.482964+08:00", "timestamp": 1756784712.482964}}}
{"text": "2025-09-02 11:45:49.895 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:45:49 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0391e85003b3</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:55:32.808196", "seconds": 42932.808196}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:45:49 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0391e85003b3</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:45:49.895155+08:00", "timestamp": 1756784749.895155}}}
{"text": "2025-09-02 11:46:02.135 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:46:02 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a03dd7c4e853b</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:55:45.048704", "seconds": 42945.048704}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:46:02 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a03dd7c4e853b</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:46:02.135663+08:00", "timestamp": 1756784762.135663}}}
{"text": "2025-09-02 11:46:50.155 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:46:50 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0509c9f4861c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:56:33.068578", "seconds": 42993.068578}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:46:50 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0509c9f4861c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:46:50.155537+08:00", "timestamp": 1756784810.155537}}}
{"text": "2025-09-02 11:46:50.157 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "11:56:33.070413", "seconds": 42993.070413}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:46:50.157372+08:00", "timestamp": 1756784810.157372}}}
{"text": "2025-09-02 11:47:25.584 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:47:25 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a05e7fce1039f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:57:08.497345", "seconds": 43028.497345}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:47:25 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a05e7fce1039f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:47:25.584304+08:00", "timestamp": 1756784845.584304}}}
{"text": "2025-09-02 11:47:37.904 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:47:37 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0634f85d85e6</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:57:20.817678", "seconds": 43040.817678}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:47:37 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0634f85d85e6</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:47:37.904637+08:00", "timestamp": 1756784857.904637}}}
{"text": "2025-09-02 11:47:37.906 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "11:57:20.819195", "seconds": 43040.819195}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:47:37.906154+08:00", "timestamp": 1756784857.906154}}}
{"text": "2025-09-02 11:48:43.777 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:48:43 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a07d0ae245dec</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:58:26.690768", "seconds": 43106.690768}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:48:43 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a07d0ae245dec</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:48:43.777727+08:00", "timestamp": 1756784923.777727}}}
{"text": "2025-09-02 11:49:01.405 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:49:01 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a083edfecc6b8</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:58:44.318604", "seconds": 43124.318604}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:49:01 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a083edfecc6b8</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:49:01.405563+08:00", "timestamp": 1756784941.405563}}}
{"text": "2025-09-02 11:49:01.409 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "11:58:44.322886", "seconds": 43124.322886}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:49:01.409845+08:00", "timestamp": 1756784941.409845}}}
{"text": "2025-09-02 11:49:31.072 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:49:31 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a08f84ea285ed</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "11:59:13.985698", "seconds": 43153.985698}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:49:31 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a08f84ea285ed</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:49:31.072657+08:00", "timestamp": 1756784971.072657}}}
{"text": "2025-09-02 11:50:19.970 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:50:19 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0a29df3a0968</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "12:00:02.884010", "seconds": 43202.88401}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:50:19 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0a29df3a0968</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:50:19.970969+08:00", "timestamp": 1756785019.970969}}}
{"text": "2025-09-02 11:51:06.791 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:51:06 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0b4e7f4302ce</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "12:00:49.704708", "seconds": 43249.704708}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:51:06 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0b4e7f4302ce</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:51:06.791667+08:00", "timestamp": 1756785066.791667}}}
{"text": "2025-09-02 11:51:55.633 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:51:55 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0c7fcb9814b4</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "12:01:38.546413", "seconds": 43298.546413}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:51:55 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0c7fcb9814b4</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:51:55.633372+08:00", "timestamp": 1756785115.633372}}}
{"text": "2025-09-02 11:52:42.837 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:52:42 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0da6cd098529</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "12:02:25.750566", "seconds": 43345.750566}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:52:42 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0da6cd098529</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:52:42.837525+08:00", "timestamp": 1756785162.837525}}}
{"text": "2025-09-02 11:53:31.513 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:53:31 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0ed67fcadd8a</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "12:03:14.426120", "seconds": 43394.42612}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:53:31 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0ed67fcadd8a</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:53:31.513079+08:00", "timestamp": 1756785211.513079}}}
{"text": "2025-09-02 11:53:31.514 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "12:03:14.427122", "seconds": 43394.427122}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:53:31.514081+08:00", "timestamp": 1756785211.514081}}}
{"text": "2025-09-02 11:54:18.634 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:54:18 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0ffd7b9f85ef</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "12:04:01.547753", "seconds": 43441.547753}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 03:54:18 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Hong Kong</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a0ffd7b9f85ef</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:54:18.634712+08:00", "timestamp": 1756785258.634712}}}
{"text": "2025-09-02 11:54:18.635 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "12:04:01.548681", "seconds": 43441.548681}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2494634, "name": "SpawnProcess-13"}, "thread": {"id": 127990862770304, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:54:18.635640+08:00", "timestamp": 1756785258.63564}}}
{"text": "2025-09-02 11:59:18.932 | ERROR    | app.services.ai_service:chat_completion:272 | AI对话失败: '<' not supported between instances of 'NoneType' and 'decimal.Decimal'\n", "record": {"elapsed": {"repr": "0:02:57.249784", "seconds": 177.249784}, "exception": null, "extra": {}, "file": {"name": "ai_service.py", "path": "/root/trademe/backend/trading-service/app/services/ai_service.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 272, "message": "AI对话失败: '<' not supported between instances of 'NoneType' and 'decimal.Decimal'", "module": "ai_service", "name": "app.services.ai_service", "process": {"id": 2724386, "name": "MainProcess"}, "thread": {"id": 129705636401280, "name": "MainThread"}, "time": {"repr": "2025-09-02 11:59:18.932498+08:00", "timestamp": 1756785558.932498}}}
{"text": "2025-09-02 12:13:30.962 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:13:30 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a2c1ffa82d423</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:03:21.620321", "seconds": 201.620321}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:13:30 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a2c1ffa82d423</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2730117, "name": "MainProcess"}, "thread": {"id": 130225279295616, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:13:30.962981+08:00", "timestamp": 1756786410.962981}}}
{"text": "2025-09-02 12:14:18.403 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:14:18 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a2d488a9b2615</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:04:09.061025", "seconds": 249.061025}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:14:18 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a2d488a9b2615</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2730117, "name": "MainProcess"}, "thread": {"id": 130225279295616, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:14:18.403685+08:00", "timestamp": 1756786458.403685}}}
{"text": "2025-09-02 12:15:06.635 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:15:06 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a2e75ff17dfc9</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:04:57.293015", "seconds": 297.293015}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:15:06 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a2e75ff17dfc9</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2730117, "name": "MainProcess"}, "thread": {"id": 130225279295616, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:15:06.635675+08:00", "timestamp": 1756786506.635675}}}
{"text": "2025-09-02 12:15:54.085 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:15:54 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a2f9e8a3c00b8</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:05:44.742879", "seconds": 344.742879}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:15:54 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a2f9e8a3c00b8</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2730117, "name": "MainProcess"}, "thread": {"id": 130225279295616, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:15:54.085539+08:00", "timestamp": 1756786554.085539}}}
{"text": "2025-09-02 12:16:42.109 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:16:42 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a30cabc51d79c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:06:32.766954", "seconds": 392.766954}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:16:42 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a30cabc51d79c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2730117, "name": "MainProcess"}, "thread": {"id": 130225279295616, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:16:42.109614+08:00", "timestamp": 1756786602.109614}}}
{"text": "2025-09-02 12:17:29.437 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:17:29 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a31f26c2e006c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:07:20.094961", "seconds": 440.094961}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:17:29 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a31f26c2e006c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2730117, "name": "MainProcess"}, "thread": {"id": 130225279295616, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:17:29.437621+08:00", "timestamp": 1756786649.437621}}}
{"text": "2025-09-02 12:21:04.057 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:21:04 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a372fd83200b4</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:02:41.595877", "seconds": 161.595877}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:21:04 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a372fd83200b4</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2732971, "name": "MainProcess"}, "thread": {"id": 128339356872832, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:21:04.057126+08:00", "timestamp": 1756786864.057126}}}
{"text": "2025-09-02 12:22:39.213 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:22:39 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a39829d8600b4</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:04:16.752299", "seconds": 256.752299}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:22:39 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a39829d8600b4</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2732971, "name": "MainProcess"}, "thread": {"id": 128339356872832, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:22:39.213548+08:00", "timestamp": 1756786959.213548}}}
{"text": "2025-09-02 12:31:44.077 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:31:44 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a46d00afbd779</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:06:50.786206", "seconds": 410.786206}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:31:44 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a46d00afbd779</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2735414, "name": "MainProcess"}, "thread": {"id": 126243214491776, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:31:44.077742+08:00", "timestamp": 1756787504.077742}}}
{"text": "2025-09-02 12:32:32.030 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:32:32 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a47fb28dd17c3</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:07:38.739137", "seconds": 458.739137}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:32:32 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a47fb28dd17c3</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2735414, "name": "MainProcess"}, "thread": {"id": 126243214491776, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:32:32.030673+08:00", "timestamp": 1756787552.030673}}}
{"text": "2025-09-02 12:33:19.492 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:33:19 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a49245b09eb96</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:08:26.201407", "seconds": 506.201407}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:33:19 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a49245b09eb96</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2735414, "name": "MainProcess"}, "thread": {"id": 126243214491776, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:33:19.492943+08:00", "timestamp": 1756787599.492943}}}
{"text": "2025-09-02 12:34:07.083 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:34:07 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a4a4db873e387</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:09:13.791497", "seconds": 553.791497}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:34:07 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a4a4db873e387</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2735414, "name": "MainProcess"}, "thread": {"id": 126243214491776, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:34:07.083033+08:00", "timestamp": 1756787647.083033}}}
{"text": "2025-09-02 12:34:54.618 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:34:54 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a4b76ed5625ef</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:10:01.327314", "seconds": 601.327314}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:34:54 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a4b76ed5625ef</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2735414, "name": "MainProcess"}, "thread": {"id": 126243214491776, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:34:54.618850+08:00", "timestamp": 1756787694.61885}}}
{"text": "2025-09-02 12:35:42.461 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:35:42 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a4ca1ee8eeb8a</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:10:49.170168", "seconds": 649.170168}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:35:42 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a4ca1ee8eeb8a</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2735414, "name": "MainProcess"}, "thread": {"id": 126243214491776, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:35:42.461704+08:00", "timestamp": 1756787742.461704}}}
{"text": "2025-09-02 12:40:26.316 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:40:26 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a538fffd900c7</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:03:47.684078", "seconds": 227.684078}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:40:26 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a538fffd900c7</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:40:26.316485+08:00", "timestamp": 1756788026.316485}}}
{"text": "2025-09-02 12:44:27.378 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:44:27 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a59729d3fb5ea</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:07:48.745863", "seconds": 468.745863}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:44:27 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a59729d3fb5ea</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:44:27.378270+08:00", "timestamp": 1756788267.37827}}}
{"text": "2025-09-02 12:45:14.645 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:45:14 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5a9a1b803c14</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:08:36.012900", "seconds": 516.0129}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:45:14 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5a9a1b803c14</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:45:14.645307+08:00", "timestamp": 1756788314.645307}}}
{"text": "2025-09-02 12:46:02.899 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:46:02 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5bc79fe9961c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:09:24.267084", "seconds": 564.267084}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:46:02 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5bc79fe9961c</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:46:02.899491+08:00", "timestamp": 1756788362.899491}}}
{"text": "2025-09-02 12:46:49.889 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:46:49 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5ced4f62c362</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:10:11.256654", "seconds": 611.256654}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:46:49 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5ced4f62c362</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:46:49.889061+08:00", "timestamp": 1756788409.889061}}}
{"text": "2025-09-02 12:47:38.029 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:47:38 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5e1a49eed74f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:10:59.396810", "seconds": 659.39681}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:47:38 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5e1a49eed74f</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:47:38.029217+08:00", "timestamp": 1756788458.029217}}}
{"text": "2025-09-02 12:48:25.021 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:48:25 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5f3fdc92fc98</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:11:46.388742", "seconds": 706.388742}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:48:25 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a5f3fdc92fc98</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:48:25.021149+08:00", "timestamp": 1756788505.021149}}}
{"text": "2025-09-02 12:49:13.411 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:49:13 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a606e5f6be35b</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:12:34.779254", "seconds": 754.779254}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:49:13 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a606e5f6be35b</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:49:13.411661+08:00", "timestamp": 1756788553.411661}}}
{"text": "2025-09-02 12:49:13.412 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "0:12:34.780043", "seconds": 754.780043}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:49:13.412450+08:00", "timestamp": 1756788553.41245}}}
{"text": "2025-09-02 12:50:00.615 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:50:00 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a61955cd0d797</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:13:21.982979", "seconds": 801.982979}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:50:00 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a61955cd0d797</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:50:00.615386+08:00", "timestamp": 1756788600.615386}}}
{"text": "2025-09-02 12:50:00.616 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "0:13:21.983969", "seconds": 801.983969}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:50:00.616376+08:00", "timestamp": 1756788600.616376}}}
{"text": "2025-09-02 12:58:08.990 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:58:08 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a6d81ab9cd3c9</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:21:30.358279", "seconds": 1290.358279}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 04:58:08 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Osaka</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a6d81ab9cd3c9</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 12:58:08.990686+08:00", "timestamp": 1756789088.990686}}}
{"text": "2025-09-02 13:06:35.353 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 05:06:35 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a79de8d49af55</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:29:56.721176", "seconds": 1796.721176}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 05:06:35 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a79de8d49af55</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 13:06:35.353583+08:00", "timestamp": 1756789595.353583}}}
{"text": "2025-09-02 13:08:10.340 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 05:08:10 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a7c2fe860e06a</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:31:31.707899", "seconds": 1891.707899}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 05:08:10 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a7c2fe860e06a</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 13:08:10.340306+08:00", "timestamp": 1756789690.340306}}}
{"text": "2025-09-02 13:09:45.248 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 05:09:45 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a7e815f80e381</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:33:06.615858", "seconds": 1986.615858}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 05:09:45 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a7e815f80e381</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 13:09:45.248265+08:00", "timestamp": 1756789785.248265}}}
{"text": "2025-09-02 13:11:20.760 | ERROR    | app.ai.core.claude_client:_make_request:228 | Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 05:11:20 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a80d63b3beb6d</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>\n", "record": {"elapsed": {"repr": "0:34:42.128254", "seconds": 2082.128254}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 228, "message": "Claude API错误: <!DOCTYPE html>\n<!--[if lt IE 7]> <html class=\"no-js ie6 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 7]>    <html class=\"no-js ie7 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if IE 8]>    <html class=\"no-js ie8 oldie\" lang=\"en-US\"> <![endif]-->\n<!--[if gt IE 8]><!--> <html class=\"no-js\" lang=\"en-US\"> <!--<![endif]-->\n<head>\n\n<title>cloudcdn7.com | 504: Gateway time-out</title>\n<meta charset=\"UTF-8\" />\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\n<meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\" />\n<meta name=\"robots\" content=\"noindex, nofollow\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<link rel=\"stylesheet\" id=\"cf_styles-css\" href=\"/cdn-cgi/styles/main.css\" />\n</head>\n<body>\n<div id=\"cf-wrapper\">\n    <div id=\"cf-error-details\" class=\"p-0\">\n        <header class=\"mx-auto pt-10 lg:pt-6 lg:px-8 w-240 lg:w-full mb-8\">\n            <h1 class=\"inline-block sm:block sm:mb-2 font-light text-60 lg:text-4xl text-black-dark leading-tight mr-2\">\n                <span class=\"inline-block\">Gateway time-out</span>\n                <span class=\"code-label\">Error code 504</span>\n            </h1>\n            <div>\n                Visit <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">cloudflare.com</a> for more information.\n            </div>\n            <div class=\"mt-3\">2025-09-02 05:11:20 UTC</div>\n        </header>\n        <div class=\"my-8 bg-gradient-gray\">\n            <div class=\"w-240 lg:w-full mx-auto\">\n                <div class=\"clearfix md:px-8\">\n                    <div id=\"cf-browser-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-browser block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">You</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Browser\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-cloudflare-status\" class=\" relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    <span class=\"cf-icon-cloud block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-ok w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    </a>\n  </div>\n  <span class=\"md:block w-full truncate\">Tokyo</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  <a href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&utm_campaign=claude.cloudcdn7.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n    Cloudflare\n  </a>\n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-green-success\">Working</span>\n  \n</div>\n                    <div id=\"cf-host-status\" class=\"cf-error-source relative w-1/3 md:w-full py-15 md:p-0 md:py-8 md:text-left md:border-solid md:border-0 md:border-b md:border-gray-400 overflow-hidden float-left md:float-none text-center\">\n  <div class=\"relative mb-10 md:m-0\">\n    \n    <span class=\"cf-icon-server block md:hidden h-20 bg-center bg-no-repeat\"></span>\n    <span class=\"cf-icon-error w-12 h-12 absolute left-1/2 md:left-auto md:right-0 md:top-0 -ml-6 -bottom-4\"></span>\n    \n  </div>\n  <span class=\"md:block w-full truncate\">claude.cloudcdn7.com</span>\n  <h3 class=\"md:inline-block mt-3 md:mt-0 text-2xl text-gray-600 font-light leading-1.3\">\n  \n    Host\n  \n  </h3>\n  \n  <span class=\"leading-1.3 text-2xl text-red-error\">Error</span>\n  \n</div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"w-240 lg:w-full mx-auto mb-8 lg:px-8\">\n            <div class=\"clearfix\">\n                <div class=\"w-1/2 md:w-full float-left pr-6 md:pb-10 md:pr-0 leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What happened?</h2>\n                    <p>The web server reported a gateway time-out error.</p>\n                </div>\n                <div class=\"w-1/2 md:w-full float-left leading-relaxed\">\n                    <h2 class=\"text-3xl font-normal leading-1.3 mb-4\">What can I do?</h2>\n                    <p class=\"mb-6\">Please try again in a few minutes.</p>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cf-error-footer cf-wrapper w-240 lg:w-full py-10 sm:py-4 sm:px-8 mx-auto text-center sm:text-left border-solid border-0 border-t border-gray-300\">\n    <p class=\"text-13\">\n      <span class=\"cf-footer-item sm:block sm:mb-1\">Cloudflare Ray ID: <strong class=\"font-semibold\">978a80d63b3beb6d</strong></span>\n      <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      <span id=\"cf-footer-item-ip\" class=\"cf-footer-item hidden sm:block sm:mb-1\">\n        Your IP:\n        <button type=\"button\" id=\"cf-footer-ip-reveal\" class=\"cf-footer-ip-reveal-btn\">Click to reveal</button>\n        <span class=\"hidden\" id=\"cf-footer-ip\">43.167.252.120</span>\n        <span class=\"cf-footer-separator sm:hidden\">&bull;</span>\n      </span>\n      <span class=\"cf-footer-item sm:block sm:mb-1\"><span>Performance &amp; security by</span> <a rel=\"noopener noreferrer\" href=\"https://www.cloudflare.com/5xx-error-landing?utm_source=errorcode_504&#38;utm_campaign=claude.cloudcdn7.com\" id=\"brand_link\" target=\"_blank\">Cloudflare</a></span>\n      \n    </p>\n    <script>(function(){function d(){var b=a.getElementById(\"cf-footer-item-ip\"),c=a.getElementById(\"cf-footer-ip-reveal\");b&&\"classList\"in b&&(b.classList.remove(\"hidden\"),c.addEventListener(\"click\",function(){c.classList.add(\"hidden\");a.getElementById(\"cf-footer-ip\").classList.remove(\"hidden\")}))}var a=document;document.addEventListener&&a.addEventListener(\"DOMContentLoaded\",d)})();</script>\n  </div><!-- /.error-footer -->\n\n    </div>\n</div>\n</body>\n</html>", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 13:11:20.760661+08:00", "timestamp": 1756789880.760661}}}
{"text": "2025-09-02 13:11:20.762 | ERROR    | app.ai.core.claude_client:chat_completion:399 | 聊天完成失败: Claude AI服务繁忙，请稍后重试\n", "record": {"elapsed": {"repr": "0:34:42.129634", "seconds": 2082.129634}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 399, "message": "聊天完成失败: Claude AI服务繁忙，请稍后重试", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2739586, "name": "MainProcess"}, "thread": {"id": 125580780257408, "name": "MainThread"}, "time": {"repr": "2025-09-02 13:11:20.762041+08:00", "timestamp": 1756789880.762041}}}
{"text": "2025-09-02 14:45:40.528 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:10:28.906731", "seconds": 628.906731}, "exception": null, "extra": {"request_id": "ec0332d9-0930-434c-aab6-382037983ff4", "extra": {"structured_data": {"request_id": "ec0332d9-0930-434c-aab6-382037983ff4", "method": "POST", "url": "http://43.167.252.120/api/v1/anthropic-accounts/exchange-setup-token", "path": "/api/v1/anthropic-accounts/exchange-setup-token", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "content-length": "246", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T06:45:40.528540+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "209", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 63.19}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2781251, "name": "MainProcess"}, "thread": {"id": 130877076545664, "name": "MainThread"}, "time": {"repr": "2025-09-02 14:45:40.528571+08:00", "timestamp": 1756795540.528571}}}
{"text": "2025-09-02 14:58:45.854 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:04:37.768577", "seconds": 277.768577}, "exception": null, "extra": {"request_id": "0b8eab16-223e-45be-b0cd-1d128bf3d3c0", "extra": {"structured_data": {"request_id": "0b8eab16-223e-45be-b0cd-1d128bf3d3c0", "method": "POST", "url": "http://43.167.252.120/api/v1/anthropic-accounts/exchange-setup-token", "path": "/api/v1/anthropic-accounts/exchange-setup-token", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "content-length": "246", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T06:58:45.854247+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "136", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 39.53}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2788087, "name": "MainProcess"}, "thread": {"id": 136569281704064, "name": "MainThread"}, "time": {"repr": "2025-09-02 14:58:45.854286+08:00", "timestamp": 1756796325.854286}}}
{"text": "2025-09-02 15:19:11.769 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:03:54.318932", "seconds": 234.318932}, "exception": null, "extra": {"request_id": "2c2d3b73-d952-4cb4-b157-37963c5b1bf4", "extra": {"structured_data": {"request_id": "2c2d3b73-d952-4cb4-b157-37963c5b1bf4", "method": "POST", "url": "http://43.167.252.120/api/v1/anthropic-accounts/exchange-setup-token", "path": "/api/v1/anthropic-accounts/exchange-setup-token", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "content-length": "246", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T07:19:11.769171+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 71.2}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2796083, "name": "MainProcess"}, "thread": {"id": 123139531194496, "name": "MainThread"}, "time": {"repr": "2025-09-02 15:19:11.769206+08:00", "timestamp": 1756797551.769206}}}
{"text": "2025-09-02 15:24:41.293 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:16.002690", "seconds": 76.00269}, "exception": null, "extra": {"request_id": "c3bfff50-bc38-4ed5-b8ca-19420d467898", "extra": {"structured_data": {"request_id": "c3bfff50-bc38-4ed5-b8ca-19420d467898", "method": "POST", "url": "http://43.167.252.120/api/v1/anthropic-accounts/exchange-setup-token", "path": "/api/v1/anthropic-accounts/exchange-setup-token", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "content-length": "246", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T07:24:41.293919+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 58.01}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2798927, "name": "MainProcess"}, "thread": {"id": 139927443902592, "name": "MainThread"}, "time": {"repr": "2025-09-02 15:24:41.293961+08:00", "timestamp": 1756797881.293961}}}
{"text": "2025-09-02 15:32:09.907 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:00:45.703434", "seconds": 45.703434}, "exception": null, "extra": {"request_id": "e10f6cf4-f7da-4b0d-9abd-f1d09a732e1d", "extra": {"structured_data": {"request_id": "e10f6cf4-f7da-4b0d-9abd-f1d09a732e1d", "method": "POST", "url": "http://43.167.252.120/api/v1/anthropic-accounts/exchange-setup-token", "path": "/api/v1/anthropic-accounts/exchange-setup-token", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "content-length": "246", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T07:32:09.907032+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "73", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 47.7}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2801867, "name": "MainProcess"}, "thread": {"id": 132046738567296, "name": "MainThread"}, "time": {"repr": "2025-09-02 15:32:09.907061+08:00", "timestamp": 1756798329.907061}}}
{"text": "2025-09-02 15:40:43.323 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:01:46.407620", "seconds": 106.40762}, "exception": null, "extra": {"request_id": "97d9b61d-e3d3-4ef0-9c4f-0b693eff31c6", "extra": {"structured_data": {"request_id": "97d9b61d-e3d3-4ef0-9c4f-0b693eff31c6", "method": "POST", "url": "http://43.167.252.120/api/v1/anthropic-accounts/exchange-setup-token", "path": "/api/v1/anthropic-accounts/exchange-setup-token", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "content-length": "246", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T07:40:43.323593+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 36.76}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2804683, "name": "MainProcess"}, "thread": {"id": 129940915110016, "name": "MainThread"}, "time": {"repr": "2025-09-02 15:40:43.323628+08:00", "timestamp": 1756798843.323628}}}
{"text": "2025-09-02 15:46:09.245 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:12.329491", "seconds": 432.329491}, "exception": null, "extra": {"request_id": "d75d1747-27dd-42d5-bd4f-7649d8b6e8a6", "extra": {"structured_data": {"request_id": "d75d1747-27dd-42d5-bd4f-7649d8b6e8a6", "method": "POST", "url": "http://43.167.252.120/api/v1/anthropic-accounts/exchange-setup-token", "path": "/api/v1/anthropic-accounts/exchange-setup-token", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "content-length": "246", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T07:46:09.245468+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 37.33}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2804683, "name": "MainProcess"}, "thread": {"id": 129940915110016, "name": "MainThread"}, "time": {"repr": "2025-09-02 15:46:09.245499+08:00", "timestamp": 1756799169.245499}}}
{"text": "2025-09-02 15:46:40.226 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:07:43.310090", "seconds": 463.31009}, "exception": null, "extra": {"request_id": "2ebcaae0-7b69-42c0-a2ba-5025a2257e2a", "extra": {"structured_data": {"request_id": "2ebcaae0-7b69-42c0-a2ba-5025a2257e2a", "method": "POST", "url": "http://43.167.252.120/api/v1/anthropic-accounts/exchange-setup-token", "path": "/api/v1/anthropic-accounts/exchange-setup-token", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "content-length": "307", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "content-type": "application/json", "origin": "http://43.167.252.120", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T07:46:40.226062+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "65", "content-type": "application/json", "access-control-allow-credentials": "true"}, "duration_ms": 45.27}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2804683, "name": "MainProcess"}, "thread": {"id": 129940915110016, "name": "MainThread"}, "time": {"repr": "2025-09-02 15:46:40.226098+08:00", "timestamp": 1756799200.226098}}}
{"text": "2025-09-02 16:02:08.603 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:23:11.687109", "seconds": 1391.687109}, "exception": null, "extra": {"request_id": "6a346986-33e8-4929-b259-9ead856cfbd5", "extra": {"structured_data": {"request_id": "6a346986-33e8-4929-b259-9ead856cfbd5", "method": "GET", "url": "http://43.167.252.120/api/v1/anthropic-accounts/", "path": "/api/v1/anthropic-accounts/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T08:02:08.603088+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "92", "content-type": "application/json"}, "duration_ms": 4.36}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2804683, "name": "MainProcess"}, "thread": {"id": 129940915110016, "name": "MainThread"}, "time": {"repr": "2025-09-02 16:02:08.603117+08:00", "timestamp": 1756800128.603117}}}
{"text": "2025-09-02 16:02:11.397 | ERROR    | app.middleware.structured_logging:log_request_end:152 | Server error: 500\n", "record": {"elapsed": {"repr": "0:23:14.481613", "seconds": 1394.481613}, "exception": null, "extra": {"request_id": "2c2e559b-b5b4-42e9-a5c2-4df766a50200", "extra": {"structured_data": {"request_id": "2c2e559b-b5b4-42e9-a5c2-4df766a50200", "method": "GET", "url": "http://43.167.252.120/api/v1/anthropic-accounts/", "path": "/api/v1/anthropic-accounts/", "query_params": {}, "headers": {"host": "43.167.252.120", "x-real-ip": "167.234.211.253", "x-forwarded-for": "167.234.211.253", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "[FILTERED]", "referer": "http://43.167.252.120/admin/claude"}, "client_ip": "167.234.211.253", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36", "timestamp": "2025-09-02T08:02:11.397596+00:00", "event_type": "request_end", "status_code": 500, "response_headers": {"content-length": "92", "content-type": "application/json"}, "duration_ms": 3.63}}}, "file": {"name": "structured_logging.py", "path": "/root/trademe/backend/trading-service/app/middleware/structured_logging.py"}, "function": "log_request_end", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 152, "message": "Server error: 500", "module": "structured_logging", "name": "app.middleware.structured_logging", "process": {"id": 2804683, "name": "MainProcess"}, "thread": {"id": 129940915110016, "name": "MainThread"}, "time": {"repr": "2025-09-02 16:02:11.397621+08:00", "timestamp": 1756800131.397621}}}
{"text": "2025-09-02 18:01:20.745 | ERROR    | app.main:websocket_realtime_endpoint:542 | AI聊天处理错误: \n", "record": {"elapsed": {"repr": "0:00:22.928273", "seconds": 22.928273}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 542, "message": "AI聊天处理错误: ", "module": "main", "name": "app.main", "process": {"id": 2852144, "name": "MainProcess"}, "thread": {"id": 132568875802752, "name": "MainThread"}, "time": {"repr": "2025-09-02 18:01:20.745388+08:00", "timestamp": 1756807280.745388}}}
{"text": "2025-09-02 18:05:01.962 | ERROR    | app.main:websocket_realtime_endpoint:542 | AI聊天处理错误: \n", "record": {"elapsed": {"repr": "0:04:04.145788", "seconds": 244.145788}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 542, "message": "AI聊天处理错误: ", "module": "main", "name": "app.main", "process": {"id": 2852144, "name": "MainProcess"}, "thread": {"id": 132568875802752, "name": "MainThread"}, "time": {"repr": "2025-09-02 18:05:01.962903+08:00", "timestamp": 1756807501.962903}}}
{"text": "2025-09-02 18:07:23.708 | ERROR    | app.main:websocket_realtime_endpoint:533 | AI聊天处理错误: name 'ai_response' is not defined\n", "record": {"elapsed": {"repr": "0:00:08.224486", "seconds": 8.224486}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 533, "message": "AI聊天处理错误: name 'ai_response' is not defined", "module": "main", "name": "app.main", "process": {"id": 2854620, "name": "SpawnProcess-2"}, "thread": {"id": 126206397841536, "name": "MainThread"}, "time": {"repr": "2025-09-02 18:07:23.708934+08:00", "timestamp": 1756807643.708934}}}
{"text": "2025-09-02 20:30:55.029 | ERROR    | app.services.ai_service:chat_completion:272 | AI对话失败: 'total_tokens'\n", "record": {"elapsed": {"repr": "2:23:01.939359", "seconds": 8581.939359}, "exception": null, "extra": {}, "file": {"name": "ai_service.py", "path": "/root/trademe/backend/trading-service/app/services/ai_service.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 272, "message": "AI对话失败: 'total_tokens'", "module": "ai_service", "name": "app.services.ai_service", "process": {"id": 2854908, "name": "SpawnProcess-3"}, "thread": {"id": 131174284492928, "name": "MainThread"}, "time": {"repr": "2025-09-02 20:30:55.029560+08:00", "timestamp": 1756816255.02956}}}
{"text": "2025-09-02 21:01:46.193 | ERROR    | app.main:websocket_realtime_endpoint:533 | AI聊天处理错误: \n", "record": {"elapsed": {"repr": "2:53:53.102948", "seconds": 10433.102948}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 533, "message": "AI聊天处理错误: ", "module": "main", "name": "app.main", "process": {"id": 2854908, "name": "SpawnProcess-3"}, "thread": {"id": 131174284492928, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:01:46.193149+08:00", "timestamp": 1756818106.193149}}}
{"text": "2025-09-02 21:13:19.198 | ERROR    | app.main:websocket_realtime_endpoint:533 | AI聊天处理错误: \n", "record": {"elapsed": {"repr": "3:05:26.108368", "seconds": 11126.108368}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 533, "message": "AI聊天处理错误: ", "module": "main", "name": "app.main", "process": {"id": 2854908, "name": "SpawnProcess-3"}, "thread": {"id": 131174284492928, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:13:19.198569+08:00", "timestamp": 1756818799.198569}}}
{"text": "2025-09-02 21:17:49.520 | ERROR    | app.main:websocket_realtime_endpoint:555 | AI聊天处理错误: No module named 'app.db'\n", "record": {"elapsed": {"repr": "0:01:45.769867", "seconds": 105.769867}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 555, "message": "AI聊天处理错误: No module named 'app.db'", "module": "main", "name": "app.main", "process": {"id": 2915572, "name": "SpawnProcess-4"}, "thread": {"id": 130907839422592, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:17:49.520103+08:00", "timestamp": 1756819069.520103}}}
{"text": "2025-09-02 21:18:06.192 | ERROR    | app.main:websocket_realtime_endpoint:555 | AI聊天处理错误: No module named 'app.db'\n", "record": {"elapsed": {"repr": "0:02:02.442423", "seconds": 122.442423}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 555, "message": "AI聊天处理错误: No module named 'app.db'", "module": "main", "name": "app.main", "process": {"id": 2915572, "name": "SpawnProcess-4"}, "thread": {"id": 130907839422592, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:18:06.192659+08:00", "timestamp": 1756819086.192659}}}
{"text": "2025-09-02 21:33:02.869 | ERROR    | app.main:websocket_realtime_endpoint:571 | AI聊天处理错误: No module named 'app.db'\n", "record": {"elapsed": {"repr": "0:03:05.615613", "seconds": 185.615613}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 571, "message": "AI聊天处理错误: No module named 'app.db'", "module": "main", "name": "app.main", "process": {"id": 2920665, "name": "SpawnProcess-8"}, "thread": {"id": 130682627039360, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:33:02.869501+08:00", "timestamp": 1756819982.869501}}}
{"text": "2025-09-02 21:36:27.671 | ERROR    | app.main:websocket_realtime_endpoint:592 | AI聊天处理错误: No module named 'app.db'\n", "record": {"elapsed": {"repr": "0:01:18.105765", "seconds": 78.105765}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 592, "message": "AI聊天处理错误: No module named 'app.db'", "module": "main", "name": "app.main", "process": {"id": 2922571, "name": "SpawnProcess-12"}, "thread": {"id": 128935416864896, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:36:27.671197+08:00", "timestamp": 1756820187.671197}}}
{"text": "2025-09-02 21:39:08.462 | ERROR    | app.main:websocket_realtime_endpoint:592 | AI聊天处理错误: cannot import name 'get_async_db' from 'app.database' (/root/trademe/backend/trading-service/app/database.py)\n", "record": {"elapsed": {"repr": "0:01:08.196115", "seconds": 68.196115}, "exception": null, "extra": {}, "file": {"name": "main.py", "path": "/root/trademe/backend/trading-service/app/main.py"}, "function": "websocket_realtime_endpoint", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 592, "message": "AI聊天处理错误: cannot import name 'get_async_db' from 'app.database' (/root/trademe/backend/trading-service/app/database.py)", "module": "main", "name": "app.main", "process": {"id": 2923614, "name": "SpawnProcess-13"}, "thread": {"id": 133510137147520, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:39:08.462717+08:00", "timestamp": 1756820348.462717}}}
{"text": "2025-09-02 21:41:46.612 | ERROR    | app.services.ai_service:chat_completion:272 | AI对话失败: 'total_tokens'\n", "record": {"elapsed": {"repr": "0:01:38.853332", "seconds": 98.853332}, "exception": null, "extra": {}, "file": {"name": "ai_service.py", "path": "/root/trademe/backend/trading-service/app/services/ai_service.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 272, "message": "AI对话失败: 'total_tokens'", "module": "ai_service", "name": "app.services.ai_service", "process": {"id": 2924414, "name": "SpawnProcess-14"}, "thread": {"id": 128065993810048, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:41:46.612089+08:00", "timestamp": 1756820506.612089}}}
{"text": "2025-09-02 21:53:45.804 | ERROR    | app.services.ai_service:chat_completion:298 | AI对话失败: ClaudeClient.chat_completion() got an unexpected keyword argument 'system'\n", "record": {"elapsed": {"repr": "0:04:23.532459", "seconds": 263.532459}, "exception": null, "extra": {}, "file": {"name": "ai_service.py", "path": "/root/trademe/backend/trading-service/app/services/ai_service.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 298, "message": "AI对话失败: ClaudeClient.chat_completion() got an unexpected keyword argument 'system'", "module": "ai_service", "name": "app.services.ai_service", "process": {"id": 2927585, "name": "SpawnProcess-16"}, "thread": {"id": 125342413754496, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:53:45.804473+08:00", "timestamp": 1756821225.804473}}}
{"text": "2025-09-02 21:59:12.002 | ERROR    | app.services.ai_service:chat_completion:278 | AI对话失败: 'input_tokens'\n", "record": {"elapsed": {"repr": "0:01:43.474126", "seconds": 103.474126}, "exception": null, "extra": {}, "file": {"name": "ai_service.py", "path": "/root/trademe/backend/trading-service/app/services/ai_service.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 278, "message": "AI对话失败: 'input_tokens'", "module": "ai_service", "name": "app.services.ai_service", "process": {"id": 2930530, "name": "SpawnProcess-19"}, "thread": {"id": 138314248716416, "name": "MainThread"}, "time": {"repr": "2025-09-02 21:59:12.002595+08:00", "timestamp": 1756821552.002595}}}
{"text": "2025-09-02 22:17:31.354 | ERROR    | app.ai.core.claude_client:_make_request_with_proxy_retry:226 | ❌ 所有代理尝试失败: Timeout after 60s\n", "record": {"elapsed": {"repr": "0:14:33.468919", "seconds": 873.468919}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "_make_request_with_proxy_retry", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 226, "message": "❌ 所有代理尝试失败: Timeout after 60s", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2932542, "name": "SpawnProcess-22"}, "thread": {"id": 132866929926272, "name": "MainThread"}, "time": {"repr": "2025-09-02 22:17:31.354693+08:00", "timestamp": 1756822651.354693}}}
{"text": "2025-09-02 22:17:31.355 | ERROR    | app.ai.core.claude_client:chat_completion:504 | 聊天完成失败: Claude API请求失败: Timeout after 60s\n", "record": {"elapsed": {"repr": "0:14:33.470187", "seconds": 873.470187}, "exception": null, "extra": {}, "file": {"name": "claude_client.py", "path": "/root/trademe/backend/trading-service/app/ai/core/claude_client.py"}, "function": "chat_completion", "level": {"icon": "❌", "name": "ERROR", "no": 40}, "line": 504, "message": "聊天完成失败: Claude API请求失败: Timeout after 60s", "module": "claude_client", "name": "app.ai.core.claude_client", "process": {"id": 2932542, "name": "SpawnProcess-22"}, "thread": {"id": 132866929926272, "name": "MainThread"}, "time": {"repr": "2025-09-02 22:17:31.355961+08:00", "timestamp": 1756822651.355961}}}
2025-09-03 13:04:06 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:04:06 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:04:06 | app.services.claude_account_service | ERROR | claude_account_service.py:209 | get_decrypted_api_key | Cannot decrypt API key for account 1: Failed to decrypt sensitive data: 私钥解密失败: Incorrect padding
2025-09-03 13:07:49 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:07:49 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:07:49 | app.services.claude_account_service | ERROR | claude_account_service.py:209 | get_decrypted_api_key | Cannot decrypt API key for account 1: Failed to decrypt sensitive data: 私钥解密失败: Incorrect padding
2025-09-03 13:09:08 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:08 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:10 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:15 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:09:15 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:09:15 | app.services.claude_account_service | ERROR | claude_account_service.py:209 | get_decrypted_api_key | Cannot decrypt API key for account 1: Failed to decrypt sensitive data: 私钥解密失败: Incorrect padding
2025-09-03 13:09:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:21 | app.api.v1.admin.claude | ERROR | claude.py:1623 | get_users_detailed_stats | 获取用户详细统计失败: (sqlite3.OperationalError) no such column: cl.tokens_input
[SQL: 
            SELECT 
                u.id as user_id,
                u.username,
                u.email,
                u.membership_level,
                u.is_active,
                u.last_login_at,
                COALESCE(SUM(cl.tokens_input + cl.tokens_output), 0) as total_tokens,
                COALESCE(COUNT(cl.id), 0) as total_requests,
                COALESCE(SUM(cl.api_cost), 0.0) as total_cost,
                MAX(cl.request_date) as last_usage_date
            FROM users u
            LEFT JOIN claude_usage_logs cl ON u.id = cl.user_id
            WHERE u.id IS NOT NULL
            GROUP BY u.id, u.username, u.email, u.membership_level, u.is_active, u.last_login_at
            ORDER BY total_cost DESC, total_requests DESC
            LIMIT 50
        ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-03 13:09:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:26 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:44 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:46 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:47 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:57 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:09:57 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:10:04 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:10:04 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:10:05 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:10:09 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:10:09 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:10:09 | app.services.claude_account_service | ERROR | claude_account_service.py:209 | get_decrypted_api_key | Cannot decrypt API key for account 1: Failed to decrypt sensitive data: 私钥解密失败: Incorrect padding
2025-09-03 13:10:26 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:10:26 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:10:26 | app.services.claude_account_service | ERROR | claude_account_service.py:209 | get_decrypted_api_key | Cannot decrypt API key for account 1: Failed to decrypt sensitive data: 私钥解密失败: Incorrect padding
2025-09-03 13:15:18 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:15:18 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:19:02 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:19:02 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:19:12 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:19:12 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:19:23 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:19:23 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:19:24 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:19:27 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:19:27 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:19:42 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:19:42 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:19:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:19:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:19:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:19:50 | app.api.v1.admin.claude | ERROR | claude.py:1623 | get_users_detailed_stats | 获取用户详细统计失败: (sqlite3.OperationalError) no such column: cl.tokens_input
[SQL: 
            SELECT 
                u.id as user_id,
                u.username,
                u.email,
                u.membership_level,
                u.is_active,
                u.last_login_at,
                COALESCE(SUM(cl.tokens_input + cl.tokens_output), 0) as total_tokens,
                COALESCE(COUNT(cl.id), 0) as total_requests,
                COALESCE(SUM(cl.api_cost), 0.0) as total_cost,
                MAX(cl.request_date) as last_usage_date
            FROM users u
            LEFT JOIN claude_usage_logs cl ON u.id = cl.user_id
            WHERE u.id IS NOT NULL
            GROUP BY u.id, u.username, u.email, u.membership_level, u.is_active, u.last_login_at
            ORDER BY total_cost DESC, total_requests DESC
            LIMIT 50
        ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-03 13:19:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:19:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:19:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:19:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:22:18 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:22:19 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:22:19 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:31:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:31:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:31:39 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:31:39 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:31:41 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:31:53 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:31:53 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:42:52 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:42:52 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:43:07 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:43:07 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:43:10 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:43:15 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:43:21 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:43:21 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:51:29 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:51:29 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:52:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:52:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:52:57 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:52:57 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:53:01 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-03 13:53:06 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:53:06 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:58:15 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 13:58:15 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:04:18 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 14:04:18 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:05:06 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 14:05:06 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:10:14 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 14:10:14 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:10:35 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 14:10:35 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:11:30 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 14:11:30 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:16:57 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 14:16:57 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:17:10 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 14:17:10 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:18:36 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-03 14:18:36 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 11:26:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:26:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:31:50 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 11:31:50 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 11:33:40 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:33:40 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:35:04 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:35:15 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:43:12 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 11:43:12 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 11:47:41 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 11:47:41 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 11:48:43 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:48:44 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:48:45 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:49:26 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:49:26 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:49:33 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:49:34 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:49:34 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:38 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:38 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:41 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:41 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:50:46 | app.api.v1.admin.claude | ERROR | claude.py:1623 | get_users_detailed_stats | 获取用户详细统计失败: (sqlite3.OperationalError) no such column: cl.tokens_input
[SQL: 
            SELECT 
                u.id as user_id,
                u.username,
                u.email,
                u.membership_level,
                u.is_active,
                u.last_login_at,
                COALESCE(SUM(cl.tokens_input + cl.tokens_output), 0) as total_tokens,
                COALESCE(COUNT(cl.id), 0) as total_requests,
                COALESCE(SUM(cl.api_cost), 0.0) as total_cost,
                MAX(cl.request_date) as last_usage_date
            FROM users u
            LEFT JOIN claude_usage_logs cl ON u.id = cl.user_id
            WHERE u.id IS NOT NULL
            GROUP BY u.id, u.username, u.email, u.membership_level, u.is_active, u.last_login_at
            ORDER BY total_cost DESC, total_requests DESC
            LIMIT 50
        ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:51:29 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:51:29 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:55:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:55:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:55:30 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:55:31 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:55:31 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:55:32 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:55:32 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:55:34 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 11:55:34 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:02:24 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 12:02:24 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 12:04:05 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 12:04:05 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 12:05:34 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 12:05:34 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 12:08:52 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:08:52 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:08:54 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:09:02 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 12:09:02 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 12:32:54 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:32:54 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:32:57 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:33:08 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 12:33:08 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 12:42:06 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:42:06 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:42:07 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 12:42:15 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 12:42:15 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 13:00:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 13:00:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 13:00:22 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 13:00:34 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 13:00:34 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 13:46:05 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 13:46:05 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 13:46:06 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 13:47:24 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 13:47:24 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 20:19:19 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 20:19:19 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 20:19:32 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 20:19:32 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 20:19:35 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 20:19:50 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 20:19:50 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 20:44:52 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 20:44:52 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 20:44:53 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-04 20:45:00 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 20:45:00 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 20:45:45 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 20:45:45 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 20:58:43 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:61 | _get_streaming_claude_client | 创建流式Claude客户端失败: 'ClaudeAccountService' object has no attribute 'get_available_account'
2025-09-04 20:58:43 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:237 | _process_streaming_ai_chat | 流式AI对话处理失败: 无法获取Claude客户端
2025-09-04 20:58:52 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:61 | _get_streaming_claude_client | 创建流式Claude客户端失败: 'ClaudeAccountService' object has no attribute 'get_available_account'
2025-09-04 20:58:52 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:237 | _process_streaming_ai_chat | 流式AI对话处理失败: 无法获取Claude客户端
2025-09-04 21:13:09 | app.api.v1.ai | ERROR | ai.py:73 | chat_with_ai | AI对话失败: Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai.py", line 41, in chat_with_ai
    from app.services.simplified_ai_service import unified_proxy_ai_service
ModuleNotFoundError: No module named 'app.services.simplified_ai_service'

2025-09-04 21:20:33 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 21:20:33 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 21:31:40 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 21:31:40 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 21:31:40 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:243 | _process_streaming_ai_chat | 流式AI对话处理失败: 'async for' requires an object with __aiter__ method, got coroutine
2025-09-04 21:41:30 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 21:41:30 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 21:41:35 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:246 | _process_streaming_ai_chat | 流式AI对话处理失败: AI调用失败: 未知错误
2025-09-04 21:41:35 | asyncio | ERROR | client.py:459 | __del__ | Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x73d322a56540>
2025-09-04 21:41:35 | asyncio | ERROR | connector.py:388 | __del__ | Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x73d322a86630>, 681213.608874137)])']
connector: <aiohttp.connector.TCPConnector object at 0x73d3217bdf10>
2025-09-04 22:12:08 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-04 22:12:08 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 22:14:26 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 12:37:05 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-76' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 12:37:05 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 12:37:05 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 12:42:57 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-14' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 12:42:57 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 12:42:57 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 12:46:00 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-14' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 12:46:00 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 12:46:00 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 12:47:48 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-25' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 12:47:48 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 12:47:48 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 12:47:55 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-31' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 12:47:55 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 12:47:55 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 12:54:57 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-42' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 12:54:57 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-4, started daemon 126019562374848)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 12:54:57 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-5, started daemon 126019551889088)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 12:55:06 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-46' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 12:59:47 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 12:59:47 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 12:59:53 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:01:53 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:01:54 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:02:03 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:02:03 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:02:04 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:02:11 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-127' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:02:11 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 13:02:11 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 13:09:43 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-166' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:20:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:20:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:20:21 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:20:22 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:20:31 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-43' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:20:31 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 13:20:31 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 13:22:18 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-54' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:26:14 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:14 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:14 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:14 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:14 | app.api.v1.admin.claude | ERROR | claude.py:1623 | get_users_detailed_stats | 获取用户详细统计失败: (sqlite3.OperationalError) no such column: cl.tokens_input
[SQL: 
            SELECT 
                u.id as user_id,
                u.username,
                u.email,
                u.membership_level,
                u.is_active,
                u.last_login_at,
                COALESCE(SUM(cl.tokens_input + cl.tokens_output), 0) as total_tokens,
                COALESCE(COUNT(cl.id), 0) as total_requests,
                COALESCE(SUM(cl.api_cost), 0.0) as total_cost,
                MAX(cl.request_date) as last_usage_date
            FROM users u
            LEFT JOIN claude_usage_logs cl ON u.id = cl.user_id
            WHERE u.id IS NOT NULL
            GROUP BY u.id, u.username, u.email, u.membership_level, u.is_active, u.last_login_at
            ORDER BY total_cost DESC, total_requests DESC
            LIMIT 50
        ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-05 13:26:14 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:14 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:14 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:18 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:20 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:23 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:26 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:51 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:26:54 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:27:10 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:27:14 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:32:25 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 13:32:25 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 13:33:43 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-37' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:44:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:717 | _get_request_body | 获取请求体失败: 
2025-09-05 13:44:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:717 | _get_request_body | 获取请求体失败: 
2025-09-05 13:44:25 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:717 | _get_request_body | 获取请求体失败: 
2025-09-05 13:45:10 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 13:45:10 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 13:46:08 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 13:46:08 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 13:47:19 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-33' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:47:19 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 13:47:19 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 13:50:43 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-42' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:50:43 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 13:50:43 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 13:54:28 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-14' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:54:29 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 13:54:29 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 13:56:52 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:56:52 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:57:10 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 13:57:18 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-43' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 13:57:18 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 13:57:18 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 13:58:18 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:257 | _process_streaming_ai_chat | 流式AI对话处理失败: 
2025-09-05 14:00:44 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:00:44 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:00:46 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:00:55 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-34' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 14:00:56 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 14:00:56 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 14:02:55 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:257 | _process_streaming_ai_chat | 流式AI对话超时 - Request ID: q9davae9kgemf6ffexx, 超时时间: 120秒
2025-09-05 14:04:57 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:04:57 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:04:58 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:05:19 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-34' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 14:05:19 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 14:05:19 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 14:11:33 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:254 | _process_streaming_ai_chat | 流式AI对话处理失败 - Request ID: 8m1c85blyi3mf6fl26k, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 215, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {response.get('error', '未知错误')}")
Exception: AI调用失败: 未知错误
2025-09-05 14:15:34 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:15:34 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:15:35 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:15:48 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-82' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 14:15:48 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 14:15:48 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 14:22:01 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:254 | _process_streaming_ai_chat | 流式AI对话处理失败 - Request ID: tr5o8xrem7omf6fyjhk, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 215, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {response.get('error', '未知错误')}")
Exception: AI调用失败: 未知错误
2025-09-05 14:34:11 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 14:34:12 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 14:34:12 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 14:35:17 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:35:17 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:35:18 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:35:33 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-48' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 14:35:33 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 14:35:33 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 14:41:48 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: 未知错误
2025-09-05 14:41:48 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:275 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: agb7iy83x6omf6gny8t, 异常类型: Exception, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: 未知错误
2025-09-05 14:43:43 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:43:43 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:43:44 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:43:57 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-96' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 14:43:57 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 14:43:57 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 14:43:57 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 132926027073216)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 14:45:45 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:50:11 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: 未知错误
2025-09-05 14:50:11 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:275 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: bv8yzgutk1gmf6gyqhl, 异常类型: Exception, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: 未知错误
2025-09-05 14:50:36 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:50:36 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:50:40 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:50:44 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:50:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:51:02 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-179' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 14:51:02 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 14:51:02 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 14:54:53 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:54:53 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:54:54 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 14:55:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-219' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 14:55:01 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 14:55:01 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 14:57:15 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: 未知错误
2025-09-05 14:57:15 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:275 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: cgc1tvjaq6dmf6h7uyu, 异常类型: Exception, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: 未知错误
2025-09-05 15:01:15 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: 未知错误
2025-09-05 15:01:15 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:275 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: 60ywg3f6gemf6hcyv5, 异常类型: Exception, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: 未知错误
2025-09-05 15:06:03 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:06:04 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:06:49 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:06:49 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:06:50 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:07:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-290' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 15:07:02 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 15:07:02 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 15:09:28 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:09:28 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:09:29 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:10:04 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-328' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 15:10:04 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 15:10:04 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 15:13:15 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: 未知错误
2025-09-05 15:13:15 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:275 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: lotflkvhk4mf6hsf4s, 异常类型: Exception, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: 未知错误
2025-09-05 15:15:53 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:15:53 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:15:54 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:15:56 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-34' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 15:15:57 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 15:15:57 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 15:27:47 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:27:47 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:27:48 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:27:53 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-64' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 15:27:53 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 15:27:53 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 15:33:45 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-82' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 15:33:45 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 15:33:45 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 15:39:41 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:39:41 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:39:42 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:39:56 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-135' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 15:39:56 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 15:39:56 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 15:39:59 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: 未知错误
2025-09-05 15:39:59 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:278 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: d3qcx6qkcgomf6iqs5u, 异常类型: Exception, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: 未知错误
2025-09-05 15:44:22 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:44:22 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:44:26 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:44:45 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-34' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 15:44:45 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 15:44:45 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 15:50:59 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: 未知错误
2025-09-05 15:50:59 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:278 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: sephbjglbljmf6j4xp2, 异常类型: Exception, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: 未知错误
2025-09-05 15:56:06 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:56:06 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:56:07 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 15:56:18 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-34' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 15:56:18 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 15:56:18 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 16:00:00 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 16:00:06 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:548 | _perform_security_checks | 安全检查失败: name 're' is not defined
2025-09-05 16:00:13 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-71' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 16:00:13 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 16:00:13 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 16:00:52 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-81' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 16:00:52 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 16:00:52 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 16:02:32 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: 未知错误
2025-09-05 16:02:32 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:278 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: y83zdcdr0famf6jjs73, 异常类型: Exception, 错误: AI调用失败: 未知错误
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: 未知错误
2025-09-05 16:15:13 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-46' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 16:15:14 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 16:15:14 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 16:21:28 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: 未知错误
2025-09-05 16:21:28 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:279 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: rryfwywvyummf6k84kn
2025-09-05 16:21:28 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:280 | _process_streaming_ai_chat |    📋 异常类型: Exception
2025-09-05 16:21:28 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:281 | _process_streaming_ai_chat |    📝 错误信息: AI调用失败: 未知错误
2025-09-05 16:21:28 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:282 | _process_streaming_ai_chat |    🔍 原始异常对象: Exception('AI调用失败: 未知错误')
2025-09-05 16:21:28 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:283 | _process_streaming_ai_chat |    📍 异常属性: ['__cause__', '__class__', '__context__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setstate__', '__sizeof__', '__str__', '__subclasshook__', '__suppress_context__', '__traceback__', 'add_note', 'args', 'with_traceback']
2025-09-05 16:21:28 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:285 | _process_streaming_ai_chat |    📄 异常参数: ('AI调用失败: 未知错误',)
2025-09-05 16:21:28 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:286 | _process_streaming_ai_chat | ❌ 异常堆栈跟踪:
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: 未知错误
2025-09-05 16:24:02 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-111' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 16:24:02 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 16:24:02 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 16:35:39 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-39' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 16:35:39 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 16:35:39 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 16:58:17 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-34' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 16:58:17 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 16:58:17 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 17:00:55 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-82' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 17:00:55 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 17:00:55 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 17:04:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: Request timed out.
2025-09-05 17:04:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:279 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: i7t535j7njgmf6lrhuv
2025-09-05 17:04:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:280 | _process_streaming_ai_chat |    📋 异常类型: Exception
2025-09-05 17:04:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:281 | _process_streaming_ai_chat |    📝 错误信息: AI调用失败: Request timed out.
2025-09-05 17:04:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:282 | _process_streaming_ai_chat |    🔍 原始异常对象: Exception('AI调用失败: Request timed out.')
2025-09-05 17:04:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:283 | _process_streaming_ai_chat |    📍 异常属性: ['__cause__', '__class__', '__context__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setstate__', '__sizeof__', '__str__', '__subclasshook__', '__suppress_context__', '__traceback__', 'add_note', 'args', 'with_traceback']
2025-09-05 17:04:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:285 | _process_streaming_ai_chat |    📄 异常参数: ('AI调用失败: Request timed out.',)
2025-09-05 17:04:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:286 | _process_streaming_ai_chat | ❌ 异常堆栈跟踪:
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: Request timed out.
2025-09-05 17:15:09 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-29' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 17:15:09 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 17:15:09 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 17:21:23 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: Request timed out.
2025-09-05 17:21:23 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:279 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: yxeszy75gbjmf6md6yy
2025-09-05 17:21:23 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:280 | _process_streaming_ai_chat |    📋 异常类型: Exception
2025-09-05 17:21:23 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:281 | _process_streaming_ai_chat |    📝 错误信息: AI调用失败: Request timed out.
2025-09-05 17:21:23 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:282 | _process_streaming_ai_chat |    🔍 原始异常对象: Exception('AI调用失败: Request timed out.')
2025-09-05 17:21:23 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:283 | _process_streaming_ai_chat |    📍 异常属性: ['__cause__', '__class__', '__context__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setstate__', '__sizeof__', '__str__', '__subclasshook__', '__suppress_context__', '__traceback__', 'add_note', 'args', 'with_traceback']
2025-09-05 17:21:23 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:285 | _process_streaming_ai_chat |    📄 异常参数: ('AI调用失败: Request timed out.',)
2025-09-05 17:21:23 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:286 | _process_streaming_ai_chat | ❌ 异常堆栈跟踪:
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: Request timed out.
2025-09-05 17:39:40 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-39' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 17:39:40 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 17:39:40 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 17:52:31 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 17:52:31 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 19:34:10 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-49' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 19:34:10 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 19:34:10 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 19:40:25 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:225 | _process_streaming_ai_chat | ❌ AI调用明确失败: Request timed out.
2025-09-05 19:40:25 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:279 | _process_streaming_ai_chat | ❌ 流式AI对话处理失败 - Request ID: cp9z7o6ki68mf6rbyxi
2025-09-05 19:40:25 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:280 | _process_streaming_ai_chat |    📋 异常类型: Exception
2025-09-05 19:40:25 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:281 | _process_streaming_ai_chat |    📝 错误信息: AI调用失败: Request timed out.
2025-09-05 19:40:25 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:282 | _process_streaming_ai_chat |    🔍 原始异常对象: Exception('AI调用失败: Request timed out.')
2025-09-05 19:40:25 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:283 | _process_streaming_ai_chat |    📍 异常属性: ['__cause__', '__class__', '__context__', '__delattr__', '__dict__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getstate__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__le__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setstate__', '__sizeof__', '__str__', '__subclasshook__', '__suppress_context__', '__traceback__', 'add_note', 'args', 'with_traceback']
2025-09-05 19:40:25 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:285 | _process_streaming_ai_chat |    📄 异常参数: ('AI调用失败: Request timed out.',)
2025-09-05 19:40:25 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:286 | _process_streaming_ai_chat | ❌ 异常堆栈跟踪:
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 226, in _process_streaming_ai_chat
    raise Exception(f"AI调用失败: {error_msg}")
Exception: AI调用失败: Request timed out.
2025-09-05 19:56:32 | app.services.anthropic_oauth_service | ERROR | anthropic_oauth_service.py:184 | exchange_setup_token_code | ❌ Setup Token exchange failed: HTTP 403
2025-09-05 19:56:32 | app.services.anthropic_oauth_service | ERROR | anthropic_oauth_service.py:185 | exchange_setup_token_code | Response body: <!DOCTYPE html><html lang="en-US"><head><title>Just a moment...</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="robots" content="noindex,nofollow"><meta name="viewport" content="width=device-width,initial-scale=1"><style>*{box-sizing:border-box;margin:0;padding:0}html{line-height:1.15;-webkit-text-size-adjust:100%;color:#313131;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helve
2025-09-05 19:56:32 | app.api.v1.anthropic_accounts | ERROR | anthropic_accounts.py:150 | exchange_setup_token | ❌ Failed to exchange Setup Token: OAuth交换失败: HTTP 403
2025-09-05 20:24:47 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:246 | _process_streaming_ai_chat | ❌ AI流式对话错误: 流式AI服务异常: AIService.check_daily_usage_limit() missing 1 required positional argument: 'membership_level'
2025-09-05 20:28:50 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-14' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:28:50 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 20:28:50 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 20:30:48 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-4, started daemon 133883301463744)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 20:31:26 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-79' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:31:26 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 20:31:26 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 20:32:15 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-90' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:32:15 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:246 | _process_streaming_ai_chat | ❌ AI流式对话错误: 流式AI服务异常: 'ClaudeConversation' object is not subscriptable
2025-09-05 20:34:08 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-113' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:34:08 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:246 | _process_streaming_ai_chat | ❌ AI流式对话错误: 流式AI服务异常: 'ClaudeConversation' object is not subscriptable
2025-09-05 20:37:31 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:37:31 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 20:37:31 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 20:37:41 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-30' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:37:41 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 20:37:41 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 20:38:50 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-61' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:38:50 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:246 | _process_streaming_ai_chat | ❌ AI流式对话错误: 流式AI服务异常: 'ClaudeConversation' object has no attribute 'role'
2025-09-05 20:39:01 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 135953838507712)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 20:39:18 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-96' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:39:18 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 20:39:18 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 20:40:13 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-107' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:40:13 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:246 | _process_streaming_ai_chat | ❌ AI流式对话错误: 流式AI服务异常: 'ClaudeConversation' object has no attribute 'role'
2025-09-05 20:55:03 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:55:04 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 20:55:04 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 20:55:10 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:246 | _process_streaming_ai_chat | ❌ AI流式对话错误: 
2025-09-05 20:55:13 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-29' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 20:55:13 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 20:55:13 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:03:16 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:03:16 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:03:16 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:03:36 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-30' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:03:36 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:03:36 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:04:02 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-61' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:04:02 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:04:02 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:04:12 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-67' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:04:12 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:04:12 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:04:12 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:246 | _process_streaming_ai_chat | ❌ AI流式对话错误: {'error': 'Claude API error', 'status': 400, 'details': '{"type":"error","error":{"type":"invalid_request_error","message":"messages: Unexpected role \\"我想开发一个macd背离策略\\". Allowed roles are \\"user\\" or \\"assistant\\""},"request_id":"req_011CSqJQYdqBhosFgsYaAccp"}', 'timestamp': '2025-09-05T13:04:12.808Z'}
2025-09-05 21:04:57 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-124' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:06:54 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-3, started daemon 129215783503552)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 21:07:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-147' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:07:43 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-5, started daemon 129215668160192)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 21:07:43 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 129215835932352)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 21:07:43 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-7, started daemon 129215647188672)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 21:08:07 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-207' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:12:20 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-215' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:12:20 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:12:20 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:12:36 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-226' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:16:41 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:23:43 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 139637702002368)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 21:23:48 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-47' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:23:48 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:23:48 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:23:48 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-53' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:23:49 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:23:49 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:24:08 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-64' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:24:43 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-72' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:37:23 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:37:23 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:37:23 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:37:40 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-30' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:40:05 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-19' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:42:45 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-42' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:42:45 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:42:45 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:42:45 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 137758003693248)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 21:42:46 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:246 | _process_streaming_ai_chat | ❌ AI流式对话错误: {'error': 'Claude API error', 'status': 400, 'details': '{"type":"error","error":{"type":"invalid_request_error","message":"messages: Unexpected role \\"我想开发一个macd背离策略\\". Allowed roles are \\"user\\" or \\"assistant\\""},"request_id":"req_011CSqMM6SFfKU2Kx3q6jP29"}', 'timestamp': '2025-09-05T13:42:46.378Z'}
2025-09-05 21:43:10 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-89' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:43:50 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-124' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:45:03 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-5, started daemon 137757764617920)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 21:45:16 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-147' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:46:04 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-3, started daemon 137757877864128)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 21:46:04 | app.api.v1.admin.claude | ERROR | claude.py:1623 | get_users_detailed_stats | 获取用户详细统计失败: (sqlite3.OperationalError) no such column: cl.tokens_input
[SQL: 
            SELECT 
                u.id as user_id,
                u.username,
                u.email,
                u.membership_level,
                u.is_active,
                u.last_login_at,
                COALESCE(SUM(cl.tokens_input + cl.tokens_output), 0) as total_tokens,
                COALESCE(COUNT(cl.id), 0) as total_requests,
                COALESCE(SUM(cl.api_cost), 0.0) as total_cost,
                MAX(cl.request_date) as last_usage_date
            FROM users u
            LEFT JOIN claude_usage_logs cl ON u.id = cl.user_id
            WHERE u.id IS NOT NULL
            GROUP BY u.id, u.username, u.email, u.membership_level, u.is_active, u.last_login_at
            ORDER BY total_cost DESC, total_requests DESC
            LIMIT 50
        ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-05 21:52:52 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-231' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:52:52 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:52:52 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:53:16 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-242' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:59:08 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-8, started daemon 137757733160640)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 21:59:15 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-275' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 21:59:15 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 21:59:15 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 21:59:57 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-6, started daemon 137757754132160)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 22:05:03 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-318' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 22:05:03 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 22:05:03 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:24:00 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-391' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:24:00 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:24:00 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:30:32 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-13, started daemon 137757542319808)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:31:17 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-496' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:31:17 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:31:17 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:32:04 | app.api.v1.admin.claude | ERROR | claude.py:1623 | get_users_detailed_stats | 获取用户详细统计失败: (sqlite3.OperationalError) no such column: cl.tokens_input
[SQL: 
            SELECT 
                u.id as user_id,
                u.username,
                u.email,
                u.membership_level,
                u.is_active,
                u.last_login_at,
                COALESCE(SUM(cl.tokens_input + cl.tokens_output), 0) as total_tokens,
                COALESCE(COUNT(cl.id), 0) as total_requests,
                COALESCE(SUM(cl.api_cost), 0.0) as total_cost,
                MAX(cl.request_date) as last_usage_date
            FROM users u
            LEFT JOIN claude_usage_logs cl ON u.id = cl.user_id
            WHERE u.id IS NOT NULL
            GROUP BY u.id, u.username, u.email, u.membership_level, u.is_active, u.last_login_at
            ORDER BY total_cost DESC, total_requests DESC
            LIMIT 50
        ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-05 23:32:41 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-543' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:39:45 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-29' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:39:45 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:39:45 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:39:56 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-40' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:40:42 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 133457927734976)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:43:44 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-29' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:43:44 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:43:44 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:43:59 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-40' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:43:59 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:43:59 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:46:14 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-82' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:46:14 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:46:14 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:47:19 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-93' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:47:19 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:47:19 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:48:21 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-119' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:48:21 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:48:21 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:48:21 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-139' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:48:21 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:48:21 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:48:21 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-152' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:48:21 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:48:21 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:48:22 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-163' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:48:22 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:48:22 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:48:22 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-174' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:48:22 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:48:22 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:48:37 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-4, started daemon 138275421423296)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:49:00 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-224' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:00 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:49:00 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-235' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:01 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-246' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:01 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-257' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:01 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-268' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:01 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-279' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:01 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-290' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:01 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-301' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:01 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-05 23:49:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-312' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:01 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-319' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-05 23:49:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 流式AI服务异常: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:49:51 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 数据块处理错误: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:49:54 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 数据块处理错误: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:50:01 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 数据块处理错误: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:50:03 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 数据块处理错误: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:50:04 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 数据块处理错误: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:50:09 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 数据块处理错误: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:50:21 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 数据块处理错误: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:50:22 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 数据块处理错误: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:50:31 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:260 | _process_streaming_ai_chat | ❌ AI流式对话错误: 流式AI服务异常: QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30.00 (Background on this error at: https://sqlalche.me/e/20/3o7r)
2025-09-05 23:55:17 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-7, started daemon 138275318662848)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:55:17 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 138275580806848)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:55:17 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-11, started daemon 138275276719808)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:55:17 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-12, started daemon 138275127822016)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:55:17 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-13, started daemon 138275117336256)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:55:17 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-14, started daemon 138275106850496)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:55:17 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-15, started daemon 138275096364736)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:55:17 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-16, started daemon 138275085878976)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-05 23:55:17 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-17, started daemon 138275075393216)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-06 00:06:14 | uvicorn.error | ERROR | server.py:172 | startup | [Errno 98] error while attempting to bind on address ('0.0.***.***.***', 8001): address already in use
2025-09-06 00:13:52 | app.api.v1.market_data | ERROR | market_data.py:60 | get_klines | ❌ 获取K线数据失败: BTCUSDT 1h - 400: 交易对格式错误，应为 BASE/QUOTE 格式
2025-09-06 00:17:45 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:408 | dispatch | API验证中间件处理请求失败: name 'business_logger' is not defined
2025-09-06 00:17:45 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:504 | _log_error | API错误: {"method": "POST", "path": "/auth/login", "error": "name 'business_logger' is not defined", "error_type": "NameError", "duration": 38.27, "client_ip": "127.0.***.***.***", "timestamp": "2025-09-05T16:17:45.262908"}
2025-09-06 15:25:00 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-34' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 15:25:00 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 15:25:00 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 15:26:15 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-45' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 15:26:15 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 15:26:15 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 15:28:36 | asyncio | ERROR | runners.py:118 | run | Task exception was never retrieved
future: <Task finished name='Task-58' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 15:28:36 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 15:28:36 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 20:05:18 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-125' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 20:05:18 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 20:05:18 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 20:14:07 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-155' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 20:14:07 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 20:14:07 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 20:20:36 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-214' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 20:20:36 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 20:20:36 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 20:23:45 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-227' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 20:23:45 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 20:23:45 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 20:24:03 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-266' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 20:24:03 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 20:24:03 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 20:32:08 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 20:32:08 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 20:33:56 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-323' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 20:33:56 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 20:33:56 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 20:34:32 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-376' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 20:34:32 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-06 20:34:32 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-06 20:40:35 | uvicorn.error | ERROR | server.py:172 | startup | [Errno 98] error while attempting to bind on address ('0.0.***.***.***', 8001): address already in use
2025-09-06 20:41:35 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-49' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 20:43:20 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-97' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 20:50:38 | uvicorn.error | ERROR | server.py:172 | startup | [Errno 98] error while attempting to bind on address ('0.0.***.***.***', 8001): address already in use
2025-09-06 20:52:59 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-53' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 22:27:56 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 135162908116672)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-06 22:28:03 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-106' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-06 23:56:49 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-4, started daemon 135162788579008)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-07 19:03:53 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-1813' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-07 19:19:01 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-8, started daemon 135162685818560)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-07 19:19:10 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-1842' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-07 19:20:09 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-1847' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-07 19:37:33 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-1852' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-07 19:38:36 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-9, started daemon 135162767607488)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-07 19:38:36 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-10, started daemon 135162809550528)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-07 19:38:36 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-11, started daemon 135162778093248)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-07 19:38:36 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-1857' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-08 03:49:11 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-12, started daemon 135162675332800)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-08 16:09:36 | app.services.okx_market_data_service | ERROR | okx_market_data_service.py:196 | get_symbol_info | ❌ 获取交易对信息失败: BTC-USDT-SWAP - not enough values to unpack (expected 2, got 1)
2025-09-08 16:09:36 | app.services.okx_market_data_service | ERROR | okx_market_data_service.py:196 | get_symbol_info | ❌ 获取交易对信息失败: ETH-USDT-SWAP - not enough values to unpack (expected 2, got 1)
2025-09-08 16:09:36 | app.services.okx_market_data_service | ERROR | okx_market_data_service.py:196 | get_symbol_info | ❌ 获取交易对信息失败: SOL-USDT-SWAP - not enough values to unpack (expected 2, got 1)
2025-09-08 16:09:36 | app.services.okx_market_data_service | ERROR | okx_market_data_service.py:196 | get_symbol_info | ❌ 获取交易对信息失败: ADA-USDT-SWAP - not enough values to unpack (expected 2, got 1)
2025-09-08 16:09:36 | app.services.okx_market_data_service | ERROR | okx_market_data_service.py:196 | get_symbol_info | ❌ 获取交易对信息失败: DOT-USDT-SWAP - not enough values to unpack (expected 2, got 1)
2025-09-08 16:09:36 | app.services.okx_market_data_service | ERROR | okx_market_data_service.py:196 | get_symbol_info | ❌ 获取交易对信息失败: LINK-USDT-SWAP - not enough values to unpack (expected 2, got 1)
2025-09-08 16:09:36 | app.services.okx_market_data_service | ERROR | okx_market_data_service.py:196 | get_symbol_info | ❌ 获取交易对信息失败: MATIC-USDT-SWAP - not enough values to unpack (expected 2, got 1)
2025-09-08 16:09:36 | app.services.okx_market_data_service | ERROR | okx_market_data_service.py:196 | get_symbol_info | ❌ 获取交易对信息失败: AVAX-USDT-SWAP - not enough values to unpack (expected 2, got 1)
2025-09-08 16:38:28 | app.api.v1.market_data | ERROR | market_data.py:60 | get_klines | ❌ 获取K线数据失败: BTC-USDT 15m - 400: 交易对格式错误，应为 BASE/QUOTE 格式
2025-09-08 21:23:13 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-55049' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-08 21:42:02 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-55097' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-08 21:45:28 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-55102' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-08 21:46:13 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-55107' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-08 21:48:19 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-55113' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-08 21:48:19 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-28, started daemon 135162654361280)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-08 21:48:19 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-26, started daemon 135162474006208)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-08 21:48:19 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-29, started daemon 135162484491968)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-08 21:48:19 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-27, started daemon 135162633389760)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-08 21:49:03 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-55118' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-08 21:49:31 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-55123' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-08 21:51:44 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-31, started daemon 135162664847040)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-08 21:52:43 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-08 21:52:43 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-08 22:02:31 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-08 22:02:31 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-08 22:05:23 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-08 22:05:23 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-08 22:18:31 | uvicorn.error | ERROR | on.py:134 | send | Traceback (most recent call last):
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 86, in _serve
    await self.startup(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 136, in startup
    server = await loop.create_server(create_protocol, sock=sock, ssl=config.ssl, backlog=config.backlog)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1597, in create_server
    server._start_serving()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 317, in _start_serving
    sock.listen(self._backlog)
OSError: [Errno 98] Address already in use

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.12/dist-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

2025-09-08 22:19:24 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-08 22:19:24 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-08 22:19:48 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-08 22:19:48 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-08 22:30:27 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-199' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-08 22:30:27 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-08 22:30:27 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-09 14:28:23 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-09 14:28:23 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-09 14:28:33 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: Expecting value: line 1 column 1 (char 0)
2025-09-09 14:28:33 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: Expecting value: line 1 column 1 (char 0)
2025-09-09 14:28:33 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: Expecting value: line 1 column 1 (char 0)
2025-09-09 14:29:02 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-09 14:29:02 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-09 14:29:13 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: Expecting value: line 1 column 1 (char 0)
2025-09-09 14:29:13 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: Expecting value: line 1 column 1 (char 0)
2025-09-09 14:29:13 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: Expecting value: line 1 column 1 (char 0)
2025-09-09 14:29:36 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-09 14:29:36 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-09 14:29:47 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: Expecting value: line 1 column 1 (char 0)
2025-09-09 14:29:47 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: Expecting value: line 1 column 1 (char 0)
2025-09-09 14:29:47 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: Expecting value: line 1 column 1 (char 0)
2025-09-09 14:32:33 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-648' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 14:32:33 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-09 14:32:33 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-09 14:34:44 | uvicorn.error | ERROR | on.py:134 | send | Traceback (most recent call last):
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 86, in _serve
    await self.startup(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 136, in startup
    server = await loop.create_server(create_protocol, sock=sock, ssl=config.ssl, backlog=config.backlog)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1597, in create_server
    server._start_serving()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 317, in _start_serving
    sock.listen(self._backlog)
OSError: [Errno 98] Address already in use

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.12/dist-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

2025-09-09 14:39:09 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-09 14:39:09 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-09 14:41:32 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-09 14:41:32 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-09 14:42:51 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: Incorrect padding
2025-09-09 14:42:51 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-09 14:45:28 | app.security.crypto_manager | ERROR | crypto_manager.py:172 | decrypt_private_key | 私钥解密失败: 
2025-09-09 14:45:28 | app.services.claude_account_service | ERROR | claude_account_service.py:83 | _decrypt_sensitive_data | Failed to decrypt data for : 私钥解密失败: 
2025-09-09 14:45:28 | app.services.claude_account_service | ERROR | claude_account_service.py:221 | get_decrypted_api_key | Cannot decrypt API key for account 1: Failed to decrypt sensitive data: 私钥解密失败: 
2025-09-09 15:00:52 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-368' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 15:02:30 | uvicorn.error | ERROR | on.py:134 | send | Traceback (most recent call last):
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 86, in _serve
    await self.startup(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 136, in startup
    server = await loop.create_server(create_protocol, sock=sock, ssl=config.ssl, backlog=config.backlog)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1597, in create_server
    server._start_serving()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 317, in _start_serving
    sock.listen(self._backlog)
OSError: [Errno 98] Address already in use

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.12/dist-packages/starlette/routing.py", line 701, in lifespan
    await receive()
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/lifespan/on.py", line 137, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

2025-09-09 15:17:15 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-100' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 15:17:30 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-125' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 21:09:11 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-228' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 21:14:01 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-241' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 21:15:35 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-254' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 21:17:05 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-267' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 21:20:21 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-280' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 21:20:39 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-293' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 21:22:16 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-3, started daemon 123853086918336)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 21:22:16 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-5, started daemon 123853055461056)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 21:22:16 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-4, started daemon 123853065946816)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 21:22:16 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-6, started daemon 123853044975296)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 21:22:16 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-7, started daemon 123852963186368)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 21:24:14 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-434' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 21:44:58 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: 
2025-09-09 21:44:58 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: 
2025-09-09 21:44:58 | app.middleware.api_validation_middleware | ERROR | api_validation_middleware.py:720 | _get_request_body | 获取请求体失败: 
2025-09-09 21:45:44 | uvicorn.error | ERROR | server.py:172 | startup | [Errno 98] error while attempting to bind on address ('0.0.***.***.***', 8001): address already in use
2025-09-09 22:05:22 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-95' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 22:06:42 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-119' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 22:06:42 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-3, started daemon 139682564277952)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 22:07:16 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-130' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 22:09:28 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-149' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 22:09:44 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-162' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 22:10:51 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-175' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 22:11:56 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-218' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-09 22:12:40 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-4, started daemon 139682467808960)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 22:12:40 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-6, started daemon 139682446837440)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 22:12:40 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-7, started daemon 139682436351680)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 22:12:40 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-8, started daemon 139682425865920)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-09 22:12:40 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-5, started daemon 139682457323200)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 11:38:02 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-501' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 11:39:25 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-514' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 11:40:42 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-527' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 11:42:05 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-540' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 11:43:07 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-553' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 11:43:20 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-13, started daemon 139682255996608)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 11:43:20 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-15, started daemon 139682235025088)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 11:43:20 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-11, started daemon 139682415380160)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 11:43:20 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-14, started daemon 139682245510848)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 11:43:24 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-614' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 11:54:32 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-46' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 11:56:58 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-40' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:00:10 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-40' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:11:27 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-69' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:34:50 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-98' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:41:46 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-161' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:44:19 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-189' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:46:08 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-200' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:47:55 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-213' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:48:30 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-226' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:48:30 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-3, started daemon 134416368142016)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 12:48:30 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-4, started daemon 134416347170496)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 12:48:30 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-5, started daemon 134416336684736)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 12:48:56 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-275' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 12:57:27 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-357' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 13:11:56 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-33' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 13:23:43 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x70619ecefce0>
2025-09-10 13:23:43 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x70619dff3f50>, 1169741.390673116)])']
connector: <aiohttp.connector.TCPConnector object at 0x70619f645be0>
2025-09-10 13:25:26 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x74184fc2f560>
2025-09-10 13:25:26 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x74184efe92b0>, 1169844.091339514)])']
connector: <aiohttp.connector.TCPConnector object at 0x74184fe07530>
2025-09-10 13:44:33 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-39' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 13:44:33 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:274 | _process_streaming_ai_chat | ❌ AI流式对话错误: AI服务繁忙，请稍后重试
2025-09-10 13:58:14 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-39' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 13:58:14 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:274 | _process_streaming_ai_chat | ❌ AI流式对话错误: AI服务繁忙，请稍后重试
2025-09-10 13:58:41 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-3, started daemon 124039087523520)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 13:58:48 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-87' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 13:58:48 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:274 | _process_streaming_ai_chat | ❌ AI流式对话错误: AI服务繁忙，请稍后重试
2025-09-10 14:10:33 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-45' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 14:11:16 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x751675d85bb0>
2025-09-10 14:11:16 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x751674732b10>, 1172594.131655434)])']
connector: <aiohttp.connector.TCPConnector object at 0x751674728e30>
2025-09-10 14:17:25 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-85' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 14:17:58 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7516766b4fe0>
2025-09-10 14:17:58 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x7516747613d0>, 1172996.736343741)])']
connector: <aiohttp.connector.TCPConnector object at 0x75167666b4a0>
2025-09-10 14:29:31 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-119' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 14:29:58 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x7516769ac260>
2025-09-10 14:29:58 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x751674761df0>, 1173716.836705248)])']
connector: <aiohttp.connector.TCPConnector object at 0x75167666b4a0>
2025-09-10 14:38:08 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-171' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 14:38:40 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x751675d55ee0>
2025-09-10 14:38:40 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x751674762b70>, 1174238.206764861)])']
connector: <aiohttp.connector.TCPConnector object at 0x751675d557f0>
2025-09-10 15:04:44 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-247' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 15:05:20 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x75167672eab0>
2025-09-10 15:05:20 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Unclosed connector
connections: ['deque([(<aiohttp.client_proto.ResponseHandler object at 0x751674762330>, 1175838.35729321)])']
connector: <aiohttp.connector.TCPConnector object at 0x75167496ddf0>
2025-09-10 15:35:24 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-65' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 15:35:25 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:274 | _process_streaming_ai_chat | ❌ AI流式对话错误: AI服务繁忙，请稍后重试
2025-09-10 15:35:48 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-3, started daemon 128519476610752)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 15:36:11 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-113' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 15:36:11 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:274 | _process_streaming_ai_chat | ❌ AI流式对话错误: AI服务繁忙，请稍后重试
2025-09-10 15:39:39 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-4, started daemon 128519378044608)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
2025-09-10 15:44:01 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-45' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 15:44:01 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:274 | _process_streaming_ai_chat | ❌ AI流式对话错误: AI服务繁忙，请稍后重试
2025-09-10 16:48:19 | asyncio | ERROR | base_events.py:1821 | default_exception_handler | Task exception was never retrieved
future: <Task finished name='Task-58' coro=<<async_generator_athrow without __name__>()> exception=IllegalStateChangeError("Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5>")>
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/database.py", line 66, in get_db
    await session.close()
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/ext/asyncio/session.py", line 1030, in close
    await greenlet_spawn(self.sync_session.close)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/util/_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2521, in close
    self._close_impl(invalidate=False)
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/session.py", line 2590, in _close_impl
    transaction.close(invalidate)
  File "<string>", line 2, in close
  File "/usr/local/lib/python3.12/dist-packages/sqlalchemy/orm/state_changes.py", line 119, in _go
    raise sa_exc.IllegalStateChangeError(
sqlalchemy.exc.IllegalStateChangeError: Method 'close()' can't be called here; method '_connection_for_bind()' is already in progress and this would cause an unexpected state change to <SessionTransactionState.CLOSED: 5> (Background on this error at: https://sqlalche.me/e/20/isce)
2025-09-10 16:48:19 | app.api.v1.ai_websocket | ERROR | ai_websocket.py:275 | _process_streaming_ai_chat | ❌ AI流式对话错误: AI服务繁忙，请稍后重试
2025-09-10 17:48:44 | sqlalchemy.pool.impl.AsyncAdaptedQueuePool | ERROR | base.py:1030 | _finalize_fairy | The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 124511460525760)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
