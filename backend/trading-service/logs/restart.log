INFO:     Will watch for changes in these directories: ['/root/trademe/backend/trading-service']
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     Started reloader process [3708881] using StatReload
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 16:31:14.093 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
âœ… ä½¿ç”¨logging.yamlé…ç½®æ–‡ä»¶
âœ… APIéªŒè¯ä¸­é—´ä»¶é›†æˆæˆåŠŸ
2025-09-13 16:31:15 | uvicorn.error | INFO | Started server process [3708895]
2025-09-13 16:31:15 | uvicorn.error | INFO | Waiting for application startup.
2025-09-13 16:31:15 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/register, å­—æ®µæ•°: 2
2025-09-13 16:31:15 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/login, å­—æ®µæ•°: 2
2025-09-13 16:31:15 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/trading/orders, å­—æ®µæ•°: 5
2025-09-13 16:31:15 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/strategies, å­—æ®µæ•°: 3
2025-09-13 16:31:15 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/ai/chat, å­—æ®µæ•°: 3
2025-09-13 16:31:15 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/market-data/klines, å­—æ®µæ•°: 3
2025-09-13 16:31:15 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/backtest, å­—æ®µæ•°: 5
2025-09-13 16:31:15 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/wallet/transfer, å­—æ®µæ•°: 3
2025-09-13 16:31:15 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/data/download, å­—æ®µæ•°: 5
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“‹ åŒ…å«çš„è¡¨ï¼šç”¨æˆ·ã€ç­–ç•¥ã€å›æµ‹ã€äº¤æ˜“ã€APIå¯†é’¥ã€å¸‚åœºæ•°æ®ã€Claudeå¯¹è¯ã€äº¤æ˜“å¿ƒå¾—
ğŸ“‹ ç®¡ç†åå°è¡¨ï¼šç®¡ç†å‘˜ã€Claudeä»£ç†æ± ã€USDTæ”¯ä»˜ã€æ•°æ®é‡‡é›†
âœ… Redisè¿æ¥æˆåŠŸ
ğŸ”‘ OKX APIè®¤è¯æˆåŠŸï¼Œå·²è¿æ¥åˆ°çœŸå®äº¤æ˜“æ¥å£
ğŸš€ Trading Service å¯åŠ¨æˆåŠŸ
ğŸ“Š ç¯å¢ƒ: development
ğŸ  Host: 0.0.0.0:8001
2025-09-13 16:31:15 | uvicorn.error | INFO | Application startup complete.
2025-09-13 16:33:31 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:33:31.924050", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...V6EhWg", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "300"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "binance", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2024-01-01", "end_date": "2024-01-31", "data_type": "kline"}}
2025-09-13 16:33:31 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:33:31.926 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:33:31.927 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 404
2025-09-13 16:33:31 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 404, "duration": 3.83, "timestamp": "2025-09-13T08:33:31.927831"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:59326', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 404)
2025-09-13 16:33:31 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:33:31.958909", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...V6EhWg", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "296"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "okx", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2024-01-01", "end_date": "2024-01-31", "data_type": "kline"}}
2025-09-13 16:33:31 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:33:31.960 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:33:31.961 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 404
2025-09-13 16:33:31 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 404, "duration": 3.22, "timestamp": "2025-09-13T08:33:31.962085"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:59338', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 404)
WARNING:  StatReload detected changes in 'app/api/v1/realtime_backtest.py'. Reloading...
2025-09-13 16:34:48 | uvicorn.error | INFO | Shutting down
2025-09-13 16:34:48 | uvicorn.error | INFO | Waiting for application shutdown.
âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
âœ… Redisè¿æ¥å·²å…³é—­
ğŸ‘‹ Trading Service å·²å…³é—­
2025-09-13 16:34:48 | uvicorn.error | INFO | Application shutdown complete.
2025-09-13 16:34:48 | uvicorn.error | INFO | Finished server process [3708895]
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 16:34:51.123 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
âœ… ä½¿ç”¨logging.yamlé…ç½®æ–‡ä»¶
âœ… APIéªŒè¯ä¸­é—´ä»¶é›†æˆæˆåŠŸ
2025-09-13 16:34:51 | uvicorn.error | INFO | Started server process [3710357]
2025-09-13 16:34:51 | uvicorn.error | INFO | Waiting for application startup.
2025-09-13 16:34:51 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/register, å­—æ®µæ•°: 2
2025-09-13 16:34:51 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/login, å­—æ®µæ•°: 2
2025-09-13 16:34:51 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/trading/orders, å­—æ®µæ•°: 5
2025-09-13 16:34:51 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/strategies, å­—æ®µæ•°: 3
2025-09-13 16:34:51 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/ai/chat, å­—æ®µæ•°: 3
2025-09-13 16:34:51 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/market-data/klines, å­—æ®µæ•°: 3
2025-09-13 16:34:51 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/backtest, å­—æ®µæ•°: 5
2025-09-13 16:34:51 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/wallet/transfer, å­—æ®µæ•°: 3
2025-09-13 16:34:51 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/data/download, å­—æ®µæ•°: 5
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“‹ åŒ…å«çš„è¡¨ï¼šç”¨æˆ·ã€ç­–ç•¥ã€å›æµ‹ã€äº¤æ˜“ã€APIå¯†é’¥ã€å¸‚åœºæ•°æ®ã€Claudeå¯¹è¯ã€äº¤æ˜“å¿ƒå¾—
ğŸ“‹ ç®¡ç†åå°è¡¨ï¼šç®¡ç†å‘˜ã€Claudeä»£ç†æ± ã€USDTæ”¯ä»˜ã€æ•°æ®é‡‡é›†
âœ… Redisè¿æ¥æˆåŠŸ
ğŸ”‘ OKX APIè®¤è¯æˆåŠŸï¼Œå·²è¿æ¥åˆ°çœŸå®äº¤æ˜“æ¥å£
ğŸš€ Trading Service å¯åŠ¨æˆåŠŸ
ğŸ“Š ç¯å¢ƒ: development
ğŸ  Host: 0.0.0.0:8001
2025-09-13 16:34:51 | uvicorn.error | INFO | Application startup complete.
2025-09-13 16:34:59 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/active", "path": "/api/v1/realtime-backtest/active", "client_ip": "127.0.***.***.***", "user_agent": "curl/8.5.0", "timestamp": "2025-09-13T08:34:59.297344", "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*"}, "query_params": {}}
2025-09-13 16:34:59 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:34:59 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/active
2025-09-13 16:34:59.298 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:34:59.299 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 401
2025-09-13 16:34:59 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/active", "status_code": 401, "duration": 3.36, "timestamp": "2025-09-13T08:34:59.300653"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56434', 'GET', '/api/v1/realtime-backtest/active', '1.1', 401)
2025-09-13 16:36:20 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:36:20.635448", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...V6EhWg", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "300"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "binance", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2024-01-01", "end_date": "2024-01-31", "data_type": "kline"}}
2025-09-13 16:36:20 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:36:20.637 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:36:20.640 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 401
2025-09-13 16:36:20 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 401, "duration": 4.79, "timestamp": "2025-09-13T08:36:20.640196"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:49326', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 401)
2025-09-13 16:36:20 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:36:20.645679", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...V6EhWg", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "296"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "okx", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2024-01-01", "end_date": "2024-01-31", "data_type": "kline"}}
2025-09-13 16:36:20 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:36:20.647 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:36:20.648 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 401
2025-09-13 16:36:20 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 401, "duration": 3.48, "timestamp": "2025-09-13T08:36:20.649137"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:49342', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 401)
WARNING:  StatReload detected changes in 'test_data_source_fix.py'. Reloading...
2025-09-13 16:41:14 | uvicorn.error | INFO | Shutting down
2025-09-13 16:41:15 | uvicorn.error | INFO | Waiting for application shutdown.
âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
âœ… Redisè¿æ¥å·²å…³é—­
ğŸ‘‹ Trading Service å·²å…³é—­
2025-09-13 16:41:15 | uvicorn.error | INFO | Application shutdown complete.
2025-09-13 16:41:15 | uvicorn.error | INFO | Finished server process [3710357]
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 16:41:17.900 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
âœ… ä½¿ç”¨logging.yamlé…ç½®æ–‡ä»¶
âœ… APIéªŒè¯ä¸­é—´ä»¶é›†æˆæˆåŠŸ
2025-09-13 16:41:18 | uvicorn.error | INFO | Started server process [3712565]
2025-09-13 16:41:18 | uvicorn.error | INFO | Waiting for application startup.
2025-09-13 16:41:18 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/register, å­—æ®µæ•°: 2
2025-09-13 16:41:18 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/login, å­—æ®µæ•°: 2
2025-09-13 16:41:18 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/trading/orders, å­—æ®µæ•°: 5
2025-09-13 16:41:18 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/strategies, å­—æ®µæ•°: 3
2025-09-13 16:41:18 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/ai/chat, å­—æ®µæ•°: 3
2025-09-13 16:41:18 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/market-data/klines, å­—æ®µæ•°: 3
2025-09-13 16:41:18 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/backtest, å­—æ®µæ•°: 5
2025-09-13 16:41:18 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/wallet/transfer, å­—æ®µæ•°: 3
2025-09-13 16:41:18 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/data/download, å­—æ®µæ•°: 5
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“‹ åŒ…å«çš„è¡¨ï¼šç”¨æˆ·ã€ç­–ç•¥ã€å›æµ‹ã€äº¤æ˜“ã€APIå¯†é’¥ã€å¸‚åœºæ•°æ®ã€Claudeå¯¹è¯ã€äº¤æ˜“å¿ƒå¾—
ğŸ“‹ ç®¡ç†åå°è¡¨ï¼šç®¡ç†å‘˜ã€Claudeä»£ç†æ± ã€USDTæ”¯ä»˜ã€æ•°æ®é‡‡é›†
âœ… Redisè¿æ¥æˆåŠŸ
ğŸ”‘ OKX APIè®¤è¯æˆåŠŸï¼Œå·²è¿æ¥åˆ°çœŸå®äº¤æ˜“æ¥å£
ğŸš€ Trading Service å¯åŠ¨æˆåŠŸ
ğŸ“Š ç¯å¢ƒ: development
ğŸ  Host: 0.0.0.0:8001
2025-09-13 16:41:18 | uvicorn.error | INFO | Application startup complete.
2025-09-13 16:41:20 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:41:20.409397", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "300"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "binance", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2024-01-01", "end_date": "2024-01-31", "data_type": "kline"}}
2025-09-13 16:41:20 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:41:20.411 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:41:20.415 | ERROR    | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1231 - å¯åŠ¨AIç­–ç•¥å›æµ‹å¤±è´¥: 'MockUser' object has no attribute 'get'
2025-09-13 16:41:20.415 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 400
2025-09-13 16:41:20 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 400, "duration": 6.31, "timestamp": "2025-09-13T08:41:20.415660"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:48716', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 400)
2025-09-13 16:41:20 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:41:20.422230", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "296"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "okx", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2024-01-01", "end_date": "2024-01-31", "data_type": "kline"}}
2025-09-13 16:41:20 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:41:20.423 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:41:20.424 | ERROR    | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1231 - å¯åŠ¨AIç­–ç•¥å›æµ‹å¤±è´¥: 'MockUser' object has no attribute 'get'
2025-09-13 16:41:20.425 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 400
2025-09-13 16:41:20 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 400, "duration": 2.98, "timestamp": "2025-09-13T08:41:20.425179"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:48728', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 400)
WARNING:  StatReload detected changes in 'app/api/v1/realtime_backtest.py'. Reloading...
2025-09-13 16:42:36 | uvicorn.error | INFO | Shutting down
2025-09-13 16:42:36 | uvicorn.error | INFO | Waiting for application shutdown.
âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
âœ… Redisè¿æ¥å·²å…³é—­
ğŸ‘‹ Trading Service å·²å…³é—­
2025-09-13 16:42:36 | uvicorn.error | INFO | Application shutdown complete.
2025-09-13 16:42:36 | uvicorn.error | INFO | Finished server process [3712565]
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 16:42:39.858 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
âœ… ä½¿ç”¨logging.yamlé…ç½®æ–‡ä»¶
âœ… APIéªŒè¯ä¸­é—´ä»¶é›†æˆæˆåŠŸ
2025-09-13 16:42:40 | uvicorn.error | INFO | Started server process [3713128]
2025-09-13 16:42:40 | uvicorn.error | INFO | Waiting for application startup.
2025-09-13 16:42:40 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/register, å­—æ®µæ•°: 2
2025-09-13 16:42:40 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/login, å­—æ®µæ•°: 2
2025-09-13 16:42:40 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/trading/orders, å­—æ®µæ•°: 5
2025-09-13 16:42:40 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/strategies, å­—æ®µæ•°: 3
2025-09-13 16:42:40 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/ai/chat, å­—æ®µæ•°: 3
2025-09-13 16:42:40 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/market-data/klines, å­—æ®µæ•°: 3
2025-09-13 16:42:40 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/backtest, å­—æ®µæ•°: 5
2025-09-13 16:42:40 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/wallet/transfer, å­—æ®µæ•°: 3
2025-09-13 16:42:40 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/data/download, å­—æ®µæ•°: 5
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“‹ åŒ…å«çš„è¡¨ï¼šç”¨æˆ·ã€ç­–ç•¥ã€å›æµ‹ã€äº¤æ˜“ã€APIå¯†é’¥ã€å¸‚åœºæ•°æ®ã€Claudeå¯¹è¯ã€äº¤æ˜“å¿ƒå¾—
ğŸ“‹ ç®¡ç†åå°è¡¨ï¼šç®¡ç†å‘˜ã€Claudeä»£ç†æ± ã€USDTæ”¯ä»˜ã€æ•°æ®é‡‡é›†
âœ… Redisè¿æ¥æˆåŠŸ
ğŸ”‘ OKX APIè®¤è¯æˆåŠŸï¼Œå·²è¿æ¥åˆ°çœŸå®äº¤æ˜“æ¥å£
ğŸš€ Trading Service å¯åŠ¨æˆåŠŸ
ğŸ“Š ç¯å¢ƒ: development
ğŸ  Host: 0.0.0.0:8001
2025-09-13 16:42:40 | uvicorn.error | INFO | Application startup complete.
WARNING:  StatReload detected changes in 'app/api/v1/realtime_backtest.py'. Reloading...
2025-09-13 16:42:46 | uvicorn.error | INFO | Shutting down
2025-09-13 16:42:46 | uvicorn.error | INFO | Waiting for application shutdown.
âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
âœ… Redisè¿æ¥å·²å…³é—­
ğŸ‘‹ Trading Service å·²å…³é—­
2025-09-13 16:42:46 | uvicorn.error | INFO | Application shutdown complete.
2025-09-13 16:42:46 | uvicorn.error | INFO | Finished server process [3713128]
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 16:42:49.441 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
âœ… ä½¿ç”¨logging.yamlé…ç½®æ–‡ä»¶
âœ… APIéªŒè¯ä¸­é—´ä»¶é›†æˆæˆåŠŸ
2025-09-13 16:42:50 | uvicorn.error | INFO | Started server process [3713187]
2025-09-13 16:42:50 | uvicorn.error | INFO | Waiting for application startup.
2025-09-13 16:42:50 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/register, å­—æ®µæ•°: 2
2025-09-13 16:42:50 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/login, å­—æ®µæ•°: 2
2025-09-13 16:42:50 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/trading/orders, å­—æ®µæ•°: 5
2025-09-13 16:42:50 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/strategies, å­—æ®µæ•°: 3
2025-09-13 16:42:50 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/ai/chat, å­—æ®µæ•°: 3
2025-09-13 16:42:50 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/market-data/klines, å­—æ®µæ•°: 3
2025-09-13 16:42:50 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/backtest, å­—æ®µæ•°: 5
2025-09-13 16:42:50 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/wallet/transfer, å­—æ®µæ•°: 3
2025-09-13 16:42:50 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/data/download, å­—æ®µæ•°: 5
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“‹ åŒ…å«çš„è¡¨ï¼šç”¨æˆ·ã€ç­–ç•¥ã€å›æµ‹ã€äº¤æ˜“ã€APIå¯†é’¥ã€å¸‚åœºæ•°æ®ã€Claudeå¯¹è¯ã€äº¤æ˜“å¿ƒå¾—
ğŸ“‹ ç®¡ç†åå°è¡¨ï¼šç®¡ç†å‘˜ã€Claudeä»£ç†æ± ã€USDTæ”¯ä»˜ã€æ•°æ®é‡‡é›†
âœ… Redisè¿æ¥æˆåŠŸ
ğŸ”‘ OKX APIè®¤è¯æˆåŠŸï¼Œå·²è¿æ¥åˆ°çœŸå®äº¤æ˜“æ¥å£
ğŸš€ Trading Service å¯åŠ¨æˆåŠŸ
ğŸ“Š ç¯å¢ƒ: development
ğŸ  Host: 0.0.0.0:8001
2025-09-13 16:42:50 | uvicorn.error | INFO | Application startup complete.
WARNING:  StatReload detected changes in 'app/api/v1/realtime_backtest.py'. Reloading...
2025-09-13 16:42:58 | uvicorn.error | INFO | Shutting down
2025-09-13 16:42:58 | uvicorn.error | INFO | Waiting for application shutdown.
âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
âœ… Redisè¿æ¥å·²å…³é—­
ğŸ‘‹ Trading Service å·²å…³é—­
2025-09-13 16:42:58 | uvicorn.error | INFO | Application shutdown complete.
2025-09-13 16:42:58 | uvicorn.error | INFO | Finished server process [3713187]
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 16:43:01.062 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
âœ… ä½¿ç”¨logging.yamlé…ç½®æ–‡ä»¶
âœ… APIéªŒè¯ä¸­é—´ä»¶é›†æˆæˆåŠŸ
2025-09-13 16:43:01 | uvicorn.error | INFO | Started server process [3713272]
2025-09-13 16:43:01 | uvicorn.error | INFO | Waiting for application startup.
2025-09-13 16:43:01 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/register, å­—æ®µæ•°: 2
2025-09-13 16:43:01 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/login, å­—æ®µæ•°: 2
2025-09-13 16:43:01 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/trading/orders, å­—æ®µæ•°: 5
2025-09-13 16:43:01 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/strategies, å­—æ®µæ•°: 3
2025-09-13 16:43:01 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/ai/chat, å­—æ®µæ•°: 3
2025-09-13 16:43:01 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/market-data/klines, å­—æ®µæ•°: 3
2025-09-13 16:43:01 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/backtest, å­—æ®µæ•°: 5
2025-09-13 16:43:01 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/wallet/transfer, å­—æ®µæ•°: 3
2025-09-13 16:43:01 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/data/download, å­—æ®µæ•°: 5
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“‹ åŒ…å«çš„è¡¨ï¼šç”¨æˆ·ã€ç­–ç•¥ã€å›æµ‹ã€äº¤æ˜“ã€APIå¯†é’¥ã€å¸‚åœºæ•°æ®ã€Claudeå¯¹è¯ã€äº¤æ˜“å¿ƒå¾—
ğŸ“‹ ç®¡ç†åå°è¡¨ï¼šç®¡ç†å‘˜ã€Claudeä»£ç†æ± ã€USDTæ”¯ä»˜ã€æ•°æ®é‡‡é›†
âœ… Redisè¿æ¥æˆåŠŸ
ğŸ”‘ OKX APIè®¤è¯æˆåŠŸï¼Œå·²è¿æ¥åˆ°çœŸå®äº¤æ˜“æ¥å£
ğŸš€ Trading Service å¯åŠ¨æˆåŠŸ
ğŸ“Š ç¯å¢ƒ: development
ğŸ  Host: 0.0.0.0:8001
2025-09-13 16:43:01 | uvicorn.error | INFO | Application startup complete.
WARNING:  StatReload detected changes in 'app/api/v1/realtime_backtest.py'. Reloading...
2025-09-13 16:43:20 | uvicorn.error | INFO | Shutting down
2025-09-13 16:43:20 | uvicorn.error | INFO | Waiting for application shutdown.
âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
âœ… Redisè¿æ¥å·²å…³é—­
ğŸ‘‹ Trading Service å·²å…³é—­
2025-09-13 16:43:20 | uvicorn.error | INFO | Application shutdown complete.
2025-09-13 16:43:20 | uvicorn.error | INFO | Finished server process [3713272]
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 16:43:23.241 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
âœ… ä½¿ç”¨logging.yamlé…ç½®æ–‡ä»¶
âœ… APIéªŒè¯ä¸­é—´ä»¶é›†æˆæˆåŠŸ
2025-09-13 16:43:23 | uvicorn.error | INFO | Started server process [3713411]
2025-09-13 16:43:23 | uvicorn.error | INFO | Waiting for application startup.
2025-09-13 16:43:23 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/register, å­—æ®µæ•°: 2
2025-09-13 16:43:23 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/login, å­—æ®µæ•°: 2
2025-09-13 16:43:23 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/trading/orders, å­—æ®µæ•°: 5
2025-09-13 16:43:23 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/strategies, å­—æ®µæ•°: 3
2025-09-13 16:43:23 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/ai/chat, å­—æ®µæ•°: 3
2025-09-13 16:43:23 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/market-data/klines, å­—æ®µæ•°: 3
2025-09-13 16:43:23 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/backtest, å­—æ®µæ•°: 5
2025-09-13 16:43:23 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/wallet/transfer, å­—æ®µæ•°: 3
2025-09-13 16:43:23 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/data/download, å­—æ®µæ•°: 5
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“‹ åŒ…å«çš„è¡¨ï¼šç”¨æˆ·ã€ç­–ç•¥ã€å›æµ‹ã€äº¤æ˜“ã€APIå¯†é’¥ã€å¸‚åœºæ•°æ®ã€Claudeå¯¹è¯ã€äº¤æ˜“å¿ƒå¾—
ğŸ“‹ ç®¡ç†åå°è¡¨ï¼šç®¡ç†å‘˜ã€Claudeä»£ç†æ± ã€USDTæ”¯ä»˜ã€æ•°æ®é‡‡é›†
âœ… Redisè¿æ¥æˆåŠŸ
ğŸ”‘ OKX APIè®¤è¯æˆåŠŸï¼Œå·²è¿æ¥åˆ°çœŸå®äº¤æ˜“æ¥å£
ğŸš€ Trading Service å¯åŠ¨æˆåŠŸ
ğŸ“Š ç¯å¢ƒ: development
ğŸ  Host: 0.0.0.0:8001
2025-09-13 16:43:24 | uvicorn.error | INFO | Application startup complete.
2025-09-13 16:48:22 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:48:22.254043", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "300"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "binance", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2024-01-01", "end_date": "2024-01-31", "data_type": "kline"}}
2025-09-13 16:48:22 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:48:22.256 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:48:22.260 | INFO     | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1213 - AIç­–ç•¥å›æµ‹è¯·æ±‚: ç”¨æˆ·6, ä¼šå‘˜çº§åˆ«professional
2025-09-13 16:48:22.260 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-13 16:48:22 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 200, "duration": 6.82, "timestamp": "2025-09-13T08:48:22.260824"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:57416', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 200)
2025-09-13 16:48:23.769 | INFO     | app.api.v1.realtime_backtest:_prepare_data:598 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2024-01-01 00:00:00 - 2024-01-31 00:00:00
2025-09-13 16:48:23.769 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:625 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 16:48:24.040 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:666 - âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2024-01-01 åˆ° 2024-01-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:48:24.040 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:671 - âŒ BTC/USDT æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2024-01-01 åˆ° 2024-01-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:48:24.041 | ERROR    | app.api.v1.realtime_backtest:_prepare_data:612 - âŒ æ•°æ®å‡†å¤‡å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2024-01-01 åˆ° 2024-01-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:48:24.041 | ERROR    | app.api.v1.realtime_backtest:_execute_ai_strategy_backtest:278 - AIç­–ç•¥å›æµ‹ä»»åŠ¡ e628471a-2236-4923-a9af-c98f269537e2 å¤±è´¥: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2024-01-01 åˆ° 2024-01-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:48:25 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/e628471a-2236-4923-a9af-c98f269537e2", "path": "/api/v1/realtime-backtest/status/e628471a-2236-4923-a9af-c98f269537e2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:48:25.266513", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:48:25 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:48:25 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/e628471a-2236-4923-a9af-c98f269537e2
2025-09-13 16:48:25.267 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:48:25.268 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:48:25 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/e628471a-2236-4923-a9af-c98f269537e2", "status_code": 200, "duration": 2.11, "timestamp": "2025-09-13T08:48:25.268588"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:57416', 'GET', '/api/v1/realtime-backtest/status/e628471a-2236-4923-a9af-c98f269537e2', '1.1', 200)
2025-09-13 16:48:25 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:48:25.273260", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "296"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "okx", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2024-01-01", "end_date": "2024-01-31", "data_type": "kline"}}
2025-09-13 16:48:25 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:48:25.274 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:48:25.275 | INFO     | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1213 - AIç­–ç•¥å›æµ‹è¯·æ±‚: ç”¨æˆ·6, ä¼šå‘˜çº§åˆ«professional
2025-09-13 16:48:25.277 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-13 16:48:25 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 200, "duration": 4.23, "timestamp": "2025-09-13T08:48:25.277467"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:59384', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 200)
2025-09-13 16:48:26 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788", "path": "/api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:48:26.282344", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:48:26 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:48:26 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788
2025-09-13 16:48:26.283 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:48:26.283 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:48:26 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788", "status_code": 200, "duration": 1.81, "timestamp": "2025-09-13T08:48:26.284105"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:59384', 'GET', '/api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788', '1.1', 200)
2025-09-13 16:48:26.779 | INFO     | app.api.v1.realtime_backtest:_prepare_data:598 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2024-01-01 00:00:00 - 2024-01-31 00:00:00
2025-09-13 16:48:26.779 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:625 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 16:48:26.862 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:666 - âŒ OKXäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2024-01-01 åˆ° 2024-01-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šè¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:48:26.862 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:671 - âŒ BTC/USDT æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: âŒ OKXäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2024-01-01 åˆ° 2024-01-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šè¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:48:26.862 | ERROR    | app.api.v1.realtime_backtest:_prepare_data:612 - âŒ æ•°æ®å‡†å¤‡å¤±è´¥: âŒ OKXäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2024-01-01 åˆ° 2024-01-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šè¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:48:26.862 | ERROR    | app.api.v1.realtime_backtest:_execute_ai_strategy_backtest:278 - AIç­–ç•¥å›æµ‹ä»»åŠ¡ 57c7d4ba-adce-4ab6-9356-1ba54bc5d788 å¤±è´¥: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ OKXäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2024-01-01 åˆ° 2024-01-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šè¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:48:27 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788", "path": "/api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:48:27.288576", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:48:27 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:48:27 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788
2025-09-13 16:48:27.289 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:48:27.290 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:48:27 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788", "status_code": 200, "duration": 2.54, "timestamp": "2025-09-13T08:48:27.291081"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:59384', 'GET', '/api/v1/realtime-backtest/status/57c7d4ba-adce-4ab6-9356-1ba54bc5d788', '1.1', 200)
WARNING:  StatReload detected changes in 'test_data_source_fix.py'. Reloading...
2025-09-13 16:49:09 | uvicorn.error | INFO | Shutting down
2025-09-13 16:49:09 | uvicorn.error | INFO | Waiting for application shutdown.
âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
âœ… Redisè¿æ¥å·²å…³é—­
ğŸ‘‹ Trading Service å·²å…³é—­
2025-09-13 16:49:09 | uvicorn.error | INFO | Application shutdown complete.
2025-09-13 16:49:09 | uvicorn.error | INFO | Finished server process [3713411]
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 16:49:12.682 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
âœ… ä½¿ç”¨logging.yamlé…ç½®æ–‡ä»¶
âœ… APIéªŒè¯ä¸­é—´ä»¶é›†æˆæˆåŠŸ
2025-09-13 16:49:13 | uvicorn.error | INFO | Started server process [3715376]
2025-09-13 16:49:13 | uvicorn.error | INFO | Waiting for application startup.
2025-09-13 16:49:13 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/register, å­—æ®µæ•°: 2
2025-09-13 16:49:13 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/login, å­—æ®µæ•°: 2
2025-09-13 16:49:13 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/trading/orders, å­—æ®µæ•°: 5
2025-09-13 16:49:13 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/strategies, å­—æ®µæ•°: 3
2025-09-13 16:49:13 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/ai/chat, å­—æ®µæ•°: 3
2025-09-13 16:49:13 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/market-data/klines, å­—æ®µæ•°: 3
2025-09-13 16:49:13 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/backtest, å­—æ®µæ•°: 5
2025-09-13 16:49:13 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/wallet/transfer, å­—æ®µæ•°: 3
2025-09-13 16:49:13 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/data/download, å­—æ®µæ•°: 5
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“‹ åŒ…å«çš„è¡¨ï¼šç”¨æˆ·ã€ç­–ç•¥ã€å›æµ‹ã€äº¤æ˜“ã€APIå¯†é’¥ã€å¸‚åœºæ•°æ®ã€Claudeå¯¹è¯ã€äº¤æ˜“å¿ƒå¾—
ğŸ“‹ ç®¡ç†åå°è¡¨ï¼šç®¡ç†å‘˜ã€Claudeä»£ç†æ± ã€USDTæ”¯ä»˜ã€æ•°æ®é‡‡é›†
âœ… Redisè¿æ¥æˆåŠŸ
ğŸ”‘ OKX APIè®¤è¯æˆåŠŸï¼Œå·²è¿æ¥åˆ°çœŸå®äº¤æ˜“æ¥å£
ğŸš€ Trading Service å¯åŠ¨æˆåŠŸ
ğŸ“Š ç¯å¢ƒ: development
ğŸ  Host: 0.0.0.0:8001
2025-09-13 16:49:13 | uvicorn.error | INFO | Application startup complete.
2025-09-13 16:49:15 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:15.539290", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "300"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "binance", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2025-07-01", "end_date": "2025-07-31", "data_type": "kline"}}
2025-09-13 16:49:15 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:49:15.541 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:15.546 | INFO     | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1213 - AIç­–ç•¥å›æµ‹è¯·æ±‚: ç”¨æˆ·6, ä¼šå‘˜çº§åˆ«professional
2025-09-13 16:49:15.546 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.005s
2025-09-13 16:49:15 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 200, "duration": 7.87, "timestamp": "2025-09-13T08:49:15.547118"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56830', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 200)
2025-09-13 16:49:17.050 | INFO     | app.api.v1.realtime_backtest:_prepare_data:598 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2025-07-01 00:00:00 - 2025-07-31 00:00:00
2025-09-13 16:49:17.050 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:625 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 16:49:17.107 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:666 - âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:49:17.107 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:671 - âŒ BTC/USDT æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:49:17.107 | ERROR    | app.api.v1.realtime_backtest:_prepare_data:612 - âŒ æ•°æ®å‡†å¤‡å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:49:17.107 | ERROR    | app.api.v1.realtime_backtest:_execute_ai_strategy_backtest:278 - AIç­–ç•¥å›æµ‹ä»»åŠ¡ bdc301f5-b133-4091-864e-6a3a97d17359 å¤±è´¥: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:49:18 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/bdc301f5-b133-4091-864e-6a3a97d17359", "path": "/api/v1/realtime-backtest/status/bdc301f5-b133-4091-864e-6a3a97d17359", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:18.555891", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:18 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:18 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/bdc301f5-b133-4091-864e-6a3a97d17359
2025-09-13 16:49:18.557 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:18.558 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:18 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/bdc301f5-b133-4091-864e-6a3a97d17359", "status_code": 200, "duration": 3.02, "timestamp": "2025-09-13T08:49:18.558857"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56830', 'GET', '/api/v1/realtime-backtest/status/bdc301f5-b133-4091-864e-6a3a97d17359', '1.1', 200)
2025-09-13 16:49:18 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:18.567025", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "296"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "okx", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2025-07-01", "end_date": "2025-07-31", "data_type": "kline"}}
2025-09-13 16:49:18 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 16:49:18.568 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:18.570 | INFO     | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1213 - AIç­–ç•¥å›æµ‹è¯·æ±‚: ç”¨æˆ·6, ä¼šå‘˜çº§åˆ«professional
2025-09-13 16:49:18.570 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.002s
2025-09-13 16:49:18 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 200, "duration": 4.2, "timestamp": "2025-09-13T08:49:18.571134"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 200)
2025-09-13 16:49:19 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:19.576425", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:19 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:19 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:19.578 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:19.579 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:19 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 3.0, "timestamp": "2025-09-13T08:49:19.579388"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:49:20.073 | INFO     | app.api.v1.realtime_backtest:_prepare_data:598 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2025-07-01 00:00:00 - 2025-07-31 00:00:00
2025-09-13 16:49:20.073 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:625 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 16:49:20 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:20.586409", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:20 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:20 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:20.587 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:20.588 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:20 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 1.96, "timestamp": "2025-09-13T08:49:20.588271"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:49:23.729 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:654 - âœ… BTC/USDT æ•°æ®åº“çœŸå®æ•°æ®åŠ è½½æˆåŠŸ: 113489 æ¡è®°å½•
2025-09-13 16:49:23.729 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:655 - ğŸ“ˆ æ•°æ®èŒƒå›´: 2025-07-01 13:12:00 åˆ° 2025-07-31 00:00:00
2025-09-13 16:49:23 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:23.973765", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:23 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:23 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:23.974 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:23.975 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:23 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 2.43, "timestamp": "2025-09-13T08:49:23.976105"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:49:24 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:24.980950", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:24 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:24 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:24.981 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:24.982 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:24 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 1.83, "timestamp": "2025-09-13T08:49:24.982751"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:49:25.473 | INFO     | app.api.v1.realtime_backtest:_run_backtest_logic:682 - ğŸ§® å¼€å§‹æ‰§è¡ŒçœŸå®ç­–ç•¥ä»£ç å›æµ‹...
2025-09-13 16:49:25.473 | INFO     | app.api.v1.realtime_backtest:_run_backtest_logic:702 - ğŸ“Š ç­–ç•¥å›æµ‹å‚æ•°: {'strategy_code': '\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {"signal": "hold"}\n        ', 'exchange': 'okx', 'symbols': ['BTC/USDT'], 'timeframes': ['1h'], 'start_date': '2025-07-01', 'end_date': '2025-07-31', 'initial_capital': 10000.0, 'fee_rate': 'vip0', 'data_type': 'kline'}
2025-09-13 16:49:25.473 | INFO     | app.services.backtest_service:execute_backtest:731 - æ‰§è¡Œå›æµ‹ï¼Œå‚æ•°: {'strategy_code': '\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {"signal": "hold"}\n        ', 'exchange': 'okx', 'symbols': ['BTC/USDT'], 'timeframes': ['1h'], 'start_date': '2025-07-01', 'end_date': '2025-07-31', 'initial_capital': 10000.0, 'fee_rate': 'vip0', 'data_type': 'kline'}
2025-09-13 16:49:25.510 | INFO     | app.services.backtest_service:_get_historical_data:133 - è·å–å†å²æ•°æ®: okx BTC/USDT 1h 2025-07-01 00:00:00-2025-07-31 00:00:00
2025-09-13 16:49:25.583 | INFO     | app.services.backtest_service:_get_historical_data:166 - âœ… æˆåŠŸè·å–OKXå†å²æ•°æ®: 4507æ¡è®°å½•
2025-09-13 16:49:25.583 | INFO     | app.services.backtest_service:_get_historical_data:167 -    æ•°æ®æ—¶é—´èŒƒå›´: 2025-07-01 14:00:00 åˆ° 2025-09-12 16:00:00
2025-09-13 16:49:25.611 | INFO     | app.services.backtest_service:execute_backtest:789 - æˆåŠŸå‡†å¤‡å›æµ‹æ•°æ®: 4507 æ¡è®°å½•ï¼Œæ—¶é—´èŒƒå›´: 2025-07-01 06:00:00 åˆ° 2025-09-12 08:00:00
/root/trademe/backend/trading-service/app/services/backtest_service.py:262: RuntimeWarning: invalid value encountered in scalar divide
  daily_return = (self.total_value - prev_value) / prev_value
2025-09-13 16:49:26.749 | INFO     | app.services.backtest_service:execute_backtest:807 - å›æµ‹æ‰§è¡ŒæˆåŠŸï¼Œæ€»æ”¶ç›Šç‡: -100.00%
2025-09-13 16:49:26.752 | INFO     | app.api.v1.realtime_backtest:_run_backtest_logic:726 - âœ… ç­–ç•¥ä»£ç å›æµ‹æ‰§è¡ŒæˆåŠŸ
2025-09-13 16:49:26 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:26.753060", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:26 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:26 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:26.754 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:26.755 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:26 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 2.28, "timestamp": "2025-09-13T08:49:26.755302"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:49:27 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:27.761021", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:27 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:27 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:27.761 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:27.762 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:27 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 1.87, "timestamp": "2025-09-13T08:49:27.762855"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:49:28 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:28.768079", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:28 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:28 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:28.768 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:28.769 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:28 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 1.76, "timestamp": "2025-09-13T08:49:28.769806"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:49:29 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:29.774493", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:29 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:29 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:29.775 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:29.776 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:29 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 2.53, "timestamp": "2025-09-13T08:49:29.776980"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:49:30 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:30.782367", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:30 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:30 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:30.783 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:30.784 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:30 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 2.59, "timestamp": "2025-09-13T08:49:30.784902"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:49:31.256 | INFO     | app.api.v1.realtime_backtest:_execute_ai_strategy_backtest:275 - AIç­–ç•¥å›æµ‹ä»»åŠ¡ 28976c82-2d5c-41e8-a728-b39a1343f2a2 å®Œæˆ
2025-09-13 16:49:31 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T08:49:31.790823", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 16:49:31 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:49:31 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2
2025-09-13 16:49:31.792 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:49:31.793 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 16:49:31 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2", "status_code": 200, "duration": 2.61, "timestamp": "2025-09-13T08:49:31.793391"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:56832', 'GET', '/api/v1/realtime-backtest/status/28976c82-2d5c-41e8-a728-b39a1343f2a2', '1.1', 200)
2025-09-13 16:58:32 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T08:58:32.409270", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-13 16:58:32 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:58:32 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/ai/usage/stats
2025-09-13 16:58:32.410 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:58:32 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=trader", "path": "/api/v1/ai/sessions", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T08:58:32.413147", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "trader"}}
2025-09-13 16:58:32 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:58:32 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/ai/sessions
2025-09-13 16:58:32.414 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:58:32.421 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.011s
2025-09-13 16:58:32 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 12.06, "timestamp": "2025-09-13T08:58:32.421288"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-13 16:58:32.424 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.011s
2025-09-13 16:58:32 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 11.83, "timestamp": "2025-09-13T08:58:32.424966"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'GET', '/api/v1/ai/sessions?ai_mode=trader', '1.0', 200)
2025-09-13 16:58:33 | uvicorn.error | INFO | 52.192.***.***.***:0 - "WebSocket /api/v1/ai/ws/chat" [accepted]
2025-09-13 16:58:33 | uvicorn.error | INFO | connection open
2025-09-13 16:58:33 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: auth
2025-09-13 16:58:33 | app.api.v1.ai_websocket | INFO | ğŸ” å¼€å§‹å¤„ç†è®¤è¯æ¶ˆæ¯
2025-09-13 16:58:33 | app.api.v1.ai_websocket | INFO | ğŸ”‘ éªŒè¯JWTä»¤ç‰Œ...
2025-09-13 16:58:33 | app.api.v1.ai_websocket | INFO | âœ… JWTéªŒè¯æˆåŠŸï¼Œç”¨æˆ·ID: 6
2025-09-13 16:58:33 | app.api.v1.ai_websocket | INFO | ğŸ“¡ å»ºç«‹WebSocketè¿æ¥ç®¡ç†...
2025-09-13 16:58:33 | app.services.websocket_manager | INFO | ğŸ’“ WebSocketå¿ƒè·³ç›‘æ§å·²å¯åŠ¨
2025-09-13 16:58:33 | app.services.websocket_manager | INFO | ğŸ§¹ WebSocketæ¸…ç†ç›‘æ§å·²å¯åŠ¨
2025-09-13 16:58:33 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketç»Ÿè®¡ç›‘æ§å·²å¯åŠ¨
2025-09-13 16:58:33 | app.services.websocket_manager | INFO | ğŸ”— ç”¨æˆ· 6 å»ºç«‹WebSocketè¿æ¥: a0332872-28c1-44b0-aab9-6bf3e7f2a596 (æ€»è¿æ¥æ•°: 1)
2025-09-13 16:58:33 | app.api.v1.ai_websocket | INFO | âœ… è¿æ¥IDå·²åˆ›å»º: a0332872-28c1-44b0-aab9-6bf3e7f2a596
2025-09-13 16:58:33 | app.api.v1.ai_websocket | INFO | ğŸ“¤ å‘é€è®¤è¯æˆåŠŸå“åº”: {'type': 'auth_success', 'connection_id': 'a0332872-28c1-44b0-aab9-6bf3e7f2a596', 'user_id': 6, 'message': 'è®¤è¯æˆåŠŸï¼ŒAIå¯¹è¯å·²å‡†å¤‡å°±ç»ª'}
2025-09-13 16:58:33 | app.api.v1.ai_websocket | INFO | âœ… ç”¨æˆ· 6 é€šè¿‡WebSocketè®¤è¯æˆåŠŸ
2025-09-13 16:58:34 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/chat/history?session_id=5be7cbc0-e982-4695-833b-6f983061cbf6&limit=20", "path": "/api/v1/ai/chat/history", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T08:58:34.350483", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"session_id": "5be7cbc0-e982-4695-833b-6f983061cbf6", "limit": "20"}}
2025-09-13 16:58:34 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:58:34 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/ai/chat/history
2025-09-13 16:58:34.352 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:58:34.359 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.007s
2025-09-13 16:58:34 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/ai/chat/history", "status_code": 200, "duration": 9.43, "timestamp": "2025-09-13T08:58:34.359886"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'GET', '/api/v1/ai/chat/history?session_id=5be7cbc0-e982-4695-833b-6f983061cbf6&limit=20', '1.0', 200)
2025-09-13 16:58:38 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6", "path": "/api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T08:58:38.632197", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {}}
2025-09-13 16:58:38 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 16:58:38 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6
2025-09-13 16:58:38.633 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:58:38.641 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.008s
2025-09-13 16:58:38 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6", "status_code": 200, "duration": 9.53, "timestamp": "2025-09-13T08:58:38.641701"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'GET', '/api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6', '1.0', 200)
2025-09-13 16:58:38 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://43.167.***.***.***/api/v1/realtime-backtest/start", "path": "/api/v1/realtime-backtest/start", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T08:58:38.742607", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "content-length": "8167", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "content-type": "application/json", "origin": "http://43.167.***.***.***", "referer": "http://43.167.***.***.***/ai-chat"}, "body": {"strategy_code": "from app.core.enhanced_strategy import EnhancedBaseStrategy, DataRequest, DataType\nfrom app.core.strategy_engine import TradingSignal, SignalType\nfrom typing import List, Optional, Dict, Any\nfrom datetime import datetime\nimport pandas as pd\nimport numpy as np\n\nclass UserStrategy(EnhancedBaseStrategy):\n    \"\"\"ä¼˜åŒ–çš„åŒå‡çº¿äº¤å‰ç­–ç•¥ - ç»“åˆKDJæŒ‡æ ‡è¿‡æ»¤\"\"\"\n    \n    def get_data_requirements(self) -> List[DataRequest]:\n        \"\"\"å®šä¹‰ç­–ç•¥æ‰€éœ€çš„æ•°æ®æº\"\"\"\n        return [\n            DataRequest(\n                data_type=DataType.KLINE,\n                exchange=\"okx\",\n                symbol=\"BTC-USDT-SWAP\", \n                timeframe=\"1h\",\n                required=True\n            )\n        ]\n    \n    async def on_data_update(self, data_type: str, data: Dict[str, Any]) -> Optional[TradingSignal]:\n        \"\"\"æ•°æ®æ›´æ–°å¤„ç† - å®ç°åŒå‡çº¿äº¤å‰ç­–ç•¥é€»è¾‘\"\"\"\n        if data_type != \"kline\":\n            return None\n            \n        # è·å–Kçº¿æ•°æ®\n        df = self.get_kline_data()\n        if df is None or len(df) < 50:  # éœ€è¦è¶³å¤Ÿçš„å†å²æ•°æ®\n            return None\n        \n        # è®¡ç®—æŠ€æœ¯æŒ‡æ ‡\n        sma5 = self.calculate_sma(df['close'], 5)\n        sma10 = self.calculate_sma(df['close'], 10)\n        \n        # è®¡ç®—KDJæŒ‡æ ‡ç”¨äºä¿¡å·è¿‡æ»¤\n        kdj_k, kdj_d, kdj_j = self.calculate_kdj(df['high'], df['low'], df['close'], 9, 3, 3)\n        \n        # è·å–å½“å‰ä»·æ ¼å’Œä»“ä½ä¿¡æ¯\n        current_price = df['close'].iloc[-1]\n        current_position = self.get_current_position()\n        \n        # ä»å‚æ•°ä¸­è·å–é…ç½®\n        position_size = self.context.parameters.get('position_size', 10.0) / 100.0  # è½¬æ¢ä¸ºæ¯”ä¾‹\n        stop_loss_pct = self.context.parameters.get('stop_loss', 5.0) / 100.0\n        take_profit_pct = self.context.parameters.get('take_profit', 5.0) / 100.0\n        \n        # æ£€æµ‹å‡çº¿äº¤å‰ä¿¡å·\n        golden_cross = self._detect_golden_cross(sma5, sma10)\n        death_cross = self._detect_death_cross(sma5, sma10)\n        \n        # ä¼˜åŒ–çš„ä¿¡å·ç”Ÿæˆé€»è¾‘\n        signal = None\n        \n        # é‡‘å‰ä¿¡å· - å¼€å¤šä»“\n        if golden_cross:\n            # KDJè¿‡æ»¤ï¼šKå€¼å°äº80ä¸”K>Dæ—¶ä¿¡å·æ›´å¯é \n            if kdj_k[-1] < 80 and kdj_k[-1] > kdj_d[-1]:\n                # å¦‚æœæœ‰ç©ºä»“ï¼Œå…ˆå¹³ç©ºå†å¼€å¤š\n                if current_position and current_position < 0:\n                    # ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†å¹³ä»“é€»è¾‘\n                    pass\n                \n                signal = TradingSignal(\n                    signal_type=SignalType.BUY,\n                    symbol=\"BTC-USDT-SWAP\",\n                    price=current_price,\n                    quantity=position_size,\n                    stop_loss=current_price * (1 - stop_loss_pct),\n                    take_profit=current_price * (1 + take_profit_pct),\n                    metadata={\n                        'strategy': 'sma_cross_optimized',\n                        'signal_reason': 'golden_cross_with_kdj_filter',\n                        'sma5': sma5[-1],\n                        'sma10': sma10[-1],\n                        'kdj_k': kdj_k[-1],\n                        'kdj_d': kdj_d[-1]\n                    }\n                )\n        \n        # æ­»å‰ä¿¡å· - å¼€ç©ºä»“\n        elif death_cross:\n            # KDJè¿‡æ»¤ï¼šKå€¼å¤§äº20ä¸”K<Dæ—¶ä¿¡å·æ›´å¯é \n            if kdj_k[-1] > 20 and kdj_k[-1] < kdj_d[-1]:\n                # å¦‚æœæœ‰å¤šä»“ï¼Œå…ˆå¹³å¤šå†å¼€ç©º\n                if current_position and current_position > 0:\n                    # ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†å¹³ä»“é€»è¾‘\n                    pass\n                \n                signal = TradingSignal(\n                    signal_type=SignalType.SELL,\n                    symbol=\"BTC-USDT-SWAP\",\n                    price=current_price,\n                    quantity=position_size,\n                    stop_loss=current_price * (1 + stop_loss_pct),\n                    take_profit=current_price * (1 - take_profit_pct),\n                    metadata={\n                        'strategy': 'sma_cross_optimized',\n                        'signal_reason': 'death_cross_with_kdj_filter',\n                        'sma5': sma5[-1],\n                        'sma10': sma10[-1],\n                        'kdj_k': kdj_k[-1],\n                        'kdj_d': kdj_d[-1]\n                    }\n                )\n        \n        # åŠ¨æ€æ­¢ç›ˆæ­¢æŸè°ƒæ•´ï¼ˆè¶‹åŠ¿è·Ÿè¸ªä¼˜åŒ–ï¼‰\n        if current_position and signal is None:\n            signal = self._check_dynamic_exit(df, current_position, current_price, \n                                            sma5, sma10, kdj_k, kdj_d)\n        \n        return signal\n    \n    def _detect_golden_cross(self, sma5: pd.Series, sma10: pd.Series) -> bool:\n        \"\"\"æ£€æµ‹é‡‘å‰ä¿¡å·\"\"\"\n        if len(sma5) < 2 or len(sma10) < 2:\n            return False\n        \n        # å½“å‰SMA5 > SMA10 ä¸” å‰ä¸€æ ¹SMA5 <= SMA10\n        current_cross = sma5.iloc[-1] > sma10.iloc[-1]\n        previous_cross = sma5.iloc[-2] <= sma10.iloc[-2]\n        \n        return current_cross and previous_cross\n    \n    def _detect_death_cross(self, sma5: pd.Series, sma10: pd.Series) -> bool:\n        \"\"\"æ£€æµ‹æ­»å‰ä¿¡å·\"\"\"\n        if len(sma5) < 2 or len(sma10) < 2:\n            return False\n        \n        # å½“å‰SMA5 < SMA10 ä¸” å‰ä¸€æ ¹SMA5 >= SMA10\n        current_cross = sma5.iloc[-1] < sma10.iloc[-1]\n        previous_cross = sma5.iloc[-2] >= sma10.iloc[-2]\n        \n        return current_cross and previous_cross\n    \n    def _check_dynamic_exit(self, df: pd.DataFrame, position: float, current_price: float,\n                          sma5: pd.Series, sma10: pd.Series, kdj_k: pd.Series, kdj_d: pd.Series) -> Optional[TradingSignal]:\n        \"\"\"åŠ¨æ€å‡ºåœºé€»è¾‘ - è¶‹åŠ¿è·Ÿè¸ªä¼˜åŒ–\"\"\"\n        \n        # å¤šä»“åŠ¨æ€æ­¢ç›ˆé€»è¾‘\n        if position > 0:\n            # è¶‹åŠ¿è½¬å¼±ä¿¡å·ï¼šSMA5å¼€å§‹èµ°å¹³æˆ–KDJè¶…ä¹°\n            if (sma5.iloc[-1] <= sma5.iloc[-2] or kdj_k[-1] > 85) and kdj_k[-1] < kdj_d[-1]:\n                return TradingSignal(\n                    signal_type=SignalType.SELL,\n                    symbol=\"BTC-USDT-SWAP\",\n                    price=current_price,\n                    quantity=abs(position),\n                    metadata={\n                        'strategy': 'sma_cross_optimized',\n                        'signal_reason': 'dynamic_exit_long_trend_weak'\n                    }\n                )\n        \n        # ç©ºä»“åŠ¨æ€æ­¢ç›ˆé€»è¾‘\n        elif position < 0:\n            # è¶‹åŠ¿è½¬å¼ºä¿¡å·ï¼šSMA5å¼€å§‹ä¸Šæ¶¨æˆ–KDJè¶…å–åå¼¹\n            if (sma5.iloc[-1] >= sma5.iloc[-2] or kdj_k[-1] < 15) and kdj_k[-1] > kdj_d[-1]:\n                return TradingSignal(\n                    signal_type=SignalType.BUY,\n                    symbol=\"BTC-USDT-SWAP\",\n                    price=current_price,\n                    quantity=abs(position),\n                    metadata={\n                        'strategy': 'sma_cross_optimized',\n                        'signal_reason': 'dynamic_exit_short_trend_strong'\n                    }\n                )\n        \n        return None\n    \n    def calculate_kdj(self, high: pd.Series, low: pd.Series, close: pd.Series, \n                     k_period: int = 9, k_smooth: int = 3, d_smooth: int = 3) -> tuple:\n        \"\"\"è®¡ç®—KDJæŒ‡æ ‡\"\"\"\n        lowest_low = low.rolling(window=k_period).min()\n        highest_high = high.rolling(window=k_period).max()\n        \n        rsv = 100 * (close - lowest_low) / (highest_high - lowest_low)\n        rsv = rsv.fillna(50)  # å¡«å……NaNå€¼\n        \n        k = rsv.ewm(span=k_smooth).mean()\n        d = k.ewm(span=d_smooth).mean()\n        j = 3 * k - 2 * d\n        \n        return k, d, j", "exchange": "binance", "product_type": "spot", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "fee_rate": "vip0", "initial_capital": 10000, "start_date": "2025-08-14", "end_date": "2025-09-13", "data_type": "kline"}}
2025-09-13 16:58:38 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start
2025-09-13 16:58:38.749 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 16:58:38.756 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.006s
2025-09-13 16:58:38 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start", "status_code": 200, "duration": 13.63, "timestamp": "2025-09-13T08:58:38.756213"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'POST', '/api/v1/realtime-backtest/start', '1.0', 200)
2025-09-13 16:58:39 | uvicorn.error | INFO | 52.192.***.***.***:0 - "WebSocket /api/v1/realtime-backtest/ws/8fcbd3e4-16ee-46a8-a6ec-e1141e867a2f" [accepted]
2025-09-13 16:58:39 | uvicorn.error | INFO | connection open
2025-09-13 16:58:40.757 | INFO     | app.api.v1.realtime_backtest:_prepare_data:598 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2025-08-14 00:00:00 - 2025-09-13 00:00:00
2025-09-13 16:58:40.757 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:625 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 16:58:40.759 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:666 - âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:58:40.759 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:671 - âŒ BTC/USDT æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:58:40.759 | ERROR    | app.api.v1.realtime_backtest:_prepare_data:612 - âŒ æ•°æ®å‡†å¤‡å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:58:40.759 | ERROR    | app.api.v1.realtime_backtest:_execute_backtest:556 - å›æµ‹ä»»åŠ¡ 8fcbd3e4-16ee-46a8-a6ec-e1141e867a2f å¤±è´¥: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 16:58:40.761 | ERROR    | app.api.v1.realtime_backtest:_execute_backtest:557 - å®Œæ•´é”™è¯¯å †æ ˆ: Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 609, in _prepare_data
    return await self._fetch_market_data(self.db_session, config, start_date, end_date)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 672, in _fetch_market_data
    raise e
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 667, in _fetch_market_data
    raise Exception(error_msg)
Exception: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 528, in _execute_backtest
    step_result = await step_info["action"](config, backtest_data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 614, in _prepare_data
    raise Exception(f"æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: {str(e)}")
Exception: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹

2025-09-13 16:59:03 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
/root/trademe/backend/trading-service/app/services/websocket_manager.py:369: SAWarning: The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 138709991163584)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
  collected = gc.collect()
2025-09-13 16:59:34 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:00:04 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:00:34 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:01:04 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:01:34 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:02:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:03:33 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=17, æ€»é”™è¯¯=0
2025-09-13 17:03:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:04:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:05:04 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:05:26 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:26.491908", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "300"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "binance", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2025-07-01", "end_date": "2025-07-31", "data_type": "kline"}}
2025-09-13 17:05:26 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 17:05:26.493 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:26.494 | INFO     | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1213 - AIç­–ç•¥å›æµ‹è¯·æ±‚: ç”¨æˆ·6, ä¼šå‘˜çº§åˆ«professional
2025-09-13 17:05:26.495 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.002s
2025-09-13 17:05:26 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 200, "duration": 3.31, "timestamp": "2025-09-13T09:05:26.495184"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55608', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 200)
2025-09-13 17:05:27.997 | INFO     | app.api.v1.realtime_backtest:_prepare_data:598 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2025-07-01 00:00:00 - 2025-07-31 00:00:00
2025-09-13 17:05:27.997 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:625 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 17:05:27.999 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:666 - âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:05:27.999 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:671 - âŒ BTC/USDT æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:05:27.999 | ERROR    | app.api.v1.realtime_backtest:_prepare_data:612 - âŒ æ•°æ®å‡†å¤‡å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:05:27.999 | ERROR    | app.api.v1.realtime_backtest:_execute_ai_strategy_backtest:278 - AIç­–ç•¥å›æµ‹ä»»åŠ¡ 4edd2db1-99c4-4934-a551-f70431f16894 å¤±è´¥: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:05:29 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/4edd2db1-99c4-4934-a551-f70431f16894", "path": "/api/v1/realtime-backtest/status/4edd2db1-99c4-4934-a551-f70431f16894", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:29.500853", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:29 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:29 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/4edd2db1-99c4-4934-a551-f70431f16894
2025-09-13 17:05:29.502 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:29.503 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:05:29 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/4edd2db1-99c4-4934-a551-f70431f16894", "status_code": 200, "duration": 2.46, "timestamp": "2025-09-13T09:05:29.503278"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55608', 'GET', '/api/v1/realtime-backtest/status/4edd2db1-99c4-4934-a551-f70431f16894', '1.1', 200)
2025-09-13 17:05:29 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:29.510100", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "296"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "okx", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2025-07-01", "end_date": "2025-07-31", "data_type": "kline"}}
2025-09-13 17:05:29 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 17:05:29.511 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:29.515 | INFO     | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1213 - AIç­–ç•¥å›æµ‹è¯·æ±‚: ç”¨æˆ·6, ä¼šå‘˜çº§åˆ«professional
2025-09-13 17:05:29.516 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-13 17:05:29 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 200, "duration": 6.2, "timestamp": "2025-09-13T09:05:29.516266"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 200)
2025-09-13 17:05:30 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:30.523120", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:30 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:30 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:30.524 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:30.525 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:05:30 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 2.1, "timestamp": "2025-09-13T09:05:30.525187"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:05:31.018 | INFO     | app.api.v1.realtime_backtest:_prepare_data:598 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2025-07-01 00:00:00 - 2025-07-31 00:00:00
2025-09-13 17:05:31.018 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:625 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 17:05:31 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:31.534862", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:31 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:31 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:31.536 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:31.539 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-13 17:05:31 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 6.93, "timestamp": "2025-09-13T09:05:31.541757"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:05:34.247 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:654 - âœ… BTC/USDT æ•°æ®åº“çœŸå®æ•°æ®åŠ è½½æˆåŠŸ: 113489 æ¡è®°å½•
2025-09-13 17:05:34.247 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:655 - ğŸ“ˆ æ•°æ®èŒƒå›´: 2025-07-01 13:12:00 åˆ° 2025-07-31 00:00:00
2025-09-13 17:05:34 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:34.585478", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:34 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:34 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:34.586 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:34.587 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:05:34 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 2.49, "timestamp": "2025-09-13T09:05:34.587931"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:05:34 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:05:35 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:35.593208", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:35 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:35 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:35.594 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:35.595 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:05:35 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 2.36, "timestamp": "2025-09-13T09:05:35.595541"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:05:36.085 | INFO     | app.api.v1.realtime_backtest:_run_backtest_logic:682 - ğŸ§® å¼€å§‹æ‰§è¡ŒçœŸå®ç­–ç•¥ä»£ç å›æµ‹...
2025-09-13 17:05:36.085 | INFO     | app.api.v1.realtime_backtest:_run_backtest_logic:702 - ğŸ“Š ç­–ç•¥å›æµ‹å‚æ•°: {'strategy_code': '\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {"signal": "hold"}\n        ', 'exchange': 'okx', 'symbols': ['BTC/USDT'], 'timeframes': ['1h'], 'start_date': '2025-07-01', 'end_date': '2025-07-31', 'initial_capital': 10000.0, 'fee_rate': 'vip0', 'data_type': 'kline'}
2025-09-13 17:05:36.085 | INFO     | app.services.backtest_service:execute_backtest:731 - æ‰§è¡Œå›æµ‹ï¼Œå‚æ•°: {'strategy_code': '\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {"signal": "hold"}\n        ', 'exchange': 'okx', 'symbols': ['BTC/USDT'], 'timeframes': ['1h'], 'start_date': '2025-07-01', 'end_date': '2025-07-31', 'initial_capital': 10000.0, 'fee_rate': 'vip0', 'data_type': 'kline'}
2025-09-13 17:05:36.145 | INFO     | app.services.backtest_service:_get_historical_data:133 - è·å–å†å²æ•°æ®: okx BTC/USDT 1h 2025-07-01 00:00:00-2025-07-31 00:00:00
2025-09-13 17:05:36.261 | INFO     | app.services.backtest_service:_get_historical_data:166 - âœ… æˆåŠŸè·å–OKXå†å²æ•°æ®: 4507æ¡è®°å½•
2025-09-13 17:05:36.261 | INFO     | app.services.backtest_service:_get_historical_data:167 -    æ•°æ®æ—¶é—´èŒƒå›´: 2025-07-01 14:00:00 åˆ° 2025-09-12 16:00:00
2025-09-13 17:05:36.284 | INFO     | app.services.backtest_service:execute_backtest:789 - æˆåŠŸå‡†å¤‡å›æµ‹æ•°æ®: 4507 æ¡è®°å½•ï¼Œæ—¶é—´èŒƒå›´: 2025-07-01 06:00:00 åˆ° 2025-09-12 08:00:00
/root/trademe/backend/trading-service/app/services/backtest_service.py:262: RuntimeWarning: invalid value encountered in scalar divide
  daily_return = (self.total_value - prev_value) / prev_value
2025-09-13 17:05:37.469 | INFO     | app.services.backtest_service:execute_backtest:807 - å›æµ‹æ‰§è¡ŒæˆåŠŸï¼Œæ€»æ”¶ç›Šç‡: -100.00%
2025-09-13 17:05:37.472 | INFO     | app.api.v1.realtime_backtest:_run_backtest_logic:726 - âœ… ç­–ç•¥ä»£ç å›æµ‹æ‰§è¡ŒæˆåŠŸ
2025-09-13 17:05:37 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:37.472791", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:37 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:37 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:37.473 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:37.474 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:05:37 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 1.77, "timestamp": "2025-09-13T09:05:37.474530"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:05:38 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:38.478826", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:38 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:38 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:38.480 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:38.481 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:05:38 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 2.45, "timestamp": "2025-09-13T09:05:38.481241"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:05:39 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:39.487463", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:39 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:39 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:39.488 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:39.489 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:05:39 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 2.46, "timestamp": "2025-09-13T09:05:39.489880"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:05:40 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:40.494799", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:40 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:40 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:40.495 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:40.496 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:05:40 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 1.79, "timestamp": "2025-09-13T09:05:40.496556"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:05:41 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:41.500651", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:41 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:41 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:41.501 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:41.502 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:05:41 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 1.99, "timestamp": "2025-09-13T09:05:41.502592"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:05:41.976 | INFO     | app.api.v1.realtime_backtest:_execute_ai_strategy_backtest:275 - AIç­–ç•¥å›æµ‹ä»»åŠ¡ 68c29b65-2a88-469d-b564-0b6bbea6d848 å®Œæˆ
2025-09-13 17:05:42 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:05:42.508982", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:05:42 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:05:42 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848
2025-09-13 17:05:42.510 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:05:42.512 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-13 17:05:42 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848", "status_code": 200, "duration": 3.96, "timestamp": "2025-09-13T09:05:42.512901"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:55618', 'GET', '/api/v1/realtime-backtest/status/68c29b65-2a88-469d-b564-0b6bbea6d848', '1.1', 200)
2025-09-13 17:06:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:07:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
WARNING:  StatReload detected changes in 'app/api/v1/realtime_backtest.py'. Reloading...
2025-09-13 17:07:48 | uvicorn.error | INFO | Shutting down
2025-09-13 17:07:48 | uvicorn.error | INFO | connection closed
2025-09-13 17:07:48 | app.api.v1.ai_websocket | INFO | WebSocketè¿æ¥æ–­å¼€: a0332872-28c1-44b0-aab9-6bf3e7f2a596
2025-09-13 17:07:48 | app.services.websocket_manager | INFO | âŒ ç”¨æˆ· 6 æ–­å¼€WebSocketè¿æ¥: a0332872-28c1-44b0-aab9-6bf3e7f2a596 (åŸå› : è¿æ¥å…³é—­)
2025-09-13 17:07:48 | uvicorn.error | INFO | connection closed
2025-09-13 17:07:48 | uvicorn.error | INFO | Waiting for application shutdown.
âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
âœ… Redisè¿æ¥å·²å…³é—­
ğŸ‘‹ Trading Service å·²å…³é—­
2025-09-13 17:07:48 | uvicorn.error | INFO | Application shutdown complete.
2025-09-13 17:07:48 | uvicorn.error | INFO | Finished server process [3715376]
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 17:07:51.410 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
Process SpawnProcess-9:
Traceback (most recent call last):
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 78, in _serve
    config.load()
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/config.py", line 436, in load
    self.loaded_app = import_from_string(self.app)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/importlib/__init__.py", line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/root/trademe/backend/trading-service/app/main.py", line 28, in <module>
    from app.api.v1 import api_router
  File "/root/trademe/backend/trading-service/app/api/v1/__init__.py", line 51, in <module>
    from .realtime_backtest import router as realtime_backtest_router
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 1239, in <module>
    db: AsyncSession = Depends(get_db)
        ^^^^^^^^^^^^
NameError: name 'AsyncSession' is not defined
WARNING:  StatReload detected changes in 'app/api/v1/realtime_backtest.py'. Reloading...
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 17:08:04.300 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
Process SpawnProcess-10:
Traceback (most recent call last):
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/base_events.py", line 687, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 78, in _serve
    config.load()
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/config.py", line 436, in load
    self.loaded_app = import_from_string(self.app)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/importlib/__init__.py", line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/root/trademe/backend/trading-service/app/main.py", line 28, in <module>
    from app.api.v1 import api_router
  File "/root/trademe/backend/trading-service/app/api/v1/__init__.py", line 51, in <module>
    from .realtime_backtest import router as realtime_backtest_router
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 1206, in <module>
    db: AsyncSession = Depends(get_db)
        ^^^^^^^^^^^^
NameError: name 'AsyncSession' is not defined
WARNING:  StatReload detected changes in 'app/api/v1/realtime_backtest.py'. Reloading...
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
2025-09-13 17:08:36.090 | INFO     | app.services.okx_service:__init__:116 - ğŸš€ OKXäº¤æ˜“æœåŠ¡åˆå§‹åŒ–å®Œæˆ
INFO:app.services.wallet_generator:å¤šé“¾é’±åŒ…ç”Ÿæˆå™¨åˆå§‹åŒ–å®Œæˆ
INFO:app.security.crypto_manager:åŠ å¯†ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ
/usr/local/lib/python3.12/dist-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
* 'schema_extra' has been renamed to 'json_schema_extra'
  warnings.warn(message, UserWarning)
âœ… ä½¿ç”¨logging.yamlé…ç½®æ–‡ä»¶
âœ… APIéªŒè¯ä¸­é—´ä»¶é›†æˆæˆåŠŸ
2025-09-13 17:08:36 | uvicorn.error | INFO | Started server process [3721850]
2025-09-13 17:08:36 | uvicorn.error | INFO | Waiting for application startup.
2025-09-13 17:08:36 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/register, å­—æ®µæ•°: 2
2025-09-13 17:08:36 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/auth/login, å­—æ®µæ•°: 2
2025-09-13 17:08:36 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/trading/orders, å­—æ®µæ•°: 5
2025-09-13 17:08:36 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/strategies, å­—æ®µæ•°: 3
2025-09-13 17:08:36 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/ai/chat, å­—æ®µæ•°: 3
2025-09-13 17:08:36 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/market-data/klines, å­—æ®µæ•°: 3
2025-09-13 17:08:36 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/backtest, å­—æ®µæ•°: 5
2025-09-13 17:08:36 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/wallet/transfer, å­—æ®µæ•°: 3
2025-09-13 17:08:36 | app.services.api_validation_service | INFO | æ³¨å†Œç«¯ç‚¹éªŒè¯é…ç½®: /api/v1/data/download, å­—æ®µæ•°: 5
âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
ğŸ“‹ åŒ…å«çš„è¡¨ï¼šç”¨æˆ·ã€ç­–ç•¥ã€å›æµ‹ã€äº¤æ˜“ã€APIå¯†é’¥ã€å¸‚åœºæ•°æ®ã€Claudeå¯¹è¯ã€äº¤æ˜“å¿ƒå¾—
ğŸ“‹ ç®¡ç†åå°è¡¨ï¼šç®¡ç†å‘˜ã€Claudeä»£ç†æ± ã€USDTæ”¯ä»˜ã€æ•°æ®é‡‡é›†
âœ… Redisè¿æ¥æˆåŠŸ
ğŸ”‘ OKX APIè®¤è¯æˆåŠŸï¼Œå·²è¿æ¥åˆ°çœŸå®äº¤æ˜“æ¥å£
ğŸš€ Trading Service å¯åŠ¨æˆåŠŸ
ğŸ“Š ç¯å¢ƒ: development
ğŸ  Host: 0.0.0.0:8001
2025-09-13 17:08:36 | uvicorn.error | INFO | Application startup complete.
2025-09-13 17:08:36 | uvicorn.error | INFO | 52.192.***.***.***:0 - "WebSocket /api/v1/ai/ws/chat" [accepted]
2025-09-13 17:08:36 | uvicorn.error | INFO | connection open
2025-09-13 17:08:36 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: auth
2025-09-13 17:08:36 | app.api.v1.ai_websocket | INFO | ğŸ” å¼€å§‹å¤„ç†è®¤è¯æ¶ˆæ¯
2025-09-13 17:08:36 | app.api.v1.ai_websocket | INFO | ğŸ”‘ éªŒè¯JWTä»¤ç‰Œ...
2025-09-13 17:08:36 | app.api.v1.ai_websocket | INFO | âœ… JWTéªŒè¯æˆåŠŸï¼Œç”¨æˆ·ID: 6
2025-09-13 17:08:36 | app.api.v1.ai_websocket | INFO | ğŸ“¡ å»ºç«‹WebSocketè¿æ¥ç®¡ç†...
2025-09-13 17:08:36 | app.services.websocket_manager | INFO | ğŸ’“ WebSocketå¿ƒè·³ç›‘æ§å·²å¯åŠ¨
2025-09-13 17:08:36 | app.services.websocket_manager | INFO | ğŸ§¹ WebSocketæ¸…ç†ç›‘æ§å·²å¯åŠ¨
2025-09-13 17:08:36 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketç»Ÿè®¡ç›‘æ§å·²å¯åŠ¨
2025-09-13 17:08:36 | app.services.websocket_manager | INFO | ğŸ”— ç”¨æˆ· 6 å»ºç«‹WebSocketè¿æ¥: 2de9c24f-1ba4-41c3-b56c-c1e90e89ead4 (æ€»è¿æ¥æ•°: 1)
2025-09-13 17:08:36 | app.api.v1.ai_websocket | INFO | âœ… è¿æ¥IDå·²åˆ›å»º: 2de9c24f-1ba4-41c3-b56c-c1e90e89ead4
2025-09-13 17:08:36 | app.api.v1.ai_websocket | INFO | ğŸ“¤ å‘é€è®¤è¯æˆåŠŸå“åº”: {'type': 'auth_success', 'connection_id': '2de9c24f-1ba4-41c3-b56c-c1e90e89ead4', 'user_id': 6, 'message': 'è®¤è¯æˆåŠŸï¼ŒAIå¯¹è¯å·²å‡†å¤‡å°±ç»ª'}
2025-09-13 17:08:36 | app.api.v1.ai_websocket | INFO | âœ… ç”¨æˆ· 6 é€šè¿‡WebSocketè®¤è¯æˆåŠŸ
2025-09-13 17:09:07 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:09:37 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:10:07 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:10:37 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:11:07 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:11:37 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:12:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:13:36 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=17, æ€»é”™è¯¯=0
2025-09-13 17:13:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:14:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:15:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:16:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:17:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:18:36 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=32, æ€»é”™è¯¯=0
2025-09-13 17:18:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:19:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:20:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:21:27 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:27.074447", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "300"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "binance", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2025-07-01", "end_date": "2025-07-31", "data_type": "kline"}}
2025-09-13 17:21:27 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 17:21:27.078 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:27.089 | INFO     | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1215 - AIç­–ç•¥å›æµ‹è¯·æ±‚: ç”¨æˆ·6, ä¼šå‘˜çº§åˆ«professional, äº¤æ˜“æ‰€: binance
2025-09-13 17:21:27.138 | WARNING  | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1233 - AIç­–ç•¥æ•°æ®éªŒè¯å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨ï¼Œè¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:21:27.139 | ERROR    | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1253 - å¯åŠ¨AIç­–ç•¥å›æµ‹å¤±è´¥: 400: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨ï¼Œè¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:21:27.139 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 400
2025-09-13 17:21:27 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 400, "duration": 65.57, "timestamp": "2025-09-13T09:21:27.139971"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45266', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 400)
2025-09-13 17:21:27 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start-ai-strategy", "path": "/api/v1/realtime-backtest/start-ai-strategy", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:27.146371", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15", "content-length": "296"}, "body": {"strategy_code": "\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {\"signal\": \"hold\"}\n        ", "exchange": "okx", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2025-07-01", "end_date": "2025-07-31", "data_type": "kline"}}
2025-09-13 17:21:27 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start-ai-strategy
2025-09-13 17:21:27.147 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:27.149 | INFO     | app.api.v1.realtime_backtest:start_ai_strategy_backtest:1215 - AIç­–ç•¥å›æµ‹è¯·æ±‚: ç”¨æˆ·6, ä¼šå‘˜çº§åˆ«professional, äº¤æ˜“æ‰€: okx
2025-09-13 17:21:27.152 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.005s
2025-09-13 17:21:27 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start-ai-strategy", "status_code": 200, "duration": 6.2, "timestamp": "2025-09-13T09:21:27.152548"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'POST', '/api/v1/realtime-backtest/start-ai-strategy', '1.1', 200)
2025-09-13 17:21:28 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:28.157094", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:21:28 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:21:28 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb
2025-09-13 17:21:28.158 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:28.159 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:21:28 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "status_code": 200, "duration": 2.59, "timestamp": "2025-09-13T09:21:28.159653"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'GET', '/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb', '1.1', 200)
2025-09-13 17:21:28.657 | INFO     | app.api.v1.realtime_backtest:_prepare_data:599 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2025-07-01 00:00:00 - 2025-07-31 00:00:00
2025-09-13 17:21:28.657 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:626 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 17:21:32.380 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:655 - âœ… BTC/USDT æ•°æ®åº“çœŸå®æ•°æ®åŠ è½½æˆåŠŸ: 113489 æ¡è®°å½•
2025-09-13 17:21:32.380 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:656 - ğŸ“ˆ æ•°æ®èŒƒå›´: 2025-07-01 13:12:00 åˆ° 2025-07-31 00:00:00
2025-09-13 17:21:32 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:32.673741", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:21:32 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:21:32 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb
2025-09-13 17:21:32.674 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:32.676 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:21:32 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "status_code": 200, "duration": 2.45, "timestamp": "2025-09-13T09:21:32.676143"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'GET', '/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb', '1.1', 200)
2025-09-13 17:21:33 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:33.681909", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:21:33 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:21:33 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb
2025-09-13 17:21:33.682 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:33.683 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:21:33 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "status_code": 200, "duration": 1.99, "timestamp": "2025-09-13T09:21:33.683868"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'GET', '/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb', '1.1', 200)
2025-09-13 17:21:34.174 | INFO     | app.api.v1.realtime_backtest:_run_backtest_logic:683 - ğŸ§® å¼€å§‹æ‰§è¡ŒçœŸå®ç­–ç•¥ä»£ç å›æµ‹...
2025-09-13 17:21:34.175 | INFO     | app.api.v1.realtime_backtest:_run_backtest_logic:703 - ğŸ“Š ç­–ç•¥å›æµ‹å‚æ•°: {'strategy_code': '\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {"signal": "hold"}\n        ', 'exchange': 'okx', 'symbols': ['BTC/USDT'], 'timeframes': ['1h'], 'start_date': '2025-07-01', 'end_date': '2025-07-31', 'initial_capital': 10000.0, 'fee_rate': 'vip0', 'data_type': 'kline'}
2025-09-13 17:21:34.175 | INFO     | app.services.backtest_service:execute_backtest:731 - æ‰§è¡Œå›æµ‹ï¼Œå‚æ•°: {'strategy_code': '\n# ç®€å•æµ‹è¯•ç­–ç•¥\ndef on_data(data):\n    return {"signal": "hold"}\n        ', 'exchange': 'okx', 'symbols': ['BTC/USDT'], 'timeframes': ['1h'], 'start_date': '2025-07-01', 'end_date': '2025-07-31', 'initial_capital': 10000.0, 'fee_rate': 'vip0', 'data_type': 'kline'}
2025-09-13 17:21:34.228 | INFO     | app.services.backtest_service:_get_historical_data:133 - è·å–å†å²æ•°æ®: okx BTC/USDT 1h 2025-07-01 00:00:00-2025-07-31 00:00:00
2025-09-13 17:21:34.316 | INFO     | app.services.backtest_service:_get_historical_data:166 - âœ… æˆåŠŸè·å–OKXå†å²æ•°æ®: 4507æ¡è®°å½•
2025-09-13 17:21:34.317 | INFO     | app.services.backtest_service:_get_historical_data:167 -    æ•°æ®æ—¶é—´èŒƒå›´: 2025-07-01 14:00:00 åˆ° 2025-09-12 16:00:00
2025-09-13 17:21:34.341 | INFO     | app.services.backtest_service:execute_backtest:789 - æˆåŠŸå‡†å¤‡å›æµ‹æ•°æ®: 4507 æ¡è®°å½•ï¼Œæ—¶é—´èŒƒå›´: 2025-07-01 06:00:00 åˆ° 2025-09-12 08:00:00
/root/trademe/backend/trading-service/app/services/backtest_service.py:262: RuntimeWarning: invalid value encountered in scalar divide
  daily_return = (self.total_value - prev_value) / prev_value
2025-09-13 17:21:35.596 | INFO     | app.services.backtest_service:execute_backtest:807 - å›æµ‹æ‰§è¡ŒæˆåŠŸï¼Œæ€»æ”¶ç›Šç‡: -100.00%
2025-09-13 17:21:35.599 | INFO     | app.api.v1.realtime_backtest:_run_backtest_logic:727 - âœ… ç­–ç•¥ä»£ç å›æµ‹æ‰§è¡ŒæˆåŠŸ
2025-09-13 17:21:35 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:35.600012", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:21:35 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:21:35 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb
2025-09-13 17:21:35.601 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:35.602 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:21:35 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "status_code": 200, "duration": 2.53, "timestamp": "2025-09-13T09:21:35.602512"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'GET', '/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb', '1.1', 200)
2025-09-13 17:21:36 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:36.607278", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:21:36 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:21:36 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb
2025-09-13 17:21:36.608 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:36.609 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:21:36 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "status_code": 200, "duration": 2.66, "timestamp": "2025-09-13T09:21:36.609903"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'GET', '/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb', '1.1', 200)
2025-09-13 17:21:37 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:37.615540", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:21:37 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:21:37 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb
2025-09-13 17:21:37.616 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:37.617 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:21:37 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "status_code": 200, "duration": 2.44, "timestamp": "2025-09-13T09:21:37.617943"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'GET', '/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb', '1.1', 200)
2025-09-13 17:21:38 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:38.622288", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:21:38 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:21:38 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb
2025-09-13 17:21:38.623 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:38.623 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:21:38 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "status_code": 200, "duration": 1.85, "timestamp": "2025-09-13T09:21:38.624106"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'GET', '/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb', '1.1', 200)
2025-09-13 17:21:39 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:39.628424", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:21:39 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:21:39 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb
2025-09-13 17:21:39.629 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:39.630 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:21:39 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "status_code": 200, "duration": 2.4, "timestamp": "2025-09-13T09:21:39.630791"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'GET', '/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb', '1.1', 200)
2025-09-13 17:21:40.100 | INFO     | app.api.v1.realtime_backtest:_execute_ai_strategy_backtest:276 - AIç­–ç•¥å›æµ‹ä»»åŠ¡ 135b587a-9935-47b6-945d-fe2ae673f1eb å®Œæˆ
2025-09-13 17:21:40 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://localhost:8001/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "client_ip": "127.0.***.***.***", "user_agent": "Python/3.12 aiohttp/3.12.15", "timestamp": "2025-09-13T09:21:40.635285", "headers": {"host": "localhost:8001", "authorization": "Bearer eyJhbGciOi...-2UrlM", "content-type": "application/json", "accept": "*/*", "accept-encoding": "gzip, deflate", "user-agent": "Python/3.12 aiohttp/3.12.15"}, "query_params": {}}
2025-09-13 17:21:40 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:21:40 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb
2025-09-13 17:21:40.636 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:21:40.637 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-13 17:21:40 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb", "status_code": 200, "duration": 2.74, "timestamp": "2025-09-13T09:21:40.637984"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:45278', 'GET', '/api/v1/realtime-backtest/status/135b587a-9935-47b6-945d-fe2ae673f1eb', '1.1', 200)
2025-09-13 17:21:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:22:43 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:22:44 | app.api.v1.ai_websocket | INFO | WebSocketè¿æ¥æ–­å¼€: 2de9c24f-1ba4-41c3-b56c-c1e90e89ead4
2025-09-13 17:22:44 | app.services.websocket_manager | INFO | âŒ ç”¨æˆ· 6 æ–­å¼€WebSocketè¿æ¥: 2de9c24f-1ba4-41c3-b56c-c1e90e89ead4 (åŸå› : è¿æ¥å…³é—­)
2025-09-13 17:22:44 | uvicorn.error | INFO | connection closed
2025-09-13 17:22:48 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T09:22:48.223055", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-13 17:22:48 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:22:48 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/ai/usage/stats
2025-09-13 17:22:48.224 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:22:48 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=trader", "path": "/api/v1/ai/sessions", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T09:22:48.225564", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "trader"}}
2025-09-13 17:22:48 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:22:48 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/ai/sessions
2025-09-13 17:22:48.226 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:22:48.233 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.010s
2025-09-13 17:22:48 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 10.94, "timestamp": "2025-09-13T09:22:48.233965"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-13 17:22:48.236 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.010s
2025-09-13 17:22:48 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 11.25, "timestamp": "2025-09-13T09:22:48.236799"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'GET', '/api/v1/ai/sessions?ai_mode=trader', '1.0', 200)
2025-09-13 17:22:49 | uvicorn.error | INFO | 52.192.***.***.***:0 - "WebSocket /api/v1/ai/ws/chat" [accepted]
2025-09-13 17:22:49 | uvicorn.error | INFO | connection open
2025-09-13 17:22:49 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: auth
2025-09-13 17:22:49 | app.api.v1.ai_websocket | INFO | ğŸ” å¼€å§‹å¤„ç†è®¤è¯æ¶ˆæ¯
2025-09-13 17:22:49 | app.api.v1.ai_websocket | INFO | ğŸ”‘ éªŒè¯JWTä»¤ç‰Œ...
2025-09-13 17:22:49 | app.api.v1.ai_websocket | INFO | âœ… JWTéªŒè¯æˆåŠŸï¼Œç”¨æˆ·ID: 6
2025-09-13 17:22:49 | app.api.v1.ai_websocket | INFO | ğŸ“¡ å»ºç«‹WebSocketè¿æ¥ç®¡ç†...
2025-09-13 17:22:49 | app.services.websocket_manager | INFO | ğŸ’“ WebSocketå¿ƒè·³ç›‘æ§å·²å¯åŠ¨
2025-09-13 17:22:49 | app.services.websocket_manager | INFO | ğŸ§¹ WebSocketæ¸…ç†ç›‘æ§å·²å¯åŠ¨
2025-09-13 17:22:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketç»Ÿè®¡ç›‘æ§å·²å¯åŠ¨
2025-09-13 17:22:49 | app.services.websocket_manager | INFO | ğŸ”— ç”¨æˆ· 6 å»ºç«‹WebSocketè¿æ¥: 2362a32b-899f-4140-956d-9f6702f21c3c (æ€»è¿æ¥æ•°: 1)
2025-09-13 17:22:49 | app.api.v1.ai_websocket | INFO | âœ… è¿æ¥IDå·²åˆ›å»º: 2362a32b-899f-4140-956d-9f6702f21c3c
2025-09-13 17:22:49 | app.api.v1.ai_websocket | INFO | ğŸ“¤ å‘é€è®¤è¯æˆåŠŸå“åº”: {'type': 'auth_success', 'connection_id': '2362a32b-899f-4140-956d-9f6702f21c3c', 'user_id': 6, 'message': 'è®¤è¯æˆåŠŸï¼ŒAIå¯¹è¯å·²å‡†å¤‡å°±ç»ª'}
2025-09-13 17:22:49 | app.api.v1.ai_websocket | INFO | âœ… ç”¨æˆ· 6 é€šè¿‡WebSocketè®¤è¯æˆåŠŸ
2025-09-13 17:22:50 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/chat/history?session_id=5be7cbc0-e982-4695-833b-6f983061cbf6&limit=20", "path": "/api/v1/ai/chat/history", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T09:22:50.621059", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"session_id": "5be7cbc0-e982-4695-833b-6f983061cbf6", "limit": "20"}}
2025-09-13 17:22:50 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:22:50 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/ai/chat/history
2025-09-13 17:22:50.622 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:22:50.630 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.008s
2025-09-13 17:22:50 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/ai/chat/history", "status_code": 200, "duration": 9.88, "timestamp": "2025-09-13T09:22:50.630905"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'GET', '/api/v1/ai/chat/history?session_id=5be7cbc0-e982-4695-833b-6f983061cbf6&limit=20', '1.0', 200)
2025-09-13 17:22:55 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6", "path": "/api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T09:22:55.408030", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {}}
2025-09-13 17:22:55 | app.services.integrated_cache_manager | WARNING | ç¼“å­˜ç®¡ç†å™¨å°šæœªåˆå§‹åŒ–
2025-09-13 17:22:55 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6
2025-09-13 17:22:55.409 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:22:55.417 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.008s
2025-09-13 17:22:55 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "GET", "path": "/api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6", "status_code": 200, "duration": 9.49, "timestamp": "2025-09-13T09:22:55.417485"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'GET', '/api/v1/strategies/latest-ai-strategy/5be7cbc0-e982-4695-833b-6f983061cbf6', '1.0', 200)
2025-09-13 17:22:55 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://43.167.***.***.***/api/v1/realtime-backtest/start", "path": "/api/v1/realtime-backtest/start", "client_ip": "52.192.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-13T09:22:55.569593", "headers": {"host": "43.167.***.***.***", "x-real-ip": "52.192.***.***.***", "x-forwarded-for": "52.192.***.***.***", "x-forwarded-proto": "http", "connection": "close", "content-length": "8167", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...VGkplk", "content-type": "application/json", "origin": "http://43.167.***.***.***", "referer": "http://43.167.***.***.***/ai-chat"}, "body": {"strategy_code": "from app.core.enhanced_strategy import EnhancedBaseStrategy, DataRequest, DataType\nfrom app.core.strategy_engine import TradingSignal, SignalType\nfrom typing import List, Optional, Dict, Any\nfrom datetime import datetime\nimport pandas as pd\nimport numpy as np\n\nclass UserStrategy(EnhancedBaseStrategy):\n    \"\"\"ä¼˜åŒ–çš„åŒå‡çº¿äº¤å‰ç­–ç•¥ - ç»“åˆKDJæŒ‡æ ‡è¿‡æ»¤\"\"\"\n    \n    def get_data_requirements(self) -> List[DataRequest]:\n        \"\"\"å®šä¹‰ç­–ç•¥æ‰€éœ€çš„æ•°æ®æº\"\"\"\n        return [\n            DataRequest(\n                data_type=DataType.KLINE,\n                exchange=\"okx\",\n                symbol=\"BTC-USDT-SWAP\", \n                timeframe=\"1h\",\n                required=True\n            )\n        ]\n    \n    async def on_data_update(self, data_type: str, data: Dict[str, Any]) -> Optional[TradingSignal]:\n        \"\"\"æ•°æ®æ›´æ–°å¤„ç† - å®ç°åŒå‡çº¿äº¤å‰ç­–ç•¥é€»è¾‘\"\"\"\n        if data_type != \"kline\":\n            return None\n            \n        # è·å–Kçº¿æ•°æ®\n        df = self.get_kline_data()\n        if df is None or len(df) < 50:  # éœ€è¦è¶³å¤Ÿçš„å†å²æ•°æ®\n            return None\n        \n        # è®¡ç®—æŠ€æœ¯æŒ‡æ ‡\n        sma5 = self.calculate_sma(df['close'], 5)\n        sma10 = self.calculate_sma(df['close'], 10)\n        \n        # è®¡ç®—KDJæŒ‡æ ‡ç”¨äºä¿¡å·è¿‡æ»¤\n        kdj_k, kdj_d, kdj_j = self.calculate_kdj(df['high'], df['low'], df['close'], 9, 3, 3)\n        \n        # è·å–å½“å‰ä»·æ ¼å’Œä»“ä½ä¿¡æ¯\n        current_price = df['close'].iloc[-1]\n        current_position = self.get_current_position()\n        \n        # ä»å‚æ•°ä¸­è·å–é…ç½®\n        position_size = self.context.parameters.get('position_size', 10.0) / 100.0  # è½¬æ¢ä¸ºæ¯”ä¾‹\n        stop_loss_pct = self.context.parameters.get('stop_loss', 5.0) / 100.0\n        take_profit_pct = self.context.parameters.get('take_profit', 5.0) / 100.0\n        \n        # æ£€æµ‹å‡çº¿äº¤å‰ä¿¡å·\n        golden_cross = self._detect_golden_cross(sma5, sma10)\n        death_cross = self._detect_death_cross(sma5, sma10)\n        \n        # ä¼˜åŒ–çš„ä¿¡å·ç”Ÿæˆé€»è¾‘\n        signal = None\n        \n        # é‡‘å‰ä¿¡å· - å¼€å¤šä»“\n        if golden_cross:\n            # KDJè¿‡æ»¤ï¼šKå€¼å°äº80ä¸”K>Dæ—¶ä¿¡å·æ›´å¯é \n            if kdj_k[-1] < 80 and kdj_k[-1] > kdj_d[-1]:\n                # å¦‚æœæœ‰ç©ºä»“ï¼Œå…ˆå¹³ç©ºå†å¼€å¤š\n                if current_position and current_position < 0:\n                    # ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†å¹³ä»“é€»è¾‘\n                    pass\n                \n                signal = TradingSignal(\n                    signal_type=SignalType.BUY,\n                    symbol=\"BTC-USDT-SWAP\",\n                    price=current_price,\n                    quantity=position_size,\n                    stop_loss=current_price * (1 - stop_loss_pct),\n                    take_profit=current_price * (1 + take_profit_pct),\n                    metadata={\n                        'strategy': 'sma_cross_optimized',\n                        'signal_reason': 'golden_cross_with_kdj_filter',\n                        'sma5': sma5[-1],\n                        'sma10': sma10[-1],\n                        'kdj_k': kdj_k[-1],\n                        'kdj_d': kdj_d[-1]\n                    }\n                )\n        \n        # æ­»å‰ä¿¡å· - å¼€ç©ºä»“\n        elif death_cross:\n            # KDJè¿‡æ»¤ï¼šKå€¼å¤§äº20ä¸”K<Dæ—¶ä¿¡å·æ›´å¯é \n            if kdj_k[-1] > 20 and kdj_k[-1] < kdj_d[-1]:\n                # å¦‚æœæœ‰å¤šä»“ï¼Œå…ˆå¹³å¤šå†å¼€ç©º\n                if current_position and current_position > 0:\n                    # ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†å¹³ä»“é€»è¾‘\n                    pass\n                \n                signal = TradingSignal(\n                    signal_type=SignalType.SELL,\n                    symbol=\"BTC-USDT-SWAP\",\n                    price=current_price,\n                    quantity=position_size,\n                    stop_loss=current_price * (1 + stop_loss_pct),\n                    take_profit=current_price * (1 - take_profit_pct),\n                    metadata={\n                        'strategy': 'sma_cross_optimized',\n                        'signal_reason': 'death_cross_with_kdj_filter',\n                        'sma5': sma5[-1],\n                        'sma10': sma10[-1],\n                        'kdj_k': kdj_k[-1],\n                        'kdj_d': kdj_d[-1]\n                    }\n                )\n        \n        # åŠ¨æ€æ­¢ç›ˆæ­¢æŸè°ƒæ•´ï¼ˆè¶‹åŠ¿è·Ÿè¸ªä¼˜åŒ–ï¼‰\n        if current_position and signal is None:\n            signal = self._check_dynamic_exit(df, current_position, current_price, \n                                            sma5, sma10, kdj_k, kdj_d)\n        \n        return signal\n    \n    def _detect_golden_cross(self, sma5: pd.Series, sma10: pd.Series) -> bool:\n        \"\"\"æ£€æµ‹é‡‘å‰ä¿¡å·\"\"\"\n        if len(sma5) < 2 or len(sma10) < 2:\n            return False\n        \n        # å½“å‰SMA5 > SMA10 ä¸” å‰ä¸€æ ¹SMA5 <= SMA10\n        current_cross = sma5.iloc[-1] > sma10.iloc[-1]\n        previous_cross = sma5.iloc[-2] <= sma10.iloc[-2]\n        \n        return current_cross and previous_cross\n    \n    def _detect_death_cross(self, sma5: pd.Series, sma10: pd.Series) -> bool:\n        \"\"\"æ£€æµ‹æ­»å‰ä¿¡å·\"\"\"\n        if len(sma5) < 2 or len(sma10) < 2:\n            return False\n        \n        # å½“å‰SMA5 < SMA10 ä¸” å‰ä¸€æ ¹SMA5 >= SMA10\n        current_cross = sma5.iloc[-1] < sma10.iloc[-1]\n        previous_cross = sma5.iloc[-2] >= sma10.iloc[-2]\n        \n        return current_cross and previous_cross\n    \n    def _check_dynamic_exit(self, df: pd.DataFrame, position: float, current_price: float,\n                          sma5: pd.Series, sma10: pd.Series, kdj_k: pd.Series, kdj_d: pd.Series) -> Optional[TradingSignal]:\n        \"\"\"åŠ¨æ€å‡ºåœºé€»è¾‘ - è¶‹åŠ¿è·Ÿè¸ªä¼˜åŒ–\"\"\"\n        \n        # å¤šä»“åŠ¨æ€æ­¢ç›ˆé€»è¾‘\n        if position > 0:\n            # è¶‹åŠ¿è½¬å¼±ä¿¡å·ï¼šSMA5å¼€å§‹èµ°å¹³æˆ–KDJè¶…ä¹°\n            if (sma5.iloc[-1] <= sma5.iloc[-2] or kdj_k[-1] > 85) and kdj_k[-1] < kdj_d[-1]:\n                return TradingSignal(\n                    signal_type=SignalType.SELL,\n                    symbol=\"BTC-USDT-SWAP\",\n                    price=current_price,\n                    quantity=abs(position),\n                    metadata={\n                        'strategy': 'sma_cross_optimized',\n                        'signal_reason': 'dynamic_exit_long_trend_weak'\n                    }\n                )\n        \n        # ç©ºä»“åŠ¨æ€æ­¢ç›ˆé€»è¾‘\n        elif position < 0:\n            # è¶‹åŠ¿è½¬å¼ºä¿¡å·ï¼šSMA5å¼€å§‹ä¸Šæ¶¨æˆ–KDJè¶…å–åå¼¹\n            if (sma5.iloc[-1] >= sma5.iloc[-2] or kdj_k[-1] < 15) and kdj_k[-1] > kdj_d[-1]:\n                return TradingSignal(\n                    signal_type=SignalType.BUY,\n                    symbol=\"BTC-USDT-SWAP\",\n                    price=current_price,\n                    quantity=abs(position),\n                    metadata={\n                        'strategy': 'sma_cross_optimized',\n                        'signal_reason': 'dynamic_exit_short_trend_strong'\n                    }\n                )\n        \n        return None\n    \n    def calculate_kdj(self, high: pd.Series, low: pd.Series, close: pd.Series, \n                     k_period: int = 9, k_smooth: int = 3, d_smooth: int = 3) -> tuple:\n        \"\"\"è®¡ç®—KDJæŒ‡æ ‡\"\"\"\n        lowest_low = low.rolling(window=k_period).min()\n        highest_high = high.rolling(window=k_period).max()\n        \n        rsv = 100 * (close - lowest_low) / (highest_high - lowest_low)\n        rsv = rsv.fillna(50)  # å¡«å……NaNå€¼\n        \n        k = rsv.ewm(span=k_smooth).mean()\n        d = k.ewm(span=d_smooth).mean()\n        j = 3 * k - 2 * d\n        \n        return k, d, j", "exchange": "binance", "product_type": "spot", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "fee_rate": "vip0", "initial_capital": 10000, "start_date": "2025-08-14", "end_date": "2025-09-13", "data_type": "kline"}}
2025-09-13 17:22:55 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start
2025-09-13 17:22:55.576 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:22:55.583 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.006s
2025-09-13 17:22:55 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start", "status_code": 200, "duration": 13.88, "timestamp": "2025-09-13T09:22:55.583444"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('52.192.119.253:0', 'POST', '/api/v1/realtime-backtest/start', '1.0', 200)
2025-09-13 17:22:55 | uvicorn.error | INFO | 52.192.***.***.***:0 - "WebSocket /api/v1/realtime-backtest/ws/db2e9454-6950-4c58-8605-18244bfc6c60" [accepted]
2025-09-13 17:22:55 | uvicorn.error | INFO | connection open
2025-09-13 17:22:57.584 | INFO     | app.api.v1.realtime_backtest:_prepare_data:599 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2025-08-14 00:00:00 - 2025-09-13 00:00:00
2025-09-13 17:22:57.584 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:626 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 17:22:57.586 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:667 - âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:22:57.586 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:672 - âŒ BTC/USDT æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:22:57.586 | ERROR    | app.api.v1.realtime_backtest:_prepare_data:613 - âŒ æ•°æ®å‡†å¤‡å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:22:57.586 | ERROR    | app.api.v1.realtime_backtest:_execute_backtest:557 - å›æµ‹ä»»åŠ¡ db2e9454-6950-4c58-8605-18244bfc6c60 å¤±è´¥: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:22:57.587 | ERROR    | app.api.v1.realtime_backtest:_execute_backtest:558 - å®Œæ•´é”™è¯¯å †æ ˆ: Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 610, in _prepare_data
    return await self._fetch_market_data(self.db_session, config, start_date, end_date)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 673, in _fetch_market_data
    raise e
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 668, in _fetch_market_data
    raise Exception(error_msg)
Exception: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 529, in _execute_backtest
    step_result = await step_info["action"](config, backtest_data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 615, in _prepare_data
    raise Exception(f"æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: {str(e)}")
Exception: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-08-14 åˆ° 2025-09-13)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹

2025-09-13 17:23:19 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
/root/trademe/backend/trading-service/app/services/websocket_manager.py:369: SAWarning: The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-1, started daemon 135368867317440)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
  collected = gc.collect()
2025-09-13 17:23:49 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:24:19 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:24:49 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:25:19 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:25:49 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:26:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:27:25 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:27:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=18, æ€»é”™è¯¯=0
2025-09-13 17:27:49 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:28:19 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:29:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:30:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:31:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:32:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:32:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=34, æ€»é”™è¯¯=0
2025-09-13 17:33:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:34:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:35:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:36:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:37:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:37:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=49, æ€»é”™è¯¯=0
2025-09-13 17:38:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:39:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:40:38 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start", "path": "/api/v1/realtime-backtest/start", "client_ip": "127.0.***.***.***", "user_agent": "curl/8.5.0", "timestamp": "2025-09-13T09:40:38.658098", "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "Bearer eyJhbGciOi...bYqzoo", "content-length": "290"}, "body": {"strategy_code": "# Simple test strategy\ndef on_data(data):\n    return {\"signal\": \"hold\"}", "exchange": "binance", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2025-07-01", "end_date": "2025-07-31", "data_type": "kline"}}
2025-09-13 17:40:38 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start
2025-09-13 17:40:38.659 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 17:40:38.665 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.006s
2025-09-13 17:40:38 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start", "status_code": 200, "duration": 7.55, "timestamp": "2025-09-13T09:40:38.665611"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:58508', 'POST', '/api/v1/realtime-backtest/start', '1.1', 200)
2025-09-13 17:40:40.673 | INFO     | app.api.v1.realtime_backtest:_prepare_data:599 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2025-07-01 00:00:00 - 2025-07-31 00:00:00
2025-09-13 17:40:40.673 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:626 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 17:40:40.681 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:667 - âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:40:40.681 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:672 - âŒ BTC/USDT æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:40:40.681 | ERROR    | app.api.v1.realtime_backtest:_prepare_data:613 - âŒ æ•°æ®å‡†å¤‡å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:40:40.681 | ERROR    | app.api.v1.realtime_backtest:_execute_backtest:557 - å›æµ‹ä»»åŠ¡ 77a1a682-cda5-4e7f-b540-a66c525a139a å¤±è´¥: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 17:40:40.684 | ERROR    | app.api.v1.realtime_backtest:_execute_backtest:558 - å®Œæ•´é”™è¯¯å †æ ˆ: Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 610, in _prepare_data
    return await self._fetch_market_data(self.db_session, config, start_date, end_date)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 673, in _fetch_market_data
    raise e
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 668, in _fetch_market_data
    raise Exception(error_msg)
Exception: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 529, in _execute_backtest
    step_result = await step_info["action"](config, backtest_data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 615, in _prepare_data
    raise Exception(f"æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: {str(e)}")
Exception: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹

2025-09-13 17:40:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
/root/trademe/backend/trading-service/app/services/websocket_manager.py:369: SAWarning: The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-3, started daemon 135368777139904)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
  collected = gc.collect()
2025-09-13 17:41:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:42:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:42:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=64, æ€»é”™è¯¯=0
2025-09-13 17:43:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:44:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:45:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:46:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:47:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:47:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=79, æ€»é”™è¯¯=0
2025-09-13 17:48:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:49:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:50:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:51:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:52:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:52:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=94, æ€»é”™è¯¯=0
2025-09-13 17:53:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:54:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:55:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:56:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:57:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:57:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=109, æ€»é”™è¯¯=0
2025-09-13 17:58:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 17:59:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:00:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:01:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:02:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:02:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=124, æ€»é”™è¯¯=0
2025-09-13 18:03:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:04:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:05:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:06:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:06:48 | app.middleware.api_validation_middleware | INFO | APIè¯·æ±‚: {"method": "POST", "url": "http://localhost:8001/api/v1/realtime-backtest/start", "path": "/api/v1/realtime-backtest/start", "client_ip": "127.0.***.***.***", "user_agent": "curl/8.5.0", "timestamp": "2025-09-13T10:06:48.923407", "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "Bearer eyJhbGciOi...bYqzoo", "content-length": "290"}, "body": {"strategy_code": "# Simple test strategy\ndef on_data(data):\n    return {\"signal\": \"hold\"}", "exchange": "binance", "symbols": ["BTC/USDT"], "timeframes": ["1h"], "initial_capital": 10000.0, "start_date": "2025-07-01", "end_date": "2025-07-31", "data_type": "kline"}}
2025-09-13 18:06:48 | app.services.api_validation_service | WARNING | ç«¯ç‚¹éªŒè¯é…ç½®ä¸å­˜åœ¨: /api/v1/realtime-backtest/start
2025-09-13 18:06:48.925 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-13 18:06:48.927 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-13 18:06:48 | app.middleware.api_validation_middleware | INFO | APIå“åº”: {"method": "POST", "path": "/api/v1/realtime-backtest/start", "status_code": 200, "duration": 4.51, "timestamp": "2025-09-13T10:06:48.927879"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/usr/lib/python3.12/asyncio/base_events.py", line 674, in run_until_complete
    self.run_forever()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 641, in run_forever
    self._run_once()
  File "/usr/lib/python3.12/asyncio/base_events.py", line 1987, in _run_once
    handle._run()
  File "/usr/lib/python3.12/asyncio/events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/usr/local/lib/python3.12/dist-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/usr/local/lib/python3.12/dist-packages/uvicorn/protocols/http/h11_impl.py", line 473, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:57068', 'POST', '/api/v1/realtime-backtest/start', '1.1', 200)
2025-09-13 18:06:50.929 | INFO     | app.api.v1.realtime_backtest:_prepare_data:599 - ğŸ“Š ç›´æ¥ä»æ•°æ®åº“è·å–çœŸå®å†å²æ•°æ®: 2025-07-01 00:00:00 - 2025-07-31 00:00:00
2025-09-13 18:06:50.929 | INFO     | app.api.v1.realtime_backtest:_fetch_market_data:626 - ğŸ“Š æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ BTC/USDT æ•°æ®...
2025-09-13 18:06:50.934 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:667 - âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 18:06:50.934 | ERROR    | app.api.v1.realtime_backtest:_fetch_market_data:672 - âŒ BTC/USDT æ•°æ®åº“æŸ¥è¯¢å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 18:06:50.934 | ERROR    | app.api.v1.realtime_backtest:_prepare_data:613 - âŒ æ•°æ®å‡†å¤‡å¤±è´¥: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 18:06:50.934 | ERROR    | app.api.v1.realtime_backtest:_execute_backtest:557 - å›æµ‹ä»»åŠ¡ 68ebd07a-264e-4078-b95b-36854f2d69cf å¤±è´¥: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹
2025-09-13 18:06:50.935 | ERROR    | app.api.v1.realtime_backtest:_execute_backtest:558 - å®Œæ•´é”™è¯¯å †æ ˆ: Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 610, in _prepare_data
    return await self._fetch_market_data(self.db_session, config, start_date, end_date)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 673, in _fetch_market_data
    raise e
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 668, in _fetch_market_data
    raise Exception(error_msg)
Exception: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 529, in _execute_backtest
    step_result = await step_info["action"](config, backtest_data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/realtime_backtest.py", line 615, in _prepare_data
    raise Exception(f"æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: {str(e)}")
Exception: æ— æ³•è·å–å›æµ‹æ‰€éœ€çš„å†å²æ•°æ®: âŒ BINANCEäº¤æ˜“æ‰€çš„BTC/USDT åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´(2025-07-01 åˆ° 2025-07-31)å†…å†å²æ•°æ®ä¸è¶³ï¼ˆä»…0æ¡è®°å½•ï¼Œéœ€è¦è‡³å°‘10æ¡ï¼‰ï¼Œæ— æ³•è¿›è¡Œæœ‰æ•ˆå›æµ‹ã€‚
ğŸ’¡ å»ºè®®ï¼šç›®å‰ç³»ç»Ÿåªæœ‰OKXäº¤æ˜“æ‰€çš„æ•°æ®å¯ç”¨è¯·é€‰æ‹©æœ‰å……è¶³æ•°æ®çš„æ—¶é—´èŒƒå›´ã€äº¤æ˜“æ‰€æˆ–äº¤æ˜“å¯¹è¿›è¡Œå›æµ‹

/root/trademe/backend/trading-service/app/services/websocket_manager.py:369: SAWarning: The garbage collector is trying to clean up non-checked-in connection <AdaptedConnection <Connection(Thread-4, started daemon 135368756168384)>>, which will be dropped, as it cannot be safely terminated.  Please ensure that SQLAlchemy pooled connections are returned to the pool explicitly, either by calling ``close()`` or by using appropriate context managers to manage their lifecycle.
  collected = gc.collect()
2025-09-13 18:07:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:07:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=139, æ€»é”™è¯¯=0
2025-09-13 18:08:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:09:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:10:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:11:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:12:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:12:49 | app.services.websocket_manager | INFO | ğŸ“Š WebSocketè¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥=1, åœ¨çº¿ç”¨æˆ·=1, å³°å€¼è¿æ¥=1, æ€»æ¶ˆæ¯=154, æ€»é”™è¯¯=0
2025-09-13 18:13:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:14:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:15:45 | app.api.v1.ai_websocket | INFO | ğŸ“¨ æ”¶åˆ°WebSocketæ¶ˆæ¯ï¼Œç±»å‹: ping
2025-09-13 18:15:56 | uvicorn.error | INFO | Shutting down
2025-09-13 18:15:56 | app.api.v1.ai_websocket | INFO | WebSocketè¿æ¥æ–­å¼€: 2362a32b-899f-4140-956d-9f6702f21c3c
2025-09-13 18:15:56 | app.services.websocket_manager | INFO | âŒ ç”¨æˆ· 6 æ–­å¼€WebSocketè¿æ¥: 2362a32b-899f-4140-956d-9f6702f21c3c (åŸå› : è¿æ¥å…³é—­)
2025-09-13 18:15:56 | uvicorn.error | INFO | connection closed
2025-09-13 18:15:56 | uvicorn.error | INFO | connection closed
2025-09-13 18:15:56 | uvicorn.error | INFO | Waiting for application shutdown.
âœ… æ•°æ®åº“è¿æ¥å·²å…³é—­
âœ… Redisè¿æ¥å·²å…³é—­
ğŸ‘‹ Trading Service å·²å…³é—­
2025-09-13 18:15:56 | uvicorn.error | INFO | Application shutdown complete.
2025-09-13 18:15:56 | uvicorn.error | INFO | Finished server process [3721850]
INFO:     Stopping reloader process [3708881]
