INFO:     Will watch for changes in these directories: ['/root/trademe/backend/trading-service']
INFO:     Uvicorn running on http://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     Started reloader process [3246150] using WatchFiles
2025-09-03 13:39:41.082 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-03 13:39:41.105 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-03 13:39:41.105 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-03 13:39:41.105 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-03 13:39:41.616 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-03 13:39:42 | uvicorn.error | INFO | Started server process [3246168]
2025-09-03 13:39:42 | uvicorn.error | INFO | Waiting for application startup.
2025-09-03 13:39:42 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-03 13:39:42 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-03 13:39:42 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-03 13:39:42 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-03 13:39:42 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-03 13:39:42 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-03 13:39:42 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-03 13:39:42 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-03 13:39:42 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-03 13:39:42 | uvicorn.error | INFO | Application startup complete.
2025-09-03 13:42:52 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:42:52.796451", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...3tQJ1M", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "developer"}}
2025-09-03 13:42:52 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:42:52 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 13:42:52 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-03 13:42:52.797 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:42:52 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:42:52.803830", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...3tQJ1M", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-03 13:42:52 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:42:52 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 13:42:52 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-03 13:42:52.805 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:42:52.845 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.047s
2025-09-03 13:42:52 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 49.03, "timestamp": "2025-09-03T05:42:52.845463"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-03 13:42:52.858 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.053s
2025-09-03 13:42:52 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 54.98, "timestamp": "2025-09-03T05:42:52.858784"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-03 13:43:07 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:43:07.451440", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...2_ySXg", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-03 13:43:07 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:43:07 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 13:43:07 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-03 13:43:07.452 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:43:07 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:43:07.452965", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...2_ySXg", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "developer"}}
2025-09-03 13:43:07 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:43:07 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 13:43:07 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-03 13:43:07.455 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:43:07.459 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-03 13:43:07 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 6.8, "timestamp": "2025-09-03T05:43:07.459750"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-03 13:43:07.461 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.009s
2025-09-03 13:43:07 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 10.68, "timestamp": "2025-09-03T05:43:07.462095"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-03 13:43:10 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "DELETE", "url": "http://43.167.***.***.***/api/v1/ai/sessions/00d03dd6-5742-4cdf-8f49-338ae5b990fc", "path": "/api/v1/ai/sessions/00d03dd6-5742-4cdf-8f49-338ae5b990fc", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:43:10.042120", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...2_ySXg", "origin": "http://43.167.***.***.***", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {}}
2025-09-03 13:43:10 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:43:10 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions/00d03dd6-5742-4cdf-8f49-338ae5b990fc
2025-09-03 13:43:10.043 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:43:10.055 | INFO     | app.services.ai_service:delete_chat_session:1178 - 删除AI会话成功 - 会话ID: 00d03dd6-5742-4cdf-8f49-338ae5b990fc, 删除对话记录: 5条
2025-09-03 13:43:10.055 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.012s
2025-09-03 13:43:10 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "DELETE", "path": "/api/v1/ai/sessions/00d03dd6-5742-4cdf-8f49-338ae5b990fc", "status_code": 200, "duration": 13.83, "timestamp": "2025-09-03T05:43:10.055934"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'DELETE', '/api/v1/ai/sessions/00d03dd6-5742-4cdf-8f49-338ae5b990fc', '1.0', 200)
2025-09-03 13:43:15 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "POST", "url": "http://43.167.***.***.***/api/v1/ai/sessions", "path": "/api/v1/ai/sessions", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:43:15.222446", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "content-length": "63", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...2_ySXg", "content-type": "application/json", "origin": "http://43.167.***.***.***", "referer": "http://43.167.***.***.***/ai-chat"}, "body": {"name": "macd", "ai_mode": "developer", "session_type": "strategy"}}
2025-09-03 13:43:15 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:43:15 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-03 13:43:15.223 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:43:15.239 | INFO     | app.services.ai_service:create_chat_session:1040 - 创建AI会话成功 - 用户ID: 6, 会话ID: f81b6cba-120b-48cf-9cda-c0659d958931, 类型: strategy
2025-09-03 13:43:15.240 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.016s
2025-09-03 13:43:15 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "POST", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 17.78, "timestamp": "2025-09-03T05:43:15.240212"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'POST', '/api/v1/ai/sessions', '1.0', 200)
2025-09-03 13:43:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756878198091
2025-09-03 13:43:18 | uvicorn.error | INFO | connection open
2025-09-03 13:43:21.072 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:f81b6cba-120b-48cf-9cda-c0659d958931, 窗口:10, 策略:default_fallback
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 我想开发一个macd背离策略...
📡 调用AIService.chat_completion...
2025-09-03 13:43:21 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='f81b6cba-120b-48cf-9cda-c0659d958931', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 13:43:21 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 13:43:21 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 13:43:21 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 13:43:21 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 13:43:21 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T05:43:21.078059",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 90.07535826888888,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.19101246777777778 (score: 3.8)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "f81b6cba-120b-48cf-9cda-c0659d958931",
    "priority": 100
  }
}
2025-09-03 13:43:21 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 90.08)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 13:43:21 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:43:21 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 13:43:21.089 | INFO     | app.ai.core.claude_client:chat_completion:477 - 🔄 使用代理重试管理器处理请求
2025-09-03 13:43:21 | app.services.proxy_retry_manager | INFO | 🏥 Started proxy health monitoring
2025-09-03 13:43:51 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.914297 seconds
2025-09-03 13:44:21 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 1/3)
2025-09-03 13:44:21 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 0.9s before retry...
2025-09-03 13:44:52 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.974834 seconds
2025-09-03 13:45:22 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 2/3)
2025-09-03 13:45:22 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 1.9s before retry...
2025-09-03 13:45:54 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.956175 seconds
2025-09-03 13:46:23 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 3/3)
2025-09-03 13:46:54 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.866822 seconds
2025-09-03 13:47:23 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 1/3)
2025-09-03 13:47:23 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 1.0s before retry...
2025-09-03 13:47:55 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.946561 seconds
2025-09-03 13:48:24 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 2/3)
2025-09-03 13:48:24 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 1.9s before retry...
2025-09-03 13:48:57 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.896493 seconds
2025-09-03 13:48:59 | anthropic._base_client | INFO | Retrying request to /v1/messages in 1.797401 seconds
WARNING:  WatchFiles detected changes in 'app/services/proxy_retry_manager.py'. Reloading...
2025-09-03 13:49:23 | uvicorn.error | INFO | Shutting down
2025-09-03 13:49:23 | uvicorn.error | INFO | connection closed
2025-09-03 13:49:23 | uvicorn.error | INFO | Waiting for background tasks to complete. (CTRL+C to force quit)
2025-09-03 13:49:26 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 3/3)
2025-09-03 13:49:26.882 | ERROR    | app.ai.core.claude_client:_make_request_with_proxy_retry:226 - ❌ 所有代理尝试失败: Timeout after 60s
2025-09-03 13:49:26.882 | ERROR    | app.ai.core.claude_client:chat_completion:504 - 聊天完成失败: Claude API请求失败: Timeout after 60s
2025-09-03 13:49:26.882 | ERROR    | app.main:websocket_realtime_endpoint:610 - AI聊天处理错误: 
📨 AI服务返回结果: {"content": "\u62b1\u6b49\uff0cAI\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528: Claude API\u8bf7\u6c42\u5931\u8d25: Timeout after 60s", "session_id": "f81b6cba-120b-48cf-9cda-c0659d958931", "tokens_used": 0, "model": "claude-sonnet-4-20250514", "success": false, "requires_strategy_generation": false}
❌ AI服务失败: 抱歉，AI服务暂时不可用: Claude API请求失败: Timeout after 60s
❌ 数据库错误: 
WebSocket消息处理错误: Cannot call "send" once a close message has been sent.
❌ WebSocket连接已断开: conn_1756878198091 (用户: 6)
2025-09-03 13:49:26 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-03 13:49:26 | uvicorn.error | INFO | Application shutdown complete.
2025-09-03 13:49:26 | uvicorn.error | INFO | Finished server process [3246168]
2025-09-03 13:49:28.982 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-03 13:49:29.003 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-03 13:49:29.003 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-03 13:49:29.003 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-03 13:49:29.635 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-03 13:49:30 | uvicorn.error | INFO | Started server process [3249614]
2025-09-03 13:49:30 | uvicorn.error | INFO | Waiting for application startup.
2025-09-03 13:49:30 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-03 13:49:30 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-03 13:49:30 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-03 13:49:30 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-03 13:49:30 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-03 13:49:30 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-03 13:49:30 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-03 13:49:30 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-03 13:49:30 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-03 13:49:30 | uvicorn.error | INFO | Application startup complete.
2025-09-03 13:49:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756878570500
2025-09-03 13:49:30 | uvicorn.error | INFO | connection open
WARNING:  WatchFiles detected changes in 'app/services/proxy_retry_manager.py'. Reloading...
2025-09-03 13:49:32 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756878570500 (用户: 6)
2025-09-03 13:49:32 | uvicorn.error | INFO | connection closed
2025-09-03 13:49:32 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-03 13:49:32 | uvicorn.error | INFO | Application shutdown complete.
2025-09-03 13:49:32 | uvicorn.error | INFO | Finished server process [3249614]
2025-09-03 13:49:35.245 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-03 13:49:35.267 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-03 13:49:35.267 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-03 13:49:35.267 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-03 13:49:35.756 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-03 13:49:36 | uvicorn.error | INFO | Started server process [3249684]
2025-09-03 13:49:36 | uvicorn.error | INFO | Waiting for application startup.
2025-09-03 13:49:36 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-03 13:49:36 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-03 13:49:36 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-03 13:49:36 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-03 13:49:36 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-03 13:49:36 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-03 13:49:36 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-03 13:49:36 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-03 13:49:36 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-03 13:49:36 | uvicorn.error | INFO | Application startup complete.
2025-09-03 13:49:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756878576541
2025-09-03 13:49:36 | uvicorn.error | INFO | connection open
2025-09-03 13:50:00 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "client_ip": "127.0.***.***.***", "user_agent": "curl/8.5.0", "timestamp": "2025-09-03T05:50:00.432636", "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "Bearer eyJhbGciOi...9cyDM4", "content-length": "78"}, "body": {"content": "测试AI响应速度", "ai_mode": "trader", "session_type": "general"}}
2025-09-03 13:50:00.433 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:50:00.435 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 401
2025-09-03 13:50:00 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "POST", "path": "/api/v1/ai/chat", "status_code": 401, "duration": 2.9, "timestamp": "2025-09-03T05:50:00.435509"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:46950', 'POST', '/api/v1/ai/chat', '1.1', 401)
2025-09-03 13:51:29 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "client_ip": "127.0.***.***.***", "user_agent": "curl/8.5.0", "timestamp": "2025-09-03T05:51:29.736892", "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "Bearer eyJhbGciOi...qvb3a0", "content-length": "78"}, "body": {"content": "测试AI响应速度", "ai_mode": "trader", "session_type": "general"}}
2025-09-03 13:51:29.738 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:51:29.824 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:145c9631-8591-4cf5-826c-ae8d7aa7ac75, 窗口:10, 策略:default_fallback
2025-09-03 13:51:29 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='145c9631-8591-4cf5-826c-ae8d7aa7ac75', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 13:51:29 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 13:51:29 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 13:51:29 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 13:51:29 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 13:51:29 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T05:51:29.833668",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 90.34688915888889,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-7778 (score: 6.5)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "145c9631-8591-4cf5-826c-ae8d7aa7ac75",
    "priority": 100
  }
}
2025-09-03 13:51:29 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 90.35)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/trademe/backend/trading-service/app/api/v1/ai.py", line 49, in chat_with_ai
    response = await unified_proxy_ai_service.chat_completion_with_context(
  File "/root/trademe/backend/trading-service/app/services/simplified_ai_service.py", line 188, in chat_completion_with_context
    return await AIService.chat_completion(**supported_params)
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 13:51:29 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:51:29 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 13:51:29.842 | INFO     | app.ai.core.claude_client:chat_completion:477 - 🔄 使用代理重试管理器处理请求
2025-09-03 13:51:29 | app.services.proxy_retry_manager | INFO | 🏥 Started proxy health monitoring
2025-09-03 13:51:36 | app.services.proxy_retry_manager | INFO | ✅ Request successful via Custom Proxy (attempt 1/3)
2025-09-03 13:51:36.810 | INFO     | app.ai.core.claude_client:_make_request_with_proxy_retry:217 - ✅ 请求成功通过 Custom Proxy (尝试 1次)
2025-09-03 13:51:36.827 | DEBUG    | app.services.ai_service:_save_usage_stats:949 - AI使用统计 - 用户ID: 6, 实际API成本: $0.000000, 用户计费成本: $0.000000 (2倍计费)
2025-09-03 13:51:36.845 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Slow request completed in 7.107s
2025-09-03 13:51:36 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "POST", "path": "/api/v1/ai/chat", "status_code": 200, "duration": 7108.42, "timestamp": "2025-09-03T05:51:36.845284"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:51168', 'POST', '/api/v1/ai/chat', '1.1', 200)
WebSocket消息处理错误: (1001, '')
❌ WebSocket连接已断开: conn_1756878576541 (用户: 6)
2025-09-03 13:52:24 | uvicorn.error | INFO | connection closed
2025-09-03 13:52:25 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:52:25.137973", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...2_ySXg", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "developer"}}
2025-09-03 13:52:25 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:52:25 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 13:52:25 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-03 13:52:25.139 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:52:25 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:52:25.139510", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...2_ySXg", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-03 13:52:25 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:52:25 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 13:52:25 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-03 13:52:25.141 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:52:25.146 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.007s
2025-09-03 13:52:25 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 8.24, "timestamp": "2025-09-03T05:52:25.146185"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-03 13:52:25.149 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.007s
2025-09-03 13:52:25 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 9.76, "timestamp": "2025-09-03T05:52:25.149258"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-03 13:52:57 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:52:57.444990", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...hr8YHk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-03 13:52:57 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:52:57 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 13:52:57 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-03 13:52:57.446 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:52:57 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:52:57.446558", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...hr8YHk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "developer"}}
2025-09-03 13:52:57 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:52:57 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 13:52:57 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-03 13:52:57.448 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:52:57.452 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-03 13:52:57 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 6.63, "timestamp": "2025-09-03T05:52:57.453174"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-03 13:52:57.455 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.009s
2025-09-03 13:52:57 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 10.72, "timestamp": "2025-09-03T05:52:57.455679"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-03 13:53:01 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/chat/history?session_id=f81b6cba-120b-48cf-9cda-c0659d958931&limit=20", "path": "/api/v1/ai/chat/history", "client_ip": "167.234.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T05:53:01.838970", "headers": {"host": "43.167.***.***.***", "x-real-ip": "167.234.***.***.***", "x-forwarded-for": "167.234.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...hr8YHk", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"session_id": "f81b6cba-120b-48cf-9cda-c0659d958931", "limit": "20"}}
2025-09-03 13:53:01 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-03 13:53:01 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 13:53:01 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/chat/history
2025-09-03 13:53:01.840 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:53:01.843 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-03 13:53:01 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/chat/history", "status_code": 200, "duration": 5.09, "timestamp": "2025-09-03T05:53:01.844037"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('167.234.211.253:0', 'GET', '/api/v1/ai/chat/history?session_id=f81b6cba-120b-48cf-9cda-c0659d958931&limit=20', '1.0', 200)
2025-09-03 13:53:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756878783546
2025-09-03 13:53:03 | uvicorn.error | INFO | connection open
2025-09-03 13:53:06.458 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:f81b6cba-120b-48cf-9cda-c0659d958931, 窗口:10, 策略:default_fallback
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 我想开发一个macd背离策略...
📡 调用AIService.chat_completion...
2025-09-03 13:53:06 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='f81b6cba-120b-48cf-9cda-c0659d958931', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 13:53:06 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 13:53:06 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 13:53:06 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 13:53:06 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 13:53:06 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T05:53:06.461235",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 90.40057114444444,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-5556 (score: 7.1)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "f81b6cba-120b-48cf-9cda-c0659d958931",
    "priority": 100
  }
}
2025-09-03 13:53:06 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 90.40)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 13:53:06 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:53:06 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 13:53:06.464 | INFO     | app.ai.core.claude_client:chat_completion:477 - 🔄 使用代理重试管理器处理请求
2025-09-03 13:53:21 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 1/3)
2025-09-03 13:53:21 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 0.9s before retry...
2025-09-03 13:53:37 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 2/3)
2025-09-03 13:53:37 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 1.6s before retry...
2025-09-03 13:53:54 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 3/3)
2025-09-03 13:54:09 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 1/3)
2025-09-03 13:54:09 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 1.0s before retry...
2025-09-03 13:54:25 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 2/3)
2025-09-03 13:54:25 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 2.0s before retry...
2025-09-03 13:54:42 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 3/3)
2025-09-03 13:54:42.049 | ERROR    | app.ai.core.claude_client:_make_request_with_proxy_retry:226 - ❌ 所有代理尝试失败: Timeout after 15s
2025-09-03 13:54:42.049 | ERROR    | app.ai.core.claude_client:chat_completion:504 - 聊天完成失败: Claude API请求失败: Timeout after 15s
2025-09-03 13:55:24.410 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 13:55:24.413 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:58688', 'GET', '/health', '1.1', 200)
WARNING:  WatchFiles detected changes in 'test_websocket_full_flow.py'. Reloading...
📨 AI服务返回结果: {"content": "\u62b1\u6b49\uff0cAI\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528: Claude API\u8bf7\u6c42\u5931\u8d25: Timeout after 15s", "session_id": "f81b6cba-120b-48cf-9cda-c0659d958931", "tokens_used": 0, "model": "claude-sonnet-4-20250514", "success": false, "requires_strategy_generation": false}
❌ AI服务失败: 抱歉，AI服务暂时不可用: Claude API请求失败: Timeout after 15s
2025-09-03 13:57:31 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756878783546 (用户: 6)
2025-09-03 13:57:31 | uvicorn.error | INFO | connection closed
2025-09-03 13:57:31 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-03 13:57:31 | uvicorn.error | INFO | Application shutdown complete.
2025-09-03 13:57:31 | uvicorn.error | INFO | Finished server process [3249684]
2025-09-03 13:57:33.712 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-03 13:57:33.735 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-03 13:57:33.735 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-03 13:57:33.735 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-03 13:57:34.238 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-03 13:57:34 | uvicorn.error | INFO | Started server process [3252561]
2025-09-03 13:57:34 | uvicorn.error | INFO | Waiting for application startup.
2025-09-03 13:57:34 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-03 13:57:34 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-03 13:57:34 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-03 13:57:34 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-03 13:57:34 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-03 13:57:34 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-03 13:57:34 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-03 13:57:34 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-03 13:57:34 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-03 13:57:34 | uvicorn.error | INFO | Application startup complete.
2025-09-03 13:57:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879055549
2025-09-03 13:57:35 | uvicorn.error | INFO | connection open
2025-09-03 13:57:37 | uvicorn.error | INFO | 127.0.***.***.***:39928 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879057945
2025-09-03 13:57:37 | uvicorn.error | INFO | connection open
2025-09-03 13:57:37 | uvicorn.error | INFO | connection closed
WARNING:  WatchFiles detected changes in 'test_websocket_full_flow.py'. Reloading...
2025-09-03 13:58:01 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756879055549 (用户: 6)
2025-09-03 13:58:01 | uvicorn.error | INFO | connection closed
2025-09-03 13:58:01 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-03 13:58:01 | uvicorn.error | INFO | Application shutdown complete.
2025-09-03 13:58:01 | uvicorn.error | INFO | Finished server process [3252561]
2025-09-03 13:58:03.812 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-03 13:58:03.833 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-03 13:58:03.833 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-03 13:58:03.833 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-03 13:58:04.311 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-03 13:58:04 | uvicorn.error | INFO | Started server process [3252801]
2025-09-03 13:58:04 | uvicorn.error | INFO | Waiting for application startup.
2025-09-03 13:58:04 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-03 13:58:04 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-03 13:58:04 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-03 13:58:04 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-03 13:58:04 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-03 13:58:04 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-03 13:58:04 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-03 13:58:04 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-03 13:58:04 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-03 13:58:04 | uvicorn.error | INFO | Application startup complete.
2025-09-03 13:58:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879085536
2025-09-03 13:58:05 | uvicorn.error | INFO | connection open
WARNING:  WatchFiles detected changes in 'test_websocket_full_flow.py'. Reloading...
2025-09-03 13:58:08 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756879085536 (用户: 6)
2025-09-03 13:58:08 | uvicorn.error | INFO | connection closed
2025-09-03 13:58:08 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-03 13:58:08 | uvicorn.error | INFO | Application shutdown complete.
2025-09-03 13:58:08 | uvicorn.error | INFO | Finished server process [3252801]
2025-09-03 13:58:10.876 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-03 13:58:10.898 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-03 13:58:10.899 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-03 13:58:10.899 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-03 13:58:11.390 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-03 13:58:11 | uvicorn.error | INFO | Started server process [3252882]
2025-09-03 13:58:11 | uvicorn.error | INFO | Waiting for application startup.
2025-09-03 13:58:11 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-03 13:58:11 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-03 13:58:11 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-03 13:58:11 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-03 13:58:11 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-03 13:58:11 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-03 13:58:11 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-03 13:58:11 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-03 13:58:11 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-03 13:58:12 | uvicorn.error | INFO | Application startup complete.
2025-09-03 13:58:12 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879092527
2025-09-03 13:58:12 | uvicorn.error | INFO | connection open
2025-09-03 13:58:15 | uvicorn.error | INFO | 127.0.***.***.***:43178 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879095252
2025-09-03 13:58:15 | uvicorn.error | INFO | connection open
2025-09-03 13:58:15.300 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:test_session_1756879095, 窗口:10, 策略:default_fallback
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 测试AI响应，请简单回复确认收到...
📡 调用AIService.chat_completion...
2025-09-03 13:58:15 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='test_session_1756879095', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 13:58:15 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 13:58:15 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 13:58:15 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 13:58:15 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 13:58:15 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T05:58:15.307680",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 90.5721525,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-3333 (score: 8.8)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "test_session_1756879095",
    "priority": 100
  }
}
2025-09-03 13:58:15 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 90.57)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 13:58:15 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 13:58:15 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 13:58:15.316 | INFO     | app.ai.core.claude_client:chat_completion:477 - 🔄 使用代理重试管理器处理请求
2025-09-03 13:58:15 | app.services.proxy_retry_manager | INFO | 🏥 Started proxy health monitoring
2025-09-03 13:58:18 | app.services.proxy_retry_manager | INFO | ✅ Request successful via Custom Proxy (attempt 1/3)
2025-09-03 13:58:18.878 | INFO     | app.ai.core.claude_client:_make_request_with_proxy_retry:217 - ✅ 请求成功通过 Custom Proxy (尝试 1次)
2025-09-03 13:58:18.899 | DEBUG    | app.services.ai_service:_save_usage_stats:949 - AI使用统计 - 用户ID: 6, 实际API成本: $0.000000, 用户计费成本: $0.000000 (2倍计费)
📨 AI服务返回结果: {"content": "\u6536\u5230\uff01\ud83d\udc4b\n\n\u6211\u662fTrademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684\u4e13\u4e1aAI\u52a9\u624b\uff0c\u5df2\u51c6\u5907\u5c31\u7eea\u3002\n\n\ud83d\ude80 \u6211\u53ef\u4ee5\u5e2e\u52a9\u60a8\uff1a\n- \u5f00\u53d1Python\u91cf\u5316\u7b56\u7565\n- \u5206\u6790\u5e02\u573a\u8d8b\u52bf\u548c\u6280\u672f\u6307\u6807\n- \u89e3\u8bfb\u56de\u6d4b\u7ed3\u679c\n- \u56de\u7b54\u4ea4\u6613\u76f8\u5173\u95ee\u9898\n\n\u6709\u4ec0\u4e48\u91cf\u5316\u4ea4\u6613\u65b9\u976
📤 发送WebSocket响应: {"type": "ai_chat_success", "request_id": "1756879095254", "response": "\u6536\u5230\uff01\ud83d\udc4b\n\n\u6211\u662fTrademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684\u4e13\u4e1aAI\u52a9\u624b\uff0c\u5df2\u51c6\u5907\u5c31\u7eea\u3002\n\n\ud83d\ude80 \u6211\u53ef\u4ee5\u5e2e\u52a9\u60a8\uff1a\n- \u5f00\u53d1Python\u91cf\u5316\u7b56\u7565\n- \u5206\u6790\u5e02\u573a\u8d8b\u52bf\u548c\u6280\u672f\u6307\u6807\n- \u89e3\u8bfb\u56de\u6d4b\u7ed3\u679c\n- \u56de\u7b54\u4ea4\u6613\u76f8\u5173\u95ee\u98
WebSocket消息处理错误: (1000, '')
❌ WebSocket连接已断开: conn_1756879095252 (用户: 6)
2025-09-03 13:58:18 | uvicorn.error | INFO | connection closed
2025-09-03 14:04:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879451972
2025-09-03 14:04:11 | uvicorn.error | INFO | connection open
2025-09-03 14:04:18.738 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:debug_session_1756879458440, 窗口:10, 策略:default_fallback
🤖 开始调用真实Claude AI服务，用户: 6, 内容: test...
📡 调用AIService.chat_completion...
2025-09-03 14:04:18 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='debug_session_1756879458440', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 14:04:18 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 14:04:18 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 14:04:18 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 14:04:18 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 14:04:18 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T06:04:18.741373",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 90.77406011,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-3333 (score: 10.8)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "debug_session_1756879458440",
    "priority": 100
  }
}
2025-09-03 14:04:18 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 90.77)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 14:04:18 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:04:18 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 14:04:18.744 | INFO     | app.ai.core.claude_client:chat_completion:477 - 🔄 使用代理重试管理器处理请求
2025-09-03 14:04:27 | app.services.proxy_retry_manager | INFO | ✅ Request successful via Custom Proxy (attempt 1/3)
2025-09-03 14:04:27.046 | INFO     | app.ai.core.claude_client:_make_request_with_proxy_retry:217 - ✅ 请求成功通过 Custom Proxy (尝试 1次)
2025-09-03 14:04:27.057 | DEBUG    | app.services.ai_service:_save_usage_stats:949 - AI使用统计 - 用户ID: 6, 实际API成本: $0.000000, 用户计费成本: $0.000000 (2倍计费)
2025-09-03 14:05:06.452 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:debug_session_1756879505920, 窗口:10, 策略:default_fallback
📨 AI服务返回结果: {"content": "\u4f60\u597d\uff01\u6b22\u8fce\u4f7f\u7528Trademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684AI\u52a9\u624b\uff01\ud83d\ude80\n\n\u6211\u662f\u60a8\u7684\u4e13\u4e1a\u91cf\u5316\u4ea4\u6613\u987e\u95ee\uff0c\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u4ee5\u4e0b\u670d\u52a1\uff1a\n\n## \ud83c\udfaf \u6838\u5fc3\u529f\u80fd\n- **\u7b56\u7565\u5f00\u53d1** - Python\u91cf\u5316\u7b56\u7565\u4ee3\u7801\u751f\u6210\n- **\u6280\u672f\u5206\u6790** - \u56fe\u8868\u5206\u6790\u548c\u8d8b\u52bf\u5224
📤 发送WebSocket响应: {"type": "ai_chat_success", "request_id": "1756879458440", "response": "\u4f60\u597d\uff01\u6b22\u8fce\u4f7f\u7528Trademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684AI\u52a9\u624b\uff01\ud83d\ude80\n\n\u6211\u662f\u60a8\u7684\u4e13\u4e1a\u91cf\u5316\u4ea4\u6613\u987e\u95ee\uff0c\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u4ee5\u4e0b\u670d\u52a1\uff1a\n\n## \ud83c\udfaf \u6838\u5fc3\u529f\u80fd\n- **\u7b56\u7565\u5f00\u53d1** - Python\u91cf\u5316\u7b56\u7565\u4ee3\u7801\u751f\u6210\n- **\u6280\u672f\u5206
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 我想开发一个macd背离策略...
📡 调用AIService.chat_completion...
2025-09-03 14:05:06 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='debug_session_1756879505920', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 14:05:06 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 14:05:06 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 14:05:06 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 14:05:06 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 14:05:06 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T06:05:06.455786",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 90.80056812055555,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-1112 (score: 11.1)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "debug_session_1756879505920",
    "priority": 100
  }
}
2025-09-03 14:05:06 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 90.80)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 14:05:06 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:05:06 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 14:05:06.458 | INFO     | app.ai.core.claude_client:chat_completion:477 - 🔄 使用代理重试管理器处理请求
2025-09-03 14:05:21 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 1/3)
2025-09-03 14:05:21 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 0.9s before retry...
2025-09-03 14:05:37 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 2/3)
2025-09-03 14:05:37 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 1.8s before retry...
2025-09-03 14:05:54 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 3/3)
2025-09-03 14:06:09 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 1/3)
2025-09-03 14:06:09 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 0.9s before retry...
2025-09-03 14:06:25 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 2/3)
2025-09-03 14:06:25 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 2.1s before retry...
2025-09-03 14:06:42 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 3/3)
2025-09-03 14:06:42.194 | ERROR    | app.ai.core.claude_client:_make_request_with_proxy_retry:226 - ❌ 所有代理尝试失败: Timeout after 15s
2025-09-03 14:06:42.194 | ERROR    | app.ai.core.claude_client:chat_completion:504 - 聊天完成失败: Claude API请求失败: Timeout after 15s
WARNING:  WatchFiles detected changes in 'app/services/proxy_retry_manager.py'. Reloading...
📨 AI服务返回结果: {"content": "\u62b1\u6b49\uff0cAI\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528: Claude API\u8bf7\u6c42\u5931\u8d25: Timeout after 15s", "session_id": "debug_session_1756879505920", "tokens_used": 0, "model": "claude-sonnet-4-20250514", "success": false, "requires_strategy_generation": false}
❌ AI服务失败: 抱歉，AI服务暂时不可用: Claude API请求失败: Timeout after 15s
2025-09-03 14:09:10 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756879451972 (用户: 6)
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756879092527 (用户: 6)
2025-09-03 14:09:10 | uvicorn.error | INFO | connection closed
2025-09-03 14:09:10 | uvicorn.error | INFO | connection closed
2025-09-03 14:09:11 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-03 14:09:11 | uvicorn.error | INFO | Application shutdown complete.
2025-09-03 14:09:11 | uvicorn.error | INFO | Finished server process [3252882]
2025-09-03 14:09:13.267 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-03 14:09:13.287 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-03 14:09:13.288 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-03 14:09:13.288 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-03 14:09:13.779 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-03 14:09:14 | uvicorn.error | INFO | Started server process [3256553]
2025-09-03 14:09:14 | uvicorn.error | INFO | Waiting for application startup.
2025-09-03 14:09:14 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-03 14:09:14 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-03 14:09:14 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-03 14:09:14 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-03 14:09:14 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-03 14:09:14 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-03 14:09:14 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-03 14:09:14 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-03 14:09:14 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-03 14:09:14 | uvicorn.error | INFO | Application startup complete.
2025-09-03 14:09:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879754540
2025-09-03 14:09:14 | uvicorn.error | INFO | connection open
WARNING:  WatchFiles detected changes in 'app/services/proxy_retry_manager.py'. Reloading...
2025-09-03 14:09:18 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756879754540 (用户: 6)
2025-09-03 14:09:18 | uvicorn.error | INFO | connection closed
2025-09-03 14:09:18 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-03 14:09:18 | uvicorn.error | INFO | Application shutdown complete.
2025-09-03 14:09:18 | uvicorn.error | INFO | Finished server process [3256553]
2025-09-03 14:09:20.480 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-03 14:09:20.500 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-03 14:09:20.500 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-03 14:09:20.500 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-03 14:09:20.988 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-03 14:09:21 | uvicorn.error | INFO | Started server process [3256631]
2025-09-03 14:09:21 | uvicorn.error | INFO | Waiting for application startup.
2025-09-03 14:09:21 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-03 14:09:21 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-03 14:09:21 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-03 14:09:21 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-03 14:09:21 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-03 14:09:21 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-03 14:09:21 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-03 14:09:21 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-03 14:09:21 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-03 14:09:21 | uvicorn.error | INFO | Application startup complete.
2025-09-03 14:09:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879762545
2025-09-03 14:09:22 | uvicorn.error | INFO | connection open
2025-09-03 14:10:14 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "client_ip": "127.0.***.***.***", "user_agent": "curl/8.5.0", "timestamp": "2025-09-03T06:10:14.325095", "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "Bearer eyJhbGciOi...qvb3a0", "content-length": "79"}, "body": {"content": "简单回复：你好", "ai_mode": "trader", "session_type": "general"}}
2025-09-03 14:10:14.329 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 14:10:14.428 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:4541dff1-07b8-411d-b561-7f1570aa5acd, 窗口:10, 策略:default_fallback
2025-09-03 14:10:14 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='4541dff1-07b8-411d-b561-7f1570aa5acd', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 14:10:14 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 14:10:14 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 14:10:14 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 14:10:14 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 14:10:14 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T06:10:14.440664",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 90.97167081944444,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-5555 (score: 12.8)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "4541dff1-07b8-411d-b561-7f1570aa5acd",
    "priority": 100
  }
}
2025-09-03 14:10:14 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 90.97)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/trademe/backend/trading-service/app/api/v1/ai.py", line 49, in chat_with_ai
    response = await unified_proxy_ai_service.chat_completion_with_context(
  File "/root/trademe/backend/trading-service/app/services/simplified_ai_service.py", line 188, in chat_completion_with_context
    return await AIService.chat_completion(**supported_params)
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 14:10:14 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:10:14 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 14:10:14.456 | INFO     | app.ai.core.claude_client:chat_completion:477 - 🔄 使用代理重试管理器处理请求
2025-09-03 14:10:14 | app.services.proxy_retry_manager | INFO | 🏥 Started proxy health monitoring
2025-09-03 14:10:17 | app.services.proxy_retry_manager | INFO | ✅ Request successful via Custom Proxy (attempt 1/3)
2025-09-03 14:10:17.786 | INFO     | app.ai.core.claude_client:_make_request_with_proxy_retry:217 - ✅ 请求成功通过 Custom Proxy (尝试 1次)
2025-09-03 14:10:17.803 | DEBUG    | app.services.ai_service:_save_usage_stats:949 - AI使用统计 - 用户ID: 6, 实际API成本: $0.000000, 用户计费成本: $0.000000 (2倍计费)
2025-09-03 14:10:17.817 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Slow request completed in 3.488s
2025-09-03 14:10:17 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "POST", "path": "/api/v1/ai/chat", "status_code": 200, "duration": 3492.46, "timestamp": "2025-09-03T06:10:17.817506"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:41672', 'POST', '/api/v1/ai/chat', '1.1', 200)
2025-09-03 14:10:35 | uvicorn.error | INFO | 127.0.***.***.***:45796 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879835503
2025-09-03 14:10:35 | uvicorn.error | INFO | connection open
2025-09-03 14:10:35.511 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:test_session_1756879835, 窗口:10, 策略:default_fallback
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 测试AI响应，请简单回复确认收到...
📡 调用AIService.chat_completion...
2025-09-03 14:10:35 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='test_session_1756879835', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 14:10:35 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 14:10:35 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 14:10:35 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 14:10:35 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 14:10:35 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T06:10:35.515884",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 90.98337927833333,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.6450229725 (score: 12.9)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "test_session_1756879835",
    "priority": 100
  }
}
2025-09-03 14:10:35 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 90.98)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 14:10:35 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:10:35 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 14:10:35.520 | INFO     | app.ai.core.claude_client:chat_completion:477 - 🔄 使用代理重试管理器处理请求
2025-09-03 14:10:38 | app.services.proxy_retry_manager | INFO | ✅ Request successful via Custom Proxy (attempt 1/3)
2025-09-03 14:10:38.709 | INFO     | app.ai.core.claude_client:_make_request_with_proxy_retry:217 - ✅ 请求成功通过 Custom Proxy (尝试 1次)
2025-09-03 14:10:38.723 | DEBUG    | app.services.ai_service:_save_usage_stats:949 - AI使用统计 - 用户ID: 6, 实际API成本: $0.000000, 用户计费成本: $0.000000 (2倍计费)
📨 AI服务返回结果: {"content": "\u6536\u5230\uff01\u6211\u662fTrademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684\u4e13\u4e1aAI\u52a9\u624b\uff0c\u5df2\u51c6\u5907\u5c31\u7eea\u3002\n\n\u6211\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\uff1a\n- \ud83d\udcc8 \u91cf\u5316\u7b56\u7565\u5f00\u53d1\n- \ud83d\udcca \u5e02\u573a\u5206\u6790\u6307\u5bfc  \n- \ud83d\udd0d \u56de\u6d4b\u7ed3\u679c\u89e3\u8bfb\n- \ud83d\udca1 \u4ea4\u6613\u77e5\u8bc6\u7b54\u7591\n- \u26a1 \u6280\u672f\u5206\u6790\u5efa\u8bae\n\n\u6709\u4ec0\u4e48\u91c
📤 发送WebSocket响应: {"type": "ai_chat_success", "request_id": "1756879835505", "response": "\u6536\u5230\uff01\u6211\u662fTrademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684\u4e13\u4e1aAI\u52a9\u624b\uff0c\u5df2\u51c6\u5907\u5c31\u7eea\u3002\n\n\u6211\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\uff1a\n- \ud83d\udcc8 \u91cf\u5316\u7b56\u7565\u5f00\u53d1\n- \ud83d\udcca \u5e02\u573a\u5206\u6790\u6307\u5bfc  \n- \ud83d\udd0d \u56de\u6d4b\u7ed3\u679c\u89e3\u8bfb\n- \ud83d\udca1 \u4ea4\u6613\u77e5\u8bc6\u7b54\u7591\n- \u26a1 \u62
WebSocket消息处理错误: (1000, '')
❌ WebSocket连接已断开: conn_1756879835503 (用户: 6)
2025-09-03 14:10:38 | uvicorn.error | INFO | connection closed
2025-09-03 14:11:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756879888407
2025-09-03 14:11:28 | uvicorn.error | INFO | connection open
2025-09-03 14:11:30.825 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:debug_session_1756879890504, 窗口:10, 策略:default_fallback
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 我想开发一个macd背离策略...
📡 调用AIService.chat_completion...
2025-09-03 14:11:30 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='debug_session_1756879890504', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 14:11:30 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 14:11:30 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 14:11:30 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 14:11:30 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 14:11:30 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T06:11:30.828993",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 91.01410879,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-3334 (score: 13.2)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "debug_session_1756879890504",
    "priority": 100
  }
}
2025-09-03 14:11:30 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 91.01)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 14:11:30 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:11:30 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 14:11:30.832 | INFO     | app.ai.core.claude_client:chat_completion:477 - 🔄 使用代理重试管理器处理请求
2025-09-03 14:12:00 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 1/3)
2025-09-03 14:12:00 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 0.9s before retry...
2025-09-03 14:12:31 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 2/3)
2025-09-03 14:12:31 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 1.9s before retry...
2025-09-03 14:13:03 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 3/3)
2025-09-03 14:13:33 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 1/3)
2025-09-03 14:13:33 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 0.8s before retry...
2025-09-03 14:14:04 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 2/3)
2025-09-03 14:14:04 | app.services.proxy_retry_manager | INFO | ⏳ Waiting 2.2s before retry...
2025-09-03 14:14:36 | app.services.proxy_retry_manager | WARNING | ⏱️ Timeout on Custom Proxy (attempt 3/3)
2025-09-03 14:14:36.653 | ERROR    | app.ai.core.claude_client:_make_request_with_proxy_retry:226 - ❌ 所有代理尝试失败: Timeout after 30s
2025-09-03 14:14:36.653 | ERROR    | app.ai.core.claude_client:chat_completion:504 - 聊天完成失败: Claude API请求失败: Timeout after 30s
WARNING:  WatchFiles detected changes in 'app/ai/core/claude_client.py'. Reloading...
📨 AI服务返回结果: {"content": "\u62b1\u6b49\uff0cAI\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528: Claude API\u8bf7\u6c42\u5931\u8d25: Timeout after 30s", "session_id": "debug_session_1756879890504", "tokens_used": 0, "model": "claude-sonnet-4-20250514", "success": false, "requires_strategy_generation": false}
❌ AI服务失败: 抱歉，AI服务暂时不可用: Claude API请求失败: Timeout after 30s
2025-09-03 14:16:23 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756879888407 (用户: 6)
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756879762545 (用户: 6)
2025-09-03 14:16:23 | uvicorn.error | INFO | connection closed
2025-09-03 14:16:23 | uvicorn.error | INFO | connection closed
2025-09-03 14:16:23 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-03 14:16:23 | uvicorn.error | INFO | Application shutdown complete.
2025-09-03 14:16:23 | uvicorn.error | INFO | Finished server process [3256631]
2025-09-03 14:16:25.338 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-03 14:16:25.358 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-03 14:16:25.359 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-03 14:16:25.359 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-03 14:16:25.839 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-03 14:16:26 | uvicorn.error | INFO | Started server process [3259005]
2025-09-03 14:16:26 | uvicorn.error | INFO | Waiting for application startup.
2025-09-03 14:16:26 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-03 14:16:26 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-03 14:16:26 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-03 14:16:26 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-03 14:16:26 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-03 14:16:26 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-03 14:16:26 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-03 14:16:26 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-03 14:16:26 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-03 14:16:26 | uvicorn.error | INFO | Application startup complete.
2025-09-03 14:16:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756880186552
2025-09-03 14:16:26 | uvicorn.error | INFO | connection open
2025-09-03 14:16:57 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "POST", "url": "http://localhost:8001/api/v1/ai/chat", "path": "/api/v1/ai/chat", "client_ip": "127.0.***.***.***", "user_agent": "curl/8.5.0", "timestamp": "2025-09-03T06:16:57.180678", "headers": {"host": "localhost:8001", "user-agent": "curl/8.5.0", "accept": "*/*", "content-type": "application/json", "authorization": "Bearer eyJhbGciOi...qvb3a0", "content-length": "82"}, "body": {"content": "你好，请简短回复", "ai_mode": "trader", "session_type": "general"}}
2025-09-03 14:16:57.182 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 14:16:57.271 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:54dade8d-c749-4690-b86e-0e3a1ba5924d, 窗口:10, 策略:default_fallback
2025-09-03 14:16:57 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='54dade8d-c749-4690-b86e-0e3a1ba5924d', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 14:16:57 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 14:16:57 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.00, remaining=100.00
2025-09-03 14:16:57 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 14:16:57 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 14:16:57 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T06:16:57.290871",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 91.19547649055555,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $100.00 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-1112 (score: 15.0)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "54dade8d-c749-4690-b86e-0e3a1ba5924d",
    "priority": 100
  }
}
2025-09-03 14:16:57 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 91.20)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 302, in app
    raw_response = await run_endpoint_function(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
  File "/root/trademe/backend/trading-service/app/api/v1/ai.py", line 49, in chat_with_ai
    response = await unified_proxy_ai_service.chat_completion_with_context(
  File "/root/trademe/backend/trading-service/app/services/simplified_ai_service.py", line 188, in chat_completion_with_context
    return await AIService.chat_completion(**supported_params)
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 14:16:57 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:16:57 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 14:16:57.308 | INFO     | app.ai.core.claude_client:chat_completion:476 - 🔄 使用直接请求模式(绕过代理重试)
2025-09-03 14:17:00.619 | DEBUG    | app.ai.core.claude_client:_make_request:301 - Claude API请求成功 - Token使用: 583, 响应时间: 3310.60ms
2025-09-03 14:17:00.636 | DEBUG    | app.services.ai_service:_save_usage_stats:949 - AI使用统计 - 用户ID: 6, 实际API成本: $0.003177, 用户计费成本: $0.006354 (2倍计费)
2025-09-03 14:17:00.651 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Slow request completed in 3.470s
2025-09-03 14:17:00 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "POST", "path": "/api/v1/ai/chat", "status_code": 200, "duration": 3471.17, "timestamp": "2025-09-03T06:17:00.651806"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('127.0.0.1:44436', 'POST', '/api/v1/ai/chat', '1.1', 200)
2025-09-03 14:17:10 | uvicorn.error | INFO | 127.0.***.***.***:45754 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756880230348
2025-09-03 14:17:10 | uvicorn.error | INFO | connection open
2025-09-03 14:17:10.356 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:test_session_1756880230, 窗口:10, 策略:default_fallback
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 测试AI响应，请简单回复确认收到...
📡 调用AIService.chat_completion...
2025-09-03 14:17:10 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='test_session_1756880230', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 14:17:10 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 14:17:10 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.01, remaining=99.99
2025-09-03 14:17:10 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 14:17:10 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 14:17:10 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T06:17:10.360178",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 91.20273722444443,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $99.99 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-5556 (score: 15.1)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "test_session_1756880230",
    "priority": 100
  }
}
2025-09-03 14:17:10 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 91.20)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 14:17:10 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:17:10 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 14:17:10.363 | INFO     | app.ai.core.claude_client:chat_completion:476 - 🔄 使用直接请求模式(绕过代理重试)
2025-09-03 14:17:14.021 | DEBUG    | app.ai.core.claude_client:_make_request:301 - Claude API请求成功 - Token使用: 611, 响应时间: 3658.04ms
2025-09-03 14:17:14.039 | DEBUG    | app.services.ai_service:_save_usage_stats:949 - AI使用统计 - 用户ID: 6, 实际API成本: $0.003513, 用户计费成本: $0.007026 (2倍计费)
📨 AI服务返回结果: {"content": "\u6536\u5230\uff01\ud83d\udc4b\n\n\u6211\u662fTrademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684AI\u52a9\u624b\uff0c\u5df2\u51c6\u5907\u5c31\u7eea\u4e3a\u60a8\u63d0\u4f9b\u4e13\u4e1a\u7684\u91cf\u5316\u4ea4\u6613\u670d\u52a1\u3002\n\n\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\uff1a\n- \ud83d\udcc8 \u7b56\u7565\u5f00\u53d1\u4e0e\u4ee3\u7801\u751f\u6210\n- \ud83d\udcca \u5e02\u573a\u5206\u6790\u4e0e\u6280\u672f\u6307\u6807\n- \ud83d\udd0d \u56de\u6d4b\u7ed3\u679c\u89e3\u8bfb\n- \ud83d\udca1 
📤 发送WebSocket响应: {"type": "ai_chat_success", "request_id": "1756880230350", "response": "\u6536\u5230\uff01\ud83d\udc4b\n\n\u6211\u662fTrademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684AI\u52a9\u624b\uff0c\u5df2\u51c6\u5907\u5c31\u7eea\u4e3a\u60a8\u63d0\u4f9b\u4e13\u4e1a\u7684\u91cf\u5316\u4ea4\u6613\u670d\u52a1\u3002\n\n\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\uff1a\n- \ud83d\udcc8 \u7b56\u7565\u5f00\u53d1\u4e0e\u4ee3\u7801\u751f\u6210\n- \ud83d\udcca \u5e02\u573a\u5206\u6790\u4e0e\u6280\u672f\u6307\u6807\n- \ud83d\
WebSocket消息处理错误: (1000, '')
❌ WebSocket连接已断开: conn_1756880230348 (用户: 6)
2025-09-03 14:17:14 | uvicorn.error | INFO | connection closed
2025-09-03 14:18:30 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "162.142.***.***.***", "user_agent": "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)", "timestamp": "2025-09-03T06:18:30.209434", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-03 14:18:30 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 14:18:30 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-03 14:18:30.211 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 14:18:30.212 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-03 14:18:30 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 2.92, "timestamp": "2025-09-03T06:18:30.212328"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('162.142.125.40:41272', 'GET', '/', '1.1', 200)
2025-09-03 14:18:31.982 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 14:18:31.983 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 404
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('162.142.125.40:41276', 'GET', '/favicon.ico', '1.1', 404)
2025-09-03 14:18:33 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-03 14:18:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756880314182
2025-09-03 14:18:34 | uvicorn.error | INFO | connection open
2025-09-03 14:18:36.013 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:debug_session_1756880315690, 窗口:10, 策略:default_fallback
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 我想开发一个macd背离策略...
📡 调用AIService.chat_completion...
2025-09-03 14:18:36 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='debug_session_1756880315690', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-03 14:18:36 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-03 14:18:36 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.01, remaining=99.99
2025-09-03 14:18:36 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-03 14:18:36 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-03 14:18:36 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-03T06:18:36.016303",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 91.25032395944444,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $99.99 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 0.****-****-****-5555 (score: 15.6)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "debug_session_1756880315690",
    "priority": 100
  }
}
2025-09-03 14:18:36 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 91.25)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-03 14:18:36 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-03 14:18:36 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-03 14:18:36.019 | INFO     | app.ai.core.claude_client:chat_completion:476 - 🔄 使用直接请求模式(绕过代理重试)
2025-09-03 14:18:38 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "162.142.***.***.***", "user_agent": "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)", "timestamp": "2025-09-03T06:18:38.254716", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 (compatible; CensysInspect/1.1; +https://about.censys.io/)", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-03 14:18:38 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 14:18:38 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-03 14:18:38.255 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 14:18:38.256 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-03 14:18:38 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 1.93, "timestamp": "2025-09-03T06:18:38.256613"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('162.142.125.40:56756', 'GET', '/', '1.1', 200)
2025-09-03 14:19:06 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.980442 seconds
2025-09-03 14:19:37 | anthropic._base_client | INFO | Retrying request to /v1/messages in 1.710389 seconds
2025-09-03 14:20:08.810 | WARNING  | app.ai.core.claude_client:_make_request:313 - Claude API超时: Request timed out.
2025-09-03 14:20:39 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.918728 seconds
2025-09-03 14:21:10 | anthropic._base_client | INFO | Retrying request to /v1/messages in 1.708426 seconds
2025-09-03 14:21:34 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "65.49.***.***.***", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:95.0) Gecko/20100101 Firefox/98.0", "timestamp": "2025-09-03T06:21:34.257523", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:95.0) Gecko/20100101 Firefox/98.0", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-03 14:21:34 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 14:21:34 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-03 14:21:34.258 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 14:21:34.259 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-03 14:21:34 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 1.8, "timestamp": "2025-09-03T06:21:34.259291"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('65.49.1.152:16920', 'GET', '/', '1.1', 200)
2025-09-03 14:21:42.538 | WARNING  | app.ai.core.claude_client:_make_request:313 - Claude API超时: Request timed out.
2025-09-03 14:21:46.620 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 14:21:46.621 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 404
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('65.49.1.159:15775', 'GET', '/favicon.ico', '1.1', 404)
2025-09-03 14:21:49 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://api.ipify.org/?format=json", "path": "/", "client_ip": "65.49.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.***.***.*** Safari/537.36 Edg/124.0.***.***.***", "timestamp": "2025-09-03T06:21:49.185203", "headers": {"host": "api.ipify.org", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.***.***.*** Safari/537.36 Edg/124.0.***.***.***"}, "query_params": {"format": "json"}}
2025-09-03 14:21:49 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 14:21:49 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-03 14:21:49.186 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 14:21:49.186 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-03 14:21:49 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 1.83, "timestamp": "2025-09-03T06:21:49.187006"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('65.49.1.156:33921', 'GET', '/?format=json', '1.1', 200)
2025-09-03 14:21:51 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-03 14:22:13 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.942358 seconds
2025-09-03 14:22:44 | anthropic._base_client | INFO | Retrying request to /v1/messages in 1.741569 seconds
2025-09-03 14:23:16.303 | WARNING  | app.ai.core.claude_client:_make_request:313 - Claude API超时: Request timed out.
2025-09-03 14:23:47 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.839331 seconds
2025-09-03 14:24:18 | anthropic._base_client | INFO | Retrying request to /v1/messages in 1.985408 seconds
2025-09-03 14:24:50.219 | WARNING  | app.ai.core.claude_client:_make_request:313 - Claude API超时: Request timed out.
2025-09-03 14:24:50.219 | ERROR    | app.ai.core.claude_client:chat_completion:494 - 聊天完成失败: Request timed out.
📨 AI服务返回结果: {"content": "\u62b1\u6b49\uff0cAI\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528: Request timed out.", "session_id": "debug_session_1756880315690", "tokens_used": 0, "model": "claude-sonnet-4-20250514", "success": false, "requires_strategy_generation": false}
❌ AI服务失败: 抱歉，AI服务暂时不可用: Request timed out.
2025-09-03 14:36:45 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-03 14:36:46 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-03 15:11:00 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "104.155.***.***.***", "user_agent": "python-requests/2.32.4", "timestamp": "2025-09-03T07:11:00.278644", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "python-requests/2.32.4", "accept-encoding": "gzip, deflate", "accept": "*/*", "connection": "keep-alive"}, "query_params": {}}
2025-09-03 15:11:00 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 15:11:00 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-03 15:11:00.280 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 15:11:00.281 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-03 15:11:00 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 3.21, "timestamp": "2025-09-03T07:11:00.281821"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('104.155.20.12:59830', 'GET', '/', '1.1', 200)
WebSocket消息处理错误: (<CloseCode.ABNORMAL_CLOSURE: 1006>, '')
❌ WebSocket连接已断开: conn_1756880314182 (用户: 6)
2025-09-03 16:32:30 | uvicorn.error | INFO | connection closed
WebSocket消息处理错误: (<CloseCode.ABNORMAL_CLOSURE: 1006>, '')
❌ WebSocket连接已断开: conn_1756880186552 (用户: 6)
2025-09-03 16:55:58 | uvicorn.error | INFO | connection closed
2025-09-03 16:56:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756889770566
2025-09-03 16:56:10 | uvicorn.error | INFO | connection open
2025-09-03 17:00:16 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-03 17:00:16 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-03 19:40:26 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/aaa9", "path": "/aaa9", "client_ip": "178.128.***.***.***", "user_agent": "Mozilla/5.0 zgrab/0.x", "timestamp": "2025-09-03T11:40:26.849145", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 zgrab/0.x", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-03 19:40:26 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 19:40:26 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /aaa9
2025-09-03 19:40:26.850 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 19:40:26.850 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 404
2025-09-03 19:40:26 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/aaa9", "status_code": 404, "duration": 1.82, "timestamp": "2025-09-03T11:40:26.850939"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('178.128.84.187:52786', 'GET', '/aaa9', '1.1', 404)
2025-09-03 19:40:28 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/aab8", "path": "/aab8", "client_ip": "178.128.***.***.***", "user_agent": "Mozilla/5.0 zgrab/0.x", "timestamp": "2025-09-03T11:40:28.599563", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 zgrab/0.x", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-03 19:40:28 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 19:40:28 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /aab8
2025-09-03 19:40:28.600 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 19:40:28.601 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 404
2025-09-03 19:40:28 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/aab8", "status_code": 404, "duration": 1.74, "timestamp": "2025-09-03T11:40:28.601275"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('178.128.84.187:54990', 'GET', '/aab8', '1.1', 404)
2025-09-03 19:40:29 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "178.128.***.***.***", "user_agent": "Mozilla/5.0 zgrab/0.x", "timestamp": "2025-09-03T11:40:29.581648", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 zgrab/0.x", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-03 19:40:29 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 19:40:29 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-03 19:40:29.582 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 19:40:29.583 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-03 19:40:29 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 2.04, "timestamp": "2025-09-03T11:40:29.583653"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('178.128.84.187:55006', 'GET', '/', '1.1', 200)
2025-09-03 22:02:04 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "40.124.***.***.***", "user_agent": "Mozilla/5.0 zgrab/0.x", "timestamp": "2025-09-03T14:02:04.620467", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 zgrab/0.x", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-03 22:02:04 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 22:02:04 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-03 22:02:04.621 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 22:02:04.621 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-03 22:02:04 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 1.69, "timestamp": "2025-09-03T14:02:04.622116"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('40.124.80.149:36958', 'GET', '/', '1.1', 200)
2025-09-03 22:02:09 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-03 22:20:34 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "185.247.***.***.***", "user_agent": "Mozilla/5.0 (compatible; InternetMeasurement/1.0; +https://internet-measurement.com/)", "timestamp": "2025-09-03T14:20:34.824456", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 (compatible; InternetMeasurement/1.0; +https://internet-measurement.com/)", "connection": "close", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-03 22:20:34 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 22:20:34 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-03 22:20:34.825 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 22:20:34.826 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-03 22:20:34 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 1.76, "timestamp": "2025-09-03T14:20:34.826185"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('185.247.137.83:46771', 'GET', '/', '1.1', 200)
2025-09-03 23:28:26 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "103.203.***.***.***", "user_agent": "Mozilla/5.0", "timestamp": "2025-09-03T15:28:26.626697", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0", "accept-encoding": "gzip", "connection": "close"}, "query_params": {}}
2025-09-03 23:28:26 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-03 23:28:26 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-03 23:28:26.627 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-03 23:28:26.628 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-03 23:28:26 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 1.81, "timestamp": "2025-09-03T15:28:26.628476"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('103.203.58.4:48994', 'GET', '/', '1.1', 200)
2025-09-04 01:06:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919170662
2025-09-04 01:06:10 | uvicorn.error | INFO | connection open
2025-09-04 01:06:11 | uvicorn.error | INFO | connection closed
WebSocket消息处理错误: (<CloseCode.ABNORMAL_CLOSURE: 1006>, '')
❌ WebSocket连接已断开: conn_1756889770566 (用户: 6)
2025-09-04 01:06:11 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919174676
2025-09-04 01:06:14 | uvicorn.error | INFO | connection open
2025-09-04 01:06:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919178640
2025-09-04 01:06:18 | uvicorn.error | INFO | connection open
2025-09-04 01:06:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919182644
2025-09-04 01:06:22 | uvicorn.error | INFO | connection open
2025-09-04 01:06:23 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919186667
2025-09-04 01:06:26 | uvicorn.error | INFO | connection open
2025-09-04 01:06:27 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919190645
2025-09-04 01:06:30 | uvicorn.error | INFO | connection open
2025-09-04 01:06:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919194656
2025-09-04 01:06:34 | uvicorn.error | INFO | connection open
2025-09-04 01:06:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:38 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919198673
2025-09-04 01:06:38 | uvicorn.error | INFO | connection open
2025-09-04 01:06:39 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919203650
2025-09-04 01:06:43 | uvicorn.error | INFO | connection open
2025-09-04 01:06:44 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919207676
2025-09-04 01:06:47 | uvicorn.error | INFO | connection open
2025-09-04 01:06:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919211666
2025-09-04 01:06:51 | uvicorn.error | INFO | connection open
2025-09-04 01:06:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919215658
2025-09-04 01:06:55 | uvicorn.error | INFO | connection open
2025-09-04 01:06:56 | uvicorn.error | INFO | connection closed
2025-09-04 01:06:59 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919219659
2025-09-04 01:06:59 | uvicorn.error | INFO | connection open
2025-09-04 01:07:00 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919223661
2025-09-04 01:07:03 | uvicorn.error | INFO | connection open
2025-09-04 01:07:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919227662
2025-09-04 01:07:07 | uvicorn.error | INFO | connection open
2025-09-04 01:07:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919231668
2025-09-04 01:07:11 | uvicorn.error | INFO | connection open
2025-09-04 01:07:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919235670
2025-09-04 01:07:15 | uvicorn.error | INFO | connection open
2025-09-04 01:07:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:19 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919239677
2025-09-04 01:07:19 | uvicorn.error | INFO | connection open
2025-09-04 01:07:20 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919244652
2025-09-04 01:07:24 | uvicorn.error | INFO | connection open
2025-09-04 01:07:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919248658
2025-09-04 01:07:28 | uvicorn.error | INFO | connection open
2025-09-04 01:07:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:32 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919252660
2025-09-04 01:07:32 | uvicorn.error | INFO | connection open
2025-09-04 01:07:33 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919256673
2025-09-04 01:07:36 | uvicorn.error | INFO | connection open
2025-09-04 01:07:37 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919260670
2025-09-04 01:07:40 | uvicorn.error | INFO | connection open
2025-09-04 01:07:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919264655
2025-09-04 01:07:44 | uvicorn.error | INFO | connection open
2025-09-04 01:07:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919269296
2025-09-04 01:07:49 | uvicorn.error | INFO | connection open
2025-09-04 01:07:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919273645
2025-09-04 01:07:53 | uvicorn.error | INFO | connection open
2025-09-04 01:07:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:07:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919277667
2025-09-04 01:07:57 | uvicorn.error | INFO | connection open
2025-09-04 01:07:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919281661
2025-09-04 01:08:01 | uvicorn.error | INFO | connection open
2025-09-04 01:08:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919285644
2025-09-04 01:08:05 | uvicorn.error | INFO | connection open
2025-09-04 01:08:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919289650
2025-09-04 01:08:09 | uvicorn.error | INFO | connection open
2025-09-04 01:08:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919294650
2025-09-04 01:08:14 | uvicorn.error | INFO | connection open
2025-09-04 01:08:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919298669
2025-09-04 01:08:18 | uvicorn.error | INFO | connection open
2025-09-04 01:08:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919302663
2025-09-04 01:08:22 | uvicorn.error | INFO | connection open
2025-09-04 01:08:23 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919306648
2025-09-04 01:08:26 | uvicorn.error | INFO | connection open
2025-09-04 01:08:27 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919310648
2025-09-04 01:08:30 | uvicorn.error | INFO | connection open
2025-09-04 01:08:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919314671
2025-09-04 01:08:34 | uvicorn.error | INFO | connection open
2025-09-04 01:08:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919320786
2025-09-04 01:08:40 | uvicorn.error | INFO | connection open
2025-09-04 01:08:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919325654
2025-09-04 01:08:45 | uvicorn.error | INFO | connection open
2025-09-04 01:08:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919329679
2025-09-04 01:08:49 | uvicorn.error | INFO | connection open
2025-09-04 01:08:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919333650
2025-09-04 01:08:53 | uvicorn.error | INFO | connection open
2025-09-04 01:08:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:08:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919338673
2025-09-04 01:08:58 | uvicorn.error | INFO | connection open
2025-09-04 01:08:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919342668
2025-09-04 01:09:02 | uvicorn.error | INFO | connection open
2025-09-04 01:09:03 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:06 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919346705
2025-09-04 01:09:06 | uvicorn.error | INFO | connection open
2025-09-04 01:09:07 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919350653
2025-09-04 01:09:10 | uvicorn.error | INFO | connection open
2025-09-04 01:09:11 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919354679
2025-09-04 01:09:14 | uvicorn.error | INFO | connection open
2025-09-04 01:09:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919358687
2025-09-04 01:09:18 | uvicorn.error | INFO | connection open
2025-09-04 01:09:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:23 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919363669
2025-09-04 01:09:23 | uvicorn.error | INFO | connection open
2025-09-04 01:09:24 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:27 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919367676
2025-09-04 01:09:27 | uvicorn.error | INFO | connection open
2025-09-04 01:09:28 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:31 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919371662
2025-09-04 01:09:31 | uvicorn.error | INFO | connection open
2025-09-04 01:09:32 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919375652
2025-09-04 01:09:35 | uvicorn.error | INFO | connection open
2025-09-04 01:09:36 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919380667
2025-09-04 01:09:40 | uvicorn.error | INFO | connection open
2025-09-04 01:09:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919384668
2025-09-04 01:09:44 | uvicorn.error | INFO | connection open
2025-09-04 01:09:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:48 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919388660
2025-09-04 01:09:48 | uvicorn.error | INFO | connection open
2025-09-04 01:09:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919392666
2025-09-04 01:09:52 | uvicorn.error | INFO | connection open
2025-09-04 01:09:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:09:56 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919396669
2025-09-04 01:09:56 | uvicorn.error | INFO | connection open
2025-09-04 01:09:57 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:00 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919400653
2025-09-04 01:10:00 | uvicorn.error | INFO | connection open
2025-09-04 01:10:01 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:04 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919404655
2025-09-04 01:10:04 | uvicorn.error | INFO | connection open
2025-09-04 01:10:05 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:08 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919408645
2025-09-04 01:10:08 | uvicorn.error | INFO | connection open
2025-09-04 01:10:09 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:12 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919412668
2025-09-04 01:10:12 | uvicorn.error | INFO | connection open
2025-09-04 01:10:13 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:16 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919416652
2025-09-04 01:10:16 | uvicorn.error | INFO | connection open
2025-09-04 01:10:17 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:20 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919420662
2025-09-04 01:10:20 | uvicorn.error | INFO | connection open
2025-09-04 01:10:21 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919424660
2025-09-04 01:10:24 | uvicorn.error | INFO | connection open
2025-09-04 01:10:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919428641
2025-09-04 01:10:28 | uvicorn.error | INFO | connection open
2025-09-04 01:10:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:32 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919432658
2025-09-04 01:10:32 | uvicorn.error | INFO | connection open
2025-09-04 01:10:33 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919436644
2025-09-04 01:10:36 | uvicorn.error | INFO | connection open
2025-09-04 01:10:37 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919440681
2025-09-04 01:10:40 | uvicorn.error | INFO | connection open
2025-09-04 01:10:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919444657
2025-09-04 01:10:44 | uvicorn.error | INFO | connection open
2025-09-04 01:10:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:48 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919448654
2025-09-04 01:10:48 | uvicorn.error | INFO | connection open
2025-09-04 01:10:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919452668
2025-09-04 01:10:52 | uvicorn.error | INFO | connection open
2025-09-04 01:10:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:10:56 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919456654
2025-09-04 01:10:56 | uvicorn.error | INFO | connection open
2025-09-04 01:10:57 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:00 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919460667
2025-09-04 01:11:00 | uvicorn.error | INFO | connection open
2025-09-04 01:11:01 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:04 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919464653
2025-09-04 01:11:04 | uvicorn.error | INFO | connection open
2025-09-04 01:11:05 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:08 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919468653
2025-09-04 01:11:08 | uvicorn.error | INFO | connection open
2025-09-04 01:11:09 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:12 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919472667
2025-09-04 01:11:12 | uvicorn.error | INFO | connection open
2025-09-04 01:11:13 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:16 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919476832
2025-09-04 01:11:16 | uvicorn.error | INFO | connection open
2025-09-04 01:11:17 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919481672
2025-09-04 01:11:21 | uvicorn.error | INFO | connection open
2025-09-04 01:11:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919485652
2025-09-04 01:11:25 | uvicorn.error | INFO | connection open
2025-09-04 01:11:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919489679
2025-09-04 01:11:29 | uvicorn.error | INFO | connection open
2025-09-04 01:11:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919493653
2025-09-04 01:11:33 | uvicorn.error | INFO | connection open
2025-09-04 01:11:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919497708
2025-09-04 01:11:37 | uvicorn.error | INFO | connection open
2025-09-04 01:11:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919501669
2025-09-04 01:11:41 | uvicorn.error | INFO | connection open
2025-09-04 01:11:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919505655
2025-09-04 01:11:45 | uvicorn.error | INFO | connection open
2025-09-04 01:11:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919509662
2025-09-04 01:11:49 | uvicorn.error | INFO | connection open
2025-09-04 01:11:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:54 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919514678
2025-09-04 01:11:54 | uvicorn.error | INFO | connection open
2025-09-04 01:11:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:11:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919518657
2025-09-04 01:11:58 | uvicorn.error | INFO | connection open
2025-09-04 01:11:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919522668
2025-09-04 01:12:02 | uvicorn.error | INFO | connection open
2025-09-04 01:12:03 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:06 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919526709
2025-09-04 01:12:06 | uvicorn.error | INFO | connection open
2025-09-04 01:12:07 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919530663
2025-09-04 01:12:10 | uvicorn.error | INFO | connection open
2025-09-04 01:12:11 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919534659
2025-09-04 01:12:14 | uvicorn.error | INFO | connection open
2025-09-04 01:12:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919538666
2025-09-04 01:12:18 | uvicorn.error | INFO | connection open
2025-09-04 01:12:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919542652
2025-09-04 01:12:22 | uvicorn.error | INFO | connection open
2025-09-04 01:12:23 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919546663
2025-09-04 01:12:26 | uvicorn.error | INFO | connection open
2025-09-04 01:12:27 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919550670
2025-09-04 01:12:30 | uvicorn.error | INFO | connection open
2025-09-04 01:12:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919554670
2025-09-04 01:12:34 | uvicorn.error | INFO | connection open
2025-09-04 01:12:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:38 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919558663
2025-09-04 01:12:38 | uvicorn.error | INFO | connection open
2025-09-04 01:12:39 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919563379
2025-09-04 01:12:43 | uvicorn.error | INFO | connection open
2025-09-04 01:12:43 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919567659
2025-09-04 01:12:47 | uvicorn.error | INFO | connection open
2025-09-04 01:12:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919571663
2025-09-04 01:12:51 | uvicorn.error | INFO | connection open
2025-09-04 01:12:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919575662
2025-09-04 01:12:55 | uvicorn.error | INFO | connection open
2025-09-04 01:12:56 | uvicorn.error | INFO | connection closed
2025-09-04 01:12:59 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919579652
2025-09-04 01:12:59 | uvicorn.error | INFO | connection open
2025-09-04 01:13:00 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919583660
2025-09-04 01:13:03 | uvicorn.error | INFO | connection open
2025-09-04 01:13:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919587660
2025-09-04 01:13:07 | uvicorn.error | INFO | connection open
2025-09-04 01:13:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919591643
2025-09-04 01:13:11 | uvicorn.error | INFO | connection open
2025-09-04 01:13:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919595658
2025-09-04 01:13:15 | uvicorn.error | INFO | connection open
2025-09-04 01:13:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:20 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919600665
2025-09-04 01:13:20 | uvicorn.error | INFO | connection open
2025-09-04 01:13:21 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919604664
2025-09-04 01:13:24 | uvicorn.error | INFO | connection open
2025-09-04 01:13:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919608659
2025-09-04 01:13:28 | uvicorn.error | INFO | connection open
2025-09-04 01:13:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:32 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919612661
2025-09-04 01:13:32 | uvicorn.error | INFO | connection open
2025-09-04 01:13:33 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919616644
2025-09-04 01:13:36 | uvicorn.error | INFO | connection open
2025-09-04 01:13:37 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919620651
2025-09-04 01:13:40 | uvicorn.error | INFO | connection open
2025-09-04 01:13:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919624655
2025-09-04 01:13:44 | uvicorn.error | INFO | connection open
2025-09-04 01:13:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:48 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919628671
2025-09-04 01:13:48 | uvicorn.error | INFO | connection open
2025-09-04 01:13:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919632660
2025-09-04 01:13:52 | uvicorn.error | INFO | connection open
2025-09-04 01:13:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:13:56 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919636650
2025-09-04 01:13:56 | uvicorn.error | INFO | connection open
2025-09-04 01:13:57 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:00 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919640654
2025-09-04 01:14:00 | uvicorn.error | INFO | connection open
2025-09-04 01:14:01 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919645666
2025-09-04 01:14:05 | uvicorn.error | INFO | connection open
2025-09-04 01:14:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919649662
2025-09-04 01:14:09 | uvicorn.error | INFO | connection open
2025-09-04 01:14:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919653654
2025-09-04 01:14:13 | uvicorn.error | INFO | connection open
2025-09-04 01:14:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919657663
2025-09-04 01:14:17 | uvicorn.error | INFO | connection open
2025-09-04 01:14:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919661653
2025-09-04 01:14:21 | uvicorn.error | INFO | connection open
2025-09-04 01:14:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919665660
2025-09-04 01:14:25 | uvicorn.error | INFO | connection open
2025-09-04 01:14:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919669663
2025-09-04 01:14:29 | uvicorn.error | INFO | connection open
2025-09-04 01:14:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919673656
2025-09-04 01:14:33 | uvicorn.error | INFO | connection open
2025-09-04 01:14:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919677682
2025-09-04 01:14:37 | uvicorn.error | INFO | connection open
2025-09-04 01:14:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919681656
2025-09-04 01:14:41 | uvicorn.error | INFO | connection open
2025-09-04 01:14:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919687790
2025-09-04 01:14:47 | uvicorn.error | INFO | connection open
2025-09-04 01:14:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919692670
2025-09-04 01:14:52 | uvicorn.error | INFO | connection open
2025-09-04 01:14:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:14:56 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919696666
2025-09-04 01:14:56 | uvicorn.error | INFO | connection open
2025-09-04 01:14:57 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:00 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919700658
2025-09-04 01:15:00 | uvicorn.error | INFO | connection open
2025-09-04 01:15:01 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:04 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919704659
2025-09-04 01:15:04 | uvicorn.error | INFO | connection open
2025-09-04 01:15:05 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:08 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919708656
2025-09-04 01:15:08 | uvicorn.error | INFO | connection open
2025-09-04 01:15:09 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:12 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919712653
2025-09-04 01:15:12 | uvicorn.error | INFO | connection open
2025-09-04 01:15:13 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:16 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919716651
2025-09-04 01:15:16 | uvicorn.error | INFO | connection open
2025-09-04 01:15:17 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:20 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919720657
2025-09-04 01:15:20 | uvicorn.error | INFO | connection open
2025-09-04 01:15:21 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919724645
2025-09-04 01:15:24 | uvicorn.error | INFO | connection open
2025-09-04 01:15:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919728644
2025-09-04 01:15:28 | uvicorn.error | INFO | connection open
2025-09-04 01:15:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:32 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919732667
2025-09-04 01:15:32 | uvicorn.error | INFO | connection open
2025-09-04 01:15:33 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919736674
2025-09-04 01:15:36 | uvicorn.error | INFO | connection open
2025-09-04 01:15:37 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919740665
2025-09-04 01:15:40 | uvicorn.error | INFO | connection open
2025-09-04 01:15:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919744661
2025-09-04 01:15:44 | uvicorn.error | INFO | connection open
2025-09-04 01:15:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:48 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919748662
2025-09-04 01:15:48 | uvicorn.error | INFO | connection open
2025-09-04 01:15:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919752658
2025-09-04 01:15:52 | uvicorn.error | INFO | connection open
2025-09-04 01:15:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:15:56 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919756665
2025-09-04 01:15:56 | uvicorn.error | INFO | connection open
2025-09-04 01:15:57 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:00 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919760647
2025-09-04 01:16:00 | uvicorn.error | INFO | connection open
2025-09-04 01:16:01 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:04 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919764661
2025-09-04 01:16:04 | uvicorn.error | INFO | connection open
2025-09-04 01:16:05 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:08 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919768652
2025-09-04 01:16:08 | uvicorn.error | INFO | connection open
2025-09-04 01:16:09 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:12 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919772657
2025-09-04 01:16:12 | uvicorn.error | INFO | connection open
2025-09-04 01:16:13 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:16 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919776653
2025-09-04 01:16:16 | uvicorn.error | INFO | connection open
2025-09-04 01:16:17 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:20 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919780665
2025-09-04 01:16:20 | uvicorn.error | INFO | connection open
2025-09-04 01:16:21 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919784650
2025-09-04 01:16:24 | uvicorn.error | INFO | connection open
2025-09-04 01:16:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919788662
2025-09-04 01:16:28 | uvicorn.error | INFO | connection open
2025-09-04 01:16:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:32 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919792677
2025-09-04 01:16:32 | uvicorn.error | INFO | connection open
2025-09-04 01:16:33 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919796651
2025-09-04 01:16:36 | uvicorn.error | INFO | connection open
2025-09-04 01:16:37 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919800645
2025-09-04 01:16:40 | uvicorn.error | INFO | connection open
2025-09-04 01:16:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919804665
2025-09-04 01:16:44 | uvicorn.error | INFO | connection open
2025-09-04 01:16:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:48 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919808665
2025-09-04 01:16:48 | uvicorn.error | INFO | connection open
2025-09-04 01:16:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919812644
2025-09-04 01:16:52 | uvicorn.error | INFO | connection open
2025-09-04 01:16:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:16:56 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919816649
2025-09-04 01:16:56 | uvicorn.error | INFO | connection open
2025-09-04 01:16:57 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:00 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919820652
2025-09-04 01:17:00 | uvicorn.error | INFO | connection open
2025-09-04 01:17:01 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:04 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919824659
2025-09-04 01:17:04 | uvicorn.error | INFO | connection open
2025-09-04 01:17:05 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:08 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919828661
2025-09-04 01:17:08 | uvicorn.error | INFO | connection open
2025-09-04 01:17:09 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:12 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919832646
2025-09-04 01:17:12 | uvicorn.error | INFO | connection open
2025-09-04 01:17:13 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:16 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919836665
2025-09-04 01:17:16 | uvicorn.error | INFO | connection open
2025-09-04 01:17:17 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:20 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919840647
2025-09-04 01:17:20 | uvicorn.error | INFO | connection open
2025-09-04 01:17:21 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919844648
2025-09-04 01:17:24 | uvicorn.error | INFO | connection open
2025-09-04 01:17:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919848647
2025-09-04 01:17:28 | uvicorn.error | INFO | connection open
2025-09-04 01:17:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:32 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919852643
2025-09-04 01:17:32 | uvicorn.error | INFO | connection open
2025-09-04 01:17:33 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919856654
2025-09-04 01:17:36 | uvicorn.error | INFO | connection open
2025-09-04 01:17:37 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919860669
2025-09-04 01:17:40 | uvicorn.error | INFO | connection open
2025-09-04 01:17:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919864680
2025-09-04 01:17:44 | uvicorn.error | INFO | connection open
2025-09-04 01:17:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:48 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919868680
2025-09-04 01:17:48 | uvicorn.error | INFO | connection open
2025-09-04 01:17:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919872666
2025-09-04 01:17:52 | uvicorn.error | INFO | connection open
2025-09-04 01:17:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:17:56 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919876674
2025-09-04 01:17:56 | uvicorn.error | INFO | connection open
2025-09-04 01:17:57 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:00 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919880670
2025-09-04 01:18:00 | uvicorn.error | INFO | connection open
2025-09-04 01:18:01 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:04 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919884664
2025-09-04 01:18:04 | uvicorn.error | INFO | connection open
2025-09-04 01:18:05 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:08 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919888667
2025-09-04 01:18:08 | uvicorn.error | INFO | connection open
2025-09-04 01:18:09 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:12 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919892642
2025-09-04 01:18:12 | uvicorn.error | INFO | connection open
2025-09-04 01:18:13 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:16 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919896653
2025-09-04 01:18:16 | uvicorn.error | INFO | connection open
2025-09-04 01:18:17 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919901645
2025-09-04 01:18:21 | uvicorn.error | INFO | connection open
2025-09-04 01:18:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919905661
2025-09-04 01:18:25 | uvicorn.error | INFO | connection open
2025-09-04 01:18:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919909661
2025-09-04 01:18:29 | uvicorn.error | INFO | connection open
2025-09-04 01:18:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919913645
2025-09-04 01:18:33 | uvicorn.error | INFO | connection open
2025-09-04 01:18:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919917645
2025-09-04 01:18:37 | uvicorn.error | INFO | connection open
2025-09-04 01:18:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919921645
2025-09-04 01:18:41 | uvicorn.error | INFO | connection open
2025-09-04 01:18:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919925660
2025-09-04 01:18:45 | uvicorn.error | INFO | connection open
2025-09-04 01:18:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919929672
2025-09-04 01:18:49 | uvicorn.error | INFO | connection open
2025-09-04 01:18:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919933659
2025-09-04 01:18:53 | uvicorn.error | INFO | connection open
2025-09-04 01:18:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:18:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919937661
2025-09-04 01:18:57 | uvicorn.error | INFO | connection open
2025-09-04 01:18:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919941653
2025-09-04 01:19:01 | uvicorn.error | INFO | connection open
2025-09-04 01:19:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919945655
2025-09-04 01:19:05 | uvicorn.error | INFO | connection open
2025-09-04 01:19:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919949649
2025-09-04 01:19:09 | uvicorn.error | INFO | connection open
2025-09-04 01:19:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919953659
2025-09-04 01:19:13 | uvicorn.error | INFO | connection open
2025-09-04 01:19:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919957656
2025-09-04 01:19:17 | uvicorn.error | INFO | connection open
2025-09-04 01:19:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919961645
2025-09-04 01:19:21 | uvicorn.error | INFO | connection open
2025-09-04 01:19:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919965644
2025-09-04 01:19:25 | uvicorn.error | INFO | connection open
2025-09-04 01:19:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919969658
2025-09-04 01:19:29 | uvicorn.error | INFO | connection open
2025-09-04 01:19:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919973658
2025-09-04 01:19:33 | uvicorn.error | INFO | connection open
2025-09-04 01:19:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919977654
2025-09-04 01:19:37 | uvicorn.error | INFO | connection open
2025-09-04 01:19:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919981655
2025-09-04 01:19:41 | uvicorn.error | INFO | connection open
2025-09-04 01:19:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919985666
2025-09-04 01:19:45 | uvicorn.error | INFO | connection open
2025-09-04 01:19:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919989654
2025-09-04 01:19:49 | uvicorn.error | INFO | connection open
2025-09-04 01:19:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919993647
2025-09-04 01:19:53 | uvicorn.error | INFO | connection open
2025-09-04 01:19:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:19:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756919997652
2025-09-04 01:19:57 | uvicorn.error | INFO | connection open
2025-09-04 01:19:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920001650
2025-09-04 01:20:01 | uvicorn.error | INFO | connection open
2025-09-04 01:20:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920005646
2025-09-04 01:20:05 | uvicorn.error | INFO | connection open
2025-09-04 01:20:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920009642
2025-09-04 01:20:09 | uvicorn.error | INFO | connection open
2025-09-04 01:20:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920013646
2025-09-04 01:20:13 | uvicorn.error | INFO | connection open
2025-09-04 01:20:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920017660
2025-09-04 01:20:17 | uvicorn.error | INFO | connection open
2025-09-04 01:20:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920021658
2025-09-04 01:20:21 | uvicorn.error | INFO | connection open
2025-09-04 01:20:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920025644
2025-09-04 01:20:25 | uvicorn.error | INFO | connection open
2025-09-04 01:20:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920029651
2025-09-04 01:20:29 | uvicorn.error | INFO | connection open
2025-09-04 01:20:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920033666
2025-09-04 01:20:33 | uvicorn.error | INFO | connection open
2025-09-04 01:20:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920037672
2025-09-04 01:20:37 | uvicorn.error | INFO | connection open
2025-09-04 01:20:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920041676
2025-09-04 01:20:41 | uvicorn.error | INFO | connection open
2025-09-04 01:20:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920045656
2025-09-04 01:20:45 | uvicorn.error | INFO | connection open
2025-09-04 01:20:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920049685
2025-09-04 01:20:49 | uvicorn.error | INFO | connection open
2025-09-04 01:20:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920053651
2025-09-04 01:20:53 | uvicorn.error | INFO | connection open
2025-09-04 01:20:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:20:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920057665
2025-09-04 01:20:57 | uvicorn.error | INFO | connection open
2025-09-04 01:20:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920061664
2025-09-04 01:21:01 | uvicorn.error | INFO | connection open
2025-09-04 01:21:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920065670
2025-09-04 01:21:05 | uvicorn.error | INFO | connection open
2025-09-04 01:21:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920069670
2025-09-04 01:21:09 | uvicorn.error | INFO | connection open
2025-09-04 01:21:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920073654
2025-09-04 01:21:13 | uvicorn.error | INFO | connection open
2025-09-04 01:21:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920077678
2025-09-04 01:21:17 | uvicorn.error | INFO | connection open
2025-09-04 01:21:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920081671
2025-09-04 01:21:21 | uvicorn.error | INFO | connection open
2025-09-04 01:21:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920085656
2025-09-04 01:21:25 | uvicorn.error | INFO | connection open
2025-09-04 01:21:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920089683
2025-09-04 01:21:29 | uvicorn.error | INFO | connection open
2025-09-04 01:21:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920093655
2025-09-04 01:21:33 | uvicorn.error | INFO | connection open
2025-09-04 01:21:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920097645
2025-09-04 01:21:37 | uvicorn.error | INFO | connection open
2025-09-04 01:21:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920101669
2025-09-04 01:21:41 | uvicorn.error | INFO | connection open
2025-09-04 01:21:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920105667
2025-09-04 01:21:45 | uvicorn.error | INFO | connection open
2025-09-04 01:21:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920109649
2025-09-04 01:21:49 | uvicorn.error | INFO | connection open
2025-09-04 01:21:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920113646
2025-09-04 01:21:53 | uvicorn.error | INFO | connection open
2025-09-04 01:21:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:21:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920117668
2025-09-04 01:21:57 | uvicorn.error | INFO | connection open
2025-09-04 01:21:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920121653
2025-09-04 01:22:01 | uvicorn.error | INFO | connection open
2025-09-04 01:22:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920125667
2025-09-04 01:22:05 | uvicorn.error | INFO | connection open
2025-09-04 01:22:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920129670
2025-09-04 01:22:09 | uvicorn.error | INFO | connection open
2025-09-04 01:22:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920133672
2025-09-04 01:22:13 | uvicorn.error | INFO | connection open
2025-09-04 01:22:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920137661
2025-09-04 01:22:17 | uvicorn.error | INFO | connection open
2025-09-04 01:22:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920141665
2025-09-04 01:22:21 | uvicorn.error | INFO | connection open
2025-09-04 01:22:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920145659
2025-09-04 01:22:25 | uvicorn.error | INFO | connection open
2025-09-04 01:22:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920149656
2025-09-04 01:22:29 | uvicorn.error | INFO | connection open
2025-09-04 01:22:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920153670
2025-09-04 01:22:33 | uvicorn.error | INFO | connection open
2025-09-04 01:22:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920157664
2025-09-04 01:22:37 | uvicorn.error | INFO | connection open
2025-09-04 01:22:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920161668
2025-09-04 01:22:41 | uvicorn.error | INFO | connection open
2025-09-04 01:22:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920165667
2025-09-04 01:22:45 | uvicorn.error | INFO | connection open
2025-09-04 01:22:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920169656
2025-09-04 01:22:49 | uvicorn.error | INFO | connection open
2025-09-04 01:22:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920173651
2025-09-04 01:22:53 | uvicorn.error | INFO | connection open
2025-09-04 01:22:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:22:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920177651
2025-09-04 01:22:57 | uvicorn.error | INFO | connection open
2025-09-04 01:22:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920181670
2025-09-04 01:23:01 | uvicorn.error | INFO | connection open
2025-09-04 01:23:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920185657
2025-09-04 01:23:05 | uvicorn.error | INFO | connection open
2025-09-04 01:23:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920189669
2025-09-04 01:23:09 | uvicorn.error | INFO | connection open
2025-09-04 01:23:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920193662
2025-09-04 01:23:13 | uvicorn.error | INFO | connection open
2025-09-04 01:23:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920197657
2025-09-04 01:23:17 | uvicorn.error | INFO | connection open
2025-09-04 01:23:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920201680
2025-09-04 01:23:21 | uvicorn.error | INFO | connection open
2025-09-04 01:23:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920205673
2025-09-04 01:23:25 | uvicorn.error | INFO | connection open
2025-09-04 01:23:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920209653
2025-09-04 01:23:29 | uvicorn.error | INFO | connection open
2025-09-04 01:23:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920213669
2025-09-04 01:23:33 | uvicorn.error | INFO | connection open
2025-09-04 01:23:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920217657
2025-09-04 01:23:37 | uvicorn.error | INFO | connection open
2025-09-04 01:23:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920221648
2025-09-04 01:23:41 | uvicorn.error | INFO | connection open
2025-09-04 01:23:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920225663
2025-09-04 01:23:45 | uvicorn.error | INFO | connection open
2025-09-04 01:23:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920229651
2025-09-04 01:23:49 | uvicorn.error | INFO | connection open
2025-09-04 01:23:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920233658
2025-09-04 01:23:53 | uvicorn.error | INFO | connection open
2025-09-04 01:23:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:23:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920237661
2025-09-04 01:23:57 | uvicorn.error | INFO | connection open
2025-09-04 01:23:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920241655
2025-09-04 01:24:01 | uvicorn.error | INFO | connection open
2025-09-04 01:24:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920245661
2025-09-04 01:24:05 | uvicorn.error | INFO | connection open
2025-09-04 01:24:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920249661
2025-09-04 01:24:09 | uvicorn.error | INFO | connection open
2025-09-04 01:24:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920253661
2025-09-04 01:24:13 | uvicorn.error | INFO | connection open
2025-09-04 01:24:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920257657
2025-09-04 01:24:17 | uvicorn.error | INFO | connection open
2025-09-04 01:24:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920261669
2025-09-04 01:24:21 | uvicorn.error | INFO | connection open
2025-09-04 01:24:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920265671
2025-09-04 01:24:25 | uvicorn.error | INFO | connection open
2025-09-04 01:24:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920269650
2025-09-04 01:24:29 | uvicorn.error | INFO | connection open
2025-09-04 01:24:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920273646
2025-09-04 01:24:33 | uvicorn.error | INFO | connection open
2025-09-04 01:24:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920277677
2025-09-04 01:24:37 | uvicorn.error | INFO | connection open
2025-09-04 01:24:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920281658
2025-09-04 01:24:41 | uvicorn.error | INFO | connection open
2025-09-04 01:24:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920285661
2025-09-04 01:24:45 | uvicorn.error | INFO | connection open
2025-09-04 01:24:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920289663
2025-09-04 01:24:49 | uvicorn.error | INFO | connection open
2025-09-04 01:24:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920293654
2025-09-04 01:24:53 | uvicorn.error | INFO | connection open
2025-09-04 01:24:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:24:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920297664
2025-09-04 01:24:57 | uvicorn.error | INFO | connection open
2025-09-04 01:24:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920301671
2025-09-04 01:25:01 | uvicorn.error | INFO | connection open
2025-09-04 01:25:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920305679
2025-09-04 01:25:05 | uvicorn.error | INFO | connection open
2025-09-04 01:25:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920309669
2025-09-04 01:25:09 | uvicorn.error | INFO | connection open
2025-09-04 01:25:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920313656
2025-09-04 01:25:13 | uvicorn.error | INFO | connection open
2025-09-04 01:25:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920317662
2025-09-04 01:25:17 | uvicorn.error | INFO | connection open
2025-09-04 01:25:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920321669
2025-09-04 01:25:21 | uvicorn.error | INFO | connection open
2025-09-04 01:25:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920325675
2025-09-04 01:25:25 | uvicorn.error | INFO | connection open
2025-09-04 01:25:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920329656
2025-09-04 01:25:29 | uvicorn.error | INFO | connection open
2025-09-04 01:25:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920333672
2025-09-04 01:25:33 | uvicorn.error | INFO | connection open
2025-09-04 01:25:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920337661
2025-09-04 01:25:37 | uvicorn.error | INFO | connection open
2025-09-04 01:25:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920341662
2025-09-04 01:25:41 | uvicorn.error | INFO | connection open
2025-09-04 01:25:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920345678
2025-09-04 01:25:45 | uvicorn.error | INFO | connection open
2025-09-04 01:25:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920349662
2025-09-04 01:25:49 | uvicorn.error | INFO | connection open
2025-09-04 01:25:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920353664
2025-09-04 01:25:53 | uvicorn.error | INFO | connection open
2025-09-04 01:25:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:25:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920357646
2025-09-04 01:25:57 | uvicorn.error | INFO | connection open
2025-09-04 01:25:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920361662
2025-09-04 01:26:01 | uvicorn.error | INFO | connection open
2025-09-04 01:26:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920365642
2025-09-04 01:26:05 | uvicorn.error | INFO | connection open
2025-09-04 01:26:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920369644
2025-09-04 01:26:09 | uvicorn.error | INFO | connection open
2025-09-04 01:26:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920373665
2025-09-04 01:26:13 | uvicorn.error | INFO | connection open
2025-09-04 01:26:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920377648
2025-09-04 01:26:17 | uvicorn.error | INFO | connection open
2025-09-04 01:26:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920381645
2025-09-04 01:26:21 | uvicorn.error | INFO | connection open
2025-09-04 01:26:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920385667
2025-09-04 01:26:25 | uvicorn.error | INFO | connection open
2025-09-04 01:26:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920390655
2025-09-04 01:26:30 | uvicorn.error | INFO | connection open
2025-09-04 01:26:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920394660
2025-09-04 01:26:34 | uvicorn.error | INFO | connection open
2025-09-04 01:26:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:38 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920398674
2025-09-04 01:26:38 | uvicorn.error | INFO | connection open
2025-09-04 01:26:39 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:42 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920402673
2025-09-04 01:26:42 | uvicorn.error | INFO | connection open
2025-09-04 01:26:43 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:46 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920406658
2025-09-04 01:26:46 | uvicorn.error | INFO | connection open
2025-09-04 01:26:47 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:50 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920410657
2025-09-04 01:26:50 | uvicorn.error | INFO | connection open
2025-09-04 01:26:51 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:54 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920414665
2025-09-04 01:26:54 | uvicorn.error | INFO | connection open
2025-09-04 01:26:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:26:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920418671
2025-09-04 01:26:58 | uvicorn.error | INFO | connection open
2025-09-04 01:26:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920422664
2025-09-04 01:27:02 | uvicorn.error | INFO | connection open
2025-09-04 01:27:03 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:06 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920426692
2025-09-04 01:27:06 | uvicorn.error | INFO | connection open
2025-09-04 01:27:07 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920430653
2025-09-04 01:27:10 | uvicorn.error | INFO | connection open
2025-09-04 01:27:11 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920434670
2025-09-04 01:27:14 | uvicorn.error | INFO | connection open
2025-09-04 01:27:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920438672
2025-09-04 01:27:18 | uvicorn.error | INFO | connection open
2025-09-04 01:27:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920442664
2025-09-04 01:27:22 | uvicorn.error | INFO | connection open
2025-09-04 01:27:23 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920446648
2025-09-04 01:27:26 | uvicorn.error | INFO | connection open
2025-09-04 01:27:27 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920450659
2025-09-04 01:27:30 | uvicorn.error | INFO | connection open
2025-09-04 01:27:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920454644
2025-09-04 01:27:34 | uvicorn.error | INFO | connection open
2025-09-04 01:27:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:38 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920458670
2025-09-04 01:27:38 | uvicorn.error | INFO | connection open
2025-09-04 01:27:39 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:42 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920462657
2025-09-04 01:27:42 | uvicorn.error | INFO | connection open
2025-09-04 01:27:43 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:46 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920466648
2025-09-04 01:27:46 | uvicorn.error | INFO | connection open
2025-09-04 01:27:47 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:50 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920470671
2025-09-04 01:27:50 | uvicorn.error | INFO | connection open
2025-09-04 01:27:51 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:54 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920474643
2025-09-04 01:27:54 | uvicorn.error | INFO | connection open
2025-09-04 01:27:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:27:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920478663
2025-09-04 01:27:58 | uvicorn.error | INFO | connection open
2025-09-04 01:27:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920482652
2025-09-04 01:28:02 | uvicorn.error | INFO | connection open
2025-09-04 01:28:03 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:06 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920486694
2025-09-04 01:28:06 | uvicorn.error | INFO | connection open
2025-09-04 01:28:07 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920490649
2025-09-04 01:28:10 | uvicorn.error | INFO | connection open
2025-09-04 01:28:11 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920494649
2025-09-04 01:28:14 | uvicorn.error | INFO | connection open
2025-09-04 01:28:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920498655
2025-09-04 01:28:18 | uvicorn.error | INFO | connection open
2025-09-04 01:28:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920502662
2025-09-04 01:28:22 | uvicorn.error | INFO | connection open
2025-09-04 01:28:23 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920506669
2025-09-04 01:28:26 | uvicorn.error | INFO | connection open
2025-09-04 01:28:27 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920510660
2025-09-04 01:28:30 | uvicorn.error | INFO | connection open
2025-09-04 01:28:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920514657
2025-09-04 01:28:34 | uvicorn.error | INFO | connection open
2025-09-04 01:28:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:38 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920518663
2025-09-04 01:28:38 | uvicorn.error | INFO | connection open
2025-09-04 01:28:39 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:42 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920522669
2025-09-04 01:28:42 | uvicorn.error | INFO | connection open
2025-09-04 01:28:43 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:46 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920526645
2025-09-04 01:28:46 | uvicorn.error | INFO | connection open
2025-09-04 01:28:47 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:50 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920530672
2025-09-04 01:28:50 | uvicorn.error | INFO | connection open
2025-09-04 01:28:51 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:54 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920534656
2025-09-04 01:28:54 | uvicorn.error | INFO | connection open
2025-09-04 01:28:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:28:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920538649
2025-09-04 01:28:58 | uvicorn.error | INFO | connection open
2025-09-04 01:28:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920542643
2025-09-04 01:29:02 | uvicorn.error | INFO | connection open
2025-09-04 01:29:03 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:06 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920546692
2025-09-04 01:29:06 | uvicorn.error | INFO | connection open
2025-09-04 01:29:07 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920550674
2025-09-04 01:29:10 | uvicorn.error | INFO | connection open
2025-09-04 01:29:11 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920554674
2025-09-04 01:29:14 | uvicorn.error | INFO | connection open
2025-09-04 01:29:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920558668
2025-09-04 01:29:18 | uvicorn.error | INFO | connection open
2025-09-04 01:29:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920562652
2025-09-04 01:29:22 | uvicorn.error | INFO | connection open
2025-09-04 01:29:23 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920566651
2025-09-04 01:29:26 | uvicorn.error | INFO | connection open
2025-09-04 01:29:27 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920570663
2025-09-04 01:29:30 | uvicorn.error | INFO | connection open
2025-09-04 01:29:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920574652
2025-09-04 01:29:34 | uvicorn.error | INFO | connection open
2025-09-04 01:29:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:38 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920578649
2025-09-04 01:29:38 | uvicorn.error | INFO | connection open
2025-09-04 01:29:39 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:42 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920582647
2025-09-04 01:29:42 | uvicorn.error | INFO | connection open
2025-09-04 01:29:43 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:46 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920586650
2025-09-04 01:29:46 | uvicorn.error | INFO | connection open
2025-09-04 01:29:47 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:50 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920590647
2025-09-04 01:29:50 | uvicorn.error | INFO | connection open
2025-09-04 01:29:51 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:54 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920594670
2025-09-04 01:29:54 | uvicorn.error | INFO | connection open
2025-09-04 01:29:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:29:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920598657
2025-09-04 01:29:58 | uvicorn.error | INFO | connection open
2025-09-04 01:29:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920602664
2025-09-04 01:30:02 | uvicorn.error | INFO | connection open
2025-09-04 01:30:03 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920607660
2025-09-04 01:30:07 | uvicorn.error | INFO | connection open
2025-09-04 01:30:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920611658
2025-09-04 01:30:11 | uvicorn.error | INFO | connection open
2025-09-04 01:30:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920615671
2025-09-04 01:30:15 | uvicorn.error | INFO | connection open
2025-09-04 01:30:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:19 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920619668
2025-09-04 01:30:19 | uvicorn.error | INFO | connection open
2025-09-04 01:30:20 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:23 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920623663
2025-09-04 01:30:23 | uvicorn.error | INFO | connection open
2025-09-04 01:30:24 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:27 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920627665
2025-09-04 01:30:27 | uvicorn.error | INFO | connection open
2025-09-04 01:30:28 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:31 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920631661
2025-09-04 01:30:31 | uvicorn.error | INFO | connection open
2025-09-04 01:30:32 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920635651
2025-09-04 01:30:35 | uvicorn.error | INFO | connection open
2025-09-04 01:30:36 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:39 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920639676
2025-09-04 01:30:39 | uvicorn.error | INFO | connection open
2025-09-04 01:30:40 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920643672
2025-09-04 01:30:43 | uvicorn.error | INFO | connection open
2025-09-04 01:30:44 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920647684
2025-09-04 01:30:47 | uvicorn.error | INFO | connection open
2025-09-04 01:30:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920651670
2025-09-04 01:30:51 | uvicorn.error | INFO | connection open
2025-09-04 01:30:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920655665
2025-09-04 01:30:55 | uvicorn.error | INFO | connection open
2025-09-04 01:30:56 | uvicorn.error | INFO | connection closed
2025-09-04 01:30:59 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920659674
2025-09-04 01:30:59 | uvicorn.error | INFO | connection open
2025-09-04 01:31:00 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920663674
2025-09-04 01:31:03 | uvicorn.error | INFO | connection open
2025-09-04 01:31:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920667656
2025-09-04 01:31:07 | uvicorn.error | INFO | connection open
2025-09-04 01:31:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920671669
2025-09-04 01:31:11 | uvicorn.error | INFO | connection open
2025-09-04 01:31:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920675681
2025-09-04 01:31:15 | uvicorn.error | INFO | connection open
2025-09-04 01:31:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:19 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920679664
2025-09-04 01:31:19 | uvicorn.error | INFO | connection open
2025-09-04 01:31:20 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:23 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920683670
2025-09-04 01:31:23 | uvicorn.error | INFO | connection open
2025-09-04 01:31:24 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:27 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920687669
2025-09-04 01:31:27 | uvicorn.error | INFO | connection open
2025-09-04 01:31:28 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:31 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920691696
2025-09-04 01:31:31 | uvicorn.error | INFO | connection open
2025-09-04 01:31:32 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920695673
2025-09-04 01:31:35 | uvicorn.error | INFO | connection open
2025-09-04 01:31:36 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:39 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920699668
2025-09-04 01:31:39 | uvicorn.error | INFO | connection open
2025-09-04 01:31:40 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920703648
2025-09-04 01:31:43 | uvicorn.error | INFO | connection open
2025-09-04 01:31:44 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920707663
2025-09-04 01:31:47 | uvicorn.error | INFO | connection open
2025-09-04 01:31:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920711662
2025-09-04 01:31:51 | uvicorn.error | INFO | connection open
2025-09-04 01:31:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920715660
2025-09-04 01:31:55 | uvicorn.error | INFO | connection open
2025-09-04 01:31:56 | uvicorn.error | INFO | connection closed
2025-09-04 01:31:59 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920719648
2025-09-04 01:31:59 | uvicorn.error | INFO | connection open
2025-09-04 01:32:00 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920723663
2025-09-04 01:32:03 | uvicorn.error | INFO | connection open
2025-09-04 01:32:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920727676
2025-09-04 01:32:07 | uvicorn.error | INFO | connection open
2025-09-04 01:32:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920731659
2025-09-04 01:32:11 | uvicorn.error | INFO | connection open
2025-09-04 01:32:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920735676
2025-09-04 01:32:15 | uvicorn.error | INFO | connection open
2025-09-04 01:32:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:19 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920739687
2025-09-04 01:32:19 | uvicorn.error | INFO | connection open
2025-09-04 01:32:20 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:23 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920743656
2025-09-04 01:32:23 | uvicorn.error | INFO | connection open
2025-09-04 01:32:24 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:27 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920747709
2025-09-04 01:32:27 | uvicorn.error | INFO | connection open
2025-09-04 01:32:28 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:31 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920751657
2025-09-04 01:32:31 | uvicorn.error | INFO | connection open
2025-09-04 01:32:32 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920755683
2025-09-04 01:32:35 | uvicorn.error | INFO | connection open
2025-09-04 01:32:36 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:39 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920759660
2025-09-04 01:32:39 | uvicorn.error | INFO | connection open
2025-09-04 01:32:40 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920763673
2025-09-04 01:32:43 | uvicorn.error | INFO | connection open
2025-09-04 01:32:44 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920767687
2025-09-04 01:32:47 | uvicorn.error | INFO | connection open
2025-09-04 01:32:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920771671
2025-09-04 01:32:51 | uvicorn.error | INFO | connection open
2025-09-04 01:32:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:32:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920775687
2025-09-04 01:32:55 | uvicorn.error | INFO | connection open
2025-09-04 01:32:56 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920782176
2025-09-04 01:33:02 | uvicorn.error | INFO | connection open
2025-09-04 01:33:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:06 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920786694
2025-09-04 01:33:06 | uvicorn.error | INFO | connection open
2025-09-04 01:33:07 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920790683
2025-09-04 01:33:10 | uvicorn.error | INFO | connection open
2025-09-04 01:33:11 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920794659
2025-09-04 01:33:14 | uvicorn.error | INFO | connection open
2025-09-04 01:33:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920798665
2025-09-04 01:33:18 | uvicorn.error | INFO | connection open
2025-09-04 01:33:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920802663
2025-09-04 01:33:22 | uvicorn.error | INFO | connection open
2025-09-04 01:33:23 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920806675
2025-09-04 01:33:26 | uvicorn.error | INFO | connection open
2025-09-04 01:33:27 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920810660
2025-09-04 01:33:30 | uvicorn.error | INFO | connection open
2025-09-04 01:33:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920814664
2025-09-04 01:33:34 | uvicorn.error | INFO | connection open
2025-09-04 01:33:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:38 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920818682
2025-09-04 01:33:38 | uvicorn.error | INFO | connection open
2025-09-04 01:33:39 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:42 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920822664
2025-09-04 01:33:42 | uvicorn.error | INFO | connection open
2025-09-04 01:33:43 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:46 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920826649
2025-09-04 01:33:46 | uvicorn.error | INFO | connection open
2025-09-04 01:33:47 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:50 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920830676
2025-09-04 01:33:50 | uvicorn.error | INFO | connection open
2025-09-04 01:33:51 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:54 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920834645
2025-09-04 01:33:54 | uvicorn.error | INFO | connection open
2025-09-04 01:33:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:33:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920838663
2025-09-04 01:33:58 | uvicorn.error | INFO | connection open
2025-09-04 01:33:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920842649
2025-09-04 01:34:02 | uvicorn.error | INFO | connection open
2025-09-04 01:34:03 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:06 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920846710
2025-09-04 01:34:06 | uvicorn.error | INFO | connection open
2025-09-04 01:34:07 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920850664
2025-09-04 01:34:10 | uvicorn.error | INFO | connection open
2025-09-04 01:34:11 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920854683
2025-09-04 01:34:14 | uvicorn.error | INFO | connection open
2025-09-04 01:34:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920858681
2025-09-04 01:34:18 | uvicorn.error | INFO | connection open
2025-09-04 01:34:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920862681
2025-09-04 01:34:22 | uvicorn.error | INFO | connection open
2025-09-04 01:34:23 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920866678
2025-09-04 01:34:26 | uvicorn.error | INFO | connection open
2025-09-04 01:34:27 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920870657
2025-09-04 01:34:30 | uvicorn.error | INFO | connection open
2025-09-04 01:34:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920874678
2025-09-04 01:34:34 | uvicorn.error | INFO | connection open
2025-09-04 01:34:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:38 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920878666
2025-09-04 01:34:38 | uvicorn.error | INFO | connection open
2025-09-04 01:34:39 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:42 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920882646
2025-09-04 01:34:42 | uvicorn.error | INFO | connection open
2025-09-04 01:34:43 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:46 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920886658
2025-09-04 01:34:46 | uvicorn.error | INFO | connection open
2025-09-04 01:34:47 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:50 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920890658
2025-09-04 01:34:50 | uvicorn.error | INFO | connection open
2025-09-04 01:34:51 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:54 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920894656
2025-09-04 01:34:54 | uvicorn.error | INFO | connection open
2025-09-04 01:34:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:34:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920898665
2025-09-04 01:34:58 | uvicorn.error | INFO | connection open
2025-09-04 01:34:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920902648
2025-09-04 01:35:02 | uvicorn.error | INFO | connection open
2025-09-04 01:35:03 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:06 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920906691
2025-09-04 01:35:06 | uvicorn.error | INFO | connection open
2025-09-04 01:35:07 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:10 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920910665
2025-09-04 01:35:10 | uvicorn.error | INFO | connection open
2025-09-04 01:35:11 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:14 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920914671
2025-09-04 01:35:14 | uvicorn.error | INFO | connection open
2025-09-04 01:35:15 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:18 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920918673
2025-09-04 01:35:18 | uvicorn.error | INFO | connection open
2025-09-04 01:35:19 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:22 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920922685
2025-09-04 01:35:22 | uvicorn.error | INFO | connection open
2025-09-04 01:35:23 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:26 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920926688
2025-09-04 01:35:26 | uvicorn.error | INFO | connection open
2025-09-04 01:35:27 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:30 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920930665
2025-09-04 01:35:30 | uvicorn.error | INFO | connection open
2025-09-04 01:35:31 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:34 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920934659
2025-09-04 01:35:34 | uvicorn.error | INFO | connection open
2025-09-04 01:35:35 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:38 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920938645
2025-09-04 01:35:38 | uvicorn.error | INFO | connection open
2025-09-04 01:35:39 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:42 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920942650
2025-09-04 01:35:42 | uvicorn.error | INFO | connection open
2025-09-04 01:35:43 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:46 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920946654
2025-09-04 01:35:46 | uvicorn.error | INFO | connection open
2025-09-04 01:35:47 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:50 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920950664
2025-09-04 01:35:50 | uvicorn.error | INFO | connection open
2025-09-04 01:35:51 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:54 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920954672
2025-09-04 01:35:54 | uvicorn.error | INFO | connection open
2025-09-04 01:35:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:35:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920958651
2025-09-04 01:35:58 | uvicorn.error | INFO | connection open
2025-09-04 01:35:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920963665
2025-09-04 01:36:03 | uvicorn.error | INFO | connection open
2025-09-04 01:36:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920967656
2025-09-04 01:36:07 | uvicorn.error | INFO | connection open
2025-09-04 01:36:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920971663
2025-09-04 01:36:11 | uvicorn.error | INFO | connection open
2025-09-04 01:36:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920975661
2025-09-04 01:36:15 | uvicorn.error | INFO | connection open
2025-09-04 01:36:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:19 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920979659
2025-09-04 01:36:19 | uvicorn.error | INFO | connection open
2025-09-04 01:36:20 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:23 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920983666
2025-09-04 01:36:23 | uvicorn.error | INFO | connection open
2025-09-04 01:36:24 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:27 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920987686
2025-09-04 01:36:27 | uvicorn.error | INFO | connection open
2025-09-04 01:36:28 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:31 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920991675
2025-09-04 01:36:31 | uvicorn.error | INFO | connection open
2025-09-04 01:36:32 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920995673
2025-09-04 01:36:35 | uvicorn.error | INFO | connection open
2025-09-04 01:36:36 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:39 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756920999665
2025-09-04 01:36:39 | uvicorn.error | INFO | connection open
2025-09-04 01:36:40 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921003657
2025-09-04 01:36:43 | uvicorn.error | INFO | connection open
2025-09-04 01:36:44 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921007666
2025-09-04 01:36:47 | uvicorn.error | INFO | connection open
2025-09-04 01:36:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921011670
2025-09-04 01:36:51 | uvicorn.error | INFO | connection open
2025-09-04 01:36:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921015649
2025-09-04 01:36:55 | uvicorn.error | INFO | connection open
2025-09-04 01:36:56 | uvicorn.error | INFO | connection closed
2025-09-04 01:36:59 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921019646
2025-09-04 01:36:59 | uvicorn.error | INFO | connection open
2025-09-04 01:37:00 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921023653
2025-09-04 01:37:03 | uvicorn.error | INFO | connection open
2025-09-04 01:37:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921027650
2025-09-04 01:37:07 | uvicorn.error | INFO | connection open
2025-09-04 01:37:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921031665
2025-09-04 01:37:11 | uvicorn.error | INFO | connection open
2025-09-04 01:37:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921035892
2025-09-04 01:37:15 | uvicorn.error | INFO | connection open
2025-09-04 01:37:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:20 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921040678
2025-09-04 01:37:20 | uvicorn.error | INFO | connection open
2025-09-04 01:37:21 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921044660
2025-09-04 01:37:24 | uvicorn.error | INFO | connection open
2025-09-04 01:37:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921048656
2025-09-04 01:37:28 | uvicorn.error | INFO | connection open
2025-09-04 01:37:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:32 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921052669
2025-09-04 01:37:32 | uvicorn.error | INFO | connection open
2025-09-04 01:37:33 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921056655
2025-09-04 01:37:36 | uvicorn.error | INFO | connection open
2025-09-04 01:37:37 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921060673
2025-09-04 01:37:40 | uvicorn.error | INFO | connection open
2025-09-04 01:37:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921064666
2025-09-04 01:37:44 | uvicorn.error | INFO | connection open
2025-09-04 01:37:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:48 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921068677
2025-09-04 01:37:48 | uvicorn.error | INFO | connection open
2025-09-04 01:37:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921073545
2025-09-04 01:37:53 | uvicorn.error | INFO | connection open
2025-09-04 01:37:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:37:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921077670
2025-09-04 01:37:57 | uvicorn.error | INFO | connection open
2025-09-04 01:37:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921081674
2025-09-04 01:38:01 | uvicorn.error | INFO | connection open
2025-09-04 01:38:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921085674
2025-09-04 01:38:05 | uvicorn.error | INFO | connection open
2025-09-04 01:38:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921089680
2025-09-04 01:38:09 | uvicorn.error | INFO | connection open
2025-09-04 01:38:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921093672
2025-09-04 01:38:13 | uvicorn.error | INFO | connection open
2025-09-04 01:38:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921097694
2025-09-04 01:38:17 | uvicorn.error | INFO | connection open
2025-09-04 01:38:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921101665
2025-09-04 01:38:21 | uvicorn.error | INFO | connection open
2025-09-04 01:38:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921105668
2025-09-04 01:38:25 | uvicorn.error | INFO | connection open
2025-09-04 01:38:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921109667
2025-09-04 01:38:29 | uvicorn.error | INFO | connection open
2025-09-04 01:38:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921113683
2025-09-04 01:38:33 | uvicorn.error | INFO | connection open
2025-09-04 01:38:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921117660
2025-09-04 01:38:37 | uvicorn.error | INFO | connection open
2025-09-04 01:38:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921121663
2025-09-04 01:38:41 | uvicorn.error | INFO | connection open
2025-09-04 01:38:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921125658
2025-09-04 01:38:45 | uvicorn.error | INFO | connection open
2025-09-04 01:38:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:50 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921130648
2025-09-04 01:38:50 | uvicorn.error | INFO | connection open
2025-09-04 01:38:51 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:54 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921134670
2025-09-04 01:38:54 | uvicorn.error | INFO | connection open
2025-09-04 01:38:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:38:58 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921138672
2025-09-04 01:38:58 | uvicorn.error | INFO | connection open
2025-09-04 01:38:59 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:02 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921142670
2025-09-04 01:39:02 | uvicorn.error | INFO | connection open
2025-09-04 01:39:03 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921147674
2025-09-04 01:39:07 | uvicorn.error | INFO | connection open
2025-09-04 01:39:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921151665
2025-09-04 01:39:11 | uvicorn.error | INFO | connection open
2025-09-04 01:39:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921155654
2025-09-04 01:39:15 | uvicorn.error | INFO | connection open
2025-09-04 01:39:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:20 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921160649
2025-09-04 01:39:20 | uvicorn.error | INFO | connection open
2025-09-04 01:39:21 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921164657
2025-09-04 01:39:24 | uvicorn.error | INFO | connection open
2025-09-04 01:39:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921168658
2025-09-04 01:39:28 | uvicorn.error | INFO | connection open
2025-09-04 01:39:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:32 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921172674
2025-09-04 01:39:32 | uvicorn.error | INFO | connection open
2025-09-04 01:39:33 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921176656
2025-09-04 01:39:36 | uvicorn.error | INFO | connection open
2025-09-04 01:39:37 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921180682
2025-09-04 01:39:40 | uvicorn.error | INFO | connection open
2025-09-04 01:39:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921184679
2025-09-04 01:39:44 | uvicorn.error | INFO | connection open
2025-09-04 01:39:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:48 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921188680
2025-09-04 01:39:48 | uvicorn.error | INFO | connection open
2025-09-04 01:39:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921192658
2025-09-04 01:39:52 | uvicorn.error | INFO | connection open
2025-09-04 01:39:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:39:56 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921196669
2025-09-04 01:39:56 | uvicorn.error | INFO | connection open
2025-09-04 01:39:57 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:00 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921200657
2025-09-04 01:40:00 | uvicorn.error | INFO | connection open
2025-09-04 01:40:01 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:04 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921204677
2025-09-04 01:40:04 | uvicorn.error | INFO | connection open
2025-09-04 01:40:05 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:08 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921208650
2025-09-04 01:40:08 | uvicorn.error | INFO | connection open
2025-09-04 01:40:09 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:12 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921212654
2025-09-04 01:40:12 | uvicorn.error | INFO | connection open
2025-09-04 01:40:13 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:16 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921216664
2025-09-04 01:40:16 | uvicorn.error | INFO | connection open
2025-09-04 01:40:17 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:20 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921220654
2025-09-04 01:40:20 | uvicorn.error | INFO | connection open
2025-09-04 01:40:21 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921224665
2025-09-04 01:40:24 | uvicorn.error | INFO | connection open
2025-09-04 01:40:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921228666
2025-09-04 01:40:28 | uvicorn.error | INFO | connection open
2025-09-04 01:40:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:32 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921232649
2025-09-04 01:40:32 | uvicorn.error | INFO | connection open
2025-09-04 01:40:33 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:36 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921236657
2025-09-04 01:40:36 | uvicorn.error | INFO | connection open
2025-09-04 01:40:37 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:40 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921240654
2025-09-04 01:40:40 | uvicorn.error | INFO | connection open
2025-09-04 01:40:41 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:44 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921244667
2025-09-04 01:40:44 | uvicorn.error | INFO | connection open
2025-09-04 01:40:45 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:48 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921248655
2025-09-04 01:40:48 | uvicorn.error | INFO | connection open
2025-09-04 01:40:49 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921252663
2025-09-04 01:40:52 | uvicorn.error | INFO | connection open
2025-09-04 01:40:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:40:56 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921256664
2025-09-04 01:40:56 | uvicorn.error | INFO | connection open
2025-09-04 01:40:57 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:00 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921260663
2025-09-04 01:41:00 | uvicorn.error | INFO | connection open
2025-09-04 01:41:01 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:04 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921264667
2025-09-04 01:41:04 | uvicorn.error | INFO | connection open
2025-09-04 01:41:05 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:08 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921268668
2025-09-04 01:41:08 | uvicorn.error | INFO | connection open
2025-09-04 01:41:09 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:12 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921272665
2025-09-04 01:41:12 | uvicorn.error | INFO | connection open
2025-09-04 01:41:13 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:16 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921276672
2025-09-04 01:41:16 | uvicorn.error | INFO | connection open
2025-09-04 01:41:17 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:20 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921280660
2025-09-04 01:41:20 | uvicorn.error | INFO | connection open
2025-09-04 01:41:21 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:24 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921284666
2025-09-04 01:41:24 | uvicorn.error | INFO | connection open
2025-09-04 01:41:25 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:28 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921288664
2025-09-04 01:41:28 | uvicorn.error | INFO | connection open
2025-09-04 01:41:29 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921293672
2025-09-04 01:41:33 | uvicorn.error | INFO | connection open
2025-09-04 01:41:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921297682
2025-09-04 01:41:37 | uvicorn.error | INFO | connection open
2025-09-04 01:41:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921301662
2025-09-04 01:41:41 | uvicorn.error | INFO | connection open
2025-09-04 01:41:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921305681
2025-09-04 01:41:45 | uvicorn.error | INFO | connection open
2025-09-04 01:41:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921309667
2025-09-04 01:41:49 | uvicorn.error | INFO | connection open
2025-09-04 01:41:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921313671
2025-09-04 01:41:53 | uvicorn.error | INFO | connection open
2025-09-04 01:41:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:41:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921317674
2025-09-04 01:41:57 | uvicorn.error | INFO | connection open
2025-09-04 01:41:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921321670
2025-09-04 01:42:01 | uvicorn.error | INFO | connection open
2025-09-04 01:42:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921325674
2025-09-04 01:42:05 | uvicorn.error | INFO | connection open
2025-09-04 01:42:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921329649
2025-09-04 01:42:09 | uvicorn.error | INFO | connection open
2025-09-04 01:42:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921333660
2025-09-04 01:42:13 | uvicorn.error | INFO | connection open
2025-09-04 01:42:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921337661
2025-09-04 01:42:17 | uvicorn.error | INFO | connection open
2025-09-04 01:42:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921341649
2025-09-04 01:42:21 | uvicorn.error | INFO | connection open
2025-09-04 01:42:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921345664
2025-09-04 01:42:25 | uvicorn.error | INFO | connection open
2025-09-04 01:42:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921349659
2025-09-04 01:42:29 | uvicorn.error | INFO | connection open
2025-09-04 01:42:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921353672
2025-09-04 01:42:33 | uvicorn.error | INFO | connection open
2025-09-04 01:42:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921357665
2025-09-04 01:42:37 | uvicorn.error | INFO | connection open
2025-09-04 01:42:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921361659
2025-09-04 01:42:41 | uvicorn.error | INFO | connection open
2025-09-04 01:42:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921365682
2025-09-04 01:42:45 | uvicorn.error | INFO | connection open
2025-09-04 01:42:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:52 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921372833
2025-09-04 01:42:52 | uvicorn.error | INFO | connection open
2025-09-04 01:42:53 | uvicorn.error | INFO | connection closed
2025-09-04 01:42:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921377678
2025-09-04 01:42:57 | uvicorn.error | INFO | connection open
2025-09-04 01:42:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921381673
2025-09-04 01:43:01 | uvicorn.error | INFO | connection open
2025-09-04 01:43:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921385655
2025-09-04 01:43:05 | uvicorn.error | INFO | connection open
2025-09-04 01:43:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921389666
2025-09-04 01:43:09 | uvicorn.error | INFO | connection open
2025-09-04 01:43:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921393673
2025-09-04 01:43:13 | uvicorn.error | INFO | connection open
2025-09-04 01:43:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921397650
2025-09-04 01:43:17 | uvicorn.error | INFO | connection open
2025-09-04 01:43:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921401651
2025-09-04 01:43:21 | uvicorn.error | INFO | connection open
2025-09-04 01:43:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921405659
2025-09-04 01:43:25 | uvicorn.error | INFO | connection open
2025-09-04 01:43:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921409667
2025-09-04 01:43:29 | uvicorn.error | INFO | connection open
2025-09-04 01:43:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921413679
2025-09-04 01:43:33 | uvicorn.error | INFO | connection open
2025-09-04 01:43:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921417661
2025-09-04 01:43:37 | uvicorn.error | INFO | connection open
2025-09-04 01:43:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921421657
2025-09-04 01:43:41 | uvicorn.error | INFO | connection open
2025-09-04 01:43:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921425682
2025-09-04 01:43:45 | uvicorn.error | INFO | connection open
2025-09-04 01:43:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921429682
2025-09-04 01:43:49 | uvicorn.error | INFO | connection open
2025-09-04 01:43:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921433660
2025-09-04 01:43:53 | uvicorn.error | INFO | connection open
2025-09-04 01:43:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:43:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921437668
2025-09-04 01:43:57 | uvicorn.error | INFO | connection open
2025-09-04 01:43:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921441662
2025-09-04 01:44:01 | uvicorn.error | INFO | connection open
2025-09-04 01:44:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921445668
2025-09-04 01:44:05 | uvicorn.error | INFO | connection open
2025-09-04 01:44:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921449661
2025-09-04 01:44:09 | uvicorn.error | INFO | connection open
2025-09-04 01:44:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921453675
2025-09-04 01:44:13 | uvicorn.error | INFO | connection open
2025-09-04 01:44:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921457689
2025-09-04 01:44:17 | uvicorn.error | INFO | connection open
2025-09-04 01:44:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921461682
2025-09-04 01:44:21 | uvicorn.error | INFO | connection open
2025-09-04 01:44:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921465675
2025-09-04 01:44:25 | uvicorn.error | INFO | connection open
2025-09-04 01:44:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921469683
2025-09-04 01:44:29 | uvicorn.error | INFO | connection open
2025-09-04 01:44:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921473664
2025-09-04 01:44:33 | uvicorn.error | INFO | connection open
2025-09-04 01:44:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921477669
2025-09-04 01:44:37 | uvicorn.error | INFO | connection open
2025-09-04 01:44:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921481648
2025-09-04 01:44:41 | uvicorn.error | INFO | connection open
2025-09-04 01:44:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921485667
2025-09-04 01:44:45 | uvicorn.error | INFO | connection open
2025-09-04 01:44:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921489667
2025-09-04 01:44:49 | uvicorn.error | INFO | connection open
2025-09-04 01:44:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921493650
2025-09-04 01:44:53 | uvicorn.error | INFO | connection open
2025-09-04 01:44:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:44:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921497648
2025-09-04 01:44:57 | uvicorn.error | INFO | connection open
2025-09-04 01:44:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921501650
2025-09-04 01:45:01 | uvicorn.error | INFO | connection open
2025-09-04 01:45:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921505673
2025-09-04 01:45:05 | uvicorn.error | INFO | connection open
2025-09-04 01:45:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921509668
2025-09-04 01:45:09 | uvicorn.error | INFO | connection open
2025-09-04 01:45:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921513664
2025-09-04 01:45:13 | uvicorn.error | INFO | connection open
2025-09-04 01:45:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921517664
2025-09-04 01:45:17 | uvicorn.error | INFO | connection open
2025-09-04 01:45:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921521659
2025-09-04 01:45:21 | uvicorn.error | INFO | connection open
2025-09-04 01:45:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921525682
2025-09-04 01:45:25 | uvicorn.error | INFO | connection open
2025-09-04 01:45:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921529662
2025-09-04 01:45:29 | uvicorn.error | INFO | connection open
2025-09-04 01:45:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921533659
2025-09-04 01:45:33 | uvicorn.error | INFO | connection open
2025-09-04 01:45:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921537659
2025-09-04 01:45:37 | uvicorn.error | INFO | connection open
2025-09-04 01:45:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921541649
2025-09-04 01:45:41 | uvicorn.error | INFO | connection open
2025-09-04 01:45:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921545651
2025-09-04 01:45:45 | uvicorn.error | INFO | connection open
2025-09-04 01:45:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921549665
2025-09-04 01:45:49 | uvicorn.error | INFO | connection open
2025-09-04 01:45:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:53 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921553649
2025-09-04 01:45:53 | uvicorn.error | INFO | connection open
2025-09-04 01:45:54 | uvicorn.error | INFO | connection closed
2025-09-04 01:45:57 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921557656
2025-09-04 01:45:57 | uvicorn.error | INFO | connection open
2025-09-04 01:45:58 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:01 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921561650
2025-09-04 01:46:01 | uvicorn.error | INFO | connection open
2025-09-04 01:46:02 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:05 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921565665
2025-09-04 01:46:05 | uvicorn.error | INFO | connection open
2025-09-04 01:46:06 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:09 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921569659
2025-09-04 01:46:09 | uvicorn.error | INFO | connection open
2025-09-04 01:46:10 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:13 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921573651
2025-09-04 01:46:13 | uvicorn.error | INFO | connection open
2025-09-04 01:46:14 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:17 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921577666
2025-09-04 01:46:17 | uvicorn.error | INFO | connection open
2025-09-04 01:46:18 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:21 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921581665
2025-09-04 01:46:21 | uvicorn.error | INFO | connection open
2025-09-04 01:46:22 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:25 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921585657
2025-09-04 01:46:25 | uvicorn.error | INFO | connection open
2025-09-04 01:46:26 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:29 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921589659
2025-09-04 01:46:29 | uvicorn.error | INFO | connection open
2025-09-04 01:46:30 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:33 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921593661
2025-09-04 01:46:33 | uvicorn.error | INFO | connection open
2025-09-04 01:46:34 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:37 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921597672
2025-09-04 01:46:37 | uvicorn.error | INFO | connection open
2025-09-04 01:46:38 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:41 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921601670
2025-09-04 01:46:41 | uvicorn.error | INFO | connection open
2025-09-04 01:46:42 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:45 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921605667
2025-09-04 01:46:45 | uvicorn.error | INFO | connection open
2025-09-04 01:46:46 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:49 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921609680
2025-09-04 01:46:49 | uvicorn.error | INFO | connection open
2025-09-04 01:46:50 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921615255
2025-09-04 01:46:55 | uvicorn.error | INFO | connection open
2025-09-04 01:46:55 | uvicorn.error | INFO | connection closed
2025-09-04 01:46:59 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921619668
2025-09-04 01:46:59 | uvicorn.error | INFO | connection open
2025-09-04 01:47:00 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921623660
2025-09-04 01:47:03 | uvicorn.error | INFO | connection open
2025-09-04 01:47:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921627668
2025-09-04 01:47:07 | uvicorn.error | INFO | connection open
2025-09-04 01:47:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921631658
2025-09-04 01:47:11 | uvicorn.error | INFO | connection open
2025-09-04 01:47:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921635657
2025-09-04 01:47:15 | uvicorn.error | INFO | connection open
2025-09-04 01:47:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:19 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921639673
2025-09-04 01:47:19 | uvicorn.error | INFO | connection open
2025-09-04 01:47:20 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:23 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921643660
2025-09-04 01:47:23 | uvicorn.error | INFO | connection open
2025-09-04 01:47:24 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:27 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921647683
2025-09-04 01:47:27 | uvicorn.error | INFO | connection open
2025-09-04 01:47:28 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:31 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921651678
2025-09-04 01:47:31 | uvicorn.error | INFO | connection open
2025-09-04 01:47:32 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921655682
2025-09-04 01:47:35 | uvicorn.error | INFO | connection open
2025-09-04 01:47:36 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:39 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921659676
2025-09-04 01:47:39 | uvicorn.error | INFO | connection open
2025-09-04 01:47:40 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921663662
2025-09-04 01:47:43 | uvicorn.error | INFO | connection open
2025-09-04 01:47:44 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921667663
2025-09-04 01:47:47 | uvicorn.error | INFO | connection open
2025-09-04 01:47:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921671672
2025-09-04 01:47:51 | uvicorn.error | INFO | connection open
2025-09-04 01:47:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921675662
2025-09-04 01:47:55 | uvicorn.error | INFO | connection open
2025-09-04 01:47:56 | uvicorn.error | INFO | connection closed
2025-09-04 01:47:59 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921679670
2025-09-04 01:47:59 | uvicorn.error | INFO | connection open
2025-09-04 01:48:00 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921683661
2025-09-04 01:48:03 | uvicorn.error | INFO | connection open
2025-09-04 01:48:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921687691
2025-09-04 01:48:07 | uvicorn.error | INFO | connection open
2025-09-04 01:48:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921691656
2025-09-04 01:48:11 | uvicorn.error | INFO | connection open
2025-09-04 01:48:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921695670
2025-09-04 01:48:15 | uvicorn.error | INFO | connection open
2025-09-04 01:48:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:19 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921699683
2025-09-04 01:48:19 | uvicorn.error | INFO | connection open
2025-09-04 01:48:20 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:23 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921703660
2025-09-04 01:48:23 | uvicorn.error | INFO | connection open
2025-09-04 01:48:24 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:27 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921707681
2025-09-04 01:48:27 | uvicorn.error | INFO | connection open
2025-09-04 01:48:28 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:31 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921711668
2025-09-04 01:48:31 | uvicorn.error | INFO | connection open
2025-09-04 01:48:32 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921715666
2025-09-04 01:48:35 | uvicorn.error | INFO | connection open
2025-09-04 01:48:36 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:39 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921719666
2025-09-04 01:48:39 | uvicorn.error | INFO | connection open
2025-09-04 01:48:40 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921723680
2025-09-04 01:48:43 | uvicorn.error | INFO | connection open
2025-09-04 01:48:44 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921727659
2025-09-04 01:48:47 | uvicorn.error | INFO | connection open
2025-09-04 01:48:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921731667
2025-09-04 01:48:51 | uvicorn.error | INFO | connection open
2025-09-04 01:48:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921735668
2025-09-04 01:48:55 | uvicorn.error | INFO | connection open
2025-09-04 01:48:56 | uvicorn.error | INFO | connection closed
2025-09-04 01:48:59 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921739662
2025-09-04 01:48:59 | uvicorn.error | INFO | connection open
2025-09-04 01:49:00 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921743669
2025-09-04 01:49:03 | uvicorn.error | INFO | connection open
2025-09-04 01:49:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921747674
2025-09-04 01:49:07 | uvicorn.error | INFO | connection open
2025-09-04 01:49:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921751661
2025-09-04 01:49:11 | uvicorn.error | INFO | connection open
2025-09-04 01:49:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921755658
2025-09-04 01:49:15 | uvicorn.error | INFO | connection open
2025-09-04 01:49:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:19 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921759666
2025-09-04 01:49:19 | uvicorn.error | INFO | connection open
2025-09-04 01:49:20 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:23 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921763668
2025-09-04 01:49:23 | uvicorn.error | INFO | connection open
2025-09-04 01:49:24 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:27 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921767686
2025-09-04 01:49:27 | uvicorn.error | INFO | connection open
2025-09-04 01:49:28 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:31 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921771667
2025-09-04 01:49:31 | uvicorn.error | INFO | connection open
2025-09-04 01:49:32 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921775666
2025-09-04 01:49:35 | uvicorn.error | INFO | connection open
2025-09-04 01:49:36 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:39 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921779675
2025-09-04 01:49:39 | uvicorn.error | INFO | connection open
2025-09-04 01:49:40 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921783678
2025-09-04 01:49:43 | uvicorn.error | INFO | connection open
2025-09-04 01:49:44 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921787673
2025-09-04 01:49:47 | uvicorn.error | INFO | connection open
2025-09-04 01:49:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921791661
2025-09-04 01:49:51 | uvicorn.error | INFO | connection open
2025-09-04 01:49:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921795686
2025-09-04 01:49:55 | uvicorn.error | INFO | connection open
2025-09-04 01:49:56 | uvicorn.error | INFO | connection closed
2025-09-04 01:49:59 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921799674
2025-09-04 01:49:59 | uvicorn.error | INFO | connection open
2025-09-04 01:50:00 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:03 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921803674
2025-09-04 01:50:03 | uvicorn.error | INFO | connection open
2025-09-04 01:50:04 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:07 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921807668
2025-09-04 01:50:07 | uvicorn.error | INFO | connection open
2025-09-04 01:50:08 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:11 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921811666
2025-09-04 01:50:11 | uvicorn.error | INFO | connection open
2025-09-04 01:50:12 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:15 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921815670
2025-09-04 01:50:15 | uvicorn.error | INFO | connection open
2025-09-04 01:50:16 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:19 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921819657
2025-09-04 01:50:19 | uvicorn.error | INFO | connection open
2025-09-04 01:50:20 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:23 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921823671
2025-09-04 01:50:23 | uvicorn.error | INFO | connection open
2025-09-04 01:50:24 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:27 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921827677
2025-09-04 01:50:27 | uvicorn.error | INFO | connection open
2025-09-04 01:50:28 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:31 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921831650
2025-09-04 01:50:31 | uvicorn.error | INFO | connection open
2025-09-04 01:50:32 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:35 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921835650
2025-09-04 01:50:35 | uvicorn.error | INFO | connection open
2025-09-04 01:50:36 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:39 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921839670
2025-09-04 01:50:39 | uvicorn.error | INFO | connection open
2025-09-04 01:50:40 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:43 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921843663
2025-09-04 01:50:43 | uvicorn.error | INFO | connection open
2025-09-04 01:50:44 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:47 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921847668
2025-09-04 01:50:47 | uvicorn.error | INFO | connection open
2025-09-04 01:50:48 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:51 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921851663
2025-09-04 01:50:51 | uvicorn.error | INFO | connection open
2025-09-04 01:50:52 | uvicorn.error | INFO | connection closed
2025-09-04 01:50:55 | uvicorn.error | INFO | 167.234.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756921855672
2025-09-04 01:50:55 | uvicorn.error | INFO | connection open
2025-09-04 01:50:56 | uvicorn.error | INFO | connection closed
2025-09-04 02:32:33 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/aaa9", "path": "/aaa9", "client_ip": "188.166.***.***.***", "user_agent": "Mozilla/5.0 zgrab/0.x", "timestamp": "2025-09-03T18:32:33.315174", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 zgrab/0.x", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-04 02:32:33 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 02:32:33 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /aaa9
2025-09-04 02:32:33.316 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 02:32:33.316 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 404
2025-09-04 02:32:33 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/aaa9", "status_code": 404, "duration": 1.93, "timestamp": "2025-09-03T18:32:33.317073"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('188.166.68.252:55302', 'GET', '/aaa9', '1.1', 404)
2025-09-04 02:32:34 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/aab8", "path": "/aab8", "client_ip": "188.166.***.***.***", "user_agent": "Mozilla/5.0 zgrab/0.x", "timestamp": "2025-09-03T18:32:34.755271", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 zgrab/0.x", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-04 02:32:34 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 02:32:34 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /aab8
2025-09-04 02:32:34.756 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 02:32:34.756 | WARNING  | app.middleware.structured_logging:log_request_end:181 - Client error: 404
2025-09-04 02:32:34 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/aab8", "status_code": 404, "duration": 1.83, "timestamp": "2025-09-03T18:32:34.757063"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('188.166.68.252:55308', 'GET', '/aab8', '1.1', 404)
2025-09-04 02:32:36 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "188.166.***.***.***", "user_agent": "Mozilla/5.0 zgrab/0.x", "timestamp": "2025-09-03T18:32:36.230558", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 zgrab/0.x", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-04 02:32:36 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 02:32:36 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-04 02:32:36.231 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 02:32:36.232 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-04 02:32:36 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 2.28, "timestamp": "2025-09-03T18:32:36.232793"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('188.166.68.252:55314', 'GET', '/', '1.1', 200)
2025-09-04 04:11:51 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "3.143.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Chrome/126.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T20:11:51.862682", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Chrome/126.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-04 04:11:51 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 04:11:51 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-04 04:11:51.863 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 04:11:51.864 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-04 04:11:51 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 1.96, "timestamp": "2025-09-03T20:11:51.864614"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('3.143.33.63:55832', 'GET', '/', '1.1', 200)
2025-09-04 04:11:52 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***:8001/", "path": "/", "client_ip": "3.143.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Chrome/126.0.***.***.*** Safari/537.36", "timestamp": "2025-09-03T20:11:52.032529", "headers": {"host": "43.167.***.***.***:8001", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Chrome/126.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip"}, "query_params": {}}
2025-09-04 04:11:52 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 04:11:52 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /
2025-09-04 04:11:52.034 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 04:11:52.035 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-04 04:11:52 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/", "status_code": 200, "duration": 3.2, "timestamp": "2025-09-03T20:11:52.035707"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('3.143.33.63:55848', 'GET', '/', '1.1', 200)
2025-09-04 04:14:22 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-04 04:16:42 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-04 04:17:04 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-04 05:51:29 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-04 06:17:42 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-04 08:15:57 | uvicorn.error | WARNING | Invalid HTTP request received.
2025-09-04 11:26:05 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956365175
2025-09-04 11:26:05 | uvicorn.error | INFO | connection open
2025-09-04 11:26:05 | uvicorn.error | INFO | connection closed
2025-09-04 11:26:25 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:26:25.091568", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...vfSrrs", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-04 11:26:25 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:26:25 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:26:25 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-04 11:26:25.092 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:26:25.098 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.006s
2025-09-04 11:26:25 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 6.96, "timestamp": "2025-09-04T03:26:25.098500"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-04 11:26:25 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:26:25.192631", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...vfSrrs", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "developer"}}
2025-09-04 11:26:25 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:26:25 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:26:25 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-04 11:26:25.193 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:26:25.200 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.006s
2025-09-04 11:26:25 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 7.87, "timestamp": "2025-09-04T03:26:25.200478"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-04 11:26:31 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956391713
2025-09-04 11:26:31 | uvicorn.error | INFO | connection open
2025-09-04 11:26:32 | uvicorn.error | INFO | connection closed
2025-09-04 11:26:37 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956397529
2025-09-04 11:26:37 | uvicorn.error | INFO | connection open
2025-09-04 11:26:38 | uvicorn.error | INFO | connection closed
2025-09-04 11:31:50 | uvicorn.error | INFO | 127.0.***.***.***:38364 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956710637
2025-09-04 11:31:50 | uvicorn.error | INFO | connection open
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 测试消息...
📡 调用AIService.chat_completion...
2025-09-04 11:31:50 | uvicorn.error | INFO | connection closed
2025-09-04 11:31:50.644 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:3afffcdd-ac2d-4f87-aa36-63980a3d8ba1, 窗口:10, 策略:default_fallback
2025-09-04 11:31:50 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='3afffcdd-ac2d-4f87-aa36-63980a3d8ba1', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-04 11:31:50 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-04 11:31:50 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.01, remaining=99.99
2025-09-04 11:31:50 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-04 11:31:50 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-04 11:31:50 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-04T03:31:50.648477",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 99.69333333333333,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $99.99 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 21.999226471944446 (score: 100.0)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "3afffcdd-ac2d-4f87-aa36-63980a3d8ba1",
    "priority": 100
  }
}
2025-09-04 11:31:50 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 99.69)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-04 11:31:50 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 11:31:50 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-04 11:31:50.652 | INFO     | app.ai.core.claude_client:chat_completion:476 - 🔄 使用直接请求模式(绕过代理重试)
2025-09-04 11:31:59.471 | DEBUG    | app.ai.core.claude_client:_make_request:301 - Claude API请求成功 - Token使用: 824, 响应时间: 8818.52ms
2025-09-04 11:31:59.485 | DEBUG    | app.services.ai_service:_save_usage_stats:949 - AI使用统计 - 用户ID: 6, 实际API成本: $0.006840, 用户计费成本: $0.013680 (2倍计费)
2025-09-04 11:31:59.494 | ERROR    | app.main:websocket_realtime_endpoint:610 - AI聊天处理错误: 
📨 AI服务返回结果: {"content": "\u60a8\u597d\uff01\u6211\u662fTrademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684\u4e13\u4e1aAI\u52a9\u624b \ud83e\udd16\n\n\u5f88\u9ad8\u5174\u4e3a\u60a8\u670d\u52a1\uff01\u6211\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u4ee5\u4e0b\u4e13\u4e1a\u670d\u52a1\uff1a\n\n## \ud83c\udfaf \u6211\u7684\u4e13\u4e1a\u80fd\u529b\n- **\u7b56\u7565\u5f00\u53d1** \ud83d\udcc8 Python\u91cf\u5316\u7b56\u7565\u7f16\u5199\u4e0e\u4f18\u5316\n- **\u5e02\u573a\u5206\u6790** \ud83d\udcca \u6280\u672f\u5206\u6790\
📤 发送WebSocket响应: {"type": "ai_chat_success", "request_id": "1234", "response": "\u60a8\u597d\uff01\u6211\u662fTrademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\u7684\u4e13\u4e1aAI\u52a9\u624b \ud83e\udd16\n\n\u5f88\u9ad8\u5174\u4e3a\u60a8\u670d\u52a1\uff01\u6211\u53ef\u4ee5\u4e3a\u60a8\u63d0\u4f9b\u4ee5\u4e0b\u4e13\u4e1a\u670d\u52a1\uff1a\n\n## \ud83c\udfaf \u6211\u7684\u4e13\u4e1a\u80fd\u529b\n- **\u7b56\u7565\u5f00\u53d1** \ud83d\udcc8 Python\u91cf\u5316\u7b56\u7565\u7f16\u5199\u4e0e\u4f18\u5316\n- **\u5e02\u573a\u5
❌ 数据库错误: 
WebSocket消息处理错误: Cannot call "send" once a close message has been sent.
❌ WebSocket连接已断开: conn_1756956710637 (用户: 6)
2025-09-04 11:32:50 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956770644
2025-09-04 11:32:50 | uvicorn.error | INFO | connection open
2025-09-04 11:32:51 | uvicorn.error | INFO | connection closed
2025-09-04 11:33:02 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956782588
2025-09-04 11:33:02 | uvicorn.error | INFO | connection open
2025-09-04 11:33:03 | uvicorn.error | INFO | connection closed
2025-09-04 11:33:25 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956805152
2025-09-04 11:33:25 | uvicorn.error | INFO | connection open
2025-09-04 11:33:25 | uvicorn.error | INFO | connection closed
2025-09-04 11:33:40 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:33:40.074269", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-04 11:33:40 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:33:40 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:33:40 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-04 11:33:40.075 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:33:40.079 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-04 11:33:40 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 5.32, "timestamp": "2025-09-04T03:33:40.079561"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-04 11:33:40 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:33:40.188151", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "developer"}}
2025-09-04 11:33:40 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:33:40 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:33:40 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-04 11:33:40.189 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:33:40.192 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-04 11:33:40 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 4.47, "timestamp": "2025-09-04T03:33:40.192594"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-04 11:33:55 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956835046
2025-09-04 11:33:55 | uvicorn.error | INFO | connection open
2025-09-04 11:33:55 | uvicorn.error | INFO | connection closed
2025-09-04 11:34:34 | uvicorn.error | INFO | 43.167.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956874109
2025-09-04 11:34:34 | uvicorn.error | INFO | connection open
WebSocket消息处理错误: (1000, '')
❌ WebSocket连接已断开: conn_1756956874109 (用户: 6)
2025-09-04 11:34:34 | uvicorn.error | INFO | connection closed
2025-09-04 11:34:50 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956890932
2025-09-04 11:34:50 | uvicorn.error | INFO | connection open
2025-09-04 11:34:51 | uvicorn.error | INFO | connection closed
2025-09-04 11:35:04 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/chat/history?session_id=f81b6cba-120b-48cf-9cda-c0659d958931&limit=20", "path": "/api/v1/ai/chat/history", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:35:04.619010", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"session_id": "f81b6cba-120b-48cf-9cda-c0659d958931", "limit": "20"}}
2025-09-04 11:35:04 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:35:04 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:35:04 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/chat/history
2025-09-04 11:35:04.620 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:35:04.624 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-04 11:35:04 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/chat/history", "status_code": 200, "duration": 5.47, "timestamp": "2025-09-04T03:35:04.624457"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/chat/history?session_id=f81b6cba-120b-48cf-9cda-c0659d958931&limit=20', '1.0', 200)
2025-09-04 11:35:10 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756956910900
2025-09-04 11:35:10 | uvicorn.error | INFO | connection open
2025-09-04 11:35:11 | uvicorn.error | INFO | connection closed
2025-09-04 11:35:15 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/chat/history?session_id=f81b6cba-120b-48cf-9cda-c0659d958931&limit=20", "path": "/api/v1/ai/chat/history", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:35:15.324607", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"session_id": "f81b6cba-120b-48cf-9cda-c0659d958931", "limit": "20"}}
2025-09-04 11:35:15 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:35:15 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:35:15 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/chat/history
2025-09-04 11:35:15.325 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:35:15.328 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-04 11:35:15 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/chat/history", "status_code": 200, "duration": 4.46, "timestamp": "2025-09-04T03:35:15.329038"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/chat/history?session_id=f81b6cba-120b-48cf-9cda-c0659d958931&limit=20', '1.0', 200)
2025-09-04 11:38:57 | uvicorn.error | INFO | 43.167.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957137627
2025-09-04 11:38:57 | uvicorn.error | INFO | connection open
WebSocket消息处理错误: (1000, '')
❌ WebSocket连接已断开: conn_1756957137627 (用户: 6)
2025-09-04 11:38:57 | uvicorn.error | INFO | connection closed
2025-09-04 11:39:08 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957148374
2025-09-04 11:39:08 | uvicorn.error | INFO | connection open
2025-09-04 11:39:08 | uvicorn.error | INFO | connection closed
2025-09-04 11:39:44 | uvicorn.error | INFO | 43.167.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957184760
2025-09-04 11:39:44 | uvicorn.error | INFO | connection open
WebSocket消息处理错误: (1000, '')
❌ WebSocket连接已断开: conn_1756957184760 (用户: 6)
2025-09-04 11:39:44 | uvicorn.error | INFO | connection closed
2025-09-04 11:40:12 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957212708
2025-09-04 11:40:12 | uvicorn.error | INFO | connection open
2025-09-04 11:40:13 | uvicorn.error | INFO | connection closed
2025-09-04 11:41:06 | uvicorn.error | INFO | 43.167.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957266834
2025-09-04 11:41:06 | uvicorn.error | INFO | connection open
WebSocket消息处理错误: (1000, '')
❌ WebSocket连接已断开: conn_1756957266834 (用户: 6)
2025-09-04 11:41:06 | uvicorn.error | INFO | connection closed
2025-09-04 11:41:37 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957297696
2025-09-04 11:41:37 | uvicorn.error | INFO | connection open
2025-09-04 11:41:38 | uvicorn.error | INFO | connection closed
2025-09-04 11:41:50 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957310000
2025-09-04 11:41:50 | uvicorn.error | INFO | connection open
2025-09-04 11:41:50 | uvicorn.error | INFO | connection closed
2025-09-04 11:43:12 | uvicorn.error | INFO | 43.167.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957392287
2025-09-04 11:43:12 | uvicorn.error | INFO | connection open
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 你好，这是一个WebSocket连接测试...
📡 调用AIService.chat_completion...
2025-09-04 11:43:12 | uvicorn.error | INFO | connection closed
2025-09-04 11:43:12.295 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:677c30be-2379-4687-9782-2470e51d204e, 窗口:10, 策略:default_fallback
2025-09-04 11:43:12 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='677c30be-2379-4687-9782-2470e51d204e', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-04 11:43:12 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-04 11:43:12 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.03, remaining=99.97
2025-09-04 11:43:12 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-04 11:43:12 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-04 11:43:12 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-04T03:43:12.299300",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 99.69333333333333,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $99.97 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 22.18857392277778 (score: 100.0)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "677c30be-2379-4687-9782-2470e51d204e",
    "priority": 100
  }
}
2025-09-04 11:43:12 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 99.69)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-04 11:43:12 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 11:43:12 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-04 11:43:12.304 | INFO     | app.ai.core.claude_client:chat_completion:476 - 🔄 使用直接请求模式(绕过代理重试)
2025-09-04 11:43:21.888 | DEBUG    | app.ai.core.claude_client:_make_request:301 - Claude API请求成功 - Token使用: 918, 响应时间: 9583.73ms
2025-09-04 11:43:21.900 | DEBUG    | app.services.ai_service:_save_usage_stats:949 - AI使用统计 - 用户ID: 6, 实际API成本: $0.008142, 用户计费成本: $0.016284 (2倍计费)
2025-09-04 11:43:21.909 | ERROR    | app.main:websocket_realtime_endpoint:610 - AI聊天处理错误: 
📨 AI服务返回结果: {"content": "\u4f60\u597d\uff01\u6b22\u8fce\u6765\u5230Trademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\uff01\ud83d\ude80\n\n\u6211\u662f\u4f60\u7684\u4e13\u4e1aAI\u91cf\u5316\u4ea4\u6613\u52a9\u624b\uff0c\u5f88\u9ad8\u5174\u4e3a\u4f60\u670d\u52a1\uff01\n\n## \ud83d\udd27 WebSocket\u8fde\u63a5\u6d4b\u8bd5\u6210\u529f \u2705\n\n\u770b\u8d77\u6765\u8fde\u63a5\u72b6\u6001\u826f\u597d\uff01\u6211\u5df2\u7ecf\u51c6\u5907\u597d\u4e3a\u4f60\u63d0\u4f9b\u4ee5\u4e0b\u670d\u52a1\uff1a\n\n### \ud83d\udccb \u621
📤 发送WebSocket响应: {"type": "ai_chat_success", "request_id": "test_645310", "response": "\u4f60\u597d\uff01\u6b22\u8fce\u6765\u5230Trademe\u91cf\u5316\u4ea4\u6613\u5e73\u53f0\uff01\ud83d\ude80\n\n\u6211\u662f\u4f60\u7684\u4e13\u4e1aAI\u91cf\u5316\u4ea4\u6613\u52a9\u624b\uff0c\u5f88\u9ad8\u5174\u4e3a\u4f60\u670d\u52a1\uff01\n\n## \ud83d\udd27 WebSocket\u8fde\u63a5\u6d4b\u8bd5\u6210\u529f \u2705\n\n\u770b\u8d77\u6765\u8fde\u63a5\u72b6\u6001\u826f\u597d\uff01\u6211\u5df2\u7ecf\u51c6\u5907\u597d\u4e3a\u4f60\u63d0\u4f9
❌ 数据库错误: 
WebSocket消息处理错误: Cannot call "send" once a close message has been sent.
❌ WebSocket连接已断开: conn_1756957392287 (用户: 6)
2025-09-04 11:43:31 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957411738
2025-09-04 11:43:31 | uvicorn.error | INFO | connection open
2025-09-04 11:43:32 | uvicorn.error | INFO | connection closed
2025-09-04 11:43:45 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957425149
2025-09-04 11:43:45 | uvicorn.error | INFO | connection open
2025-09-04 11:43:45 | uvicorn.error | INFO | connection closed
2025-09-04 11:45:34 | uvicorn.error | INFO | 43.167.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957534085
2025-09-04 11:45:34 | uvicorn.error | INFO | connection open
WebSocket消息处理错误: (1000, '')
❌ WebSocket连接已断开: conn_1756957534085 (用户: 6)
2025-09-04 11:45:34 | uvicorn.error | INFO | connection closed
2025-09-04 11:45:37 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957537976
2025-09-04 11:45:37 | uvicorn.error | INFO | connection open
2025-09-04 11:45:38 | uvicorn.error | INFO | connection closed
2025-09-04 11:45:50 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957550446
2025-09-04 11:45:50 | uvicorn.error | INFO | connection open
2025-09-04 11:45:50 | uvicorn.error | INFO | connection closed
2025-09-04 11:46:26 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957586188
2025-09-04 11:46:26 | uvicorn.error | INFO | connection open
2025-09-04 11:46:26 | uvicorn.error | INFO | connection closed
2025-09-04 11:46:56 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957616085
2025-09-04 11:46:56 | uvicorn.error | INFO | connection open
2025-09-04 11:46:56 | uvicorn.error | INFO | connection closed
2025-09-04 11:46:58 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957618589
2025-09-04 11:46:58 | uvicorn.error | INFO | connection open
2025-09-04 11:46:59 | uvicorn.error | INFO | connection closed
2025-09-04 11:47:06 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957626639
2025-09-04 11:47:06 | uvicorn.error | INFO | connection open
2025-09-04 11:47:07 | uvicorn.error | INFO | connection closed
2025-09-04 11:47:29 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957649794
2025-09-04 11:47:29 | uvicorn.error | INFO | connection open
2025-09-04 11:47:41.163 | INFO     | app.services.ai_service:chat_completion:173 - 动态上下文优化 - 会话:debug_session_1756957660877, 窗口:10, 策略:default_fallback
🤖 开始调用真实Claude AI服务，用户: 6, 内容: 我要开发一个macd背离策略...
📡 调用AIService.chat_completion...
2025-09-04 11:47:41 | app.services.claude_scheduler_service | INFO | Starting account selection with context: SchedulerContext(user_id=6, request_type='chat', model_name=None, session_id='debug_session_1756957660877', min_quota=Decimal('0.02'), prefer_proxy=False, excluded_accounts=None, priority=100)
2025-09-04 11:47:41 | app.services.claude_scheduler_service | INFO | Query returned 1 raw candidates
2025-09-04 11:47:41 | app.services.claude_scheduler_service | INFO |   - claudetest: status=active, limit=100.00, usage=0.04, remaining=99.96
2025-09-04 11:47:41 | app.services.claude_scheduler_service | INFO | Account claudetest suitable check: True
2025-09-04 11:47:41 | app.services.claude_scheduler_service | INFO | Found 1 suitable candidate accounts after filtering
2025-09-04 11:47:41 | app.services.claude_scheduler_service | INFO | Account selection decision: {
  "timestamp": "2025-09-04T03:47:41.167198",
  "selected_account_id": 1,
  "selected_account_name": "claudetest",
  "score": 99.69333333333333,
  "reasons": [
    "success_rate: 100.0%",
    "remaining_quota: $99.96 (score: 100.0)",
    "response_time: 1694ms (score: 73.5)",
    "last_used_hours: 22.26325945111111 (score: 100.0)"
  ],
  "context": {
    "user_id": 6,
    "request_type": "chat",
    "model_name": null,
    "session_id": "debug_session_1756957660877",
    "priority": 100
  }
}
2025-09-04 11:47:41 | app.services.claude_scheduler_service | INFO | Selected account: claudetest (ID: 1, Score: 99.69)
--- Logging error ---
Traceback (most recent call last):
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 144, in decrypt_private_key
    combined_data = base64.b64decode(encrypted_private_key.encode('utf-8'))
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/base64.py", line 88, in b64decode
    return binascii.a2b_base64(s, strict_mode=validate)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
binascii.Error: Incorrect padding

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'user_id'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'user_id'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/websockets/websockets_impl.py", line 244, in run_asgi
    result = await self.app(self.scope, self.asgi_receive, self.asgi_send)  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 151, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 103, in __call__
    await self.app(scope, receive, send)
  [Previous line repeated 1 more time]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 77, in __call__
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 364, in handle
    await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 97, in app
    await wrap_app_handling_exceptions(app, session)(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/routing.py", line 95, in app
    await func(session)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/routing.py", line 384, in app
    await dependant.call(**solved_result.values)
  File "/root/trademe/backend/trading-service/app/main.py", line 561, in websocket_realtime_endpoint
    result = await AIService.chat_completion(
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 202, in chat_completion
    api_key = await claude_account_service.get_decrypted_api_key(selected_account.id)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 201, in get_decrypted_api_key
    return self._decrypt_sensitive_data(account.api_key)
  File "/root/trademe/backend/trading-service/app/services/claude_account_service.py", line 81, in _decrypt_sensitive_data
    return self.crypto_manager.decrypt_private_key(encrypted_data, additional_context)
  File "/root/trademe/backend/trading-service/app/security/crypto_manager.py", line 172, in decrypt_private_key
    logger.error(f"私钥解密失败: {e}")
Message: '私钥解密失败: Incorrect padding'
Arguments: ()
2025-09-04 11:47:41 | app.services.claude_account_service | ERROR | Failed to decrypt data for : 私钥解密失败: Incorrect padding
2025-09-04 11:47:41 | app.services.claude_account_service | WARNING | Using plaintext API key for account 1 - should be encrypted!
2025-09-04 11:47:41.170 | INFO     | app.ai.core.claude_client:chat_completion:476 - 🔄 使用直接请求模式(绕过代理重试)
2025-09-04 11:48:11 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.928441 seconds
2025-09-04 11:48:42 | anthropic._base_client | INFO | Retrying request to /v1/messages in 1.872816 seconds
2025-09-04 11:48:43 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:48:43.953791", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-04 11:48:43 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:48:43 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:48:43 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-04 11:48:43.955 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:48:43.958 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-04 11:48:43 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 5.1, "timestamp": "2025-09-04T03:48:43.958853"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-04 11:48:44 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:48:44.058523", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "developer"}}
2025-09-04 11:48:44 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:48:44 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:48:44 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-04 11:48:44.059 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:48:44.063 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-04 11:48:44 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 4.98, "timestamp": "2025-09-04T03:48:44.063479"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-04 11:48:45 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/chat/history?session_id=f81b6cba-120b-48cf-9cda-c0659d958931&limit=20", "path": "/api/v1/ai/chat/history", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:48:45.326367", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"session_id": "f81b6cba-120b-48cf-9cda-c0659d958931", "limit": "20"}}
2025-09-04 11:48:45 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:48:45 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:48:45 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/chat/history
2025-09-04 11:48:45.327 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:48:45.330 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-04 11:48:45 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/chat/history", "status_code": 200, "duration": 4.78, "timestamp": "2025-09-04T03:48:45.331103"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/chat/history?session_id=f81b6cba-120b-48cf-9cda-c0659d958931&limit=20', '1.0', 200)
2025-09-04 11:48:46 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756957726381
2025-09-04 11:48:46 | uvicorn.error | INFO | connection open
2025-09-04 11:49:14.078 | WARNING  | app.ai.core.claude_client:_make_request:313 - Claude API超时: Request timed out.
2025-09-04 11:49:26 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/membership/usage-stats", "path": "/api/v1/membership/usage-stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:49:26.706859", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "content-type": "application/json", "referer": "http://43.167.***.***.***/profile"}, "query_params": {}}
2025-09-04 11:49:26 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:49:26 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:49:26 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/membership/usage-stats
2025-09-04 11:49:26.708 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:49:26 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/api-keys/", "path": "/api/v1/api-keys/", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:49:26.710754", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "content-type": "application/json", "referer": "http://43.167.***.***.***/profile"}, "query_params": {}}
2025-09-04 11:49:26 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:49:26 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:49:26 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/api-keys/
2025-09-04 11:49:26.711 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:49:26.722 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.011s
2025-09-04 11:49:26 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/api-keys/", "status_code": 200, "duration": 12.16, "timestamp": "2025-09-04T03:49:26.722900"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/api-keys/', '1.0', 200)
2025-09-04 11:49:26.750 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.042s
2025-09-04 11:49:26 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/membership/usage-stats", "status_code": 200, "duration": 43.77, "timestamp": "2025-09-04T03:49:26.750606"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/membership/usage-stats', '1.0', 200)
2025-09-04 11:49:33 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/trading/live-strategies", "path": "/api/v1/trading/live-strategies", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:49:33.605093", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/strategies"}, "query_params": {}}
2025-09-04 11:49:33 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:49:33 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:49:33 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/trading/live-strategies
2025-09-04 11:49:33.606 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:49:33.609 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-04 11:49:33 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/trading/live-strategies", "status_code": 200, "duration": 4.21, "timestamp": "2025-09-04T03:49:33.609275"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/trading/live-strategies', '1.0', 200)
2025-09-04 11:49:34 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/trading/exchanges", "path": "/api/v1/trading/exchanges", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:49:34.306958", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/trading"}, "query_params": {}}
2025-09-04 11:49:34 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:49:34 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:49:34 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/trading/exchanges
2025-09-04 11:49:34.308 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:49:34.308 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-04 11:49:34 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/trading/exchanges", "status_code": 200, "duration": 2.17, "timestamp": "2025-09-04T03:49:34.309100"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/trading/exchanges', '1.0', 200)
2025-09-04 11:49:34 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/strategies", "path": "/api/v1/strategies", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:49:34.410952", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/trading"}, "query_params": {}}
2025-09-04 11:49:34 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:49:34 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/strategies', '1.0', 400)
2025-09-04 11:49:45 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.782460 seconds
2025-09-04 11:50:15 | anthropic._base_client | INFO | Retrying request to /v1/messages in 1.611556 seconds
2025-09-04 11:50:38 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:38.597213", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "purpose": "prefetch", "referer": "http://43.167.***.***.***/ai-chat", "sec-purpose": "prefetch;prerender"}, "query_params": {"days": "1"}}
2025-09-04 11:50:38 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:38 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:38 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-04 11:50:38.598 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:38 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:38.602170", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "purpose": "prefetch", "referer": "http://43.167.***.***.***/ai-chat", "sec-purpose": "prefetch;prerender"}, "query_params": {"ai_mode": "developer"}}
2025-09-04 11:50:38 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:38 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:38 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-04 11:50:38.603 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:38.605 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.007s
2025-09-04 11:50:38 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 8.46, "timestamp": "2025-09-04T03:50:38.605639"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-04 11:50:38.608 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.005s
2025-09-04 11:50:38 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 6.71, "timestamp": "2025-09-04T03:50:38.608860"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-04 11:50:41 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/admin/users?limit=5", "path": "/api/v1/admin/users", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:41.224581", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/admin"}, "query_params": {"limit": "5"}}
2025-09-04 11:50:41 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:41 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:41 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/admin/users
2025-09-04 11:50:41.225 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:41 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/admin/stats/system", "path": "/api/v1/admin/stats/system", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:41.228999", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/admin"}, "query_params": {}}
2025-09-04 11:50:41 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:41 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:41 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/admin/stats/system
2025-09-04 11:50:41.230 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:41.234 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.009s
2025-09-04 11:50:41 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/admin/users", "status_code": 200, "duration": 10.59, "timestamp": "2025-09-04T03:50:41.235134"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/admin/users?limit=5', '1.0', 200)
2025-09-04 11:50:41.238 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.008s
2025-09-04 11:50:41 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/admin/stats/system", "status_code": 200, "duration": 9.48, "timestamp": "2025-09-04T03:50:41.238291"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/admin/stats/system', '1.0', 200)
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/admin/claude/proxies", "path": "/api/v1/admin/claude/proxies", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:45.895304", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/admin/claude"}, "query_params": {}}
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:45 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:45 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/admin/claude/proxies
2025-09-04 11:50:45.896 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/admin/claude/usage-stats?days=30", "path": "/api/v1/admin/claude/usage-stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:45.902839", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/admin/claude"}, "query_params": {"days": "30"}}
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:45 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:45 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/admin/claude/usage-stats
2025-09-04 11:50:45.904 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/admin/claude/anomaly-detection", "path": "/api/v1/admin/claude/anomaly-detection", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:45.904335", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/admin/claude"}, "query_params": {}}
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:45 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:45 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/admin/claude/anomaly-detection
2025-09-04 11:50:45.906 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/admin/claude/accounts", "path": "/api/v1/admin/claude/accounts", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:45.906855", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/admin/claude"}, "query_params": {}}
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:45 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:45 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/admin/claude/accounts
2025-09-04 11:50:45.909 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:45.911 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.015s
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/admin/claude/proxies", "status_code": 200, "duration": 19.43, "timestamp": "2025-09-04T03:50:45.914703"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/admin/claude/proxies', '1.0', 200)
2025-09-04 11:50:45.925 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.017s
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/admin/claude/accounts", "status_code": 200, "duration": 19.15, "timestamp": "2025-09-04T03:50:45.925991"}
2025-09-04 11:50:45.926 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.020s
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/admin/claude/accounts', '1.0', 200)
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/admin/claude/anomaly-detection", "status_code": 200, "duration": 23.45, "timestamp": "2025-09-04T03:50:45.927751"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/admin/claude/anomaly-detection', '1.0', 200)
2025-09-04 11:50:45.930 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.026s
2025-09-04 11:50:45 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/admin/claude/usage-stats", "status_code": 200, "duration": 27.75, "timestamp": "2025-09-04T03:50:45.930558"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/admin/claude/usage-stats?days=30', '1.0', 200)
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/admin/users/", "path": "/api/v1/admin/users/", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:46.004072", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/admin/claude"}, "query_params": {}}
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:46 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:46 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/admin/users/
2025-09-04 11:50:46.005 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:46.010 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.005s
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/admin/users/", "status_code": 200, "duration": 6.38, "timestamp": "2025-09-04T03:50:46.010426"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/admin/users/', '1.0', 200)
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/admin/claude/users-detailed-stats", "path": "/api/v1/admin/claude/users-detailed-stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:46.012800", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/admin/claude"}, "query_params": {}}
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:46 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:46 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/admin/claude/users-detailed-stats
2025-09-04 11:50:46.013 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:46 | app.api.v1.admin.claude | ERROR | 获取用户详细统计失败: (sqlite3.OperationalError) no such column: cl.tokens_input
[SQL: 
            SELECT 
                u.id as user_id,
                u.username,
                u.email,
                u.membership_level,
                u.is_active,
                u.last_login_at,
                COALESCE(SUM(cl.tokens_input + cl.tokens_output), 0) as total_tokens,
                COALESCE(COUNT(cl.id), 0) as total_requests,
                COALESCE(SUM(cl.api_cost), 0.0) as total_cost,
                MAX(cl.request_date) as last_usage_date
            FROM users u
            LEFT JOIN claude_usage_logs cl ON u.id = cl.user_id
            WHERE u.id IS NOT NULL
            GROUP BY u.id, u.username, u.email, u.membership_level, u.is_active, u.last_login_at
            ORDER BY total_cost DESC, total_requests DESC
            LIMIT 50
        ]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-09-04 11:50:46.017 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/admin/claude/users-detailed-stats", "status_code": 200, "duration": 4.44, "timestamp": "2025-09-04T03:50:46.017221"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/admin/claude/users-detailed-stats', '1.0', 200)
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/anthropic-accounts/", "path": "/api/v1/anthropic-accounts/", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:50:46.172687", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/admin/claude"}, "query_params": {}}
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:50:46 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:50:46 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/anthropic-accounts/
2025-09-04 11:50:46.175 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:50:46 | app.api.v1.anthropic_accounts | INFO | 📋 Listed 0 Anthropic Setup Token accounts
2025-09-04 11:50:46.180 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.006s
2025-09-04 11:50:46 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/anthropic-accounts/", "status_code": 200, "duration": 7.94, "timestamp": "2025-09-04T03:50:46.180600"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/anthropic-accounts/', '1.0', 200)
2025-09-04 11:50:47.576 | WARNING  | app.ai.core.claude_client:_make_request:313 - Claude API超时: Request timed out.
2025-09-04 11:51:18 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.847603 seconds
2025-09-04 11:51:29 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:51:29.342556", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-04 11:51:29 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:51:29 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:51:29 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-04 11:51:29.344 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:51:29.347 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-04 11:51:29 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 5.09, "timestamp": "2025-09-04T03:51:29.347616"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
2025-09-04 11:51:29 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:51:29.350007", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "developer"}}
2025-09-04 11:51:29 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:51:29 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:51:29 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-04 11:51:29.351 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:51:29.353 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.003s
2025-09-04 11:51:29 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 3.88, "timestamp": "2025-09-04T03:51:29.353866"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-04 11:51:49 | anthropic._base_client | INFO | Retrying request to /v1/messages in 1.707881 seconds
2025-09-04 11:52:21.233 | WARNING  | app.ai.core.claude_client:_make_request:313 - Claude API超时: Request timed out.
2025-09-04 11:52:52 | anthropic._base_client | INFO | Retrying request to /v1/messages in 0.785417 seconds
2025-09-04 11:53:23 | anthropic._base_client | INFO | Retrying request to /v1/messages in 1.998974 seconds
2025-09-04 11:53:55.124 | WARNING  | app.ai.core.claude_client:_make_request:313 - Claude API超时: Request timed out.
2025-09-04 11:53:55.124 | ERROR    | app.ai.core.claude_client:chat_completion:494 - 聊天完成失败: Request timed out.
📨 AI服务返回结果: {"content": "\u62b1\u6b49\uff0cAI\u670d\u52a1\u6682\u65f6\u4e0d\u53ef\u7528: Request timed out.", "session_id": "debug_session_1756957660877", "tokens_used": 0, "model": "claude-sonnet-4-20250514", "success": false, "requires_strategy_generation": false}
❌ AI服务失败: 抱歉，AI服务暂时不可用: Request timed out.
WebSocket消息处理错误: (1001, '')
❌ WebSocket连接已断开: conn_1756957649794 (用户: 6)
2025-09-04 11:54:39 | uvicorn.error | INFO | connection closed
2025-09-04 11:55:25 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/strategies", "path": "/api/v1/strategies", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:55:25.063664", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/trading"}, "query_params": {}}
2025-09-04 11:55:25 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:55:25 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/strategies', '1.0', 400)
2025-09-04 11:55:25 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/trading/exchanges", "path": "/api/v1/trading/exchanges", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:55:25.074067", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/trading"}, "query_params": {}}
2025-09-04 11:55:25 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:55:25 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:55:25 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/trading/exchanges
2025-09-04 11:55:25.075 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:55:25.076 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.001s
2025-09-04 11:55:25 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/trading/exchanges", "status_code": 200, "duration": 2.17, "timestamp": "2025-09-04T03:55:25.076211"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/trading/exchanges', '1.0', 200)
2025-09-04 11:55:30 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/trading/live-strategies", "path": "/api/v1/trading/live-strategies", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:55:30.488099", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/strategies"}, "query_params": {}}
2025-09-04 11:55:30 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:55:30 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:55:30 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/trading/live-strategies
2025-09-04 11:55:30.489 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:55:30.491 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.002s
2025-09-04 11:55:30 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/trading/live-strategies", "status_code": 200, "duration": 3.87, "timestamp": "2025-09-04T03:55:30.491941"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/trading/live-strategies', '1.0', 200)
2025-09-04 11:55:31 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/trading-notes/?page=1&page_size=10", "path": "/api/v1/trading-notes/", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:55:31.705179", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/trading-notes"}, "query_params": {"page": "1", "page_size": "10"}}
2025-09-04 11:55:31 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:55:31 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:55:31 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/trading-notes/
2025-09-04 11:55:31.708 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:55:31 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/trading-notes/stats/summary", "path": "/api/v1/trading-notes/stats/summary", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:55:31.710302", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/trading-notes"}, "query_params": {}}
2025-09-04 11:55:31 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:55:31 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:55:31 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/trading-notes/stats/summary
2025-09-04 11:55:31.711 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:55:31.721 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.013s
2025-09-04 11:55:31 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/trading-notes/", "status_code": 200, "duration": 16.27, "timestamp": "2025-09-04T03:55:31.721430"}
2025-09-04 11:55:31.721 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.010s
2025-09-04 11:55:31 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/trading-notes/stats/summary", "status_code": 200, "duration": 11.74, "timestamp": "2025-09-04T03:55:31.722017"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/trading-notes/?page=1&page_size=10', '1.0', 200)
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/trading-notes/stats/summary', '1.0', 200)
2025-09-04 11:55:32 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/membership/usage-stats", "path": "/api/v1/membership/usage-stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:55:32.820661", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "content-type": "application/json", "referer": "http://43.167.***.***.***/profile"}, "query_params": {}}
2025-09-04 11:55:32 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:55:32 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:55:32 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/membership/usage-stats
2025-09-04 11:55:32.821 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:55:32 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/api-keys/", "path": "/api/v1/api-keys/", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:55:32.822106", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "*/*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "content-type": "application/json", "referer": "http://43.167.***.***.***/profile"}, "query_params": {}}
2025-09-04 11:55:32 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:55:32 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:55:32 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/api-keys/
2025-09-04 11:55:32.824 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:55:32.828 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-04 11:55:32 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/api-keys/", "status_code": 200, "duration": 6.15, "timestamp": "2025-09-04T03:55:32.828249"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/api-keys/', '1.0', 200)
2025-09-04 11:55:32.835 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.014s
2025-09-04 11:55:32 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/membership/usage-stats", "status_code": 200, "duration": 15.03, "timestamp": "2025-09-04T03:55:32.835664"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/membership/usage-stats', '1.0', 200)
2025-09-04 11:55:34 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/usage/stats?days=1", "path": "/api/v1/ai/usage/stats", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:55:34.559809", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"days": "1"}}
2025-09-04 11:55:34 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:55:34 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:55:34 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/usage/stats
2025-09-04 11:55:34.561 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:55:34 | app.middleware.api_validation_middleware | INFO | API请求: {"method": "GET", "url": "http://43.167.***.***.***/api/v1/ai/sessions?ai_mode=developer", "path": "/api/v1/ai/sessions", "client_ip": "208.87.***.***.***", "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "timestamp": "2025-09-04T03:55:34.561364", "headers": {"host": "43.167.***.***.***", "x-real-ip": "208.87.***.***.***", "x-forwarded-for": "208.87.***.***.***", "x-forwarded-proto": "http", "connection": "close", "user-agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.***.***.*** Safari/537.36", "accept": "application/json, text/plain, */*", "accept-encoding": "gzip, deflate", "accept-language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "authorization": "Bearer eyJhbGciOi...aN7wFI", "referer": "http://43.167.***.***.***/ai-chat"}, "query_params": {"ai_mode": "developer"}}
2025-09-04 11:55:34 | app.middleware.api_validation_middleware | ERROR | 安全检查失败: name 're' is not defined
2025-09-04 11:55:34 | app.services.integrated_cache_manager | WARNING | 缓存管理器尚未初始化
2025-09-04 11:55:34 | app.services.api_validation_service | WARNING | 端点验证配置不存在: /api/v1/ai/sessions
2025-09-04 11:55:34.563 | INFO     | app.middleware.structured_logging:log_request_start:139 - Request started
2025-09-04 11:55:34.567 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.004s
2025-09-04 11:55:34 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/sessions", "status_code": 200, "duration": 6.06, "timestamp": "2025-09-04T03:55:34.567415"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/sessions?ai_mode=developer', '1.0', 200)
2025-09-04 11:55:34.569 | INFO     | app.middleware.structured_logging:log_request_end:181 - Request completed in 0.009s
2025-09-04 11:55:34 | app.middleware.api_validation_middleware | INFO | API响应: {"method": "GET", "path": "/api/v1/ai/usage/stats", "status_code": 200, "duration": 10.04, "timestamp": "2025-09-04T03:55:34.569819"}
--- Logging error ---
Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/__init__.py", line 464, in format
    return self._format(record)
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 460, in _format
    return self._fmt % values
           ~~~~~~~~~~^~~~~~~~
KeyError: 'duration'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.12/logging/handlers.py", line 73, in emit
    if self.shouldRollover(record):
       ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/handlers.py", line 196, in shouldRollover
    msg = "%s\n" % self.format(record)
                   ^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 999, in format
    return fmt.format(record)
           ^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 706, in format
    s = self.formatMessage(record)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 675, in formatMessage
    return self._style.format(record)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/logging/__init__.py", line 466, in format
    raise ValueError('Formatting field not found in record: %s' % e)
ValueError: Formatting field not found in record: 'duration'
Call stack:
  File "<string>", line 1, in <module>
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 185, in __call__
    await response(scope, wrapped_receive, send)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 214, in __call__
    await send(
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 161, in _send
    await send(message)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 476, in send
    self.access_logger.info(
Message: '%s - "%s %s HTTP/%s" %d'
Arguments: ('208.87.243.197:0', 'GET', '/api/v1/ai/usage/stats?days=1', '1.0', 200)
WARNING:  WatchFiles detected changes in 'app/api/v1/ai_websocket.py'. Reloading...
2025-09-04 11:57:20 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756957726381 (用户: 6)
2025-09-04 11:57:20 | uvicorn.error | INFO | connection closed
2025-09-04 11:57:20 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-04 11:57:20 | uvicorn.error | INFO | Application shutdown complete.
2025-09-04 11:57:20 | uvicorn.error | INFO | Finished server process [3259005]
2025-09-04 11:57:22.860 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-04 11:57:22.881 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-04 11:57:22.881 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-04 11:57:22.882 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-04 11:57:23.366 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
Process SpawnProcess-10:
Traceback (most recent call last):
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 78, in _serve
    config.load()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/config.py", line 436, in load
    self.loaded_app = import_from_string(self.app)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/importlib/__init__.py", line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/root/trademe/backend/trading-service/app/main.py", line 28, in <module>
    from app.api.v1 import api_router
  File "/root/trademe/backend/trading-service/app/api/v1/__init__.py", line 46, in <module>
    from .ai_websocket import router as ai_websocket_router
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 297, in <module>
    ai_websocket_handler = AIWebSocketHandler(None)
                           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 34, in __init__
    self.ai_service = UnifiedProxyAIService()
                      ^^^^^^^^^^^^^^^^^^^^^
NameError: name 'UnifiedProxyAIService' is not defined
WARNING:  WatchFiles detected changes in 'app/api/v1/ai_websocket.py'. Reloading...
2025-09-04 11:57:27.887 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-04 11:57:27.910 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-04 11:57:27.910 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-04 11:57:27.910 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-04 11:57:28.397 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-04 11:57:28 | uvicorn.error | INFO | Started server process [3664918]
2025-09-04 11:57:28 | uvicorn.error | INFO | Waiting for application startup.
2025-09-04 11:57:28 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-04 11:57:28 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-04 11:57:28 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-04 11:57:28 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-04 11:57:28 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-04 11:57:28 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-04 11:57:28 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-04 11:57:28 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-04 11:57:28 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-04 11:57:29 | uvicorn.error | INFO | Application startup complete.
2025-09-04 11:57:29 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756958249136
2025-09-04 11:57:29 | uvicorn.error | INFO | connection open
WARNING:  WatchFiles detected changes in 'app/api/v1/ai_websocket.py'. Reloading...
2025-09-04 11:57:37 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756958249136 (用户: 6)
2025-09-04 11:57:37 | uvicorn.error | INFO | connection closed
2025-09-04 11:57:37 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-04 11:57:37 | uvicorn.error | INFO | Application shutdown complete.
2025-09-04 11:57:37 | uvicorn.error | INFO | Finished server process [3664918]
2025-09-04 11:57:39.360 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-04 11:57:39.382 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-04 11:57:39.382 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-04 11:57:39.382 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-04 11:57:39.866 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-04 11:57:40 | uvicorn.error | INFO | Started server process [3665020]
2025-09-04 11:57:40 | uvicorn.error | INFO | Waiting for application startup.
2025-09-04 11:57:40 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-04 11:57:40 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-04 11:57:40 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-04 11:57:40 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-04 11:57:40 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-04 11:57:40 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-04 11:57:40 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-04 11:57:40 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-04 11:57:40 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-04 11:57:40 | uvicorn.error | INFO | Application startup complete.
2025-09-04 11:57:40 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756958260808
2025-09-04 11:57:40 | uvicorn.error | INFO | connection open
WARNING:  WatchFiles detected changes in 'app/api/v1/ai_websocket.py'. Reloading...
2025-09-04 11:58:30 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756958260808 (用户: 6)
2025-09-04 11:58:30 | uvicorn.error | INFO | connection closed
2025-09-04 11:58:30 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-04 11:58:30 | uvicorn.error | INFO | Application shutdown complete.
2025-09-04 11:58:30 | uvicorn.error | INFO | Finished server process [3665020]
2025-09-04 11:58:32.810 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-04 11:58:32.832 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-04 11:58:32.833 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-04 11:58:32.833 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-04 11:58:33.316 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
Process SpawnProcess-13:
Traceback (most recent call last):
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 78, in _serve
    config.load()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/config.py", line 436, in load
    self.loaded_app = import_from_string(self.app)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/importlib/__init__.py", line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/root/trademe/backend/trading-service/app/main.py", line 28, in <module>
    from app.api.v1 import api_router
  File "/root/trademe/backend/trading-service/app/api/v1/__init__.py", line 46, in <module>
    from .ai_websocket import router as ai_websocket_router
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 296, in <module>
    ai_websocket_handler = AIWebSocketHandler(None)
                           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/app/api/v1/ai_websocket.py", line 33, in __init__
    self.ai_service = SimplifiedAIService()
                      ^^^^^^^^^^^^^^^^^^^
NameError: name 'SimplifiedAIService' is not defined
WARNING:  WatchFiles detected changes in 'app/api/v1/ai_websocket.py'. Reloading...
2025-09-04 11:58:38.032 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-04 11:58:38.055 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-04 11:58:38.055 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-04 11:58:38.055 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-04 11:58:38.540 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-04 11:58:39 | uvicorn.error | INFO | Started server process [3665405]
2025-09-04 11:58:39 | uvicorn.error | INFO | Waiting for application startup.
2025-09-04 11:58:39 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-04 11:58:39 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-04 11:58:39 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-04 11:58:39 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-04 11:58:39 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-04 11:58:39 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-04 11:58:39 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-04 11:58:39 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-04 11:58:39 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-04 11:58:39 | uvicorn.error | INFO | Application startup complete.
2025-09-04 11:58:39 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756958319207
2025-09-04 11:58:39 | uvicorn.error | INFO | connection open
WARNING:  WatchFiles detected changes in 'app/api/v1/ai_websocket.py'. Reloading...
2025-09-04 11:58:42 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756958319207 (用户: 6)
2025-09-04 11:58:42 | uvicorn.error | INFO | connection closed
2025-09-04 11:58:42 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-04 11:58:42 | uvicorn.error | INFO | Application shutdown complete.
2025-09-04 11:58:42 | uvicorn.error | INFO | Finished server process [3665405]
2025-09-04 11:58:44.300 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-04 11:58:44.320 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-04 11:58:44.320 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-04 11:58:44.320 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
2025-09-04 11:58:44.807 | INFO     | app.services.okx_service:__init__:116 - 🚀 OKX交易服务初始化完成
INFO:app.services.wallet_generator:多链钱包生成器初始化完成
INFO:app.security.crypto_manager:加密管理器初始化完成
✅ 使用logging.yaml配置文件
✅ API验证中间件集成成功
2025-09-04 11:58:45 | uvicorn.error | INFO | Started server process [3665484]
2025-09-04 11:58:45 | uvicorn.error | INFO | Waiting for application startup.
2025-09-04 11:58:45 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/register, 字段数: 2
2025-09-04 11:58:45 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/auth/login, 字段数: 2
2025-09-04 11:58:45 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/trading/orders, 字段数: 5
2025-09-04 11:58:45 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/strategies, 字段数: 3
2025-09-04 11:58:45 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/ai/chat, 字段数: 3
2025-09-04 11:58:45 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/market-data/klines, 字段数: 3
2025-09-04 11:58:45 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/backtest, 字段数: 5
2025-09-04 11:58:45 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/wallet/transfer, 字段数: 3
2025-09-04 11:58:45 | app.services.api_validation_service | INFO | 注册端点验证配置: /api/v1/data/download, 字段数: 5
✅ 数据库初始化成功
📋 包含的表：用户、策略、回测、交易、API密钥、市场数据、Claude对话、交易心得
📋 管理后台表：管理员、Claude代理池、USDT支付、数据采集
✅ Redis连接成功
🔑 OKX API认证成功，已连接到真实交易接口
🚀 Trading Service 启动成功
📊 环境: development
🏠 Host: 0.0.0.0:8001
2025-09-04 11:58:45 | uvicorn.error | INFO | Application startup complete.
2025-09-04 11:58:45 | uvicorn.error | INFO | 208.87.***.***.***:0 - "WebSocket /ws/realtime" [accepted]
🔌 WebSocket连接请求: conn_1756958325784
2025-09-04 11:58:45 | uvicorn.error | INFO | connection open
WARNING:  WatchFiles detected changes in 'app/services/simplified_ai_service.py'. Reloading...
2025-09-04 11:58:53 | uvicorn.error | INFO | Shutting down
WebSocket消息处理错误: (1012, None)
❌ WebSocket连接已断开: conn_1756958325784 (用户: 6)
2025-09-04 11:58:53 | uvicorn.error | INFO | connection closed
2025-09-04 11:58:54 | uvicorn.error | INFO | Waiting for application shutdown.
✅ 数据库连接已关闭
✅ Redis连接已关闭
👋 Trading Service 已关闭
2025-09-04 11:58:54 | uvicorn.error | INFO | Application shutdown complete.
2025-09-04 11:58:54 | uvicorn.error | INFO | Finished server process [3665484]
2025-09-04 11:58:56.003 | INFO     | app.ai.core.claude_client:__init__:114 - 使用自定义Claude API端点: https://claude.cloudcdn7.com/api
2025-09-04 11:58:56.026 | INFO     | app.ai.core.claude_client:__init__:118 - Claude客户端初始化成功
2025-09-04 11:58:56.026 | INFO     | app.ai.core.claude_client:_init_proxy_manager:156 - ✅ 代理重试管理器已初始化
2025-09-04 11:58:56.026 | INFO     | app.ai.core.claude_client:__init__:138 - Claude客户端初始化完成 - 模型: claude-sonnet-4-20250514, 启用状态: True
Process SpawnProcess-16:
Traceback (most recent call last):
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 71, in serve
    await self._serve(sockets)
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/server.py", line 78, in _serve
    config.load()
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/config.py", line 436, in load
    self.loaded_app = import_from_string(self.app)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/importer.py", line 22, in import_from_string
    raise exc from None
  File "/root/trademe/backend/trading-service/venv/lib/python3.12/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/importlib/__init__.py", line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/root/trademe/backend/trading-service/app/main.py", line 28, in <module>
    from app.api.v1 import api_router
  File "/root/trademe/backend/trading-service/app/api/v1/__init__.py", line 15, in <module>
    from .ai import router as ai_router
  File "/root/trademe/backend/trading-service/app/api/v1/ai.py", line 22, in <module>
    from app.services.ai_service import AIService
  File "/root/trademe/backend/trading-service/app/services/ai_service.py", line 27, in <module>
    from app.services.dynamic_context_manager import dynamic_context_manager
  File "/root/trademe/backend/trading-service/app/services/dynamic_context_manager.py", line 19, in <module>
    from app.services.context_summarizer_service import context_summarizer
  File "/root/trademe/backend/trading-service/app/services/context_summarizer_service.py", line 17, in <module>
    from app.services.simplified_ai_service import UnifiedProxyAIService
ModuleNotFoundError: No module named 'app.services.simplified_ai_service'
INFO:     Stopping reloader process [3246150]
