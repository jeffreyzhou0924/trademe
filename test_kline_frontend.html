<!DOCTYPE html>
<html>
<head>
    <title>çœŸå®Kçº¿æ•°æ®æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <h1>çœŸå®Kçº¿æ•°æ®æµ‹è¯•</h1>
    <button onclick="testKlineData()">æµ‹è¯•è·å–BTC/USDTæ•°æ®</button>
    <div id="result"></div>
    <div id="chart" style="width: 800px; height: 400px; margin-top: 20px;"></div>

    <script>
        async function testKlineData() {
            try {
                console.log('ğŸ§ª å¼€å§‹æµ‹è¯•Kçº¿æ•°æ®API...')
                
                const apiUrl = `http://43.167.252.120/klines/BTC/USDT?exchange=okx&timeframe=1h&limit=20`
                console.log('ğŸ“¡ è¯·æ±‚URL:', apiUrl)
                
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                
                console.log('ğŸ“Š å“åº”çŠ¶æ€:', response.status, response.statusText)
                
                if (response.ok) {
                    const data = await response.json()
                    console.log('âœ… æˆåŠŸè·å–æ•°æ®:', data)
                    
                    document.getElementById('result').innerHTML = `
                        <h3>âœ… æˆåŠŸè·å–${data.count}æ¡çœŸå®Kçº¿æ•°æ®</h3>
                        <p>äº¤æ˜“å¯¹: ${data.symbol}</p>
                        <p>æœ€æ–°ä»·æ ¼: ${data.klines[data.klines.length-1][4]} USDT</p>
                        <p>æ•°æ®æ—¶é—´: ${new Date(data.klines[data.klines.length-1][0]).toLocaleString()}</p>
                    `
                    
                    // ç»˜åˆ¶å›¾è¡¨
                    drawChart(data.klines)
                } else {
                    const errorText = await response.text()
                    console.error('âŒ APIé”™è¯¯:', errorText)
                    document.getElementById('result').innerHTML = `<h3>âŒ APIé”™è¯¯: ${response.status}</h3><p>${errorText}</p>`
                }
            } catch (error) {
                console.error('âŒ ç½‘ç»œé”™è¯¯:', error)
                document.getElementById('result').innerHTML = `<h3>âŒ ç½‘ç»œé”™è¯¯</h3><p>${error.message}</p>`
            }
        }
        
        function drawChart(klineData) {
            const chart = echarts.init(document.getElementById('chart'))
            
            const option = {
                title: { text: 'BTC/USDT çœŸå®Kçº¿å›¾' },
                xAxis: {
                    type: 'category',
                    data: klineData.map(k => {
                        const date = new Date(k[0])
                        return `${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`
                    })
                },
                yAxis: { scale: true },
                series: [{
                    name: 'Kçº¿',
                    type: 'candlestick',
                    data: klineData.map(k => [k[1], k[4], k[3], k[2]]), // [open, close, low, high]
                    itemStyle: {
                        color: '#00da3c',
                        color0: '#ec0000',
                        borderColor: '#00da3c',
                        borderColor0: '#ec0000'
                    }
                }]
            }
            
            chart.setOption(option)
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨æµ‹è¯•
        window.onload = () => {
            setTimeout(testKlineData, 1000)
        }
    </script>
</body>
</html>